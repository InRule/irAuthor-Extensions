<!DOCTYPE HTML>
<!DOCTYPE html PUBLIC "" ""><!-- saved from url=(0014)about:internet --><HTML>
    <HEAD>
        <meta http-equiv='Content-Type' content='text/html;charset=UTF-8'>
        <META 
content="IE=11.0000" http-equiv="X-UA-Compatible">

<META http-equiv="X-UA-Compatible" content="IE=11.0000">      
<META charset="utf-8">         <TITLE>InRule RuleApp Flow Visualizer</TITLE>     

<STYLE>
    #main {
	padding-left: 20px;
}
.treed__item {
	list-style: none; border-radius: 10px; padding-left: 20px; position: relative;
}
.treed__body {
	border-radius: 10px; border: 1px solid transparent; border-image: none;
}
.collapsed.treed__item .treed__body {
	
}
.selected.treed__item .treed__head .treed__body {
	background-color: rgb(210, 246, 255);
}
.active.treed__item > .treed__head .treed__body {
	background-color: rgb(170, 255, 204);
}
.collapsed.treed__item > .treed__children {
	display: none;
}
.treed__item--parent {
	
}
.treed__collapser {
	display: none; position: relative; cursor: pointer;
}
.treed__item--parent > .treed__head .treed__collapser {
	display: block;
}
.treed__collapser::before {
	left: 6px; top: -1px; font-family: monospace; font-size: 20px; font-weight: bold; position: absolute; cursor: pointer; content: "-";
}
.collapsed.treed__item .treed__collapser::before {
	content: "+";
}
.treed__children {
	margin: 0px; padding: 0px;
}
.treed__body {
	padding-left: 20px; display: flex; min-height: 20px; flex-direction: column;
}
.treed__head:hover .treed__body {
	border-radius: 10px; background-color: rgb(204, 204, 204);
}
.treed__head {
	position: relative;
}
.treed__default-node--done {
	color: rgb(119, 119, 119); text-decoration: line-through;
}
.treed__default-node--done input {
	color: rgb(119, 119, 119); text-decoration: line-through;
}
.treed__input {
	margin: 0px; padding: 3px 7px; border-radius: 10px; border: currentColor; border-image: none; font-family: sans-serif; font-size: 16px; display: block;
}
.treed__input {
	white-space: pre-wrap;
}
.treed__input:focus {
	
}
.treed__text > p {
	margin: 0px;
}
.treed__input:focus {
	
}
.treed__text {
	padding: 3px 7px; font-family: sans-serif; font-size: 16px; display: block; min-height: 18px;
}
.treed__input {
	padding: 3px 7px; font-family: sans-serif; font-size: 16px; display: block; min-height: 18px;
}
.treed__input div {
	margin: 0px; padding: 0px; display: block; min-height: 18px;
}
.treed__mover {
	padding: 3px 5px; top: 0px; right: 2px; display: none; position: absolute; cursor: move;
}
.treed__mover::before {
	padding: 0px 3px; font-size: 17px; content: "\2195";
}
.treed__head:hover .treed__mover {
	display: block;
}
.treed__drop-shadow {
	position: fixed; opacity: 0.2; background-color: black;
}
.moving.treed__item {
	opacity: 0.5; background-color: rgb(238, 238, 238);
}
.moving.treed .treed__head:hover {
	background-color: transparent;
}
.moving.treed .treed__head:hover .treed__mover {
	display: none;
}
.moving.treed .treed__head:hover .treed__body {
	background-color: transparent;
}

/*begin index.css*/

body {
  text-align: left;
}

h1 {
  font-family: monospace;
  font-size: 60px;
  margin-bottom: 10px;
}

.features {
  list-style: none;
  margin: 0;
  padding: 0;
}

.features li {
  padding: 4px 0;
  font-size: 16px;
  font-weight: bold;
  font-family: monospace;
}

#bindings td.binding {
  font-family: monospace;
  font-weight: bold;
}

#bindings {
  text-align: left;
  width: 400px;
  margin: 0 auto;
  border: 1px solid #ccc;
  border-collapse: collapse;
  margin-top: 15px;
  margin-bottom: 20px;
}

#bindings th {
  text-align: center;

}
#bindings td {
  border: 1px solid #ccc;
  padding: 6px 10px;
  font-family: "arial";
  font-size: 16px;
}

#example {
  display: flexbox;
  /*max-width: 1800px;*/
  margin: 0 auto;
}

#d3view {
  overflow-x: auto;
  height: auto;
}

#editme {
  text-align: left;
  width: 600px;
  border-right: 1px solid #ccc;
  padding-right: 10px;
}

.explanation {
  width: 500px;
  margin: 20px auto;
}

body {
  font-family: sans-serif;
}

.node {
  cursor: pointer;
}

.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 1.5px;
}

.node text {
  font: 14px sans-serif;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1.5px;
}

#editme {
  float: left;
  height: auto;
  overflow: auto;
}

#other-demos {
  position: absolute;
  top: 0;
  left: 10px;
}

#other-demos img {
  width: 300px;
  border: 1px solid #ccc;
  margin: 10px 0;
  display: block;
  position: relative;
  left: 0;
  transition: left .2s ease;
}

#other-demos img:hover {
  left: 10px;
}

@media (max-width: 600px) {
  #other-demos {
    position: static;
  }
}


/** email stuff **/

#main {
  position: relative;
}

.news-text {
  text-align: left;
  padding: 0 30px;
}

#news-banner {
  background-color: #eee;
  margin: 20px auto 0;
  max-width: 900px;
  padding: 10px;
  border-radius: 15px;
}

#mc_embed_signup {
  background-color: transparent;
}

#mc_embed_signup input.button,
#mc_embed_signup input.email {
  display: inline;
}

/*end index.css*/
</STYLE>
 
<META name="GENERATOR" content="MSHTML 11.00.9600.18036"></HEAD>   
<BODY>
<!--     <input type="text" id="txtMessage" />
    <input type="button" value="InvokeMe" onclick="javascript: window.external.InvokeMeFromJavascript(document.getElementById('txtMessage').value);" />-->
<DIV id="example"><!--<div id="editme"></div>-->         
<DIV id="d3view"></DIV></DIV>
<SCRIPT>
    !function () {
        function n(n, t) { return t > n ? -1 : n > t ? 1 : n >= t ? 0 : 0 / 0 } function t(n) { return null != n && !isNaN(n) } function e(n) { return { left: function (t, e, r, u) { for (arguments.length < 3 && (r = 0), arguments.length < 4 && (u = t.length) ; u > r;) { var i = r + u >>> 1; n(t[i], e) < 0 ? r = i + 1 : u = i } return r }, right: function (t, e, r, u) { for (arguments.length < 3 && (r = 0), arguments.length < 4 && (u = t.length) ; u > r;) { var i = r + u >>> 1; n(t[i], e) > 0 ? u = i : r = i + 1 } return r } } } function r(n) { return n.length } function u(n) { for (var t = 1; n * t % 1;) t *= 10; return t } function i(n, t) { try { for (var e in t) Object.defineProperty(n.prototype, e, { value: t[e], enumerable: !1 }) } catch (r) { n.prototype = t } } function o() { } function a(n) { return ha + n in this } function c(n) { return n = ha + n, n in this && delete this[n] } function s() { var n = []; return this.forEach(function (t) { n.push(t) }), n } function l() { var n = 0; for (var t in this) t.charCodeAt(0) === ga && ++n; return n } function f() { for (var n in this) if (n.charCodeAt(0) === ga) return !1; return !0 } function h() { } function g(n, t, e) { return function () { var r = e.apply(t, arguments); return r === t ? n : r } } function p(n, t) { if (t in n) return t; t = t.charAt(0).toUpperCase() + t.substring(1); for (var e = 0, r = pa.length; r > e; ++e) { var u = pa[e] + t; if (u in n) return u } } function v() { } function d() { } function m(n) { function t() { for (var t, r = e, u = -1, i = r.length; ++u < i;) (t = r[u].on) && t.apply(this, arguments); return n } var e = [], r = new o; return t.on = function (t, u) { var i, o = r.get(t); return arguments.length < 2 ? o && o.on : (o && (o.on = null, e = e.slice(0, i = e.indexOf(o)).concat(e.slice(i + 1)), r.remove(t)), u && e.push(r.set(t, { on: u })), n) }, t } function y() { Go.event.preventDefault() } function x() { for (var n, t = Go.event; n = t.sourceEvent;) t = n; return t } function M(n) { for (var t = new d, e = 0, r = arguments.length; ++e < r;) t[arguments[e]] = m(t); return t.of = function (e, r) { return function (u) { try { var i = u.sourceEvent = Go.event; u.target = n, Go.event = u, t[u.type].apply(e, r) } finally { Go.event = i } } }, t } function _(n) { return da(n, _a), n } function b(n) { return "function" == typeof n ? n : function () { return ma(n, this) } } function w(n) { return "function" == typeof n ? n : function () { return ya(n, this) } } function S(n, t) { function e() { this.removeAttribute(n) } function r() { this.removeAttributeNS(n.space, n.local) } function u() { this.setAttribute(n, t) } function i() { this.setAttributeNS(n.space, n.local, t) } function o() { var e = t.apply(this, arguments); null == e ? this.removeAttribute(n) : this.setAttribute(n, e) } function a() { var e = t.apply(this, arguments); null == e ? this.removeAttributeNS(n.space, n.local) : this.setAttributeNS(n.space, n.local, e) } return n = Go.ns.qualify(n), null == t ? n.local ? r : e : "function" == typeof t ? n.local ? a : o : n.local ? i : u } function k(n) { return n.trim().replace(/\s+/g, " ") } function E(n) { return new RegExp("(?:^|\\s+)" + Go.requote(n) + "(?:\\s+|$)", "g") } function N(n) { return n.trim().split(/^|\s+/) } function A(n, t) { function e() { for (var e = -1; ++e < u;) n[e](this, t) } function r() { for (var e = -1, r = t.apply(this, arguments) ; ++e < u;) n[e](this, r) } n = N(n).map(C); var u = n.length; return "function" == typeof t ? r : e } function C(n) { var t = E(n); return function (e, r) { if (u = e.classList) return r ? u.add(n) : u.remove(n); var u = e.getAttribute("class") || ""; r ? (t.lastIndex = 0, t.test(u) || e.setAttribute("class", k(u + " " + n))) : e.setAttribute("class", k(u.replace(t, " "))) } } function L(n, t, e) { function r() { this.style.removeProperty(n) } function u() { this.style.setProperty(n, t, e) } function i() { var r = t.apply(this, arguments); null == r ? this.style.removeProperty(n) : this.style.setProperty(n, r, e) } return null == t ? r : "function" == typeof t ? i : u } function T(n, t) { function e() { delete this[n] } function r() { this[n] = t } function u() { var e = t.apply(this, arguments); null == e ? delete this[n] : this[n] = e } return null == t ? e : "function" == typeof t ? u : r } function q(n) { return "function" == typeof n ? n : (n = Go.ns.qualify(n)).local ? function () { return this.ownerDocument.createElementNS(n.space, n.local) } : function () { return this.ownerDocument.createElementNS(this.namespaceURI, n) } } function z(n) { return { __data__: n } } function R(n) { return function () { return Ma(this, n) } } function D(t) { return arguments.length || (t = n), function (n, e) { return n && e ? t(n.__data__, e.__data__) : !n - !e } } function P(n, t) { for (var e = 0, r = n.length; r > e; e++) for (var u, i = n[e], o = 0, a = i.length; a > o; o++) (u = i[o]) && t(u, o, e); return n } function U(n) { return da(n, wa), n } function j(n) { var t, e; return function (r, u, i) { var o, a = n[i].update, c = a.length; for (i != e && (e = i, t = 0), u >= t && (t = u + 1) ; !(o = a[t]) && ++t < c;); return o } } function H() { var n = this.__transition__; n && ++n.active } function F(n, t, e) { function r() { var t = this[o]; t && (this.removeEventListener(n, t, t.$), delete this[o]) } function u() { var u = c(t, Qo(arguments)); r.call(this), this.addEventListener(n, this[o] = u, u.$ = e), u._ = t } function i() { var t, e = new RegExp("^__on([^.]+)" + Go.requote(n) + "$"); for (var r in this) if (t = r.match(e)) { var u = this[r]; this.removeEventListener(t[1], u, u.$), delete this[r] } } var o = "__on" + n, a = n.indexOf("."), c = O; a > 0 && (n = n.substring(0, a)); var s = ka.get(n); return s && (n = s, c = I), a ? t ? u : r : t ? v : i } function O(n, t) { return function (e) { var r = Go.event; Go.event = e, t[0] = this.__data__; try { n.apply(this, t) } finally { Go.event = r } } } function I(n, t) { var e = O(n, t); return function (n) { var t = this, r = n.relatedTarget; r && (r === t || 8 & r.compareDocumentPosition(t)) || e.call(t, n) } } function Y() { var n = ".dragsuppress-" + ++Na, t = "click" + n, e = Go.select(ea).on("touchmove" + n, y).on("dragstart" + n, y).on("selectstart" + n, y); if (Ea) { var r = ta.style, u = r[Ea]; r[Ea] = "none" } return function (i) { function o() { e.on(t, null) } e.on(n, null), Ea && (r[Ea] = u), i && (e.on(t, function () { y(), o() }, !0), setTimeout(o, 0)) } } function Z(n, t) { t.changedTouches && (t = t.changedTouches[0]); var e = n.ownerSVGElement || n; if (e.createSVGPoint) { var r = e.createSVGPoint(); return r.x = t.clientX, r.y = t.clientY, r = r.matrixTransform(n.getScreenCTM().inverse()), [r.x, r.y] } var u = n.getBoundingClientRect(); return [t.clientX - u.left - n.clientLeft, t.clientY - u.top - n.clientTop] } function V() { return Go.event.changedTouches[0].identifier } function $() { return Go.event.target } function X() { return ea } function B(n) { return n > 0 ? 1 : 0 > n ? -1 : 0 } function J(n, t, e) { return (t[0] - n[0]) * (e[1] - n[1]) - (t[1] - n[1]) * (e[0] - n[0]) } function W(n) { return n > 1 ? 0 : -1 > n ? Aa : Math.acos(n) } function G(n) { return n > 1 ? La : -1 > n ? -La : Math.asin(n) } function K(n) { return ((n = Math.exp(n)) - 1 / n) / 2 } function Q(n) { return ((n = Math.exp(n)) + 1 / n) / 2 } function nt(n) { return ((n = Math.exp(2 * n)) - 1) / (n + 1) } function tt(n) { return (n = Math.sin(n / 2)) * n } function et() { } function rt(n, t, e) { return new ut(n, t, e) } function ut(n, t, e) { this.h = n, this.s = t, this.l = e } function it(n, t, e) { function r(n) { return n > 360 ? n -= 360 : 0 > n && (n += 360), 60 > n ? i + (o - i) * n / 60 : 180 > n ? o : 240 > n ? i + (o - i) * (240 - n) / 60 : i } function u(n) { return Math.round(255 * r(n)) } var i, o; return n = isNaN(n) ? 0 : (n %= 360) < 0 ? n + 360 : n, t = isNaN(t) ? 0 : 0 > t ? 0 : t > 1 ? 1 : t, e = 0 > e ? 0 : e > 1 ? 1 : e, o = .5 >= e ? e * (1 + t) : e + t - e * t, i = 2 * e - o, yt(u(n + 120), u(n), u(n - 120)) } function ot(n, t, e) { return new at(n, t, e) } function at(n, t, e) { this.h = n, this.c = t, this.l = e } function ct(n, t, e) { return isNaN(n) && (n = 0), isNaN(t) && (t = 0), st(e, Math.cos(n *= za) * t, Math.sin(n) * t) } function st(n, t, e) { return new lt(n, t, e) } function lt(n, t, e) { this.l = n, this.a = t, this.b = e } function ft(n, t, e) { var r = (n + 16) / 116, u = r + t / 500, i = r - e / 200; return u = gt(u) * Za, r = gt(r) * Va, i = gt(i) * $a, yt(vt(3.2404542 * u - 1.5371385 * r - .4985314 * i), vt(-.969266 * u + 1.8760108 * r + .041556 * i), vt(.0556434 * u - .2040259 * r + 1.0572252 * i)) } function ht(n, t, e) { return n > 0 ? ot(Math.atan2(e, t) * Ra, Math.sqrt(t * t + e * e), n) : ot(0 / 0, 0 / 0, n) } function gt(n) { return n > .206893034 ? n * n * n : (n - 4 / 29) / 7.787037 } function pt(n) { return n > .008856 ? Math.pow(n, 1 / 3) : 7.787037 * n + 4 / 29 } function vt(n) { return Math.round(255 * (.00304 >= n ? 12.92 * n : 1.055 * Math.pow(n, 1 / 2.4) - .055)) } function dt(n) { return yt(n >> 16, 255 & n >> 8, 255 & n) } function mt(n) { return dt(n) + "" } function yt(n, t, e) { return new xt(n, t, e) } function xt(n, t, e) { this.r = n, this.g = t, this.b = e } function Mt(n) { return 16 > n ? "0" + Math.max(0, n).toString(16) : Math.min(255, n).toString(16) } function _t(n, t, e) { var r, u, i, o = 0, a = 0, c = 0; if (r = /([a-z]+)\((.*)\)/i.exec(n)) switch (u = r[2].split(","), r[1]) { case "hsl": return e(parseFloat(u[0]), parseFloat(u[1]) / 100, parseFloat(u[2]) / 100); case "rgb": return t(kt(u[0]), kt(u[1]), kt(u[2])) } return (i = Ja.get(n)) ? t(i.r, i.g, i.b) : (null == n || "#" !== n.charAt(0) || isNaN(i = parseInt(n.substring(1), 16)) || (4 === n.length ? (o = (3840 & i) >> 4, o = o >> 4 | o, a = 240 & i, a = a >> 4 | a, c = 15 & i, c = c << 4 | c) : 7 === n.length && (o = (16711680 & i) >> 16, a = (65280 & i) >> 8, c = 255 & i)), t(o, a, c)) } function bt(n, t, e) { var r, u, i = Math.min(n /= 255, t /= 255, e /= 255), o = Math.max(n, t, e), a = o - i, c = (o + i) / 2; return a ? (u = .5 > c ? a / (o + i) : a / (2 - o - i), r = n == o ? (t - e) / a + (e > t ? 6 : 0) : t == o ? (e - n) / a + 2 : (n - t) / a + 4, r *= 60) : (r = 0 / 0, u = c > 0 && 1 > c ? 0 : r), rt(r, u, c) } function wt(n, t, e) { n = St(n), t = St(t), e = St(e); var r = pt((.4124564 * n + .3575761 * t + .1804375 * e) / Za), u = pt((.2126729 * n + .7151522 * t + .072175 * e) / Va), i = pt((.0193339 * n + .119192 * t + .9503041 * e) / $a); return st(116 * u - 16, 500 * (r - u), 200 * (u - i)) } function St(n) { return (n /= 255) <= .04045 ? n / 12.92 : Math.pow((n + .055) / 1.055, 2.4) } function kt(n) { var t = parseFloat(n); return "%" === n.charAt(n.length - 1) ? Math.round(2.55 * t) : t } function Et(n) { return "function" == typeof n ? n : function () { return n } } function Nt(n) { return n } function At(n) { return function (t, e, r) { return 2 === arguments.length && "function" == typeof e && (r = e, e = null), Ct(t, e, n, r) } } function Ct(n, t, e, r) { function u() { var n, t = c.status; if (!t && c.responseText || t >= 200 && 300 > t || 304 === t) { try { n = e.call(i, c) } catch (r) { return o.error.call(i, r), void 0 } o.load.call(i, n) } else o.error.call(i, c) } var i = {}, o = Go.dispatch("beforesend", "progress", "load", "error"), a = {}, c = new XMLHttpRequest, s = null; return !ea.XDomainRequest || "withCredentials" in c || !/^(http(s)?:)?\/\//.test(n) || (c = new XDomainRequest), "onload" in c ? c.onload = c.onerror = u : c.onreadystatechange = function () { c.readyState > 3 && u() }, c.onprogress = function (n) { var t = Go.event; Go.event = n; try { o.progress.call(i, c) } finally { Go.event = t } }, i.header = function (n, t) { return n = (n + "").toLowerCase(), arguments.length < 2 ? a[n] : (null == t ? delete a[n] : a[n] = t + "", i) }, i.mimeType = function (n) { return arguments.length ? (t = null == n ? null : n + "", i) : t }, i.responseType = function (n) { return arguments.length ? (s = n, i) : s }, i.response = function (n) { return e = n, i }, ["get", "post"].forEach(function (n) { i[n] = function () { return i.send.apply(i, [n].concat(Qo(arguments))) } }), i.send = function (e, r, u) { if (2 === arguments.length && "function" == typeof r && (u = r, r = null), c.open(e, n, !0), null == t || "accept" in a || (a.accept = t + ",*/*"), c.setRequestHeader) for (var l in a) c.setRequestHeader(l, a[l]); return null != t && c.overrideMimeType && c.overrideMimeType(t), null != s && (c.responseType = s), null != u && i.on("error", u).on("load", function (n) { u(null, n) }), o.beforesend.call(i, c), c.send(null == r ? null : r), i }, i.abort = function () { return c.abort(), i }, Go.rebind(i, o, "on"), null == r ? i : i.get(Lt(r)) } function Lt(n) { return 1 === n.length ? function (t, e) { n(null == t ? e : null) } : n } function Tt() { var n = qt(), t = zt() - n; t > 24 ? (isFinite(t) && (clearTimeout(Qa), Qa = setTimeout(Tt, t)), Ka = 0) : (Ka = 1, tc(Tt)) } function qt() { var n = Date.now(); for (nc = Wa; nc;) n >= nc.t && (nc.f = nc.c(n - nc.t)), nc = nc.n; return n } function zt() { for (var n, t = Wa, e = 1 / 0; t;) t.f ? t = n ? n.n = t.n : Wa = t.n : (t.t < e && (e = t.t), t = (n = t).n); return Ga = n, e } function Rt(n, t) { return t - (n ? Math.ceil(Math.log(n) / Math.LN10) : 1) } function Dt(n, t) { var e = Math.pow(10, 3 * fa(8 - t)); return { scale: t > 8 ? function (n) { return n / e } : function (n) { return n * e }, symbol: n } } function Pt(n) { var t = n.decimal, e = n.thousands, r = n.grouping, u = n.currency, i = r ? function (n) { for (var t = n.length, u = [], i = 0, o = r[0]; t > 0 && o > 0;) u.push(n.substring(t -= o, t + o)), o = r[i = (i + 1) % r.length]; return u.reverse().join(e) } : Nt; return function (n) { var e = rc.exec(n), r = e[1] || " ", o = e[2] || ">", a = e[3] || "", c = e[4] || "", s = e[5], l = +e[6], f = e[7], h = e[8], g = e[9], p = 1, v = "", d = "", m = !1; switch (h && (h = +h.substring(1)), (s || "0" === r && "=" === o) && (s = r = "0", o = "=", f && (l -= Math.floor((l - 1) / 4))), g) { case "n": f = !0, g = "g"; break; case "%": p = 100, d = "%", g = "f"; break; case "p": p = 100, d = "%", g = "r"; break; case "b": case "o": case "x": case "X": "#" === c && (v = "0" + g.toLowerCase()); case "c": case "d": m = !0, h = 0; break; case "s": p = -1, g = "r" } "$" === c && (v = u[0], d = u[1]), "r" != g || h || (g = "g"), null != h && ("g" == g ? h = Math.max(1, Math.min(21, h)) : ("e" == g || "f" == g) && (h = Math.max(0, Math.min(20, h)))), g = uc.get(g) || Ut; var y = s && f; return function (n) { var e = d; if (m && n % 1) return ""; var u = 0 > n || 0 === n && 0 > 1 / n ? (n = -n, "-") : a; if (0 > p) { var c = Go.formatPrefix(n, h); n = c.scale(n), e = c.symbol + d } else n *= p; n = g(n, h); var x = n.lastIndexOf("."), M = 0 > x ? n : n.substring(0, x), _ = 0 > x ? "" : t + n.substring(x + 1); !s && f && (M = i(M)); var b = v.length + M.length + _.length + (y ? 0 : u.length), w = l > b ? new Array(b = l - b + 1).join(r) : ""; return y && (M = i(w + M)), u += v, n = M + _, ("<" === o ? u + n + w : ">" === o ? w + u + n : "^" === o ? w.substring(0, b >>= 1) + u + n + w.substring(b) : u + (y ? n : w + n)) + e } } } function Ut(n) { return n + "" } function jt() { this._ = new Date(arguments.length > 1 ? Date.UTC.apply(this, arguments) : arguments[0]) } function Ht(n, t, e) { function r(t) { var e = n(t), r = i(e, 1); return r - t > t - e ? e : r } function u(e) { return t(e = n(new oc(e - 1)), 1), e } function i(n, e) { return t(n = new oc(+n), e), n } function o(n, r, i) { var o = u(n), a = []; if (i > 1) for (; r > o;) e(o) % i || a.push(new Date(+o)), t(o, 1); else for (; r > o;) a.push(new Date(+o)), t(o, 1); return a } function a(n, t, e) { try { oc = jt; var r = new jt; return r._ = n, o(r, t, e) } finally { oc = Date } } n.floor = n, n.round = r, n.ceil = u, n.offset = i, n.range = o; var c = n.utc = Ft(n); return c.floor = c, c.round = Ft(r), c.ceil = Ft(u), c.offset = Ft(i), c.range = a, n } function Ft(n) { return function (t, e) { try { oc = jt; var r = new jt; return r._ = t, n(r, e)._ } finally { oc = Date } } } function Ot(n) { function t(n) { function t(t) { for (var e, u, i, o = [], a = -1, c = 0; ++a < r;) 37 === n.charCodeAt(a) && (o.push(n.substring(c, a)), null != (u = cc[e = n.charAt(++a)]) && (e = n.charAt(++a)), (i = A[e]) && (e = i(t, null == u ? "e" === e ? " " : "0" : u)), o.push(e), c = a + 1); return o.push(n.substring(c, a)), o.join("") } var r = n.length; return t.parse = function (t) { var r = { y: 1900, m: 0, d: 1, H: 0, M: 0, S: 0, L: 0, Z: null }, u = e(r, n, t, 0); if (u != t.length) return null; "p" in r && (r.H = r.H % 12 + 12 * r.p); var i = null != r.Z && oc !== jt, o = new (i ? jt : oc); return "j" in r ? o.setFullYear(r.y, 0, r.j) : "w" in r && ("W" in r || "U" in r) ? (o.setFullYear(r.y, 0, 1), o.setFullYear(r.y, 0, "W" in r ? (r.w + 6) % 7 + 7 * r.W - (o.getDay() + 5) % 7 : r.w + 7 * r.U - (o.getDay() + 6) % 7)) : o.setFullYear(r.y, r.m, r.d), o.setHours(r.H + Math.floor(r.Z / 100), r.M + r.Z % 100, r.S, r.L), i ? o._ : o }, t.toString = function () { return n }, t } function e(n, t, e, r) { for (var u, i, o, a = 0, c = t.length, s = e.length; c > a;) { if (r >= s) return -1; if (u = t.charCodeAt(a++), 37 === u) { if (o = t.charAt(a++), i = C[o in cc ? t.charAt(a++) : o], !i || (r = i(n, e, r)) < 0) return -1 } else if (u != e.charCodeAt(r++)) return -1 } return r } function r(n, t, e) { b.lastIndex = 0; var r = b.exec(t.substring(e)); return r ? (n.w = w.get(r[0].toLowerCase()), e + r[0].length) : -1 } function u(n, t, e) { M.lastIndex = 0; var r = M.exec(t.substring(e)); return r ? (n.w = _.get(r[0].toLowerCase()), e + r[0].length) : -1 } function i(n, t, e) { E.lastIndex = 0; var r = E.exec(t.substring(e)); return r ? (n.m = N.get(r[0].toLowerCase()), e + r[0].length) : -1 } function o(n, t, e) { S.lastIndex = 0; var r = S.exec(t.substring(e)); return r ? (n.m = k.get(r[0].toLowerCase()), e + r[0].length) : -1 } function a(n, t, r) { return e(n, A.c.toString(), t, r) } function c(n, t, r) { return e(n, A.x.toString(), t, r) } function s(n, t, r) { return e(n, A.X.toString(), t, r) } function l(n, t, e) { var r = x.get(t.substring(e, e += 2).toLowerCase()); return null == r ? -1 : (n.p = r, e) } var f = n.dateTime, h = n.date, g = n.time, p = n.periods, v = n.days, d = n.shortDays, m = n.months, y = n.shortMonths; t.utc = function (n) { function e(n) { try { oc = jt; var t = new oc; return t._ = n, r(t) } finally { oc = Date } } var r = t(n); return e.parse = function (n) { try { oc = jt; var t = r.parse(n); return t && t._ } finally { oc = Date } }, e.toString = r.toString, e }, t.multi = t.utc.multi = ae; var x = Go.map(), M = Yt(v), _ = Zt(v), b = Yt(d), w = Zt(d), S = Yt(m), k = Zt(m), E = Yt(y), N = Zt(y); p.forEach(function (n, t) { x.set(n.toLowerCase(), t) }); var A = { a: function (n) { return d[n.getDay()] }, A: function (n) { return v[n.getDay()] }, b: function (n) { return y[n.getMonth()] }, B: function (n) { return m[n.getMonth()] }, c: t(f), d: function (n, t) { return It(n.getDate(), t, 2) }, e: function (n, t) { return It(n.getDate(), t, 2) }, H: function (n, t) { return It(n.getHours(), t, 2) }, I: function (n, t) { return It(n.getHours() % 12 || 12, t, 2) }, j: function (n, t) { return It(1 + ic.dayOfYear(n), t, 3) }, L: function (n, t) { return It(n.getMilliseconds(), t, 3) }, m: function (n, t) { return It(n.getMonth() + 1, t, 2) }, M: function (n, t) { return It(n.getMinutes(), t, 2) }, p: function (n) { return p[+(n.getHours() >= 12)] }, S: function (n, t) { return It(n.getSeconds(), t, 2) }, U: function (n, t) { return It(ic.sundayOfYear(n), t, 2) }, w: function (n) { return n.getDay() }, W: function (n, t) { return It(ic.mondayOfYear(n), t, 2) }, x: t(h), X: t(g), y: function (n, t) { return It(n.getFullYear() % 100, t, 2) }, Y: function (n, t) { return It(n.getFullYear() % 1e4, t, 4) }, Z: ie, "%": function () { return "%" } }, C = { a: r, A: u, b: i, B: o, c: a, d: Qt, e: Qt, H: te, I: te, j: ne, L: ue, m: Kt, M: ee, p: l, S: re, U: $t, w: Vt, W: Xt, x: c, X: s, y: Jt, Y: Bt, Z: Wt, "%": oe }; return t } function It(n, t, e) { var r = 0 > n ? "-" : "", u = (r ? -n : n) + "", i = u.length; return r + (e > i ? new Array(e - i + 1).join(t) + u : u) } function Yt(n) { return new RegExp("^(?:" + n.map(Go.requote).join("|") + ")", "i") } function Zt(n) { for (var t = new o, e = -1, r = n.length; ++e < r;) t.set(n[e].toLowerCase(), e); return t } function Vt(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e, e + 1)); return r ? (n.w = +r[0], e + r[0].length) : -1 } function $t(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e)); return r ? (n.U = +r[0], e + r[0].length) : -1 } function Xt(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e)); return r ? (n.W = +r[0], e + r[0].length) : -1 } function Bt(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e, e + 4)); return r ? (n.y = +r[0], e + r[0].length) : -1 } function Jt(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e, e + 2)); return r ? (n.y = Gt(+r[0]), e + r[0].length) : -1 } function Wt(n, t, e) { return /^[+-]\d{4}$/.test(t = t.substring(e, e + 5)) ? (n.Z = +t, e + 5) : -1 } function Gt(n) { return n + (n > 68 ? 1900 : 2e3) } function Kt(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e, e + 2)); return r ? (n.m = r[0] - 1, e + r[0].length) : -1 } function Qt(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e, e + 2)); return r ? (n.d = +r[0], e + r[0].length) : -1 } function ne(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e, e + 3)); return r ? (n.j = +r[0], e + r[0].length) : -1 } function te(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e, e + 2)); return r ? (n.H = +r[0], e + r[0].length) : -1 } function ee(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e, e + 2)); return r ? (n.M = +r[0], e + r[0].length) : -1 } function re(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e, e + 2)); return r ? (n.S = +r[0], e + r[0].length) : -1 } function ue(n, t, e) { sc.lastIndex = 0; var r = sc.exec(t.substring(e, e + 3)); return r ? (n.L = +r[0], e + r[0].length) : -1 } function ie(n) { var t = n.getTimezoneOffset(), e = t > 0 ? "-" : "+", r = ~~(fa(t) / 60), u = fa(t) % 60; return e + It(r, "0", 2) + It(u, "0", 2) } function oe(n, t, e) { lc.lastIndex = 0; var r = lc.exec(t.substring(e, e + 1)); return r ? e + r[0].length : -1 } function ae(n) { for (var t = n.length, e = -1; ++e < t;) n[e][0] = this(n[e][0]); return function (t) { for (var e = 0, r = n[e]; !r[1](t) ;) r = n[++e]; return r[0](t) } } function ce() { } function se(n, t, e) { var r = e.s = n + t, u = r - n, i = r - u; e.t = n - i + (t - u) } function le(n, t) { n && pc.hasOwnProperty(n.type) && pc[n.type](n, t) } function fe(n, t, e) { var r, u = -1, i = n.length - e; for (t.lineStart() ; ++u < i;) r = n[u], t.point(r[0], r[1], r[2]); t.lineEnd() } function he(n, t) { var e = -1, r = n.length; for (t.polygonStart() ; ++e < r;) fe(n[e], t, 1); t.polygonEnd() } function ge() { function n(n, t) { n *= za, t = t * za / 2 + Aa / 4; var e = n - r, o = e >= 0 ? 1 : -1, a = o * e, c = Math.cos(t), s = Math.sin(t), l = i * s, f = u * c + l * Math.cos(a), h = l * o * Math.sin(a); dc.add(Math.atan2(h, f)), r = n, u = c, i = s } var t, e, r, u, i; mc.point = function (o, a) { mc.point = n, r = (t = o) * za, u = Math.cos(a = (e = a) * za / 2 + Aa / 4), i = Math.sin(a) }, mc.lineEnd = function () { n(t, e) } } function pe(n) { var t = n[0], e = n[1], r = Math.cos(e); return [r * Math.cos(t), r * Math.sin(t), Math.sin(e)] } function ve(n, t) { return n[0] * t[0] + n[1] * t[1] + n[2] * t[2] } function de(n, t) { return [n[1] * t[2] - n[2] * t[1], n[2] * t[0] - n[0] * t[2], n[0] * t[1] - n[1] * t[0]] } function me(n, t) { n[0] += t[0], n[1] += t[1], n[2] += t[2] } function ye(n, t) { return [n[0] * t, n[1] * t, n[2] * t] } function xe(n) { var t = Math.sqrt(n[0] * n[0] + n[1] * n[1] + n[2] * n[2]); n[0] /= t, n[1] /= t, n[2] /= t } function Me(n) { return [Math.atan2(n[1], n[0]), G(n[2])] } function _e(n, t) { return fa(n[0] - t[0]) < Ta && fa(n[1] - t[1]) < Ta } function be(n, t) { n *= za; var e = Math.cos(t *= za); we(e * Math.cos(n), e * Math.sin(n), Math.sin(t)) } function we(n, t, e) { ++yc, Mc += (n - Mc) / yc, _c += (t - _c) / yc, bc += (e - bc) / yc } function Se() { function n(n, u) { n *= za; var i = Math.cos(u *= za), o = i * Math.cos(n), a = i * Math.sin(n), c = Math.sin(u), s = Math.atan2(Math.sqrt((s = e * c - r * a) * s + (s = r * o - t * c) * s + (s = t * a - e * o) * s), t * o + e * a + r * c); xc += s, wc += s * (t + (t = o)), Sc += s * (e + (e = a)), kc += s * (r + (r = c)), we(t, e, r) } var t, e, r; Cc.point = function (u, i) { u *= za; var o = Math.cos(i *= za); t = o * Math.cos(u), e = o * Math.sin(u), r = Math.sin(i), Cc.point = n, we(t, e, r) } } function ke() { Cc.point = be } function Ee() { function n(n, t) { n *= za; var e = Math.cos(t *= za), o = e * Math.cos(n), a = e * Math.sin(n), c = Math.sin(t), s = u * c - i * a, l = i * o - r * c, f = r * a - u * o, h = Math.sqrt(s * s + l * l + f * f), g = r * o + u * a + i * c, p = h && -W(g) / h, v = Math.atan2(h, g); Ec += p * s, Nc += p * l, Ac += p * f, xc += v, wc += v * (r + (r = o)), Sc += v * (u + (u = a)), kc += v * (i + (i = c)), we(r, u, i) } var t, e, r, u, i; Cc.point = function (o, a) { t = o, e = a, Cc.point = n, o *= za; var c = Math.cos(a *= za); r = c * Math.cos(o), u = c * Math.sin(o), i = Math.sin(a), we(r, u, i) }, Cc.lineEnd = function () { n(t, e), Cc.lineEnd = ke, Cc.point = be } } function Ne() { return !0 } function Ae(n, t, e, r, u) { var i = [], o = []; if (n.forEach(function (n) { if (!((t = n.length - 1) <= 0)) { var t, e = n[0], r = n[t]; if (_e(e, r)) { u.lineStart(); for (var a = 0; t > a; ++a) u.point((e = n[a])[0], e[1]); return u.lineEnd(), void 0 } var c = new Le(e, n, null, !0), s = new Le(e, null, c, !1); c.o = s, i.push(c), o.push(s), c = new Le(r, n, null, !1), s = new Le(r, null, c, !0), c.o = s, i.push(c), o.push(s) } }), o.sort(t), Ce(i), Ce(o), i.length) { for (var a = 0, c = e, s = o.length; s > a; ++a) o[a].e = c = !c; for (var l, f, h = i[0]; ;) { for (var g = h, p = !0; g.v;) if ((g = g.n) === h) return; l = g.z, u.lineStart(); do { if (g.v = g.o.v = !0, g.e) { if (p) for (var a = 0, s = l.length; s > a; ++a) u.point((f = l[a])[0], f[1]); else r(g.x, g.n.x, 1, u); g = g.n } else { if (p) { l = g.p.z; for (var a = l.length - 1; a >= 0; --a) u.point((f = l[a])[0], f[1]) } else r(g.x, g.p.x, -1, u); g = g.p } g = g.o, l = g.z, p = !p } while (!g.v); u.lineEnd() } } } function Ce(n) { if (t = n.length) { for (var t, e, r = 0, u = n[0]; ++r < t;) u.n = e = n[r], e.p = u, u = e; u.n = e = n[0], e.p = u } } function Le(n, t, e, r) { this.x = n, this.z = t, this.o = e, this.e = r, this.v = !1, this.n = this.p = null } function Te(n, t, e, r) { return function (u, i) { function o(t, e) { var r = u(t, e); n(t = r[0], e = r[1]) && i.point(t, e) } function a(n, t) { var e = u(n, t); d.point(e[0], e[1]) } function c() { y.point = a, d.lineStart() } function s() { y.point = o, d.lineEnd() } function l(n, t) { v.push([n, t]); var e = u(n, t); M.point(e[0], e[1]) } function f() { M.lineStart(), v = [] } function h() { l(v[0][0], v[0][1]), M.lineEnd(); var n, t = M.clean(), e = x.buffer(), r = e.length; if (v.pop(), p.push(v), v = null, r) if (1 & t) { n = e[0]; var u, r = n.length - 1, o = -1; if (r > 0) { for (_ || (i.polygonStart(), _ = !0), i.lineStart() ; ++o < r;) i.point((u = n[o])[0], u[1]); i.lineEnd() } } else r > 1 && 2 & t && e.push(e.pop().concat(e.shift())), g.push(e.filter(qe)) } var g, p, v, d = t(i), m = u.invert(r[0], r[1]), y = { point: o, lineStart: c, lineEnd: s, polygonStart: function () { y.point = l, y.lineStart = f, y.lineEnd = h, g = [], p = [] }, polygonEnd: function () { y.point = o, y.lineStart = c, y.lineEnd = s, g = Go.merge(g); var n = De(m, p); g.length ? (_ || (i.polygonStart(), _ = !0), Ae(g, Re, n, e, i)) : n && (_ || (i.polygonStart(), _ = !0), i.lineStart(), e(null, null, 1, i), i.lineEnd()), _ && (i.polygonEnd(), _ = !1), g = p = null }, sphere: function () { i.polygonStart(), i.lineStart(), e(null, null, 1, i), i.lineEnd(), i.polygonEnd() } }, x = ze(), M = t(x), _ = !1; return y } } function qe(n) { return n.length > 1 } function ze() { var n, t = []; return { lineStart: function () { t.push(n = []) }, point: function (t, e) { n.push([t, e]) }, lineEnd: v, buffer: function () { var e = t; return t = [], n = null, e }, rejoin: function () { t.length > 1 && t.push(t.pop().concat(t.shift())) } } } function Re(n, t) { return ((n = n.x)[0] < 0 ? n[1] - La - Ta : La - n[1]) - ((t = t.x)[0] < 0 ? t[1] - La - Ta : La - t[1]) } function De(n, t) { var e = n[0], r = n[1], u = [Math.sin(e), -Math.cos(e), 0], i = 0, o = 0; dc.reset(); for (var a = 0, c = t.length; c > a; ++a) { var s = t[a], l = s.length; if (l) for (var f = s[0], h = f[0], g = f[1] / 2 + Aa / 4, p = Math.sin(g), v = Math.cos(g), d = 1; ;) { d === l && (d = 0), n = s[d]; var m = n[0], y = n[1] / 2 + Aa / 4, x = Math.sin(y), M = Math.cos(y), _ = m - h, b = _ >= 0 ? 1 : -1, w = b * _, S = w > Aa, k = p * x; if (dc.add(Math.atan2(k * b * Math.sin(w), v * M + k * Math.cos(w))), i += S ? _ + b * Ca : _, S ^ h >= e ^ m >= e) { var E = de(pe(f), pe(n)); xe(E); var N = de(u, E); xe(N); var A = (S ^ _ >= 0 ? -1 : 1) * G(N[2]); (r > A || r === A && (E[0] || E[1])) && (o += S ^ _ >= 0 ? 1 : -1) } if (!d++) break; h = m, p = x, v = M, f = n } } return (-Ta > i || Ta > i && 0 > dc) ^ 1 & o } function Pe(n) { var t, e = 0 / 0, r = 0 / 0, u = 0 / 0; return { lineStart: function () { n.lineStart(), t = 1 }, point: function (i, o) { var a = i > 0 ? Aa : -Aa, c = fa(i - e); fa(c - Aa) < Ta ? (n.point(e, r = (r + o) / 2 > 0 ? La : -La), n.point(u, r), n.lineEnd(), n.lineStart(), n.point(a, r), n.point(i, r), t = 0) : u !== a && c >= Aa && (fa(e - u) < Ta && (e -= u * Ta), fa(i - a) < Ta && (i -= a * Ta), r = Ue(e, r, i, o), n.point(u, r), n.lineEnd(), n.lineStart(), n.point(a, r), t = 0), n.point(e = i, r = o), u = a }, lineEnd: function () { n.lineEnd(), e = r = 0 / 0 }, clean: function () { return 2 - t } } } function Ue(n, t, e, r) { var u, i, o = Math.sin(n - e); return fa(o) > Ta ? Math.atan((Math.sin(t) * (i = Math.cos(r)) * Math.sin(e) - Math.sin(r) * (u = Math.cos(t)) * Math.sin(n)) / (u * i * o)) : (t + r) / 2 } function je(n, t, e, r) { var u; if (null == n) u = e * La, r.point(-Aa, u), r.point(0, u), r.point(Aa, u), r.point(Aa, 0), r.point(Aa, -u), r.point(0, -u), r.point(-Aa, -u), r.point(-Aa, 0), r.point(-Aa, u); else if (fa(n[0] - t[0]) > Ta) { var i = n[0] < t[0] ? Aa : -Aa; u = e * i / 2, r.point(-i, u), r.point(0, u), r.point(i, u) } else r.point(t[0], t[1]) } function He(n) { function t(n, t) { return Math.cos(n) * Math.cos(t) > i } function e(n) { var e, i, c, s, l; return { lineStart: function () { s = c = !1, l = 1 }, point: function (f, h) { var g, p = [f, h], v = t(f, h), d = o ? v ? 0 : u(f, h) : v ? u(f + (0 > f ? Aa : -Aa), h) : 0; if (!e && (s = c = v) && n.lineStart(), v !== c && (g = r(e, p), (_e(e, g) || _e(p, g)) && (p[0] += Ta, p[1] += Ta, v = t(p[0], p[1]))), v !== c) l = 0, v ? (n.lineStart(), g = r(p, e), n.point(g[0], g[1])) : (g = r(e, p), n.point(g[0], g[1]), n.lineEnd()), e = g; else if (a && e && o ^ v) { var m; d & i || !(m = r(p, e, !0)) || (l = 0, o ? (n.lineStart(), n.point(m[0][0], m[0][1]), n.point(m[1][0], m[1][1]), n.lineEnd()) : (n.point(m[1][0], m[1][1]), n.lineEnd(), n.lineStart(), n.point(m[0][0], m[0][1]))) } !v || e && _e(e, p) || n.point(p[0], p[1]), e = p, c = v, i = d }, lineEnd: function () { c && n.lineEnd(), e = null }, clean: function () { return l | (s && c) << 1 } } } function r(n, t, e) { var r = pe(n), u = pe(t), o = [1, 0, 0], a = de(r, u), c = ve(a, a), s = a[0], l = c - s * s; if (!l) return !e && n; var f = i * c / l, h = -i * s / l, g = de(o, a), p = ye(o, f), v = ye(a, h); me(p, v); var d = g, m = ve(p, d), y = ve(d, d), x = m * m - y * (ve(p, p) - 1); if (!(0 > x)) { var M = Math.sqrt(x), _ = ye(d, (-m - M) / y); if (me(_, p), _ = Me(_), !e) return _; var b, w = n[0], S = t[0], k = n[1], E = t[1]; w > S && (b = w, w = S, S = b); var N = S - w, A = fa(N - Aa) < Ta, C = A || Ta > N; if (!A && k > E && (b = k, k = E, E = b), C ? A ? k + E > 0 ^ _[1] < (fa(_[0] - w) < Ta ? k : E) : k <= _[1] && _[1] <= E : N > Aa ^ (w <= _[0] && _[0] <= S)) { var L = ye(d, (-m + M) / y); return me(L, p), [_, Me(L)] } } } function u(t, e) { var r = o ? n : Aa - n, u = 0; return -r > t ? u |= 1 : t > r && (u |= 2), -r > e ? u |= 4 : e > r && (u |= 8), u } var i = Math.cos(n), o = i > 0, a = fa(i) > Ta, c = gr(n, 6 * za); return Te(t, e, c, o ? [0, -n] : [-Aa, n - Aa]) } function Fe(n, t, e, r) { return function (u) { var i, o = u.a, a = u.b, c = o.x, s = o.y, l = a.x, f = a.y, h = 0, g = 1, p = l - c, v = f - s; if (i = n - c, p || !(i > 0)) { if (i /= p, 0 > p) { if (h > i) return; g > i && (g = i) } else if (p > 0) { if (i > g) return; i > h && (h = i) } if (i = e - c, p || !(0 > i)) { if (i /= p, 0 > p) { if (i > g) return; i > h && (h = i) } else if (p > 0) { if (h > i) return; g > i && (g = i) } if (i = t - s, v || !(i > 0)) { if (i /= v, 0 > v) { if (h > i) return; g > i && (g = i) } else if (v > 0) { if (i > g) return; i > h && (h = i) } if (i = r - s, v || !(0 > i)) { if (i /= v, 0 > v) { if (i > g) return; i > h && (h = i) } else if (v > 0) { if (h > i) return; g > i && (g = i) } return h > 0 && (u.a = { x: c + h * p, y: s + h * v }), 1 > g && (u.b = { x: c + g * p, y: s + g * v }), u } } } } } } function Oe(n, t, e, r) { function u(r, u) { return fa(r[0] - n) < Ta ? u > 0 ? 0 : 3 : fa(r[0] - e) < Ta ? u > 0 ? 2 : 1 : fa(r[1] - t) < Ta ? u > 0 ? 1 : 0 : u > 0 ? 3 : 2 } function i(n, t) { return o(n.x, t.x) } function o(n, t) { var e = u(n, 1), r = u(t, 1); return e !== r ? e - r : 0 === e ? t[1] - n[1] : 1 === e ? n[0] - t[0] : 2 === e ? n[1] - t[1] : t[0] - n[0] } return function (a) { function c(n) { for (var t = 0, e = d.length, r = n[1], u = 0; e > u; ++u) for (var i, o = 1, a = d[u], c = a.length, s = a[0]; c > o; ++o) i = a[o], s[1] <= r ? i[1] > r && J(s, i, n) > 0 && ++t : i[1] <= r && J(s, i, n) < 0 && --t, s = i; return 0 !== t } function s(i, a, c, s) { var l = 0, f = 0; if (null == i || (l = u(i, c)) !== (f = u(a, c)) || o(i, a) < 0 ^ c > 0) { do s.point(0 === l || 3 === l ? n : e, l > 1 ? r : t); while ((l = (l + c + 4) % 4) !== f) } else s.point(a[0], a[1]) } function l(u, i) { return u >= n && e >= u && i >= t && r >= i } function f(n, t) { l(n, t) && a.point(n, t) } function h() { C.point = p, d && d.push(m = []), S = !0, w = !1, _ = b = 0 / 0 } function g() { v && (p(y, x), M && w && N.rejoin(), v.push(N.buffer())), C.point = f, w && a.lineEnd() } function p(n, t) { n = Math.max(-Tc, Math.min(Tc, n)), t = Math.max(-Tc, Math.min(Tc, t)); var e = l(n, t); if (d && m.push([n, t]), S) y = n, x = t, M = e, S = !1, e && (a.lineStart(), a.point(n, t)); else if (e && w) a.point(n, t); else { var r = { a: { x: _, y: b }, b: { x: n, y: t } }; A(r) ? (w || (a.lineStart(), a.point(r.a.x, r.a.y)), a.point(r.b.x, r.b.y), e || a.lineEnd(), k = !1) : e && (a.lineStart(), a.point(n, t), k = !1) } _ = n, b = t, w = e } var v, d, m, y, x, M, _, b, w, S, k, E = a, N = ze(), A = Fe(n, t, e, r), C = { point: f, lineStart: h, lineEnd: g, polygonStart: function () { a = N, v = [], d = [], k = !0 }, polygonEnd: function () { a = E, v = Go.merge(v); var t = c([n, r]), e = k && t, u = v.length; (e || u) && (a.polygonStart(), e && (a.lineStart(), s(null, null, 1, a), a.lineEnd()), u && Ae(v, i, t, s, a), a.polygonEnd()), v = d = m = null } }; return C } } function Ie(n, t) { function e(e, r) { return e = n(e, r), t(e[0], e[1]) } return n.invert && t.invert && (e.invert = function (e, r) { return e = t.invert(e, r), e && n.invert(e[0], e[1]) }), e } function Ye(n) { var t = 0, e = Aa / 3, r = ir(n), u = r(t, e); return u.parallels = function (n) { return arguments.length ? r(t = n[0] * Aa / 180, e = n[1] * Aa / 180) : [180 * (t / Aa), 180 * (e / Aa)] }, u } function Ze(n, t) { function e(n, t) { var e = Math.sqrt(i - 2 * u * Math.sin(t)) / u; return [e * Math.sin(n *= u), o - e * Math.cos(n)] } var r = Math.sin(n), u = (r + Math.sin(t)) / 2, i = 1 + r * (2 * u - r), o = Math.sqrt(i) / u; return e.invert = function (n, t) { var e = o - t; return [Math.atan2(n, e) / u, G((i - (n * n + e * e) * u * u) / (2 * u))] }, e } function Ve() { function n(n, t) { zc += u * n - r * t, r = n, u = t } var t, e, r, u; jc.point = function (i, o) { jc.point = n, t = r = i, e = u = o }, jc.lineEnd = function () { n(t, e) } } function $e(n, t) { Rc > n && (Rc = n), n > Pc && (Pc = n), Dc > t && (Dc = t), t > Uc && (Uc = t) } function Xe() { function n(n, t) { o.push("M", n, ",", t, i) } function t(n, t) { o.push("M", n, ",", t), a.point = e } function e(n, t) { o.push("L", n, ",", t) } function r() { a.point = n } function u() { o.push("Z") } var i = Be(4.5), o = [], a = { point: n, lineStart: function () { a.point = t }, lineEnd: r, polygonStart: function () { a.lineEnd = u }, polygonEnd: function () { a.lineEnd = r, a.point = n }, pointRadius: function (n) { return i = Be(n), a }, result: function () { if (o.length) { var n = o.join(""); return o = [], n } } }; return a } function Be(n) { return "m0," + n + "a" + n + "," + n + " 0 1,1 0," + -2 * n + "a" + n + "," + n + " 0 1,1 0," + 2 * n + "z" } function Je(n, t) { Mc += n, _c += t, ++bc } function We() { function n(n, r) { var u = n - t, i = r - e, o = Math.sqrt(u * u + i * i); wc += o * (t + n) / 2, Sc += o * (e + r) / 2, kc += o, Je(t = n, e = r) } var t, e; Fc.point = function (r, u) { Fc.point = n, Je(t = r, e = u) } } function Ge() { Fc.point = Je } function Ke() { function n(n, t) { var e = n - r, i = t - u, o = Math.sqrt(e * e + i * i); wc += o * (r + n) / 2, Sc += o * (u + t) / 2, kc += o, o = u * n - r * t, Ec += o * (r + n), Nc += o * (u + t), Ac += 3 * o, Je(r = n, u = t) } var t, e, r, u; Fc.point = function (i, o) { Fc.point = n, Je(t = r = i, e = u = o) }, Fc.lineEnd = function () { n(t, e) } } function Qe(n) { function t(t, e) { n.moveTo(t, e), n.arc(t, e, o, 0, Ca) } function e(t, e) { n.moveTo(t, e), a.point = r } function r(t, e) { n.lineTo(t, e) } function u() { a.point = t } function i() { n.closePath() } var o = 4.5, a = { point: t, lineStart: function () { a.point = e }, lineEnd: u, polygonStart: function () { a.lineEnd = i }, polygonEnd: function () { a.lineEnd = u, a.point = t }, pointRadius: function (n) { return o = n, a }, result: v }; return a } function nr(n) { function t(n) { return (a ? r : e)(n) } function e(t) { return rr(t, function (e, r) { e = n(e, r), t.point(e[0], e[1]) }) } function r(t) { function e(e, r) { e = n(e, r), t.point(e[0], e[1]) } function r() { x = 0 / 0, S.point = i, t.lineStart() } function i(e, r) { var i = pe([e, r]), o = n(e, r); u(x, M, y, _, b, w, x = o[0], M = o[1], y = e, _ = i[0], b = i[1], w = i[2], a, t), t.point(x, M) } function o() { S.point = e, t.lineEnd() } function c() { r(), S.point = s, S.lineEnd = l } function s(n, t) { i(f = n, h = t), g = x, p = M, v = _, d = b, m = w, S.point = i } function l() { u(x, M, y, _, b, w, g, p, f, v, d, m, a, t), S.lineEnd = o, o() } var f, h, g, p, v, d, m, y, x, M, _, b, w, S = { point: e, lineStart: r, lineEnd: o, polygonStart: function () { t.polygonStart(), S.lineStart = c }, polygonEnd: function () { t.polygonEnd(), S.lineStart = r } }; return S } function u(t, e, r, a, c, s, l, f, h, g, p, v, d, m) { var y = l - t, x = f - e, M = y * y + x * x; if (M > 4 * i && d--) { var _ = a + g, b = c + p, w = s + v, S = Math.sqrt(_ * _ + b * b + w * w), k = Math.asin(w /= S), E = fa(fa(w) - 1) < Ta || fa(r - h) < Ta ? (r + h) / 2 : Math.atan2(b, _), N = n(E, k), A = N[0], C = N[1], L = A - t, T = C - e, q = x * L - y * T; (q * q / M > i || fa((y * L + x * T) / M - .5) > .3 || o > a * g + c * p + s * v) && (u(t, e, r, a, c, s, A, C, E, _ /= S, b /= S, w, d, m), m.point(A, C), u(A, C, E, _, b, w, l, f, h, g, p, v, d, m)) } } var i = .5, o = Math.cos(30 * za), a = 16; return t.precision = function (n) { return arguments.length ? (a = (i = n * n) > 0 && 16, t) : Math.sqrt(i) }, t } function tr(n) { var t = nr(function (t, e) { return n([t * Ra, e * Ra]) }); return function (n) { return or(t(n)) } } function er(n) { this.stream = n } function rr(n, t) { return { point: t, sphere: function () { n.sphere() }, lineStart: function () { n.lineStart() }, lineEnd: function () { n.lineEnd() }, polygonStart: function () { n.polygonStart() }, polygonEnd: function () { n.polygonEnd() } } } function ur(n) { return ir(function () { return n })() } function ir(n) {
            function t(n) { return n = a(n[0] * za, n[1] * za), [n[0] * h + c, s - n[1] * h] } function e(n) { return n = a.invert((n[0] - c) / h, (s - n[1]) / h), n && [n[0] * Ra, n[1] * Ra] } function r() {
                a = Ie(o = sr(m, y, x), i); var n = i(v, d); return c = g - n[0] * h, s = p + n[1] * h, u()
            } function u() { return l && (l.valid = !1, l = null), t } var i, o, a, c, s, l, f = nr(function (n, t) { return n = i(n, t), [n[0] * h + c, s - n[1] * h] }), h = 150, g = 480, p = 250, v = 0, d = 0, m = 0, y = 0, x = 0, M = Lc, _ = Nt, b = null, w = null; return t.stream = function (n) { return l && (l.valid = !1), l = or(M(o, f(_(n)))), l.valid = !0, l }, t.clipAngle = function (n) { return arguments.length ? (M = null == n ? (b = n, Lc) : He((b = +n) * za), u()) : b }, t.clipExtent = function (n) { return arguments.length ? (w = n, _ = n ? Oe(n[0][0], n[0][1], n[1][0], n[1][1]) : Nt, u()) : w }, t.scale = function (n) { return arguments.length ? (h = +n, r()) : h }, t.translate = function (n) { return arguments.length ? (g = +n[0], p = +n[1], r()) : [g, p] }, t.center = function (n) { return arguments.length ? (v = n[0] % 360 * za, d = n[1] % 360 * za, r()) : [v * Ra, d * Ra] }, t.rotate = function (n) { return arguments.length ? (m = n[0] % 360 * za, y = n[1] % 360 * za, x = n.length > 2 ? n[2] % 360 * za : 0, r()) : [m * Ra, y * Ra, x * Ra] }, Go.rebind(t, f, "precision"), function () { return i = n.apply(this, arguments), t.invert = i.invert && e, r() }
        } function or(n) { return rr(n, function (t, e) { n.point(t * za, e * za) }) } function ar(n, t) { return [n, t] } function cr(n, t) { return [n > Aa ? n - Ca : -Aa > n ? n + Ca : n, t] } function sr(n, t, e) { return n ? t || e ? Ie(fr(n), hr(t, e)) : fr(n) : t || e ? hr(t, e) : cr } function lr(n) { return function (t, e) { return t += n, [t > Aa ? t - Ca : -Aa > t ? t + Ca : t, e] } } function fr(n) { var t = lr(n); return t.invert = lr(-n), t } function hr(n, t) { function e(n, t) { var e = Math.cos(t), a = Math.cos(n) * e, c = Math.sin(n) * e, s = Math.sin(t), l = s * r + a * u; return [Math.atan2(c * i - l * o, a * r - s * u), G(l * i + c * o)] } var r = Math.cos(n), u = Math.sin(n), i = Math.cos(t), o = Math.sin(t); return e.invert = function (n, t) { var e = Math.cos(t), a = Math.cos(n) * e, c = Math.sin(n) * e, s = Math.sin(t), l = s * i - c * o; return [Math.atan2(c * i + s * o, a * r + l * u), G(l * r - a * u)] }, e } function gr(n, t) { var e = Math.cos(n), r = Math.sin(n); return function (u, i, o, a) { var c = o * t; null != u ? (u = pr(e, u), i = pr(e, i), (o > 0 ? i > u : u > i) && (u += o * Ca)) : (u = n + o * Ca, i = n - .5 * c); for (var s, l = u; o > 0 ? l > i : i > l; l -= c) a.point((s = Me([e, -r * Math.cos(l), -r * Math.sin(l)]))[0], s[1]) } } function pr(n, t) { var e = pe(t); e[0] -= n, xe(e); var r = W(-e[1]); return ((-e[2] < 0 ? -r : r) + 2 * Math.PI - Ta) % (2 * Math.PI) } function vr(n, t, e) { var r = Go.range(n, t - Ta, e).concat(t); return function (n) { return r.map(function (t) { return [n, t] }) } } function dr(n, t, e) { var r = Go.range(n, t - Ta, e).concat(t); return function (n) { return r.map(function (t) { return [t, n] }) } } function mr(n) { return n.source } function yr(n) { return n.target } function xr(n, t, e, r) { var u = Math.cos(t), i = Math.sin(t), o = Math.cos(r), a = Math.sin(r), c = u * Math.cos(n), s = u * Math.sin(n), l = o * Math.cos(e), f = o * Math.sin(e), h = 2 * Math.asin(Math.sqrt(tt(r - t) + u * o * tt(e - n))), g = 1 / Math.sin(h), p = h ? function (n) { var t = Math.sin(n *= h) * g, e = Math.sin(h - n) * g, r = e * c + t * l, u = e * s + t * f, o = e * i + t * a; return [Math.atan2(u, r) * Ra, Math.atan2(o, Math.sqrt(r * r + u * u)) * Ra] } : function () { return [n * Ra, t * Ra] }; return p.distance = h, p } function Mr() { function n(n, u) { var i = Math.sin(u *= za), o = Math.cos(u), a = fa((n *= za) - t), c = Math.cos(a); Oc += Math.atan2(Math.sqrt((a = o * Math.sin(a)) * a + (a = r * i - e * o * c) * a), e * i + r * o * c), t = n, e = i, r = o } var t, e, r; Ic.point = function (u, i) { t = u * za, e = Math.sin(i *= za), r = Math.cos(i), Ic.point = n }, Ic.lineEnd = function () { Ic.point = Ic.lineEnd = v } } function _r(n, t) { function e(t, e) { var r = Math.cos(t), u = Math.cos(e), i = n(r * u); return [i * u * Math.sin(t), i * Math.sin(e)] } return e.invert = function (n, e) { var r = Math.sqrt(n * n + e * e), u = t(r), i = Math.sin(u), o = Math.cos(u); return [Math.atan2(n * i, r * o), Math.asin(r && e * i / r)] }, e } function br(n, t) { function e(n, t) { o > 0 ? -La + Ta > t && (t = -La + Ta) : t > La - Ta && (t = La - Ta); var e = o / Math.pow(u(t), i); return [e * Math.sin(i * n), o - e * Math.cos(i * n)] } var r = Math.cos(n), u = function (n) { return Math.tan(Aa / 4 + n / 2) }, i = n === t ? Math.sin(n) : Math.log(r / Math.cos(t)) / Math.log(u(t) / u(n)), o = r * Math.pow(u(n), i) / i; return i ? (e.invert = function (n, t) { var e = o - t, r = B(i) * Math.sqrt(n * n + e * e); return [Math.atan2(n, e) / i, 2 * Math.atan(Math.pow(o / r, 1 / i)) - La] }, e) : Sr } function wr(n, t) { function e(n, t) { var e = i - t; return [e * Math.sin(u * n), i - e * Math.cos(u * n)] } var r = Math.cos(n), u = n === t ? Math.sin(n) : (r - Math.cos(t)) / (t - n), i = r / u + n; return fa(u) < Ta ? ar : (e.invert = function (n, t) { var e = i - t; return [Math.atan2(n, e) / u, i - B(u) * Math.sqrt(n * n + e * e)] }, e) } function Sr(n, t) { return [n, Math.log(Math.tan(Aa / 4 + t / 2))] } function kr(n) { var t, e = ur(n), r = e.scale, u = e.translate, i = e.clipExtent; return e.scale = function () { var n = r.apply(e, arguments); return n === e ? t ? e.clipExtent(null) : e : n }, e.translate = function () { var n = u.apply(e, arguments); return n === e ? t ? e.clipExtent(null) : e : n }, e.clipExtent = function (n) { var o = i.apply(e, arguments); if (o === e) { if (t = null == n) { var a = Aa * r(), c = u(); i([[c[0] - a, c[1] - a], [c[0] + a, c[1] + a]]) } } else t && (o = null); return o }, e.clipExtent(null) } function Er(n, t) { return [Math.log(Math.tan(Aa / 4 + t / 2)), -n] } function Nr(n) { return n[0] } function Ar(n) { return n[1] } function Cr(n) { for (var t = n.length, e = [0, 1], r = 2, u = 2; t > u; u++) { for (; r > 1 && J(n[e[r - 2]], n[e[r - 1]], n[u]) <= 0;)--r; e[r++] = u } return e.slice(0, r) } function Lr(n, t) { return n[0] - t[0] || n[1] - t[1] } function Tr(n, t, e) { return (e[0] - t[0]) * (n[1] - t[1]) < (e[1] - t[1]) * (n[0] - t[0]) } function qr(n, t, e, r) { var u = n[0], i = e[0], o = t[0] - u, a = r[0] - i, c = n[1], s = e[1], l = t[1] - c, f = r[1] - s, h = (a * (c - s) - f * (u - i)) / (f * o - a * l); return [u + h * o, c + h * l] } function zr(n) { var t = n[0], e = n[n.length - 1]; return !(t[0] - e[0] || t[1] - e[1]) } function Rr() { tu(this), this.edge = this.site = this.circle = null } function Dr(n) { var t = ns.pop() || new Rr; return t.site = n, t } function Pr(n) { $r(n), Gc.remove(n), ns.push(n), tu(n) } function Ur(n) { var t = n.circle, e = t.x, r = t.cy, u = { x: e, y: r }, i = n.P, o = n.N, a = [n]; Pr(n); for (var c = i; c.circle && fa(e - c.circle.x) < Ta && fa(r - c.circle.cy) < Ta;) i = c.P, a.unshift(c), Pr(c), c = i; a.unshift(c), $r(c); for (var s = o; s.circle && fa(e - s.circle.x) < Ta && fa(r - s.circle.cy) < Ta;) o = s.N, a.push(s), Pr(s), s = o; a.push(s), $r(s); var l, f = a.length; for (l = 1; f > l; ++l) s = a[l], c = a[l - 1], Kr(s.edge, c.site, s.site, u); c = a[0], s = a[f - 1], s.edge = Wr(c.site, s.site, null, u), Vr(c), Vr(s) } function jr(n) { for (var t, e, r, u, i = n.x, o = n.y, a = Gc._; a;) if (r = Hr(a, o) - i, r > Ta) a = a.L; else { if (u = i - Fr(a, o), !(u > Ta)) { r > -Ta ? (t = a.P, e = a) : u > -Ta ? (t = a, e = a.N) : t = e = a; break } if (!a.R) { t = a; break } a = a.R } var c = Dr(n); if (Gc.insert(t, c), t || e) { if (t === e) return $r(t), e = Dr(t.site), Gc.insert(c, e), c.edge = e.edge = Wr(t.site, c.site), Vr(t), Vr(e), void 0; if (!e) return c.edge = Wr(t.site, c.site), void 0; $r(t), $r(e); var s = t.site, l = s.x, f = s.y, h = n.x - l, g = n.y - f, p = e.site, v = p.x - l, d = p.y - f, m = 2 * (h * d - g * v), y = h * h + g * g, x = v * v + d * d, M = { x: (d * y - g * x) / m + l, y: (h * x - v * y) / m + f }; Kr(e.edge, s, p, M), c.edge = Wr(s, n, null, M), e.edge = Wr(n, p, null, M), Vr(t), Vr(e) } } function Hr(n, t) { var e = n.site, r = e.x, u = e.y, i = u - t; if (!i) return r; var o = n.P; if (!o) return -1 / 0; e = o.site; var a = e.x, c = e.y, s = c - t; if (!s) return a; var l = a - r, f = 1 / i - 1 / s, h = l / s; return f ? (-h + Math.sqrt(h * h - 2 * f * (l * l / (-2 * s) - c + s / 2 + u - i / 2))) / f + r : (r + a) / 2 } function Fr(n, t) { var e = n.N; if (e) return Hr(e, t); var r = n.site; return r.y === t ? r.x : 1 / 0 } function Or(n) { this.site = n, this.edges = [] } function Ir(n) { for (var t, e, r, u, i, o, a, c, s, l, f = n[0][0], h = n[1][0], g = n[0][1], p = n[1][1], v = Wc, d = v.length; d--;) if (i = v[d], i && i.prepare()) for (a = i.edges, c = a.length, o = 0; c > o;) l = a[o].end(), r = l.x, u = l.y, s = a[++o % c].start(), t = s.x, e = s.y, (fa(r - t) > Ta || fa(u - e) > Ta) && (a.splice(o, 0, new Qr(Gr(i.site, l, fa(r - f) < Ta && p - u > Ta ? { x: f, y: fa(t - f) < Ta ? e : p } : fa(u - p) < Ta && h - r > Ta ? { x: fa(e - p) < Ta ? t : h, y: p } : fa(r - h) < Ta && u - g > Ta ? { x: h, y: fa(t - h) < Ta ? e : g } : fa(u - g) < Ta && r - f > Ta ? { x: fa(e - g) < Ta ? t : f, y: g } : null), i.site, null)), ++c) } function Yr(n, t) { return t.angle - n.angle } function Zr() { tu(this), this.x = this.y = this.arc = this.site = this.cy = null } function Vr(n) { var t = n.P, e = n.N; if (t && e) { var r = t.site, u = n.site, i = e.site; if (r !== i) { var o = u.x, a = u.y, c = r.x - o, s = r.y - a, l = i.x - o, f = i.y - a, h = 2 * (c * f - s * l); if (!(h >= -qa)) { var g = c * c + s * s, p = l * l + f * f, v = (f * g - s * p) / h, d = (c * p - l * g) / h, f = d + a, m = ts.pop() || new Zr; m.arc = n, m.site = u, m.x = v + o, m.y = f + Math.sqrt(v * v + d * d), m.cy = f, n.circle = m; for (var y = null, x = Qc._; x;) if (m.y < x.y || m.y === x.y && m.x <= x.x) { if (!x.L) { y = x.P; break } x = x.L } else { if (!x.R) { y = x; break } x = x.R } Qc.insert(y, m), y || (Kc = m) } } } } function $r(n) { var t = n.circle; t && (t.P || (Kc = t.N), Qc.remove(t), ts.push(t), tu(t), n.circle = null) } function Xr(n) { for (var t, e = Jc, r = Fe(n[0][0], n[0][1], n[1][0], n[1][1]), u = e.length; u--;) t = e[u], (!Br(t, n) || !r(t) || fa(t.a.x - t.b.x) < Ta && fa(t.a.y - t.b.y) < Ta) && (t.a = t.b = null, e.splice(u, 1)) } function Br(n, t) { var e = n.b; if (e) return !0; var r, u, i = n.a, o = t[0][0], a = t[1][0], c = t[0][1], s = t[1][1], l = n.l, f = n.r, h = l.x, g = l.y, p = f.x, v = f.y, d = (h + p) / 2, m = (g + v) / 2; if (v === g) { if (o > d || d >= a) return; if (h > p) { if (i) { if (i.y >= s) return } else i = { x: d, y: c }; e = { x: d, y: s } } else { if (i) { if (i.y < c) return } else i = { x: d, y: s }; e = { x: d, y: c } } } else if (r = (h - p) / (v - g), u = m - r * d, -1 > r || r > 1) if (h > p) { if (i) { if (i.y >= s) return } else i = { x: (c - u) / r, y: c }; e = { x: (s - u) / r, y: s } } else { if (i) { if (i.y < c) return } else i = { x: (s - u) / r, y: s }; e = { x: (c - u) / r, y: c } } else if (v > g) { if (i) { if (i.x >= a) return } else i = { x: o, y: r * o + u }; e = { x: a, y: r * a + u } } else { if (i) { if (i.x < o) return } else i = { x: a, y: r * a + u }; e = { x: o, y: r * o + u } } return n.a = i, n.b = e, !0 } function Jr(n, t) { this.l = n, this.r = t, this.a = this.b = null } function Wr(n, t, e, r) { var u = new Jr(n, t); return Jc.push(u), e && Kr(u, n, t, e), r && Kr(u, t, n, r), Wc[n.i].edges.push(new Qr(u, n, t)), Wc[t.i].edges.push(new Qr(u, t, n)), u } function Gr(n, t, e) { var r = new Jr(n, null); return r.a = t, r.b = e, Jc.push(r), r } function Kr(n, t, e, r) { n.a || n.b ? n.l === e ? n.b = r : n.a = r : (n.a = r, n.l = t, n.r = e) } function Qr(n, t, e) { var r = n.a, u = n.b; this.edge = n, this.site = t, this.angle = e ? Math.atan2(e.y - t.y, e.x - t.x) : n.l === t ? Math.atan2(u.x - r.x, r.y - u.y) : Math.atan2(r.x - u.x, u.y - r.y) } function nu() { this._ = null } function tu(n) { n.U = n.C = n.L = n.R = n.P = n.N = null } function eu(n, t) { var e = t, r = t.R, u = e.U; u ? u.L === e ? u.L = r : u.R = r : n._ = r, r.U = u, e.U = r, e.R = r.L, e.R && (e.R.U = e), r.L = e } function ru(n, t) { var e = t, r = t.L, u = e.U; u ? u.L === e ? u.L = r : u.R = r : n._ = r, r.U = u, e.U = r, e.L = r.R, e.L && (e.L.U = e), r.R = e } function uu(n) { for (; n.L;) n = n.L; return n } function iu(n, t) { var e, r, u, i = n.sort(ou).pop(); for (Jc = [], Wc = new Array(n.length), Gc = new nu, Qc = new nu; ;) if (u = Kc, i && (!u || i.y < u.y || i.y === u.y && i.x < u.x)) (i.x !== e || i.y !== r) && (Wc[i.i] = new Or(i), jr(i), e = i.x, r = i.y), i = n.pop(); else { if (!u) break; Ur(u.arc) } t && (Xr(t), Ir(t)); var o = { cells: Wc, edges: Jc }; return Gc = Qc = Jc = Wc = null, o } function ou(n, t) { return t.y - n.y || t.x - n.x } function au(n, t, e) { return (n.x - e.x) * (t.y - n.y) - (n.x - t.x) * (e.y - n.y) } function cu(n) { return n.x } function su(n) { return n.y } function lu() { return { leaf: !0, nodes: [], point: null, x: null, y: null } } function fu(n, t, e, r, u, i) { if (!n(t, e, r, u, i)) { var o = .5 * (e + u), a = .5 * (r + i), c = t.nodes; c[0] && fu(n, c[0], e, r, o, a), c[1] && fu(n, c[1], o, r, u, a), c[2] && fu(n, c[2], e, a, o, i), c[3] && fu(n, c[3], o, a, u, i) } } function hu(n, t) { n = Go.rgb(n), t = Go.rgb(t); var e = n.r, r = n.g, u = n.b, i = t.r - e, o = t.g - r, a = t.b - u; return function (n) { return "#" + Mt(Math.round(e + i * n)) + Mt(Math.round(r + o * n)) + Mt(Math.round(u + a * n)) } } function gu(n, t) { var e, r = {}, u = {}; for (e in n) e in t ? r[e] = du(n[e], t[e]) : u[e] = n[e]; for (e in t) e in n || (u[e] = t[e]); return function (n) { for (e in r) u[e] = r[e](n); return u } } function pu(n, t) { return t -= n = +n, function (e) { return n + t * e } } function vu(n, t) { var e, r, u, i = rs.lastIndex = us.lastIndex = 0, o = -1, a = [], c = []; for (n += "", t += ""; (e = rs.exec(n)) && (r = us.exec(t)) ;) (u = r.index) > i && (u = t.substring(i, u), a[o] ? a[o] += u : a[++o] = u), (e = e[0]) === (r = r[0]) ? a[o] ? a[o] += r : a[++o] = r : (a[++o] = null, c.push({ i: o, x: pu(e, r) })), i = us.lastIndex; return i < t.length && (u = t.substring(i), a[o] ? a[o] += u : a[++o] = u), a.length < 2 ? c[0] ? (t = c[0].x, function (n) { return t(n) + "" }) : function () { return t } : (t = c.length, function (n) { for (var e, r = 0; t > r; ++r) a[(e = c[r]).i] = e.x(n); return a.join("") }) } function du(n, t) { for (var e, r = Go.interpolators.length; --r >= 0 && !(e = Go.interpolators[r](n, t)) ;); return e } function mu(n, t) { var e, r = [], u = [], i = n.length, o = t.length, a = Math.min(n.length, t.length); for (e = 0; a > e; ++e) r.push(du(n[e], t[e])); for (; i > e; ++e) u[e] = n[e]; for (; o > e; ++e) u[e] = t[e]; return function (n) { for (e = 0; a > e; ++e) u[e] = r[e](n); return u } } function yu(n) { return function (t) { return 0 >= t ? 0 : t >= 1 ? 1 : n(t) } } function xu(n) { return function (t) { return 1 - n(1 - t) } } function Mu(n) { return function (t) { return .5 * (.5 > t ? n(2 * t) : 2 - n(2 - 2 * t)) } } function _u(n) { return n * n } function bu(n) { return n * n * n } function wu(n) { if (0 >= n) return 0; if (n >= 1) return 1; var t = n * n, e = t * n; return 4 * (.5 > n ? e : 3 * (n - t) + e - .75) } function Su(n) { return function (t) { return Math.pow(t, n) } } function ku(n) { return 1 - Math.cos(n * La) } function Eu(n) { return Math.pow(2, 10 * (n - 1)) } function Nu(n) { return 1 - Math.sqrt(1 - n * n) } function Au(n, t) { var e; return arguments.length < 2 && (t = .45), arguments.length ? e = t / Ca * Math.asin(1 / n) : (n = 1, e = t / 4), function (r) { return 1 + n * Math.pow(2, -10 * r) * Math.sin((r - e) * Ca / t) } } function Cu(n) { return n || (n = 1.70158), function (t) { return t * t * ((n + 1) * t - n) } } function Lu(n) { return 1 / 2.75 > n ? 7.5625 * n * n : 2 / 2.75 > n ? 7.5625 * (n -= 1.5 / 2.75) * n + .75 : 2.5 / 2.75 > n ? 7.5625 * (n -= 2.25 / 2.75) * n + .9375 : 7.5625 * (n -= 2.625 / 2.75) * n + .984375 } function Tu(n, t) { n = Go.hcl(n), t = Go.hcl(t); var e = n.h, r = n.c, u = n.l, i = t.h - e, o = t.c - r, a = t.l - u; return isNaN(o) && (o = 0, r = isNaN(r) ? t.c : r), isNaN(i) ? (i = 0, e = isNaN(e) ? t.h : e) : i > 180 ? i -= 360 : -180 > i && (i += 360), function (n) { return ct(e + i * n, r + o * n, u + a * n) + "" } } function qu(n, t) { n = Go.hsl(n), t = Go.hsl(t); var e = n.h, r = n.s, u = n.l, i = t.h - e, o = t.s - r, a = t.l - u; return isNaN(o) && (o = 0, r = isNaN(r) ? t.s : r), isNaN(i) ? (i = 0, e = isNaN(e) ? t.h : e) : i > 180 ? i -= 360 : -180 > i && (i += 360), function (n) { return it(e + i * n, r + o * n, u + a * n) + "" } } function zu(n, t) { n = Go.lab(n), t = Go.lab(t); var e = n.l, r = n.a, u = n.b, i = t.l - e, o = t.a - r, a = t.b - u; return function (n) { return ft(e + i * n, r + o * n, u + a * n) + "" } } function Ru(n, t) { return t -= n, function (e) { return Math.round(n + t * e) } } function Du(n) { var t = [n.a, n.b], e = [n.c, n.d], r = Uu(t), u = Pu(t, e), i = Uu(ju(e, t, -u)) || 0; t[0] * e[1] < e[0] * t[1] && (t[0] *= -1, t[1] *= -1, r *= -1, u *= -1), this.rotate = (r ? Math.atan2(t[1], t[0]) : Math.atan2(-e[0], e[1])) * Ra, this.translate = [n.e, n.f], this.scale = [r, i], this.skew = i ? Math.atan2(u, i) * Ra : 0 } function Pu(n, t) { return n[0] * t[0] + n[1] * t[1] } function Uu(n) { var t = Math.sqrt(Pu(n, n)); return t && (n[0] /= t, n[1] /= t), t } function ju(n, t, e) { return n[0] += e * t[0], n[1] += e * t[1], n } function Hu(n, t) { var e, r = [], u = [], i = Go.transform(n), o = Go.transform(t), a = i.translate, c = o.translate, s = i.rotate, l = o.rotate, f = i.skew, h = o.skew, g = i.scale, p = o.scale; return a[0] != c[0] || a[1] != c[1] ? (r.push("translate(", null, ",", null, ")"), u.push({ i: 1, x: pu(a[0], c[0]) }, { i: 3, x: pu(a[1], c[1]) })) : c[0] || c[1] ? r.push("translate(" + c + ")") : r.push(""), s != l ? (s - l > 180 ? l += 360 : l - s > 180 && (s += 360), u.push({ i: r.push(r.pop() + "rotate(", null, ")") - 2, x: pu(s, l) })) : l && r.push(r.pop() + "rotate(" + l + ")"), f != h ? u.push({ i: r.push(r.pop() + "skewX(", null, ")") - 2, x: pu(f, h) }) : h && r.push(r.pop() + "skewX(" + h + ")"), g[0] != p[0] || g[1] != p[1] ? (e = r.push(r.pop() + "scale(", null, ",", null, ")"), u.push({ i: e - 4, x: pu(g[0], p[0]) }, { i: e - 2, x: pu(g[1], p[1]) })) : (1 != p[0] || 1 != p[1]) && r.push(r.pop() + "scale(" + p + ")"), e = u.length, function (n) { for (var t, i = -1; ++i < e;) r[(t = u[i]).i] = t.x(n); return r.join("") } } function Fu(n, t) { return t = t - (n = +n) ? 1 / (t - n) : 0, function (e) { return (e - n) * t } } function Ou(n, t) { return t = t - (n = +n) ? 1 / (t - n) : 0, function (e) { return Math.max(0, Math.min(1, (e - n) * t)) } } function Iu(n) { for (var t = n.source, e = n.target, r = Zu(t, e), u = [t]; t !== r;) t = t.parent, u.push(t); for (var i = u.length; e !== r;) u.splice(i, 0, e), e = e.parent; return u } function Yu(n) { for (var t = [], e = n.parent; null != e;) t.push(n), n = e, e = e.parent; return t.push(n), t } function Zu(n, t) { if (n === t) return n; for (var e = Yu(n), r = Yu(t), u = e.pop(), i = r.pop(), o = null; u === i;) o = u, u = e.pop(), i = r.pop(); return o } function Vu(n) { n.fixed |= 2 } function $u(n) { n.fixed &= -7 } function Xu(n) { n.fixed |= 4, n.px = n.x, n.py = n.y } function Bu(n) { n.fixed &= -5 } function Ju(n, t, e) { var r = 0, u = 0; if (n.charge = 0, !n.leaf) for (var i, o = n.nodes, a = o.length, c = -1; ++c < a;) i = o[c], null != i && (Ju(i, t, e), n.charge += i.charge, r += i.charge * i.cx, u += i.charge * i.cy); if (n.point) { n.leaf || (n.point.x += Math.random() - .5, n.point.y += Math.random() - .5); var s = t * e[n.point.index]; n.charge += n.pointCharge = s, r += s * n.point.x, u += s * n.point.y } n.cx = r / n.charge, n.cy = u / n.charge } function Wu(n, t) { return Go.rebind(n, t, "sort", "children", "value"), n.nodes = n, n.links = ni, n } function Gu(n) { return n.children } function Ku(n) { return n.value } function Qu(n, t) { return t.value - n.value } function ni(n) { return Go.merge(n.map(function (n) { return (n.children || []).map(function (t) { return { source: n, target: t } }) })) } function ti(n) { return n.x } function ei(n) { return n.y } function ri(n, t, e) { n.y0 = t, n.y = e } function ui(n) { return Go.range(n.length) } function ii(n) { for (var t = -1, e = n[0].length, r = []; ++t < e;) r[t] = 0; return r } function oi(n) { for (var t, e = 1, r = 0, u = n[0][1], i = n.length; i > e; ++e) (t = n[e][1]) > u && (r = e, u = t); return r } function ai(n) { return n.reduce(ci, 0) } function ci(n, t) { return n + t[1] } function si(n, t) { return li(n, Math.ceil(Math.log(t.length) / Math.LN2 + 1)) } function li(n, t) { for (var e = -1, r = +n[0], u = (n[1] - r) / t, i = []; ++e <= t;) i[e] = u * e + r; return i } function fi(n) { return [Go.min(n), Go.max(n)] } function hi(n, t) { return n.parent == t.parent ? 1 : 2 } function gi(n) { var t = n.children; return t && t.length ? t[0] : n._tree.thread } function pi(n) { var t, e = n.children; return e && (t = e.length) ? e[t - 1] : n._tree.thread } function vi(n, t) { var e = n.children; if (e && (u = e.length)) for (var r, u, i = -1; ++i < u;) t(r = vi(e[i], t), n) > 0 && (n = r); return n } function di(n, t) { return n.x - t.x } function mi(n, t) { return t.x - n.x } function yi(n, t) { return n.depth - t.depth } function xi(n, t) { function e(n, r) { var u = n.children; if (u && (o = u.length)) for (var i, o, a = null, c = -1; ++c < o;) i = u[c], e(i, a), a = i; t(n, r) } e(n, null) } function Mi(n) { for (var t, e = 0, r = 0, u = n.children, i = u.length; --i >= 0;) t = u[i]._tree, t.prelim += e, t.mod += e, e += t.shift + (r += t.change) } function _i(n, t, e) { n = n._tree, t = t._tree; var r = e / (t.number - n.number); n.change += r, t.change -= r, t.shift += e, t.prelim += e, t.mod += e } function bi(n, t, e) { return n._tree.ancestor.parent == t.parent ? n._tree.ancestor : e } function wi(n, t) { return n.value - t.value } function Si(n, t) { var e = n._pack_next; n._pack_next = t, t._pack_prev = n, t._pack_next = e, e._pack_prev = t } function ki(n, t) { n._pack_next = t, t._pack_prev = n } function Ei(n, t) { var e = t.x - n.x, r = t.y - n.y, u = n.r + t.r; return .999 * u * u > e * e + r * r } function Ni(n) { function t(n) { l = Math.min(n.x - n.r, l), f = Math.max(n.x + n.r, f), h = Math.min(n.y - n.r, h), g = Math.max(n.y + n.r, g) } if ((e = n.children) && (s = e.length)) { var e, r, u, i, o, a, c, s, l = 1 / 0, f = -1 / 0, h = 1 / 0, g = -1 / 0; if (e.forEach(Ai), r = e[0], r.x = -r.r, r.y = 0, t(r), s > 1 && (u = e[1], u.x = u.r, u.y = 0, t(u), s > 2)) for (i = e[2], Ti(r, u, i), t(i), Si(r, i), r._pack_prev = i, Si(i, u), u = r._pack_next, o = 3; s > o; o++) { Ti(r, u, i = e[o]); var p = 0, v = 1, d = 1; for (a = u._pack_next; a !== u; a = a._pack_next, v++) if (Ei(a, i)) { p = 1; break } if (1 == p) for (c = r._pack_prev; c !== a._pack_prev && !Ei(c, i) ; c = c._pack_prev, d++); p ? (d > v || v == d && u.r < r.r ? ki(r, u = a) : ki(r = c, u), o--) : (Si(r, i), u = i, t(i)) } var m = (l + f) / 2, y = (h + g) / 2, x = 0; for (o = 0; s > o; o++) i = e[o], i.x -= m, i.y -= y, x = Math.max(x, i.r + Math.sqrt(i.x * i.x + i.y * i.y)); n.r = x, e.forEach(Ci) } } function Ai(n) { n._pack_next = n._pack_prev = n } function Ci(n) { delete n._pack_next, delete n._pack_prev } function Li(n, t, e, r) { var u = n.children; if (n.x = t += r * n.x, n.y = e += r * n.y, n.r *= r, u) for (var i = -1, o = u.length; ++i < o;) Li(u[i], t, e, r) } function Ti(n, t, e) { var r = n.r + e.r, u = t.x - n.x, i = t.y - n.y; if (r && (u || i)) { var o = t.r + e.r, a = u * u + i * i; o *= o, r *= r; var c = .5 + (r - o) / (2 * a), s = Math.sqrt(Math.max(0, 2 * o * (r + a) - (r -= a) * r - o * o)) / (2 * a); e.x = n.x + c * u + s * i, e.y = n.y + c * i - s * u } else e.x = n.x + r, e.y = n.y } function qi(n) { return 1 + Go.max(n, function (n) { return n.y }) } function zi(n) { return n.reduce(function (n, t) { return n + t.x }, 0) / n.length } function Ri(n) { var t = n.children; return t && t.length ? Ri(t[0]) : n } function Di(n) { var t, e = n.children; return e && (t = e.length) ? Di(e[t - 1]) : n } function Pi(n) { return { x: n.x, y: n.y, dx: n.dx, dy: n.dy } } function Ui(n, t) { var e = n.x + t[3], r = n.y + t[0], u = n.dx - t[1] - t[3], i = n.dy - t[0] - t[2]; return 0 > u && (e += u / 2, u = 0), 0 > i && (r += i / 2, i = 0), { x: e, y: r, dx: u, dy: i } } function ji(n) { var t = n[0], e = n[n.length - 1]; return e > t ? [t, e] : [e, t] } function Hi(n) { return n.rangeExtent ? n.rangeExtent() : ji(n.range()) } function Fi(n, t, e, r) { var u = e(n[0], n[1]), i = r(t[0], t[1]); return function (n) { return i(u(n)) } } function Oi(n, t) { var e, r = 0, u = n.length - 1, i = n[r], o = n[u]; return i > o && (e = r, r = u, u = e, e = i, i = o, o = e), n[r] = t.floor(i), n[u] = t.ceil(o), n } function Ii(n) { return n ? { floor: function (t) { return Math.floor(t / n) * n }, ceil: function (t) { return Math.ceil(t / n) * n } } : vs } function Yi(n, t, e, r) { var u = [], i = [], o = 0, a = Math.min(n.length, t.length) - 1; for (n[a] < n[0] && (n = n.slice().reverse(), t = t.slice().reverse()) ; ++o <= a;) u.push(e(n[o - 1], n[o])), i.push(r(t[o - 1], t[o])); return function (t) { var e = Go.bisect(n, t, 1, a) - 1; return i[e](u[e](t)) } } function Zi(n, t, e, r) { function u() { var u = Math.min(n.length, t.length) > 2 ? Yi : Fi, c = r ? Ou : Fu; return o = u(n, t, c, e), a = u(t, n, c, du), i } function i(n) { return o(n) } var o, a; return i.invert = function (n) { return a(n) }, i.domain = function (t) { return arguments.length ? (n = t.map(Number), u()) : n }, i.range = function (n) { return arguments.length ? (t = n, u()) : t }, i.rangeRound = function (n) { return i.range(n).interpolate(Ru) }, i.clamp = function (n) { return arguments.length ? (r = n, u()) : r }, i.interpolate = function (n) { return arguments.length ? (e = n, u()) : e }, i.ticks = function (t) { return Bi(n, t) }, i.tickFormat = function (t, e) { return Ji(n, t, e) }, i.nice = function (t) { return $i(n, t), u() }, i.copy = function () { return Zi(n, t, e, r) }, u() } function Vi(n, t) { return Go.rebind(n, t, "range", "rangeRound", "interpolate", "clamp") } function $i(n, t) { return Oi(n, Ii(Xi(n, t)[2])) } function Xi(n, t) { null == t && (t = 10); var e = ji(n), r = e[1] - e[0], u = Math.pow(10, Math.floor(Math.log(r / t) / Math.LN10)), i = t / r * u; return .15 >= i ? u *= 10 : .35 >= i ? u *= 5 : .75 >= i && (u *= 2), e[0] = Math.ceil(e[0] / u) * u, e[1] = Math.floor(e[1] / u) * u + .5 * u, e[2] = u, e } function Bi(n, t) { return Go.range.apply(Go, Xi(n, t)) } function Ji(n, t, e) { var r = Xi(n, t); if (e) { var u = rc.exec(e); if (u.shift(), "s" === u[8]) { var i = Go.formatPrefix(Math.max(fa(r[0]), fa(r[1]))); return u[7] || (u[7] = "." + Wi(i.scale(r[2]))), u[8] = "f", e = Go.format(u.join("")), function (n) { return e(i.scale(n)) + i.symbol } } u[7] || (u[7] = "." + Gi(u[8], r)), e = u.join("") } else e = ",." + Wi(r[2]) + "f"; return Go.format(e) } function Wi(n) { return -Math.floor(Math.log(n) / Math.LN10 + .01) } function Gi(n, t) { var e = Wi(t[2]); return n in ds ? Math.abs(e - Wi(Math.max(fa(t[0]), fa(t[1])))) + +("e" !== n) : e - 2 * ("%" === n) } function Ki(n, t, e, r) { function u(n) { return (e ? Math.log(0 > n ? 0 : n) : -Math.log(n > 0 ? 0 : -n)) / Math.log(t) } function i(n) { return e ? Math.pow(t, n) : -Math.pow(t, -n) } function o(t) { return n(u(t)) } return o.invert = function (t) { return i(n.invert(t)) }, o.domain = function (t) { return arguments.length ? (e = t[0] >= 0, n.domain((r = t.map(Number)).map(u)), o) : r }, o.base = function (e) { return arguments.length ? (t = +e, n.domain(r.map(u)), o) : t }, o.nice = function () { var t = Oi(r.map(u), e ? Math : ys); return n.domain(t), r = t.map(i), o }, o.ticks = function () { var n = ji(r), o = [], a = n[0], c = n[1], s = Math.floor(u(a)), l = Math.ceil(u(c)), f = t % 1 ? 2 : t; if (isFinite(l - s)) { if (e) { for (; l > s; s++) for (var h = 1; f > h; h++) o.push(i(s) * h); o.push(i(s)) } else for (o.push(i(s)) ; s++ < l;) for (var h = f - 1; h > 0; h--) o.push(i(s) * h); for (s = 0; o[s] < a; s++); for (l = o.length; o[l - 1] > c; l--); o = o.slice(s, l) } return o }, o.tickFormat = function (n, t) { if (!arguments.length) return ms; arguments.length < 2 ? t = ms : "function" != typeof t && (t = Go.format(t)); var r, a = Math.max(.1, n / o.ticks().length), c = e ? (r = 1e-12, Math.ceil) : (r = -1e-12, Math.floor); return function (n) { return n / i(c(u(n) + r)) <= a ? t(n) : "" } }, o.copy = function () { return Ki(n.copy(), t, e, r) }, Vi(o, n) } function Qi(n, t, e) { function r(t) { return n(u(t)) } var u = no(t), i = no(1 / t); return r.invert = function (t) { return i(n.invert(t)) }, r.domain = function (t) { return arguments.length ? (n.domain((e = t.map(Number)).map(u)), r) : e }, r.ticks = function (n) { return Bi(e, n) }, r.tickFormat = function (n, t) { return Ji(e, n, t) }, r.nice = function (n) { return r.domain($i(e, n)) }, r.exponent = function (o) { return arguments.length ? (u = no(t = o), i = no(1 / t), n.domain(e.map(u)), r) : t }, r.copy = function () { return Qi(n.copy(), t, e) }, Vi(r, n) } function no(n) { return function (t) { return 0 > t ? -Math.pow(-t, n) : Math.pow(t, n) } } function to(n, t) { function e(e) { return i[((u.get(e) || ("range" === t.t ? u.set(e, n.push(e)) : 0 / 0)) - 1) % i.length] } function r(t, e) { return Go.range(n.length).map(function (n) { return t + e * n }) } var u, i, a; return e.domain = function (r) { if (!arguments.length) return n; n = [], u = new o; for (var i, a = -1, c = r.length; ++a < c;) u.has(i = r[a]) || u.set(i, n.push(i)); return e[t.t].apply(e, t.a) }, e.range = function (n) { return arguments.length ? (i = n, a = 0, t = { t: "range", a: arguments }, e) : i }, e.rangePoints = function (u, o) { arguments.length < 2 && (o = 0); var c = u[0], s = u[1], l = (s - c) / (Math.max(1, n.length - 1) + o); return i = r(n.length < 2 ? (c + s) / 2 : c + l * o / 2, l), a = 0, t = { t: "rangePoints", a: arguments }, e }, e.rangeBands = function (u, o, c) { arguments.length < 2 && (o = 0), arguments.length < 3 && (c = o); var s = u[1] < u[0], l = u[s - 0], f = u[1 - s], h = (f - l) / (n.length - o + 2 * c); return i = r(l + h * c, h), s && i.reverse(), a = h * (1 - o), t = { t: "rangeBands", a: arguments }, e }, e.rangeRoundBands = function (u, o, c) { arguments.length < 2 && (o = 0), arguments.length < 3 && (c = o); var s = u[1] < u[0], l = u[s - 0], f = u[1 - s], h = Math.floor((f - l) / (n.length - o + 2 * c)), g = f - l - (n.length - o) * h; return i = r(l + Math.round(g / 2), h), s && i.reverse(), a = Math.round(h * (1 - o)), t = { t: "rangeRoundBands", a: arguments }, e }, e.rangeBand = function () { return a }, e.rangeExtent = function () { return ji(t.a[0]) }, e.copy = function () { return to(n, t) }, e.domain(n) } function eo(t, e) { function r() { var n = 0, r = e.length; for (i = []; ++n < r;) i[n - 1] = Go.quantile(t, n / r); return u } function u(n) { return isNaN(n = +n) ? void 0 : e[Go.bisect(i, n)] } var i; return u.domain = function (e) { return arguments.length ? (t = e.filter(function (n) { return !isNaN(n) }).sort(n), r()) : t }, u.range = function (n) { return arguments.length ? (e = n, r()) : e }, u.quantiles = function () { return i }, u.invertExtent = function (n) { return n = e.indexOf(n), 0 > n ? [0 / 0, 0 / 0] : [n > 0 ? i[n - 1] : t[0], n < i.length ? i[n] : t[t.length - 1]] }, u.copy = function () { return eo(t, e) }, r() } function ro(n, t, e) { function r(t) { return e[Math.max(0, Math.min(o, Math.floor(i * (t - n))))] } function u() { return i = e.length / (t - n), o = e.length - 1, r } var i, o; return r.domain = function (e) { return arguments.length ? (n = +e[0], t = +e[e.length - 1], u()) : [n, t] }, r.range = function (n) { return arguments.length ? (e = n, u()) : e }, r.invertExtent = function (t) { return t = e.indexOf(t), t = 0 > t ? 0 / 0 : t / i + n, [t, t + 1 / i] }, r.copy = function () { return ro(n, t, e) }, u() } function uo(n, t) { function e(e) { return e >= e ? t[Go.bisect(n, e)] : void 0 } return e.domain = function (t) { return arguments.length ? (n = t, e) : n }, e.range = function (n) { return arguments.length ? (t = n, e) : t }, e.invertExtent = function (e) { return e = t.indexOf(e), [n[e - 1], n[e]] }, e.copy = function () { return uo(n, t) }, e } function io(n) { function t(n) { return +n } return t.invert = t, t.domain = t.range = function (e) { return arguments.length ? (n = e.map(t), t) : n }, t.ticks = function (t) { return Bi(n, t) }, t.tickFormat = function (t, e) { return Ji(n, t, e) }, t.copy = function () { return io(n) }, t } function oo(n) { return n.innerRadius } function ao(n) { return n.outerRadius } function co(n) { return n.startAngle } function so(n) { return n.endAngle } function lo(n) { function t(t) { function o() { s.push("M", i(n(l), a)) } for (var c, s = [], l = [], f = -1, h = t.length, g = Et(e), p = Et(r) ; ++f < h;) u.call(this, c = t[f], f) ? l.push([+g.call(this, c, f), +p.call(this, c, f)]) : l.length && (o(), l = []); return l.length && o(), s.length ? s.join("") : null } var e = Nr, r = Ar, u = Ne, i = fo, o = i.key, a = .7; return t.x = function (n) { return arguments.length ? (e = n, t) : e }, t.y = function (n) { return arguments.length ? (r = n, t) : r }, t.defined = function (n) { return arguments.length ? (u = n, t) : u }, t.interpolate = function (n) { return arguments.length ? (o = "function" == typeof n ? i = n : (i = ks.get(n) || fo).key, t) : o }, t.tension = function (n) { return arguments.length ? (a = n, t) : a }, t } function fo(n) { return n.join("L") } function ho(n) { return fo(n) + "Z" } function go(n) { for (var t = 0, e = n.length, r = n[0], u = [r[0], ",", r[1]]; ++t < e;) u.push("H", (r[0] + (r = n[t])[0]) / 2, "V", r[1]); return e > 1 && u.push("H", r[0]), u.join("") } function po(n) { for (var t = 0, e = n.length, r = n[0], u = [r[0], ",", r[1]]; ++t < e;) u.push("V", (r = n[t])[1], "H", r[0]); return u.join("") } function vo(n) { for (var t = 0, e = n.length, r = n[0], u = [r[0], ",", r[1]]; ++t < e;) u.push("H", (r = n[t])[0], "V", r[1]); return u.join("") } function mo(n, t) { return n.length < 4 ? fo(n) : n[1] + Mo(n.slice(1, n.length - 1), _o(n, t)) } function yo(n, t) { return n.length < 3 ? fo(n) : n[0] + Mo((n.push(n[0]), n), _o([n[n.length - 2]].concat(n, [n[1]]), t)) } function xo(n, t) { return n.length < 3 ? fo(n) : n[0] + Mo(n, _o(n, t)) } function Mo(n, t) { if (t.length < 1 || n.length != t.length && n.length != t.length + 2) return fo(n); var e = n.length != t.length, r = "", u = n[0], i = n[1], o = t[0], a = o, c = 1; if (e && (r += "Q" + (i[0] - 2 * o[0] / 3) + "," + (i[1] - 2 * o[1] / 3) + "," + i[0] + "," + i[1], u = n[1], c = 2), t.length > 1) { a = t[1], i = n[c], c++, r += "C" + (u[0] + o[0]) + "," + (u[1] + o[1]) + "," + (i[0] - a[0]) + "," + (i[1] - a[1]) + "," + i[0] + "," + i[1]; for (var s = 2; s < t.length; s++, c++) i = n[c], a = t[s], r += "S" + (i[0] - a[0]) + "," + (i[1] - a[1]) + "," + i[0] + "," + i[1] } if (e) { var l = n[c]; r += "Q" + (i[0] + 2 * a[0] / 3) + "," + (i[1] + 2 * a[1] / 3) + "," + l[0] + "," + l[1] } return r } function _o(n, t) { for (var e, r = [], u = (1 - t) / 2, i = n[0], o = n[1], a = 1, c = n.length; ++a < c;) e = i, i = o, o = n[a], r.push([u * (o[0] - e[0]), u * (o[1] - e[1])]); return r } function bo(n) { if (n.length < 3) return fo(n); var t = 1, e = n.length, r = n[0], u = r[0], i = r[1], o = [u, u, u, (r = n[1])[0]], a = [i, i, i, r[1]], c = [u, ",", i, "L", Eo(As, o), ",", Eo(As, a)]; for (n.push(n[e - 1]) ; ++t <= e;) r = n[t], o.shift(), o.push(r[0]), a.shift(), a.push(r[1]), No(c, o, a); return n.pop(), c.push("L", r), c.join("") } function wo(n) { if (n.length < 4) return fo(n); for (var t, e = [], r = -1, u = n.length, i = [0], o = [0]; ++r < 3;) t = n[r], i.push(t[0]), o.push(t[1]); for (e.push(Eo(As, i) + "," + Eo(As, o)), --r; ++r < u;) t = n[r], i.shift(), i.push(t[0]), o.shift(), o.push(t[1]), No(e, i, o); return e.join("") } function So(n) { for (var t, e, r = -1, u = n.length, i = u + 4, o = [], a = []; ++r < 4;) e = n[r % u], o.push(e[0]), a.push(e[1]); for (t = [Eo(As, o), ",", Eo(As, a)], --r; ++r < i;) e = n[r % u], o.shift(), o.push(e[0]), a.shift(), a.push(e[1]), No(t, o, a); return t.join("") } function ko(n, t) { var e = n.length - 1; if (e) for (var r, u, i = n[0][0], o = n[0][1], a = n[e][0] - i, c = n[e][1] - o, s = -1; ++s <= e;) r = n[s], u = s / e, r[0] = t * r[0] + (1 - t) * (i + u * a), r[1] = t * r[1] + (1 - t) * (o + u * c); return bo(n) } function Eo(n, t) { return n[0] * t[0] + n[1] * t[1] + n[2] * t[2] + n[3] * t[3] } function No(n, t, e) { n.push("C", Eo(Es, t), ",", Eo(Es, e), ",", Eo(Ns, t), ",", Eo(Ns, e), ",", Eo(As, t), ",", Eo(As, e)) } function Ao(n, t) { return (t[1] - n[1]) / (t[0] - n[0]) } function Co(n) { for (var t = 0, e = n.length - 1, r = [], u = n[0], i = n[1], o = r[0] = Ao(u, i) ; ++t < e;) r[t] = (o + (o = Ao(u = i, i = n[t + 1]))) / 2; return r[t] = o, r } function Lo(n) { for (var t, e, r, u, i = [], o = Co(n), a = -1, c = n.length - 1; ++a < c;) t = Ao(n[a], n[a + 1]), fa(t) < Ta ? o[a] = o[a + 1] = 0 : (e = o[a] / t, r = o[a + 1] / t, u = e * e + r * r, u > 9 && (u = 3 * t / Math.sqrt(u), o[a] = u * e, o[a + 1] = u * r)); for (a = -1; ++a <= c;) u = (n[Math.min(c, a + 1)][0] - n[Math.max(0, a - 1)][0]) / (6 * (1 + o[a] * o[a])), i.push([u || 0, o[a] * u || 0]); return i } function To(n) { return n.length < 3 ? fo(n) : n[0] + Mo(n, Lo(n)) } function qo(n) { for (var t, e, r, u = -1, i = n.length; ++u < i;) t = n[u], e = t[0], r = t[1] + ws, t[0] = e * Math.cos(r), t[1] = e * Math.sin(r); return n } function zo(n) { function t(t) { function c() { v.push("M", a(n(m), f), l, s(n(d.reverse()), f), "Z") } for (var h, g, p, v = [], d = [], m = [], y = -1, x = t.length, M = Et(e), _ = Et(u), b = e === r ? function () { return g } : Et(r), w = u === i ? function () { return p } : Et(i) ; ++y < x;) o.call(this, h = t[y], y) ? (d.push([g = +M.call(this, h, y), p = +_.call(this, h, y)]), m.push([+b.call(this, h, y), +w.call(this, h, y)])) : d.length && (c(), d = [], m = []); return d.length && c(), v.length ? v.join("") : null } var e = Nr, r = Nr, u = 0, i = Ar, o = Ne, a = fo, c = a.key, s = a, l = "L", f = .7; return t.x = function (n) { return arguments.length ? (e = r = n, t) : r }, t.x0 = function (n) { return arguments.length ? (e = n, t) : e }, t.x1 = function (n) { return arguments.length ? (r = n, t) : r }, t.y = function (n) { return arguments.length ? (u = i = n, t) : i }, t.y0 = function (n) { return arguments.length ? (u = n, t) : u }, t.y1 = function (n) { return arguments.length ? (i = n, t) : i }, t.defined = function (n) { return arguments.length ? (o = n, t) : o }, t.interpolate = function (n) { return arguments.length ? (c = "function" == typeof n ? a = n : (a = ks.get(n) || fo).key, s = a.reverse || a, l = a.closed ? "M" : "L", t) : c }, t.tension = function (n) { return arguments.length ? (f = n, t) : f }, t } function Ro(n) { return n.radius } function Do(n) { return [n.x, n.y] } function Po(n) { return function () { var t = n.apply(this, arguments), e = t[0], r = t[1] + ws; return [e * Math.cos(r), e * Math.sin(r)] } } function Uo() { return 64 } function jo() { return "circle" } function Ho(n) { var t = Math.sqrt(n / Aa); return "M0," + t + "A" + t + "," + t + " 0 1,1 0," + -t + "A" + t + "," + t + " 0 1,1 0," + t + "Z" } function Fo(n, t) { return da(n, Rs), n.id = t, n } function Oo(n, t, e, r) { var u = n.id; return P(n, "function" == typeof e ? function (n, i, o) { n.__transition__[u].tween.set(t, r(e.call(n, n.__data__, i, o))) } : (e = r(e), function (n) { n.__transition__[u].tween.set(t, e) })) } function Io(n) { return null == n && (n = ""), function () { this.textContent = n } } function Yo(n, t, e, r) { var u = n.__transition__ || (n.__transition__ = { active: 0, count: 0 }), i = u[e]; if (!i) { var a = r.time; i = u[e] = { tween: new o, time: a, ease: r.ease, delay: r.delay, duration: r.duration }, ++u.count, Go.timer(function (r) { function o(r) { return u.active > e ? s() : (u.active = e, i.event && i.event.start.call(n, l, t), i.tween.forEach(function (e, r) { (r = r.call(n, l, t)) && v.push(r) }), Go.timer(function () { return p.c = c(r || 1) ? Ne : c, 1 }, 0, a), void 0) } function c(r) { if (u.active !== e) return s(); for (var o = r / g, a = f(o), c = v.length; c > 0;) v[--c].call(n, a); return o >= 1 ? (i.event && i.event.end.call(n, l, t), s()) : void 0 } function s() { return --u.count ? delete u[e] : delete n.__transition__, 1 } var l = n.__data__, f = i.ease, h = i.delay, g = i.duration, p = nc, v = []; return p.t = h + a, r >= h ? o(r - h) : (p.c = o, void 0) }, 0, a) } } function Zo(n, t) { n.attr("transform", function (n) { return "translate(" + t(n) + ",0)" }) } function Vo(n, t) { n.attr("transform", function (n) { return "translate(0," + t(n) + ")" }) } function $o(n) { return n.toISOString() } function Xo(n, t, e) {
            function r(t) {
                return n(t)
            } function u(n, e) { var r = n[1] - n[0], u = r / e, i = Go.bisect(Ys, u); return i == Ys.length ? [t.year, Xi(n.map(function (n) { return n / 31536e6 }), e)[2]] : i ? t[u / Ys[i - 1] < Ys[i] / u ? i - 1 : i] : [$s, Xi(n, e)[2]] } return r.invert = function (t) { return Bo(n.invert(t)) }, r.domain = function (t) { return arguments.length ? (n.domain(t), r) : n.domain().map(Bo) }, r.nice = function (n, t) { function e(e) { return !isNaN(e) && !n.range(e, Bo(+e + 1), t).length } var i = r.domain(), o = ji(i), a = null == n ? u(o, 10) : "number" == typeof n && u(o, n); return a && (n = a[0], t = a[1]), r.domain(Oi(i, t > 1 ? { floor: function (t) { for (; e(t = n.floor(t)) ;) t = Bo(t - 1); return t }, ceil: function (t) { for (; e(t = n.ceil(t)) ;) t = Bo(+t + 1); return t } } : n)) }, r.ticks = function (n, t) { var e = ji(r.domain()), i = null == n ? u(e, 10) : "number" == typeof n ? u(e, n) : !n.range && [{ range: n }, t]; return i && (n = i[0], t = i[1]), n.range(e[0], Bo(+e[1] + 1), 1 > t ? 1 : t) }, r.tickFormat = function () { return e }, r.copy = function () { return Xo(n.copy(), t, e) }, Vi(r, n)
        } function Bo(n) { return new Date(n) } function Jo(n) { return JSON.parse(n.responseText) } function Wo(n) { var t = na.createRange(); return t.selectNode(na.body), t.createContextualFragment(n.responseText) } var Go = { version: "3.4.5" }; Date.now || (Date.now = function () { return +new Date }); var Ko = [].slice, Qo = function (n) { return Ko.call(n) }, na = document, ta = na.documentElement, ea = window; try { Qo(ta.childNodes)[0].nodeType } catch (ra) { Qo = function (n) { for (var t = n.length, e = new Array(t) ; t--;) e[t] = n[t]; return e } } try { na.createElement("div").style.setProperty("opacity", 0, "") } catch (ua) { var ia = ea.Element.prototype, oa = ia.setAttribute, aa = ia.setAttributeNS, ca = ea.CSSStyleDeclaration.prototype, sa = ca.setProperty; ia.setAttribute = function (n, t) { oa.call(this, n, t + "") }, ia.setAttributeNS = function (n, t, e) { aa.call(this, n, t, e + "") }, ca.setProperty = function (n, t, e) { sa.call(this, n, t + "", e) } } Go.ascending = n, Go.descending = function (n, t) { return n > t ? -1 : t > n ? 1 : t >= n ? 0 : 0 / 0 }, Go.min = function (n, t) { var e, r, u = -1, i = n.length; if (1 === arguments.length) { for (; ++u < i && !(null != (e = n[u]) && e >= e) ;) e = void 0; for (; ++u < i;) null != (r = n[u]) && e > r && (e = r) } else { for (; ++u < i && !(null != (e = t.call(n, n[u], u)) && e >= e) ;) e = void 0; for (; ++u < i;) null != (r = t.call(n, n[u], u)) && e > r && (e = r) } return e }, Go.max = function (n, t) { var e, r, u = -1, i = n.length; if (1 === arguments.length) { for (; ++u < i && !(null != (e = n[u]) && e >= e) ;) e = void 0; for (; ++u < i;) null != (r = n[u]) && r > e && (e = r) } else { for (; ++u < i && !(null != (e = t.call(n, n[u], u)) && e >= e) ;) e = void 0; for (; ++u < i;) null != (r = t.call(n, n[u], u)) && r > e && (e = r) } return e }, Go.extent = function (n, t) { var e, r, u, i = -1, o = n.length; if (1 === arguments.length) { for (; ++i < o && !(null != (e = u = n[i]) && e >= e) ;) e = u = void 0; for (; ++i < o;) null != (r = n[i]) && (e > r && (e = r), r > u && (u = r)) } else { for (; ++i < o && !(null != (e = u = t.call(n, n[i], i)) && e >= e) ;) e = void 0; for (; ++i < o;) null != (r = t.call(n, n[i], i)) && (e > r && (e = r), r > u && (u = r)) } return [e, u] }, Go.sum = function (n, t) { var e, r = 0, u = n.length, i = -1; if (1 === arguments.length) for (; ++i < u;) isNaN(e = +n[i]) || (r += e); else for (; ++i < u;) isNaN(e = +t.call(n, n[i], i)) || (r += e); return r }, Go.mean = function (n, e) { var r, u = n.length, i = 0, o = -1, a = 0; if (1 === arguments.length) for (; ++o < u;) t(r = n[o]) && (i += (r - i) / ++a); else for (; ++o < u;) t(r = e.call(n, n[o], o)) && (i += (r - i) / ++a); return a ? i : void 0 }, Go.quantile = function (n, t) { var e = (n.length - 1) * t + 1, r = Math.floor(e), u = +n[r - 1], i = e - r; return i ? u + i * (n[r] - u) : u }, Go.median = function (e, r) { return arguments.length > 1 && (e = e.map(r)), e = e.filter(t), e.length ? Go.quantile(e.sort(n), .5) : void 0 }; var la = e(n); Go.bisectLeft = la.left, Go.bisect = Go.bisectRight = la.right, Go.bisector = function (t) { return e(1 === t.length ? function (e, r) { return n(t(e), r) } : t) }, Go.shuffle = function (n) { for (var t, e, r = n.length; r;) e = 0 | Math.random() * r--, t = n[r], n[r] = n[e], n[e] = t; return n }, Go.permute = function (n, t) { for (var e = t.length, r = new Array(e) ; e--;) r[e] = n[t[e]]; return r }, Go.pairs = function (n) { for (var t, e = 0, r = n.length - 1, u = n[0], i = new Array(0 > r ? 0 : r) ; r > e;) i[e] = [t = u, u = n[++e]]; return i }, Go.zip = function () { if (!(u = arguments.length)) return []; for (var n = -1, t = Go.min(arguments, r), e = new Array(t) ; ++n < t;) for (var u, i = -1, o = e[n] = new Array(u) ; ++i < u;) o[i] = arguments[i][n]; return e }, Go.transpose = function (n) { return Go.zip.apply(Go, n) }, Go.keys = function (n) { var t = []; for (var e in n) t.push(e); return t }, Go.values = function (n) { var t = []; for (var e in n) t.push(n[e]); return t }, Go.entries = function (n) { var t = []; for (var e in n) t.push({ key: e, value: n[e] }); return t }, Go.merge = function (n) { for (var t, e, r, u = n.length, i = -1, o = 0; ++i < u;) o += n[i].length; for (e = new Array(o) ; --u >= 0;) for (r = n[u], t = r.length; --t >= 0;) e[--o] = r[t]; return e }; var fa = Math.abs; Go.range = function (n, t, e) { if (arguments.length < 3 && (e = 1, arguments.length < 2 && (t = n, n = 0)), 1 / 0 === (t - n) / e) throw new Error("infinite range"); var r, i = [], o = u(fa(e)), a = -1; if (n *= o, t *= o, e *= o, 0 > e) for (; (r = n + e * ++a) > t;) i.push(r / o); else for (; (r = n + e * ++a) < t;) i.push(r / o); return i }, Go.map = function (n) { var t = new o; if (n instanceof o) n.forEach(function (n, e) { t.set(n, e) }); else for (var e in n) t.set(e, n[e]); return t }, i(o, { has: a, get: function (n) { return this[ha + n] }, set: function (n, t) { return this[ha + n] = t }, remove: c, keys: s, values: function () { var n = []; return this.forEach(function (t, e) { n.push(e) }), n }, entries: function () { var n = []; return this.forEach(function (t, e) { n.push({ key: t, value: e }) }), n }, size: l, empty: f, forEach: function (n) { for (var t in this) t.charCodeAt(0) === ga && n.call(this, t.substring(1), this[t]) } }); var ha = "\x00", ga = ha.charCodeAt(0); Go.nest = function () { function n(t, a, c) { if (c >= i.length) return r ? r.call(u, a) : e ? a.sort(e) : a; for (var s, l, f, h, g = -1, p = a.length, v = i[c++], d = new o; ++g < p;) (h = d.get(s = v(l = a[g]))) ? h.push(l) : d.set(s, [l]); return t ? (l = t(), f = function (e, r) { l.set(e, n(t, r, c)) }) : (l = {}, f = function (e, r) { l[e] = n(t, r, c) }), d.forEach(f), l } function t(n, e) { if (e >= i.length) return n; var r = [], u = a[e++]; return n.forEach(function (n, u) { r.push({ key: n, values: t(u, e) }) }), u ? r.sort(function (n, t) { return u(n.key, t.key) }) : r } var e, r, u = {}, i = [], a = []; return u.map = function (t, e) { return n(e, t, 0) }, u.entries = function (e) { return t(n(Go.map, e, 0), 0) }, u.key = function (n) { return i.push(n), u }, u.sortKeys = function (n) { return a[i.length - 1] = n, u }, u.sortValues = function (n) { return e = n, u }, u.rollup = function (n) { return r = n, u }, u }, Go.set = function (n) { var t = new h; if (n) for (var e = 0, r = n.length; r > e; ++e) t.add(n[e]); return t }, i(h, { has: a, add: function (n) { return this[ha + n] = !0, n }, remove: function (n) { return n = ha + n, n in this && delete this[n] }, values: s, size: l, empty: f, forEach: function (n) { for (var t in this) t.charCodeAt(0) === ga && n.call(this, t.substring(1)) } }), Go.behavior = {}, Go.rebind = function (n, t) { for (var e, r = 1, u = arguments.length; ++r < u;) n[e = arguments[r]] = g(n, t, t[e]); return n }; var pa = ["webkit", "ms", "moz", "Moz", "o", "O"]; Go.dispatch = function () { for (var n = new d, t = -1, e = arguments.length; ++t < e;) n[arguments[t]] = m(n); return n }, d.prototype.on = function (n, t) { var e = n.indexOf("."), r = ""; if (e >= 0 && (r = n.substring(e + 1), n = n.substring(0, e)), n) return arguments.length < 2 ? this[n].on(r) : this[n].on(r, t); if (2 === arguments.length) { if (null == t) for (n in this) this.hasOwnProperty(n) && this[n].on(r, null); return this } }, Go.event = null, Go.requote = function (n) { return n.replace(va, "\\$&") }; var va = /[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g, da = {}.__proto__ ? function (n, t) { n.__proto__ = t } : function (n, t) { for (var e in t) n[e] = t[e] }, ma = function (n, t) { return t.querySelector(n) }, ya = function (n, t) { return t.querySelectorAll(n) }, xa = ta[p(ta, "matchesSelector")], Ma = function (n, t) { return xa.call(n, t) }; "function" == typeof Sizzle && (ma = function (n, t) { return Sizzle(n, t)[0] || null }, ya = Sizzle, Ma = Sizzle.matchesSelector), Go.selection = function () { return Sa }; var _a = Go.selection.prototype = []; _a.select = function (n) { var t, e, r, u, i = []; n = b(n); for (var o = -1, a = this.length; ++o < a;) { i.push(t = []), t.parentNode = (r = this[o]).parentNode; for (var c = -1, s = r.length; ++c < s;) (u = r[c]) ? (t.push(e = n.call(u, u.__data__, c, o)), e && "__data__" in u && (e.__data__ = u.__data__)) : t.push(null) } return _(i) }, _a.selectAll = function (n) { var t, e, r = []; n = w(n); for (var u = -1, i = this.length; ++u < i;) for (var o = this[u], a = -1, c = o.length; ++a < c;) (e = o[a]) && (r.push(t = Qo(n.call(e, e.__data__, a, u))), t.parentNode = e); return _(r) }; var ba = { svg: "http://www.w3.org/2000/svg", xhtml: "http://www.w3.org/1999/xhtml", xlink: "http://www.w3.org/1999/xlink", xml: "http://www.w3.org/XML/1998/namespace", xmlns: "http://www.w3.org/2000/xmlns/" }; Go.ns = { prefix: ba, qualify: function (n) { var t = n.indexOf(":"), e = n; return t >= 0 && (e = n.substring(0, t), n = n.substring(t + 1)), ba.hasOwnProperty(e) ? { space: ba[e], local: n } : n } }, _a.attr = function (n, t) { if (arguments.length < 2) { if ("string" == typeof n) { var e = this.node(); return n = Go.ns.qualify(n), n.local ? e.getAttributeNS(n.space, n.local) : e.getAttribute(n) } for (t in n) this.each(S(t, n[t])); return this } return this.each(S(n, t)) }, _a.classed = function (n, t) { if (arguments.length < 2) { if ("string" == typeof n) { var e = this.node(), r = (n = N(n)).length, u = -1; if (t = e.classList) { for (; ++u < r;) if (!t.contains(n[u])) return !1 } else for (t = e.getAttribute("class") ; ++u < r;) if (!E(n[u]).test(t)) return !1; return !0 } for (t in n) this.each(A(t, n[t])); return this } return this.each(A(n, t)) }, _a.style = function (n, t, e) { var r = arguments.length; if (3 > r) { if ("string" != typeof n) { 2 > r && (t = ""); for (e in n) this.each(L(e, n[e], t)); return this } if (2 > r) return ea.getComputedStyle(this.node(), null).getPropertyValue(n); e = "" } return this.each(L(n, t, e)) }, _a.property = function (n, t) { if (arguments.length < 2) { if ("string" == typeof n) return this.node()[n]; for (t in n) this.each(T(t, n[t])); return this } return this.each(T(n, t)) }, _a.text = function (n) { return arguments.length ? this.each("function" == typeof n ? function () { var t = n.apply(this, arguments); this.textContent = null == t ? "" : t } : null == n ? function () { this.textContent = "" } : function () { this.textContent = n }) : this.node().textContent }, _a.html = function (n) { return arguments.length ? this.each("function" == typeof n ? function () { var t = n.apply(this, arguments); this.innerHTML = null == t ? "" : t } : null == n ? function () { this.innerHTML = "" } : function () { this.innerHTML = n }) : this.node().innerHTML }, _a.append = function (n) { return n = q(n), this.select(function () { return this.appendChild(n.apply(this, arguments)) }) }, _a.insert = function (n, t) { return n = q(n), t = b(t), this.select(function () { return this.insertBefore(n.apply(this, arguments), t.apply(this, arguments) || null) }) }, _a.remove = function () { return this.each(function () { var n = this.parentNode; n && n.removeChild(this) }) }, _a.data = function (n, t) { function e(n, e) { var r, u, i, a = n.length, f = e.length, h = Math.min(a, f), g = new Array(f), p = new Array(f), v = new Array(a); if (t) { var d, m = new o, y = new o, x = []; for (r = -1; ++r < a;) d = t.call(u = n[r], u.__data__, r), m.has(d) ? v[r] = u : m.set(d, u), x.push(d); for (r = -1; ++r < f;) d = t.call(e, i = e[r], r), (u = m.get(d)) ? (g[r] = u, u.__data__ = i) : y.has(d) || (p[r] = z(i)), y.set(d, i), m.remove(d); for (r = -1; ++r < a;) m.has(x[r]) && (v[r] = n[r]) } else { for (r = -1; ++r < h;) u = n[r], i = e[r], u ? (u.__data__ = i, g[r] = u) : p[r] = z(i); for (; f > r; ++r) p[r] = z(e[r]); for (; a > r; ++r) v[r] = n[r] } p.update = g, p.parentNode = g.parentNode = v.parentNode = n.parentNode, c.push(p), s.push(g), l.push(v) } var r, u, i = -1, a = this.length; if (!arguments.length) { for (n = new Array(a = (r = this[0]).length) ; ++i < a;) (u = r[i]) && (n[i] = u.__data__); return n } var c = U([]), s = _([]), l = _([]); if ("function" == typeof n) for (; ++i < a;) e(r = this[i], n.call(r, r.parentNode.__data__, i)); else for (; ++i < a;) e(r = this[i], n); return s.enter = function () { return c }, s.exit = function () { return l }, s }, _a.datum = function (n) { return arguments.length ? this.property("__data__", n) : this.property("__data__") }, _a.filter = function (n) { var t, e, r, u = []; "function" != typeof n && (n = R(n)); for (var i = 0, o = this.length; o > i; i++) { u.push(t = []), t.parentNode = (e = this[i]).parentNode; for (var a = 0, c = e.length; c > a; a++) (r = e[a]) && n.call(r, r.__data__, a, i) && t.push(r) } return _(u) }, _a.order = function () { for (var n = -1, t = this.length; ++n < t;) for (var e, r = this[n], u = r.length - 1, i = r[u]; --u >= 0;) (e = r[u]) && (i && i !== e.nextSibling && i.parentNode.insertBefore(e, i), i = e); return this }, _a.sort = function (n) { n = D.apply(this, arguments); for (var t = -1, e = this.length; ++t < e;) this[t].sort(n); return this.order() }, _a.each = function (n) { return P(this, function (t, e, r) { n.call(t, t.__data__, e, r) }) }, _a.call = function (n) { var t = Qo(arguments); return n.apply(t[0] = this, t), this }, _a.empty = function () { return !this.node() }, _a.node = function () { for (var n = 0, t = this.length; t > n; n++) for (var e = this[n], r = 0, u = e.length; u > r; r++) { var i = e[r]; if (i) return i } return null }, _a.size = function () { var n = 0; return this.each(function () { ++n }), n }; var wa = []; Go.selection.enter = U, Go.selection.enter.prototype = wa, wa.append = _a.append, wa.empty = _a.empty, wa.node = _a.node, wa.call = _a.call, wa.size = _a.size, wa.select = function (n) { for (var t, e, r, u, i, o = [], a = -1, c = this.length; ++a < c;) { r = (u = this[a]).update, o.push(t = []), t.parentNode = u.parentNode; for (var s = -1, l = u.length; ++s < l;) (i = u[s]) ? (t.push(r[s] = e = n.call(u.parentNode, i.__data__, s, a)), e.__data__ = i.__data__) : t.push(null) } return _(o) }, wa.insert = function (n, t) { return arguments.length < 2 && (t = j(this)), _a.insert.call(this, n, t) }, _a.transition = function () { for (var n, t, e = Ls || ++Ds, r = [], u = Ts || { time: Date.now(), ease: wu, delay: 0, duration: 250 }, i = -1, o = this.length; ++i < o;) { r.push(n = []); for (var a = this[i], c = -1, s = a.length; ++c < s;) (t = a[c]) && Yo(t, c, e, u), n.push(t) } return Fo(r, e) }, _a.interrupt = function () { return this.each(H) }, Go.select = function (n) { var t = ["string" == typeof n ? ma(n, na) : n]; return t.parentNode = ta, _([t]) }, Go.selectAll = function (n) { var t = Qo("string" == typeof n ? ya(n, na) : n); return t.parentNode = ta, _([t]) }; var Sa = Go.select(ta); _a.on = function (n, t, e) { var r = arguments.length; if (3 > r) { if ("string" != typeof n) { 2 > r && (t = !1); for (e in n) this.each(F(e, n[e], t)); return this } if (2 > r) return (r = this.node()["__on" + n]) && r._; e = !1 } return this.each(F(n, t, e)) }; var ka = Go.map({ mouseenter: "mouseover", mouseleave: "mouseout" }); ka.forEach(function (n) { "on" + n in na && ka.remove(n) }); var Ea = "onselectstart" in na ? null : p(ta.style, "userSelect"), Na = 0; Go.mouse = function (n) { return Z(n, x()) }, Go.touches = function (n, t) { return arguments.length < 2 && (t = x().touches), t ? Qo(t).map(function (t) { var e = Z(n, t); return e.identifier = t.identifier, e }) : [] }, Go.behavior.drag = function () { function n() { this.on("mousedown.drag", u).on("touchstart.drag", i) } function t(n, t, u, i, o) { return function () { function a() { var n, e, r = t(h, v); r && (n = r[0] - x[0], e = r[1] - x[1], p |= n | e, x = r, g({ type: "drag", x: r[0] + s[0], y: r[1] + s[1], dx: n, dy: e })) } function c() { t(h, v) && (m.on(i + d, null).on(o + d, null), y(p && Go.event.target === f), g({ type: "dragend" })) } var s, l = this, f = Go.event.target, h = l.parentNode, g = e.of(l, arguments), p = 0, v = n(), d = ".drag" + (null == v ? "" : "-" + v), m = Go.select(u()).on(i + d, a).on(o + d, c), y = Y(), x = t(h, v); r ? (s = r.apply(l, arguments), s = [s.x - x[0], s.y - x[1]]) : s = [0, 0], g({ type: "dragstart" }) } } var e = M(n, "drag", "dragstart", "dragend"), r = null, u = t(v, Go.mouse, X, "mousemove", "mouseup"), i = t(V, Go.touch, $, "touchmove", "touchend"); return n.origin = function (t) { return arguments.length ? (r = t, n) : r }, Go.rebind(n, e, "on") }; var Aa = Math.PI, Ca = 2 * Aa, La = Aa / 2, Ta = 1e-6, qa = Ta * Ta, za = Aa / 180, Ra = 180 / Aa, Da = Math.SQRT2, Pa = 2, Ua = 4; Go.interpolateZoom = function (n, t) { function e(n) { var t = n * y; if (m) { var e = Q(v), o = i / (Pa * h) * (e * nt(Da * t + v) - K(v)); return [r + o * s, u + o * l, i * e / Q(Da * t + v)] } return [r + n * s, u + n * l, i * Math.exp(Da * t)] } var r = n[0], u = n[1], i = n[2], o = t[0], a = t[1], c = t[2], s = o - r, l = a - u, f = s * s + l * l, h = Math.sqrt(f), g = (c * c - i * i + Ua * f) / (2 * i * Pa * h), p = (c * c - i * i - Ua * f) / (2 * c * Pa * h), v = Math.log(Math.sqrt(g * g + 1) - g), d = Math.log(Math.sqrt(p * p + 1) - p), m = d - v, y = (m || Math.log(c / i)) / Da; return e.duration = 1e3 * y, e }, Go.behavior.zoom = function () { function n(n) { n.on(N, s).on(Fa + ".zoom", f).on(A, h).on("dblclick.zoom", g).on(L, l) } function t(n) { return [(n[0] - S.x) / S.k, (n[1] - S.y) / S.k] } function e(n) { return [n[0] * S.k + S.x, n[1] * S.k + S.y] } function r(n) { S.k = Math.max(E[0], Math.min(E[1], n)) } function u(n, t) { t = e(t), S.x += n[0] - t[0], S.y += n[1] - t[1] } function i() { _ && _.domain(x.range().map(function (n) { return (n - S.x) / S.k }).map(x.invert)), w && w.domain(b.range().map(function (n) { return (n - S.y) / S.k }).map(b.invert)) } function o(n) { n({ type: "zoomstart" }) } function a(n) { i(), n({ type: "zoom", scale: S.k, translate: [S.x, S.y] }) } function c(n) { n({ type: "zoomend" }) } function s() { function n() { l = 1, u(Go.mouse(r), g), a(s) } function e() { f.on(A, ea === r ? h : null).on(C, null), p(l && Go.event.target === i), c(s) } var r = this, i = Go.event.target, s = T.of(r, arguments), l = 0, f = Go.select(ea).on(A, n).on(C, e), g = t(Go.mouse(r)), p = Y(); H.call(r), o(s) } function l() { function n() { var n = Go.touches(g); return h = S.k, n.forEach(function (n) { n.identifier in v && (v[n.identifier] = t(n)) }), n } function e() { for (var t = Go.event.changedTouches, e = 0, i = t.length; i > e; ++e) v[t[e].identifier] = null; var o = n(), c = Date.now(); if (1 === o.length) { if (500 > c - m) { var s = o[0], l = v[s.identifier]; r(2 * S.k), u(s, l), y(), a(p) } m = c } else if (o.length > 1) { var s = o[0], f = o[1], h = s[0] - f[0], g = s[1] - f[1]; d = h * h + g * g } } function i() { for (var n, t, e, i, o = Go.touches(g), c = 0, s = o.length; s > c; ++c, i = null) if (e = o[c], i = v[e.identifier]) { if (t) break; n = e, t = i } if (i) { var l = (l = e[0] - n[0]) * l + (l = e[1] - n[1]) * l, f = d && Math.sqrt(l / d); n = [(n[0] + e[0]) / 2, (n[1] + e[1]) / 2], t = [(t[0] + i[0]) / 2, (t[1] + i[1]) / 2], r(f * h) } m = null, u(n, t), a(p) } function f() { if (Go.event.touches.length) { for (var t = Go.event.changedTouches, e = 0, r = t.length; r > e; ++e) delete v[t[e].identifier]; for (var u in v) return void n() } b.on(x, null), w.on(N, s).on(L, l), k(), c(p) } var h, g = this, p = T.of(g, arguments), v = {}, d = 0, x = ".zoom-" + Go.event.changedTouches[0].identifier, M = "touchmove" + x, _ = "touchend" + x, b = Go.select(Go.event.target).on(M, i).on(_, f), w = Go.select(g).on(N, null).on(L, e), k = Y(); H.call(g), e(), o(p) } function f() { var n = T.of(this, arguments); d ? clearTimeout(d) : (H.call(this), o(n)), d = setTimeout(function () { d = null, c(n) }, 50), y(); var e = v || Go.mouse(this); p || (p = t(e)), r(Math.pow(2, .002 * ja()) * S.k), u(e, p), a(n) } function h() { p = null } function g() { var n = T.of(this, arguments), e = Go.mouse(this), i = t(e), s = Math.log(S.k) / Math.LN2; o(n), r(Math.pow(2, Go.event.shiftKey ? Math.ceil(s) - 1 : Math.floor(s) + 1)), u(e, i), a(n), c(n) } var p, v, d, m, x, _, b, w, S = { x: 0, y: 0, k: 1 }, k = [960, 500], E = Ha, N = "mousedown.zoom", A = "mousemove.zoom", C = "mouseup.zoom", L = "touchstart.zoom", T = M(n, "zoomstart", "zoom", "zoomend"); return n.event = function (n) { n.each(function () { var n = T.of(this, arguments), t = S; Ls ? Go.select(this).transition().each("start.zoom", function () { S = this.__chart__ || { x: 0, y: 0, k: 1 }, o(n) }).tween("zoom:zoom", function () { var e = k[0], r = k[1], u = e / 2, i = r / 2, o = Go.interpolateZoom([(u - S.x) / S.k, (i - S.y) / S.k, e / S.k], [(u - t.x) / t.k, (i - t.y) / t.k, e / t.k]); return function (t) { var r = o(t), c = e / r[2]; this.__chart__ = S = { x: u - r[0] * c, y: i - r[1] * c, k: c }, a(n) } }).each("end.zoom", function () { c(n) }) : (this.__chart__ = S, o(n), a(n), c(n)) }) }, n.translate = function (t) { return arguments.length ? (S = { x: +t[0], y: +t[1], k: S.k }, i(), n) : [S.x, S.y] }, n.scale = function (t) { return arguments.length ? (S = { x: S.x, y: S.y, k: +t }, i(), n) : S.k }, n.scaleExtent = function (t) { return arguments.length ? (E = null == t ? Ha : [+t[0], +t[1]], n) : E }, n.center = function (t) { return arguments.length ? (v = t && [+t[0], +t[1]], n) : v }, n.size = function (t) { return arguments.length ? (k = t && [+t[0], +t[1]], n) : k }, n.x = function (t) { return arguments.length ? (_ = t, x = t.copy(), S = { x: 0, y: 0, k: 1 }, n) : _ }, n.y = function (t) { return arguments.length ? (w = t, b = t.copy(), S = { x: 0, y: 0, k: 1 }, n) : w }, Go.rebind(n, T, "on") }; var ja, Ha = [0, 1 / 0], Fa = "onwheel" in na ? (ja = function () { return -Go.event.deltaY * (Go.event.deltaMode ? 120 : 1) }, "wheel") : "onmousewheel" in na ? (ja = function () { return Go.event.wheelDelta }, "mousewheel") : (ja = function () { return -Go.event.detail }, "MozMousePixelScroll"); et.prototype.toString = function () { return this.rgb() + "" }, Go.hsl = function (n, t, e) { return 1 === arguments.length ? n instanceof ut ? rt(n.h, n.s, n.l) : _t("" + n, bt, rt) : rt(+n, +t, +e) }; var Oa = ut.prototype = new et; Oa.brighter = function (n) { return n = Math.pow(.7, arguments.length ? n : 1), rt(this.h, this.s, this.l / n) }, Oa.darker = function (n) { return n = Math.pow(.7, arguments.length ? n : 1), rt(this.h, this.s, n * this.l) }, Oa.rgb = function () { return it(this.h, this.s, this.l) }, Go.hcl = function (n, t, e) { return 1 === arguments.length ? n instanceof at ? ot(n.h, n.c, n.l) : n instanceof lt ? ht(n.l, n.a, n.b) : ht((n = wt((n = Go.rgb(n)).r, n.g, n.b)).l, n.a, n.b) : ot(+n, +t, +e) }; var Ia = at.prototype = new et; Ia.brighter = function (n) { return ot(this.h, this.c, Math.min(100, this.l + Ya * (arguments.length ? n : 1))) }, Ia.darker = function (n) { return ot(this.h, this.c, Math.max(0, this.l - Ya * (arguments.length ? n : 1))) }, Ia.rgb = function () { return ct(this.h, this.c, this.l).rgb() }, Go.lab = function (n, t, e) { return 1 === arguments.length ? n instanceof lt ? st(n.l, n.a, n.b) : n instanceof at ? ct(n.l, n.c, n.h) : wt((n = Go.rgb(n)).r, n.g, n.b) : st(+n, +t, +e) }; var Ya = 18, Za = .95047, Va = 1, $a = 1.08883, Xa = lt.prototype = new et; Xa.brighter = function (n) { return st(Math.min(100, this.l + Ya * (arguments.length ? n : 1)), this.a, this.b) }, Xa.darker = function (n) { return st(Math.max(0, this.l - Ya * (arguments.length ? n : 1)), this.a, this.b) }, Xa.rgb = function () { return ft(this.l, this.a, this.b) }, Go.rgb = function (n, t, e) { return 1 === arguments.length ? n instanceof xt ? yt(n.r, n.g, n.b) : _t("" + n, yt, it) : yt(~~n, ~~t, ~~e) }; var Ba = xt.prototype = new et; Ba.brighter = function (n) { n = Math.pow(.7, arguments.length ? n : 1); var t = this.r, e = this.g, r = this.b, u = 30; return t || e || r ? (t && u > t && (t = u), e && u > e && (e = u), r && u > r && (r = u), yt(Math.min(255, ~~(t / n)), Math.min(255, ~~(e / n)), Math.min(255, ~~(r / n)))) : yt(u, u, u) }, Ba.darker = function (n) { return n = Math.pow(.7, arguments.length ? n : 1), yt(~~(n * this.r), ~~(n * this.g), ~~(n * this.b)) }, Ba.hsl = function () { return bt(this.r, this.g, this.b) }, Ba.toString = function () { return "#" + Mt(this.r) + Mt(this.g) + Mt(this.b) }; var Ja = Go.map({ aliceblue: 15792383, antiquewhite: 16444375, aqua: 65535, aquamarine: 8388564, azure: 15794175, beige: 16119260, bisque: 16770244, black: 0, blanchedalmond: 16772045, blue: 255, blueviolet: 9055202, brown: 10824234, burlywood: 14596231, cadetblue: 6266528, chartreuse: 8388352, chocolate: 13789470, coral: 16744272, cornflowerblue: 6591981, cornsilk: 16775388, crimson: 14423100, cyan: 65535, darkblue: 139, darkcyan: 35723, darkgoldenrod: 12092939, darkgray: 11119017, darkgreen: 25600, darkgrey: 11119017, darkkhaki: 12433259, darkmagenta: 9109643, darkolivegreen: 5597999, darkorange: 16747520, darkorchid: 10040012, darkred: 9109504, darksalmon: 15308410, darkseagreen: 9419919, darkslateblue: 4734347, darkslategray: 3100495, darkslategrey: 3100495, darkturquoise: 52945, darkviolet: 9699539, deeppink: 16716947, deepskyblue: 49151, dimgray: 6908265, dimgrey: 6908265, dodgerblue: 2003199, firebrick: 11674146, floralwhite: 16775920, forestgreen: 2263842, fuchsia: 16711935, gainsboro: 14474460, ghostwhite: 16316671, gold: 16766720, goldenrod: 14329120, gray: 8421504, green: 32768, greenyellow: 11403055, grey: 8421504, honeydew: 15794160, hotpink: 16738740, indianred: 13458524, indigo: 4915330, ivory: 16777200, khaki: 15787660, lavender: 15132410, lavenderblush: 16773365, lawngreen: 8190976, lemonchiffon: 16775885, lightblue: 11393254, lightcoral: 15761536, lightcyan: 14745599, lightgoldenrodyellow: 16448210, lightgray: 13882323, lightgreen: 9498256, lightgrey: 13882323, lightpink: 16758465, lightsalmon: 16752762, lightseagreen: 2142890, lightskyblue: 8900346, lightslategray: 7833753, lightslategrey: 7833753, lightsteelblue: 11584734, lightyellow: 16777184, lime: 65280, limegreen: 3329330, linen: 16445670, magenta: 16711935, maroon: 8388608, mediumaquamarine: 6737322, mediumblue: 205, mediumorchid: 12211667, mediumpurple: 9662683, mediumseagreen: 3978097, mediumslateblue: 8087790, mediumspringgreen: 64154, mediumturquoise: 4772300, mediumvioletred: 13047173, midnightblue: 1644912, mintcream: 16121850, mistyrose: 16770273, moccasin: 16770229, navajowhite: 16768685, navy: 128, oldlace: 16643558, olive: 8421376, olivedrab: 7048739, orange: 16753920, orangered: 16729344, orchid: 14315734, palegoldenrod: 15657130, palegreen: 10025880, paleturquoise: 11529966, palevioletred: 14381203, papayawhip: 16773077, peachpuff: 16767673, peru: 13468991, pink: 16761035, plum: 14524637, powderblue: 11591910, purple: 8388736, red: 16711680, rosybrown: 12357519, royalblue: 4286945, saddlebrown: 9127187, salmon: 16416882, sandybrown: 16032864, seagreen: 3050327, seashell: 16774638, sienna: 10506797, silver: 12632256, skyblue: 8900331, slateblue: 6970061, slategray: 7372944, slategrey: 7372944, snow: 16775930, springgreen: 65407, steelblue: 4620980, tan: 13808780, teal: 32896, thistle: 14204888, tomato: 16737095, turquoise: 4251856, violet: 15631086, wheat: 16113331, white: 16777215, whitesmoke: 16119285, yellow: 16776960, yellowgreen: 10145074 }); Ja.forEach(function (n, t) { Ja.set(n, dt(t)) }), Go.functor = Et, Go.xhr = At(Nt), Go.dsv = function (n, t) { function e(n, e, i) { arguments.length < 3 && (i = e, e = null); var o = Ct(n, t, null == e ? r : u(e), i); return o.row = function (n) { return arguments.length ? o.response(null == (e = n) ? r : u(n)) : e }, o } function r(n) { return e.parse(n.responseText) } function u(n) { return function (t) { return e.parse(t.responseText, n) } } function i(t) { return t.map(o).join(n) } function o(n) { return a.test(n) ? '"' + n.replace(/\"/g, '""') + '"' : n } var a = new RegExp('["' + n + "\n]"), c = n.charCodeAt(0); return e.parse = function (n, t) { var r; return e.parseRows(n, function (n, e) { if (r) return r(n, e - 1); var u = new Function("d", "return {" + n.map(function (n, t) { return JSON.stringify(n) + ": d[" + t + "]" }).join(",") + "}"); r = t ? function (n, e) { return t(u(n), e) } : u }) }, e.parseRows = function (n, t) { function e() { if (l >= s) return o; if (u) return u = !1, i; var t = l; if (34 === n.charCodeAt(t)) { for (var e = t; e++ < s;) if (34 === n.charCodeAt(e)) { if (34 !== n.charCodeAt(e + 1)) break; ++e } l = e + 2; var r = n.charCodeAt(e + 1); return 13 === r ? (u = !0, 10 === n.charCodeAt(e + 2) && ++l) : 10 === r && (u = !0), n.substring(t + 1, e).replace(/""/g, '"') } for (; s > l;) { var r = n.charCodeAt(l++), a = 1; if (10 === r) u = !0; else if (13 === r) u = !0, 10 === n.charCodeAt(l) && (++l, ++a); else if (r !== c) continue; return n.substring(t, l - a) } return n.substring(t) } for (var r, u, i = {}, o = {}, a = [], s = n.length, l = 0, f = 0; (r = e()) !== o;) { for (var h = []; r !== i && r !== o;) h.push(r), r = e(); (!t || (h = t(h, f++))) && a.push(h) } return a }, e.format = function (t) { if (Array.isArray(t[0])) return e.formatRows(t); var r = new h, u = []; return t.forEach(function (n) { for (var t in n) r.has(t) || u.push(r.add(t)) }), [u.map(o).join(n)].concat(t.map(function (t) { return u.map(function (n) { return o(t[n]) }).join(n) })).join("\n") }, e.formatRows = function (n) { return n.map(i).join("\n") }, e }, Go.csv = Go.dsv(",", "text/csv"), Go.tsv = Go.dsv("	", "text/tab-separated-values"), Go.touch = function (n, t, e) { if (arguments.length < 3 && (e = t, t = x().changedTouches), t) for (var r, u = 0, i = t.length; i > u; ++u) if ((r = t[u]).identifier === e) return Z(n, r) }; var Wa, Ga, Ka, Qa, nc, tc = ea[p(ea, "requestAnimationFrame")] || function (n) { setTimeout(n, 17) }; Go.timer = function (n, t, e) { var r = arguments.length; 2 > r && (t = 0), 3 > r && (e = Date.now()); var u = e + t, i = { c: n, t: u, f: !1, n: null }; Ga ? Ga.n = i : Wa = i, Ga = i, Ka || (Qa = clearTimeout(Qa), Ka = 1, tc(Tt)) }, Go.timer.flush = function () { qt(), zt() }, Go.round = function (n, t) { return t ? Math.round(n * (t = Math.pow(10, t))) / t : Math.round(n) }; var ec = ["y", "z", "a", "f", "p", "n", "\xb5", "m", "", "k", "M", "G", "T", "P", "E", "Z", "Y"].map(Dt); Go.formatPrefix = function (n, t) { var e = 0; return n && (0 > n && (n *= -1), t && (n = Go.round(n, Rt(n, t))), e = 1 + Math.floor(1e-12 + Math.log(n) / Math.LN10), e = Math.max(-24, Math.min(24, 3 * Math.floor((e - 1) / 3)))), ec[8 + e / 3] }; var rc = /(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i, uc = Go.map({ b: function (n) { return n.toString(2) }, c: function (n) { return String.fromCharCode(n) }, o: function (n) { return n.toString(8) }, x: function (n) { return n.toString(16) }, X: function (n) { return n.toString(16).toUpperCase() }, g: function (n, t) { return n.toPrecision(t) }, e: function (n, t) { return n.toExponential(t) }, f: function (n, t) { return n.toFixed(t) }, r: function (n, t) { return (n = Go.round(n, Rt(n, t))).toFixed(Math.max(0, Math.min(20, Rt(n * (1 + 1e-15), t)))) } }), ic = Go.time = {}, oc = Date; jt.prototype = { getDate: function () { return this._.getUTCDate() }, getDay: function () { return this._.getUTCDay() }, getFullYear: function () { return this._.getUTCFullYear() }, getHours: function () { return this._.getUTCHours() }, getMilliseconds: function () { return this._.getUTCMilliseconds() }, getMinutes: function () { return this._.getUTCMinutes() }, getMonth: function () { return this._.getUTCMonth() }, getSeconds: function () { return this._.getUTCSeconds() }, getTime: function () { return this._.getTime() }, getTimezoneOffset: function () { return 0 }, valueOf: function () { return this._.valueOf() }, setDate: function () { ac.setUTCDate.apply(this._, arguments) }, setDay: function () { ac.setUTCDay.apply(this._, arguments) }, setFullYear: function () { ac.setUTCFullYear.apply(this._, arguments) }, setHours: function () { ac.setUTCHours.apply(this._, arguments) }, setMilliseconds: function () { ac.setUTCMilliseconds.apply(this._, arguments) }, setMinutes: function () { ac.setUTCMinutes.apply(this._, arguments) }, setMonth: function () { ac.setUTCMonth.apply(this._, arguments) }, setSeconds: function () { ac.setUTCSeconds.apply(this._, arguments) }, setTime: function () { ac.setTime.apply(this._, arguments) } }; var ac = Date.prototype; ic.year = Ht(function (n) { return n = ic.day(n), n.setMonth(0, 1), n }, function (n, t) { n.setFullYear(n.getFullYear() + t) }, function (n) { return n.getFullYear() }), ic.years = ic.year.range, ic.years.utc = ic.year.utc.range, ic.day = Ht(function (n) { var t = new oc(2e3, 0); return t.setFullYear(n.getFullYear(), n.getMonth(), n.getDate()), t }, function (n, t) { n.setDate(n.getDate() + t) }, function (n) { return n.getDate() - 1 }), ic.days = ic.day.range, ic.days.utc = ic.day.utc.range, ic.dayOfYear = function (n) { var t = ic.year(n); return Math.floor((n - t - 6e4 * (n.getTimezoneOffset() - t.getTimezoneOffset())) / 864e5) }, ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"].forEach(function (n, t) { t = 7 - t; var e = ic[n] = Ht(function (n) { return (n = ic.day(n)).setDate(n.getDate() - (n.getDay() + t) % 7), n }, function (n, t) { n.setDate(n.getDate() + 7 * Math.floor(t)) }, function (n) { var e = ic.year(n).getDay(); return Math.floor((ic.dayOfYear(n) + (e + t) % 7) / 7) - (e !== t) }); ic[n + "s"] = e.range, ic[n + "s"].utc = e.utc.range, ic[n + "OfYear"] = function (n) { var e = ic.year(n).getDay(); return Math.floor((ic.dayOfYear(n) + (e + t) % 7) / 7) } }), ic.week = ic.sunday, ic.weeks = ic.sunday.range, ic.weeks.utc = ic.sunday.utc.range, ic.weekOfYear = ic.sundayOfYear; var cc = { "-": "", _: " ", 0: "0" }, sc = /^\s*\d+/, lc = /^%/; Go.locale = function (n) { return { numberFormat: Pt(n), timeFormat: Ot(n) } }; var fc = Go.locale({ decimal: ".", thousands: ",", grouping: [3], currency: ["$", ""], dateTime: "%a %b %e %X %Y", date: "%m/%d/%Y", time: "%H:%M:%S", periods: ["AM", "PM"], days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"], shortDays: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"], months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"], shortMonths: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"] }); Go.format = fc.numberFormat, Go.geo = {}, ce.prototype = { s: 0, t: 0, add: function (n) { se(n, this.t, hc), se(hc.s, this.s, this), this.s ? this.t += hc.t : this.s = hc.t }, reset: function () { this.s = this.t = 0 }, valueOf: function () { return this.s } }; var hc = new ce; Go.geo.stream = function (n, t) { n && gc.hasOwnProperty(n.type) ? gc[n.type](n, t) : le(n, t) }; var gc = { Feature: function (n, t) { le(n.geometry, t) }, FeatureCollection: function (n, t) { for (var e = n.features, r = -1, u = e.length; ++r < u;) le(e[r].geometry, t) } }, pc = { Sphere: function (n, t) { t.sphere() }, Point: function (n, t) { n = n.coordinates, t.point(n[0], n[1], n[2]) }, MultiPoint: function (n, t) { for (var e = n.coordinates, r = -1, u = e.length; ++r < u;) n = e[r], t.point(n[0], n[1], n[2]) }, LineString: function (n, t) { fe(n.coordinates, t, 0) }, MultiLineString: function (n, t) { for (var e = n.coordinates, r = -1, u = e.length; ++r < u;) fe(e[r], t, 0) }, Polygon: function (n, t) { he(n.coordinates, t) }, MultiPolygon: function (n, t) { for (var e = n.coordinates, r = -1, u = e.length; ++r < u;) he(e[r], t) }, GeometryCollection: function (n, t) { for (var e = n.geometries, r = -1, u = e.length; ++r < u;) le(e[r], t) } }; Go.geo.area = function (n) { return vc = 0, Go.geo.stream(n, mc), vc }; var vc, dc = new ce, mc = { sphere: function () { vc += 4 * Aa }, point: v, lineStart: v, lineEnd: v, polygonStart: function () { dc.reset(), mc.lineStart = ge }, polygonEnd: function () { var n = 2 * dc; vc += 0 > n ? 4 * Aa + n : n, mc.lineStart = mc.lineEnd = mc.point = v } }; Go.geo.bounds = function () {
            function n(n, t) { x.push(M = [l = n, h = n]), f > t && (f = t), t > g && (g = t) } function t(t, e) { var r = pe([t * za, e * za]); if (m) { var u = de(m, r), i = [u[1], -u[0], 0], o = de(i, u); xe(o), o = Me(o); var c = t - p, s = c > 0 ? 1 : -1, v = o[0] * Ra * s, d = fa(c) > 180; if (d ^ (v > s * p && s * t > v)) { var y = o[1] * Ra; y > g && (g = y) } else if (v = (v + 360) % 360 - 180, d ^ (v > s * p && s * t > v)) { var y = -o[1] * Ra; f > y && (f = y) } else f > e && (f = e), e > g && (g = e); d ? p > t ? a(l, t) > a(l, h) && (h = t) : a(t, h) > a(l, h) && (l = t) : h >= l ? (l > t && (l = t), t > h && (h = t)) : t > p ? a(l, t) > a(l, h) && (h = t) : a(t, h) > a(l, h) && (l = t) } else n(t, e); m = r, p = t } function e() { _.point = t } function r() { M[0] = l, M[1] = h, _.point = n, m = null } function u(n, e) { if (m) { var r = n - p; y += fa(r) > 180 ? r + (r > 0 ? 360 : -360) : r } else v = n, d = e; mc.point(n, e), t(n, e) } function i() { mc.lineStart() } function o() { u(v, d), mc.lineEnd(), fa(y) > Ta && (l = -(h = 180)), M[0] = l, M[1] = h, m = null } function a(n, t) { return (t -= n) < 0 ? t + 360 : t } function c(n, t) { return n[0] - t[0] } function s(n, t) { return t[0] <= t[1] ? t[0] <= n && n <= t[1] : n < t[0] || t[1] < n } var l, f, h, g, p, v, d, m, y, x, M, _ = { point: n, lineStart: e, lineEnd: r, polygonStart: function () { _.point = u, _.lineStart = i, _.lineEnd = o, y = 0, mc.polygonStart() }, polygonEnd: function () { mc.polygonEnd(), _.point = n, _.lineStart = e, _.lineEnd = r, 0 > dc ? (l = -(h = 180), f = -(g = 90)) : y > Ta ? g = 90 : -Ta > y && (f = -90), M[0] = l, M[1] = h } }; return function (n) {
                g = h = -(l = f = 1 / 0), x = [], Go.geo.stream(n, _); var t = x.length; if (t) {
                    x.sort(c); for (var e, r = 1, u = x[0], i = [u]; t > r; ++r) e = x[r], s(e[0], u) || s(e[1], u) ? (a(u[0], e[1]) > a(u[0], u[1]) && (u[1] = e[1]), a(e[0], u[1]) > a(u[0], u[1]) && (u[0] = e[0])) : i.push(u = e);
                    for (var o, e, p = -1 / 0, t = i.length - 1, r = 0, u = i[t]; t >= r; u = e, ++r) e = i[r], (o = a(u[1], e[0])) > p && (p = o, l = e[0], h = u[1])
                } return x = M = null, 1 / 0 === l || 1 / 0 === f ? [[0 / 0, 0 / 0], [0 / 0, 0 / 0]] : [[l, f], [h, g]]
            }
        }(), Go.geo.centroid = function (n) { yc = xc = Mc = _c = bc = wc = Sc = kc = Ec = Nc = Ac = 0, Go.geo.stream(n, Cc); var t = Ec, e = Nc, r = Ac, u = t * t + e * e + r * r; return qa > u && (t = wc, e = Sc, r = kc, Ta > xc && (t = Mc, e = _c, r = bc), u = t * t + e * e + r * r, qa > u) ? [0 / 0, 0 / 0] : [Math.atan2(e, t) * Ra, G(r / Math.sqrt(u)) * Ra] }; var yc, xc, Mc, _c, bc, wc, Sc, kc, Ec, Nc, Ac, Cc = { sphere: v, point: be, lineStart: Se, lineEnd: ke, polygonStart: function () { Cc.lineStart = Ee }, polygonEnd: function () { Cc.lineStart = Se } }, Lc = Te(Ne, Pe, je, [-Aa, -Aa / 2]), Tc = 1e9; Go.geo.clipExtent = function () { var n, t, e, r, u, i, o = { stream: function (n) { return u && (u.valid = !1), u = i(n), u.valid = !0, u }, extent: function (a) { return arguments.length ? (i = Oe(n = +a[0][0], t = +a[0][1], e = +a[1][0], r = +a[1][1]), u && (u.valid = !1, u = null), o) : [[n, t], [e, r]] } }; return o.extent([[0, 0], [960, 500]]) }, (Go.geo.conicEqualArea = function () { return Ye(Ze) }).raw = Ze, Go.geo.albers = function () { return Go.geo.conicEqualArea().rotate([96, 0]).center([-.6, 38.7]).parallels([29.5, 45.5]).scale(1070) }, Go.geo.albersUsa = function () { function n(n) { var i = n[0], o = n[1]; return t = null, e(i, o), t || (r(i, o), t) || u(i, o), t } var t, e, r, u, i = Go.geo.albers(), o = Go.geo.conicEqualArea().rotate([154, 0]).center([-2, 58.5]).parallels([55, 65]), a = Go.geo.conicEqualArea().rotate([157, 0]).center([-3, 19.9]).parallels([8, 18]), c = { point: function (n, e) { t = [n, e] } }; return n.invert = function (n) { var t = i.scale(), e = i.translate(), r = (n[0] - e[0]) / t, u = (n[1] - e[1]) / t; return (u >= .12 && .234 > u && r >= -.425 && -.214 > r ? o : u >= .166 && .234 > u && r >= -.214 && -.115 > r ? a : i).invert(n) }, n.stream = function (n) { var t = i.stream(n), e = o.stream(n), r = a.stream(n); return { point: function (n, u) { t.point(n, u), e.point(n, u), r.point(n, u) }, sphere: function () { t.sphere(), e.sphere(), r.sphere() }, lineStart: function () { t.lineStart(), e.lineStart(), r.lineStart() }, lineEnd: function () { t.lineEnd(), e.lineEnd(), r.lineEnd() }, polygonStart: function () { t.polygonStart(), e.polygonStart(), r.polygonStart() }, polygonEnd: function () { t.polygonEnd(), e.polygonEnd(), r.polygonEnd() } } }, n.precision = function (t) { return arguments.length ? (i.precision(t), o.precision(t), a.precision(t), n) : i.precision() }, n.scale = function (t) { return arguments.length ? (i.scale(t), o.scale(.35 * t), a.scale(t), n.translate(i.translate())) : i.scale() }, n.translate = function (t) { if (!arguments.length) return i.translate(); var s = i.scale(), l = +t[0], f = +t[1]; return e = i.translate(t).clipExtent([[l - .455 * s, f - .238 * s], [l + .455 * s, f + .238 * s]]).stream(c).point, r = o.translate([l - .307 * s, f + .201 * s]).clipExtent([[l - .425 * s + Ta, f + .12 * s + Ta], [l - .214 * s - Ta, f + .234 * s - Ta]]).stream(c).point, u = a.translate([l - .205 * s, f + .212 * s]).clipExtent([[l - .214 * s + Ta, f + .166 * s + Ta], [l - .115 * s - Ta, f + .234 * s - Ta]]).stream(c).point, n }, n.scale(1070) }; var qc, zc, Rc, Dc, Pc, Uc, jc = { point: v, lineStart: v, lineEnd: v, polygonStart: function () { zc = 0, jc.lineStart = Ve }, polygonEnd: function () { jc.lineStart = jc.lineEnd = jc.point = v, qc += fa(zc / 2) } }, Hc = { point: $e, lineStart: v, lineEnd: v, polygonStart: v, polygonEnd: v }, Fc = { point: Je, lineStart: We, lineEnd: Ge, polygonStart: function () { Fc.lineStart = Ke }, polygonEnd: function () { Fc.point = Je, Fc.lineStart = We, Fc.lineEnd = Ge } }; Go.geo.path = function () { function n(n) { return n && ("function" == typeof a && i.pointRadius(+a.apply(this, arguments)), o && o.valid || (o = u(i)), Go.geo.stream(n, o)), i.result() } function t() { return o = null, n } var e, r, u, i, o, a = 4.5; return n.area = function (n) { return qc = 0, Go.geo.stream(n, u(jc)), qc }, n.centroid = function (n) { return Mc = _c = bc = wc = Sc = kc = Ec = Nc = Ac = 0, Go.geo.stream(n, u(Fc)), Ac ? [Ec / Ac, Nc / Ac] : kc ? [wc / kc, Sc / kc] : bc ? [Mc / bc, _c / bc] : [0 / 0, 0 / 0] }, n.bounds = function (n) { return Pc = Uc = -(Rc = Dc = 1 / 0), Go.geo.stream(n, u(Hc)), [[Rc, Dc], [Pc, Uc]] }, n.projection = function (n) { return arguments.length ? (u = (e = n) ? n.stream || tr(n) : Nt, t()) : e }, n.context = function (n) { return arguments.length ? (i = null == (r = n) ? new Xe : new Qe(n), "function" != typeof a && i.pointRadius(a), t()) : r }, n.pointRadius = function (t) { return arguments.length ? (a = "function" == typeof t ? t : (i.pointRadius(+t), +t), n) : a }, n.projection(Go.geo.albersUsa()).context(null) }, Go.geo.transform = function (n) { return { stream: function (t) { var e = new er(t); for (var r in n) e[r] = n[r]; return e } } }, er.prototype = { point: function (n, t) { this.stream.point(n, t) }, sphere: function () { this.stream.sphere() }, lineStart: function () { this.stream.lineStart() }, lineEnd: function () { this.stream.lineEnd() }, polygonStart: function () { this.stream.polygonStart() }, polygonEnd: function () { this.stream.polygonEnd() } }, Go.geo.projection = ur, Go.geo.projectionMutator = ir, (Go.geo.equirectangular = function () { return ur(ar) }).raw = ar.invert = ar, Go.geo.rotation = function (n) { function t(t) { return t = n(t[0] * za, t[1] * za), t[0] *= Ra, t[1] *= Ra, t } return n = sr(n[0] % 360 * za, n[1] * za, n.length > 2 ? n[2] * za : 0), t.invert = function (t) { return t = n.invert(t[0] * za, t[1] * za), t[0] *= Ra, t[1] *= Ra, t }, t }, cr.invert = ar, Go.geo.circle = function () { function n() { var n = "function" == typeof r ? r.apply(this, arguments) : r, t = sr(-n[0] * za, -n[1] * za, 0).invert, u = []; return e(null, null, 1, { point: function (n, e) { u.push(n = t(n, e)), n[0] *= Ra, n[1] *= Ra } }), { type: "Polygon", coordinates: [u] } } var t, e, r = [0, 0], u = 6; return n.origin = function (t) { return arguments.length ? (r = t, n) : r }, n.angle = function (r) { return arguments.length ? (e = gr((t = +r) * za, u * za), n) : t }, n.precision = function (r) { return arguments.length ? (e = gr(t * za, (u = +r) * za), n) : u }, n.angle(90) }, Go.geo.distance = function (n, t) { var e, r = (t[0] - n[0]) * za, u = n[1] * za, i = t[1] * za, o = Math.sin(r), a = Math.cos(r), c = Math.sin(u), s = Math.cos(u), l = Math.sin(i), f = Math.cos(i); return Math.atan2(Math.sqrt((e = f * o) * e + (e = s * l - c * f * a) * e), c * l + s * f * a) }, Go.geo.graticule = function () { function n() { return { type: "MultiLineString", coordinates: t() } } function t() { return Go.range(Math.ceil(i / d) * d, u, d).map(h).concat(Go.range(Math.ceil(s / m) * m, c, m).map(g)).concat(Go.range(Math.ceil(r / p) * p, e, p).filter(function (n) { return fa(n % d) > Ta }).map(l)).concat(Go.range(Math.ceil(a / v) * v, o, v).filter(function (n) { return fa(n % m) > Ta }).map(f)) } var e, r, u, i, o, a, c, s, l, f, h, g, p = 10, v = p, d = 90, m = 360, y = 2.5; return n.lines = function () { return t().map(function (n) { return { type: "LineString", coordinates: n } }) }, n.outline = function () { return { type: "Polygon", coordinates: [h(i).concat(g(c).slice(1), h(u).reverse().slice(1), g(s).reverse().slice(1))] } }, n.extent = function (t) { return arguments.length ? n.majorExtent(t).minorExtent(t) : n.minorExtent() }, n.majorExtent = function (t) { return arguments.length ? (i = +t[0][0], u = +t[1][0], s = +t[0][1], c = +t[1][1], i > u && (t = i, i = u, u = t), s > c && (t = s, s = c, c = t), n.precision(y)) : [[i, s], [u, c]] }, n.minorExtent = function (t) { return arguments.length ? (r = +t[0][0], e = +t[1][0], a = +t[0][1], o = +t[1][1], r > e && (t = r, r = e, e = t), a > o && (t = a, a = o, o = t), n.precision(y)) : [[r, a], [e, o]] }, n.step = function (t) { return arguments.length ? n.majorStep(t).minorStep(t) : n.minorStep() }, n.majorStep = function (t) { return arguments.length ? (d = +t[0], m = +t[1], n) : [d, m] }, n.minorStep = function (t) { return arguments.length ? (p = +t[0], v = +t[1], n) : [p, v] }, n.precision = function (t) { return arguments.length ? (y = +t, l = vr(a, o, 90), f = dr(r, e, y), h = vr(s, c, 90), g = dr(i, u, y), n) : y }, n.majorExtent([[-180, -90 + Ta], [180, 90 - Ta]]).minorExtent([[-180, -80 - Ta], [180, 80 + Ta]]) }, Go.geo.greatArc = function () { function n() { return { type: "LineString", coordinates: [t || r.apply(this, arguments), e || u.apply(this, arguments)] } } var t, e, r = mr, u = yr; return n.distance = function () { return Go.geo.distance(t || r.apply(this, arguments), e || u.apply(this, arguments)) }, n.source = function (e) { return arguments.length ? (r = e, t = "function" == typeof e ? null : e, n) : r }, n.target = function (t) { return arguments.length ? (u = t, e = "function" == typeof t ? null : t, n) : u }, n.precision = function () { return arguments.length ? n : 0 }, n }, Go.geo.interpolate = function (n, t) { return xr(n[0] * za, n[1] * za, t[0] * za, t[1] * za) }, Go.geo.length = function (n) { return Oc = 0, Go.geo.stream(n, Ic), Oc }; var Oc, Ic = { sphere: v, point: v, lineStart: Mr, lineEnd: v, polygonStart: v, polygonEnd: v }, Yc = _r(function (n) { return Math.sqrt(2 / (1 + n)) }, function (n) { return 2 * Math.asin(n / 2) }); (Go.geo.azimuthalEqualArea = function () { return ur(Yc) }).raw = Yc; var Zc = _r(function (n) { var t = Math.acos(n); return t && t / Math.sin(t) }, Nt); (Go.geo.azimuthalEquidistant = function () { return ur(Zc) }).raw = Zc, (Go.geo.conicConformal = function () { return Ye(br) }).raw = br, (Go.geo.conicEquidistant = function () { return Ye(wr) }).raw = wr; var Vc = _r(function (n) { return 1 / n }, Math.atan); (Go.geo.gnomonic = function () { return ur(Vc) }).raw = Vc, Sr.invert = function (n, t) { return [n, 2 * Math.atan(Math.exp(t)) - La] }, (Go.geo.mercator = function () { return kr(Sr) }).raw = Sr; var $c = _r(function () { return 1 }, Math.asin); (Go.geo.orthographic = function () { return ur($c) }).raw = $c; var Xc = _r(function (n) { return 1 / (1 + n) }, function (n) { return 2 * Math.atan(n) }); (Go.geo.stereographic = function () { return ur(Xc) }).raw = Xc, Er.invert = function (n, t) { return [-t, 2 * Math.atan(Math.exp(n)) - La] }, (Go.geo.transverseMercator = function () { var n = kr(Er), t = n.center, e = n.rotate; return n.center = function (n) { return n ? t([-n[1], n[0]]) : (n = t(), [-n[1], n[0]]) }, n.rotate = function (n) { return n ? e([n[0], n[1], n.length > 2 ? n[2] + 90 : 90]) : (n = e(), [n[0], n[1], n[2] - 90]) }, n.rotate([0, 0]) }).raw = Er, Go.geom = {}, Go.geom.hull = function (n) { function t(n) { if (n.length < 3) return []; var t, u = Et(e), i = Et(r), o = n.length, a = [], c = []; for (t = 0; o > t; t++) a.push([+u.call(this, n[t], t), +i.call(this, n[t], t), t]); for (a.sort(Lr), t = 0; o > t; t++) c.push([a[t][0], -a[t][1]]); var s = Cr(a), l = Cr(c), f = l[0] === s[0], h = l[l.length - 1] === s[s.length - 1], g = []; for (t = s.length - 1; t >= 0; --t) g.push(n[a[s[t]][2]]); for (t = +f; t < l.length - h; ++t) g.push(n[a[l[t]][2]]); return g } var e = Nr, r = Ar; return arguments.length ? t(n) : (t.x = function (n) { return arguments.length ? (e = n, t) : e }, t.y = function (n) { return arguments.length ? (r = n, t) : r }, t) }, Go.geom.polygon = function (n) { return da(n, Bc), n }; var Bc = Go.geom.polygon.prototype = []; Bc.area = function () { for (var n, t = -1, e = this.length, r = this[e - 1], u = 0; ++t < e;) n = r, r = this[t], u += n[1] * r[0] - n[0] * r[1]; return .5 * u }, Bc.centroid = function (n) { var t, e, r = -1, u = this.length, i = 0, o = 0, a = this[u - 1]; for (arguments.length || (n = -1 / (6 * this.area())) ; ++r < u;) t = a, a = this[r], e = t[0] * a[1] - a[0] * t[1], i += (t[0] + a[0]) * e, o += (t[1] + a[1]) * e; return [i * n, o * n] }, Bc.clip = function (n) { for (var t, e, r, u, i, o, a = zr(n), c = -1, s = this.length - zr(this), l = this[s - 1]; ++c < s;) { for (t = n.slice(), n.length = 0, u = this[c], i = t[(r = t.length - a) - 1], e = -1; ++e < r;) o = t[e], Tr(o, l, u) ? (Tr(i, l, u) || n.push(qr(i, o, l, u)), n.push(o)) : Tr(i, l, u) && n.push(qr(i, o, l, u)), i = o; a && n.push(n[0]), l = u } return n }; var Jc, Wc, Gc, Kc, Qc, ns = [], ts = []; Or.prototype.prepare = function () { for (var n, t = this.edges, e = t.length; e--;) n = t[e].edge, n.b && n.a || t.splice(e, 1); return t.sort(Yr), t.length }, Qr.prototype = { start: function () { return this.edge.l === this.site ? this.edge.a : this.edge.b }, end: function () { return this.edge.l === this.site ? this.edge.b : this.edge.a } }, nu.prototype = { insert: function (n, t) { var e, r, u; if (n) { if (t.P = n, t.N = n.N, n.N && (n.N.P = t), n.N = t, n.R) { for (n = n.R; n.L;) n = n.L; n.L = t } else n.R = t; e = n } else this._ ? (n = uu(this._), t.P = null, t.N = n, n.P = n.L = t, e = n) : (t.P = t.N = null, this._ = t, e = null); for (t.L = t.R = null, t.U = e, t.C = !0, n = t; e && e.C;) r = e.U, e === r.L ? (u = r.R, u && u.C ? (e.C = u.C = !1, r.C = !0, n = r) : (n === e.R && (eu(this, e), n = e, e = n.U), e.C = !1, r.C = !0, ru(this, r))) : (u = r.L, u && u.C ? (e.C = u.C = !1, r.C = !0, n = r) : (n === e.L && (ru(this, e), n = e, e = n.U), e.C = !1, r.C = !0, eu(this, r))), e = n.U; this._.C = !1 }, remove: function (n) { n.N && (n.N.P = n.P), n.P && (n.P.N = n.N), n.N = n.P = null; var t, e, r, u = n.U, i = n.L, o = n.R; if (e = i ? o ? uu(o) : i : o, u ? u.L === n ? u.L = e : u.R = e : this._ = e, i && o ? (r = e.C, e.C = n.C, e.L = i, i.U = e, e !== o ? (u = e.U, e.U = n.U, n = e.R, u.L = n, e.R = o, o.U = e) : (e.U = u, u = e, n = e.R)) : (r = n.C, n = e), n && (n.U = u), !r) { if (n && n.C) return n.C = !1, void 0; do { if (n === this._) break; if (n === u.L) { if (t = u.R, t.C && (t.C = !1, u.C = !0, eu(this, u), t = u.R), t.L && t.L.C || t.R && t.R.C) { t.R && t.R.C || (t.L.C = !1, t.C = !0, ru(this, t), t = u.R), t.C = u.C, u.C = t.R.C = !1, eu(this, u), n = this._; break } } else if (t = u.L, t.C && (t.C = !1, u.C = !0, ru(this, u), t = u.L), t.L && t.L.C || t.R && t.R.C) { t.L && t.L.C || (t.R.C = !1, t.C = !0, eu(this, t), t = u.L), t.C = u.C, u.C = t.L.C = !1, ru(this, u), n = this._; break } t.C = !0, n = u, u = u.U } while (!n.C); n && (n.C = !1) } } }, Go.geom.voronoi = function (n) { function t(n) { var t = new Array(n.length), r = a[0][0], u = a[0][1], i = a[1][0], o = a[1][1]; return iu(e(n), a).cells.forEach(function (e, a) { var c = e.edges, s = e.site, l = t[a] = c.length ? c.map(function (n) { var t = n.start(); return [t.x, t.y] }) : s.x >= r && s.x <= i && s.y >= u && s.y <= o ? [[r, o], [i, o], [i, u], [r, u]] : []; l.point = n[a] }), t } function e(n) { return n.map(function (n, t) { return { x: Math.round(i(n, t) / Ta) * Ta, y: Math.round(o(n, t) / Ta) * Ta, i: t } }) } var r = Nr, u = Ar, i = r, o = u, a = es; return n ? t(n) : (t.links = function (n) { return iu(e(n)).edges.filter(function (n) { return n.l && n.r }).map(function (t) { return { source: n[t.l.i], target: n[t.r.i] } }) }, t.triangles = function (n) { var t = []; return iu(e(n)).cells.forEach(function (e, r) { for (var u, i, o = e.site, a = e.edges.sort(Yr), c = -1, s = a.length, l = a[s - 1].edge, f = l.l === o ? l.r : l.l; ++c < s;) u = l, i = f, l = a[c].edge, f = l.l === o ? l.r : l.l, r < i.i && r < f.i && au(o, i, f) < 0 && t.push([n[r], n[i.i], n[f.i]]) }), t }, t.x = function (n) { return arguments.length ? (i = Et(r = n), t) : r }, t.y = function (n) { return arguments.length ? (o = Et(u = n), t) : u }, t.clipExtent = function (n) { return arguments.length ? (a = null == n ? es : n, t) : a === es ? null : a }, t.size = function (n) { return arguments.length ? t.clipExtent(n && [[0, 0], n]) : a === es ? null : a && a[1] }, t) }; var es = [[-1e6, -1e6], [1e6, 1e6]]; Go.geom.delaunay = function (n) { return Go.geom.voronoi().triangles(n) }, Go.geom.quadtree = function (n, t, e, r, u) { function i(n) { function i(n, t, e, r, u, i, o, a) { if (!isNaN(e) && !isNaN(r)) if (n.leaf) { var c = n.x, l = n.y; if (null != c) if (fa(c - e) + fa(l - r) < .01) s(n, t, e, r, u, i, o, a); else { var f = n.point; n.x = n.y = n.point = null, s(n, f, c, l, u, i, o, a), s(n, t, e, r, u, i, o, a) } else n.x = e, n.y = r, n.point = t } else s(n, t, e, r, u, i, o, a) } function s(n, t, e, r, u, o, a, c) { var s = .5 * (u + a), l = .5 * (o + c), f = e >= s, h = r >= l, g = (h << 1) + f; n.leaf = !1, n = n.nodes[g] || (n.nodes[g] = lu()), f ? u = s : a = s, h ? o = l : c = l, i(n, t, e, r, u, o, a, c) } var l, f, h, g, p, v, d, m, y, x = Et(a), M = Et(c); if (null != t) v = t, d = e, m = r, y = u; else if (m = y = -(v = d = 1 / 0), f = [], h = [], p = n.length, o) for (g = 0; p > g; ++g) l = n[g], l.x < v && (v = l.x), l.y < d && (d = l.y), l.x > m && (m = l.x), l.y > y && (y = l.y), f.push(l.x), h.push(l.y); else for (g = 0; p > g; ++g) { var _ = +x(l = n[g], g), b = +M(l, g); v > _ && (v = _), d > b && (d = b), _ > m && (m = _), b > y && (y = b), f.push(_), h.push(b) } var w = m - v, S = y - d; w > S ? y = d + w : m = v + S; var k = lu(); if (k.add = function (n) { i(k, n, +x(n, ++g), +M(n, g), v, d, m, y) }, k.visit = function (n) { fu(n, k, v, d, m, y) }, g = -1, null == t) { for (; ++g < p;) i(k, n[g], f[g], h[g], v, d, m, y); --g } else n.forEach(k.add); return f = h = n = l = null, k } var o, a = Nr, c = Ar; return (o = arguments.length) ? (a = cu, c = su, 3 === o && (u = e, r = t, e = t = 0), i(n)) : (i.x = function (n) { return arguments.length ? (a = n, i) : a }, i.y = function (n) { return arguments.length ? (c = n, i) : c }, i.extent = function (n) { return arguments.length ? (null == n ? t = e = r = u = null : (t = +n[0][0], e = +n[0][1], r = +n[1][0], u = +n[1][1]), i) : null == t ? null : [[t, e], [r, u]] }, i.size = function (n) { return arguments.length ? (null == n ? t = e = r = u = null : (t = e = 0, r = +n[0], u = +n[1]), i) : null == t ? null : [r - t, u - e] }, i) }, Go.interpolateRgb = hu, Go.interpolateObject = gu, Go.interpolateNumber = pu, Go.interpolateString = vu; var rs = /[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g, us = new RegExp(rs.source, "g"); Go.interpolate = du, Go.interpolators = [function (n, t) { var e = typeof t; return ("string" === e ? Ja.has(t) || /^(#|rgb\(|hsl\()/.test(t) ? hu : vu : t instanceof et ? hu : Array.isArray(t) ? mu : "object" === e && isNaN(t) ? gu : pu)(n, t) }], Go.interpolateArray = mu; var is = function () { return Nt }, os = Go.map({ linear: is, poly: Su, quad: function () { return _u }, cubic: function () { return bu }, sin: function () { return ku }, exp: function () { return Eu }, circle: function () { return Nu }, elastic: Au, back: Cu, bounce: function () { return Lu } }), as = Go.map({ "in": Nt, out: xu, "in-out": Mu, "out-in": function (n) { return Mu(xu(n)) } }); Go.ease = function (n) { var t = n.indexOf("-"), e = t >= 0 ? n.substring(0, t) : n, r = t >= 0 ? n.substring(t + 1) : "in"; return e = os.get(e) || is, r = as.get(r) || Nt, yu(r(e.apply(null, Ko.call(arguments, 1)))) }, Go.interpolateHcl = Tu, Go.interpolateHsl = qu, Go.interpolateLab = zu, Go.interpolateRound = Ru, Go.transform = function (n) { var t = na.createElementNS(Go.ns.prefix.svg, "g"); return (Go.transform = function (n) { if (null != n) { t.setAttribute("transform", n); var e = t.transform.baseVal.consolidate() } return new Du(e ? e.matrix : cs) })(n) }, Du.prototype.toString = function () { return "translate(" + this.translate + ")rotate(" + this.rotate + ")skewX(" + this.skew + ")scale(" + this.scale + ")" }; var cs = { a: 1, b: 0, c: 0, d: 1, e: 0, f: 0 }; Go.interpolateTransform = Hu, Go.layout = {}, Go.layout.bundle = function () { return function (n) { for (var t = [], e = -1, r = n.length; ++e < r;) t.push(Iu(n[e])); return t } }, Go.layout.chord = function () { function n() { var n, s, f, h, g, p = {}, v = [], d = Go.range(i), m = []; for (e = [], r = [], n = 0, h = -1; ++h < i;) { for (s = 0, g = -1; ++g < i;) s += u[h][g]; v.push(s), m.push(Go.range(i)), n += s } for (o && d.sort(function (n, t) { return o(v[n], v[t]) }), a && m.forEach(function (n, t) { n.sort(function (n, e) { return a(u[t][n], u[t][e]) }) }), n = (Ca - l * i) / n, s = 0, h = -1; ++h < i;) { for (f = s, g = -1; ++g < i;) { var y = d[h], x = m[y][g], M = u[y][x], _ = s, b = s += M * n; p[y + "-" + x] = { index: y, subindex: x, startAngle: _, endAngle: b, value: M } } r[y] = { index: y, startAngle: f, endAngle: s, value: (s - f) / n }, s += l } for (h = -1; ++h < i;) for (g = h - 1; ++g < i;) { var w = p[h + "-" + g], S = p[g + "-" + h]; (w.value || S.value) && e.push(w.value < S.value ? { source: S, target: w } : { source: w, target: S }) } c && t() } function t() { e.sort(function (n, t) { return c((n.source.value + n.target.value) / 2, (t.source.value + t.target.value) / 2) }) } var e, r, u, i, o, a, c, s = {}, l = 0; return s.matrix = function (n) { return arguments.length ? (i = (u = n) && u.length, e = r = null, s) : u }, s.padding = function (n) { return arguments.length ? (l = n, e = r = null, s) : l }, s.sortGroups = function (n) { return arguments.length ? (o = n, e = r = null, s) : o }, s.sortSubgroups = function (n) { return arguments.length ? (a = n, e = null, s) : a }, s.sortChords = function (n) { return arguments.length ? (c = n, e && t(), s) : c }, s.chords = function () { return e || n(), e }, s.groups = function () { return r || n(), r }, s }, Go.layout.force = function () { function n(n) { return function (t, e, r, u) { if (t.point !== n) { var i = t.cx - n.x, o = t.cy - n.y, a = u - e, c = i * i + o * o; if (c > a * a / d) { if (p > c) { var s = t.charge / c; n.px -= i * s, n.py -= o * s } return !0 } if (t.point && c && p > c) { var s = t.pointCharge / c; n.px -= i * s, n.py -= o * s } } return !t.charge } } function t(n) { n.px = Go.event.x, n.py = Go.event.y, a.resume() } var e, r, u, i, o, a = {}, c = Go.dispatch("start", "tick", "end"), s = [1, 1], l = .9, f = ss, h = ls, g = -30, p = fs, v = .1, d = .64, m = [], y = []; return a.tick = function () { if ((r *= .99) < .005) return c.end({ type: "end", alpha: r = 0 }), !0; var t, e, a, f, h, p, d, x, M, _ = m.length, b = y.length; for (e = 0; b > e; ++e) a = y[e], f = a.source, h = a.target, x = h.x - f.x, M = h.y - f.y, (p = x * x + M * M) && (p = r * i[e] * ((p = Math.sqrt(p)) - u[e]) / p, x *= p, M *= p, h.x -= x * (d = f.weight / (h.weight + f.weight)), h.y -= M * d, f.x += x * (d = 1 - d), f.y += M * d); if ((d = r * v) && (x = s[0] / 2, M = s[1] / 2, e = -1, d)) for (; ++e < _;) a = m[e], a.x += (x - a.x) * d, a.y += (M - a.y) * d; if (g) for (Ju(t = Go.geom.quadtree(m), r, o), e = -1; ++e < _;) (a = m[e]).fixed || t.visit(n(a)); for (e = -1; ++e < _;) a = m[e], a.fixed ? (a.x = a.px, a.y = a.py) : (a.x -= (a.px - (a.px = a.x)) * l, a.y -= (a.py - (a.py = a.y)) * l); c.tick({ type: "tick", alpha: r }) }, a.nodes = function (n) { return arguments.length ? (m = n, a) : m }, a.links = function (n) { return arguments.length ? (y = n, a) : y }, a.size = function (n) { return arguments.length ? (s = n, a) : s }, a.linkDistance = function (n) { return arguments.length ? (f = "function" == typeof n ? n : +n, a) : f }, a.distance = a.linkDistance, a.linkStrength = function (n) { return arguments.length ? (h = "function" == typeof n ? n : +n, a) : h }, a.friction = function (n) { return arguments.length ? (l = +n, a) : l }, a.charge = function (n) { return arguments.length ? (g = "function" == typeof n ? n : +n, a) : g }, a.chargeDistance = function (n) { return arguments.length ? (p = n * n, a) : Math.sqrt(p) }, a.gravity = function (n) { return arguments.length ? (v = +n, a) : v }, a.theta = function (n) { return arguments.length ? (d = n * n, a) : Math.sqrt(d) }, a.alpha = function (n) { return arguments.length ? (n = +n, r ? r = n > 0 ? n : 0 : n > 0 && (c.start({ type: "start", alpha: r = n }), Go.timer(a.tick)), a) : r }, a.start = function () { function n(n, r) { if (!e) { for (e = new Array(c), a = 0; c > a; ++a) e[a] = []; for (a = 0; s > a; ++a) { var u = y[a]; e[u.source.index].push(u.target), e[u.target.index].push(u.source) } } for (var i, o = e[t], a = -1, s = o.length; ++a < s;) if (!isNaN(i = o[a][n])) return i; return Math.random() * r } var t, e, r, c = m.length, l = y.length, p = s[0], v = s[1]; for (t = 0; c > t; ++t) (r = m[t]).index = t, r.weight = 0; for (t = 0; l > t; ++t) r = y[t], "number" == typeof r.source && (r.source = m[r.source]), "number" == typeof r.target && (r.target = m[r.target]), ++r.source.weight, ++r.target.weight; for (t = 0; c > t; ++t) r = m[t], isNaN(r.x) && (r.x = n("x", p)), isNaN(r.y) && (r.y = n("y", v)), isNaN(r.px) && (r.px = r.x), isNaN(r.py) && (r.py = r.y); if (u = [], "function" == typeof f) for (t = 0; l > t; ++t) u[t] = +f.call(this, y[t], t); else for (t = 0; l > t; ++t) u[t] = f; if (i = [], "function" == typeof h) for (t = 0; l > t; ++t) i[t] = +h.call(this, y[t], t); else for (t = 0; l > t; ++t) i[t] = h; if (o = [], "function" == typeof g) for (t = 0; c > t; ++t) o[t] = +g.call(this, m[t], t); else for (t = 0; c > t; ++t) o[t] = g; return a.resume() }, a.resume = function () { return a.alpha(.1) }, a.stop = function () { return a.alpha(0) }, a.drag = function () { return e || (e = Go.behavior.drag().origin(Nt).on("dragstart.force", Vu).on("drag.force", t).on("dragend.force", $u)), arguments.length ? (this.on("mouseover.force", Xu).on("mouseout.force", Bu).call(e), void 0) : e }, Go.rebind(a, c, "on") }; var ss = 20, ls = 1, fs = 1 / 0; Go.layout.hierarchy = function () { function n(t, o, a) { var c = u.call(e, t, o); if (t.depth = o, a.push(t), c && (s = c.length)) { for (var s, l, f = -1, h = t.children = new Array(s), g = 0, p = o + 1; ++f < s;) l = h[f] = n(c[f], p, a), l.parent = t, g += l.value; r && h.sort(r), i && (t.value = g) } else delete t.children, i && (t.value = +i.call(e, t, o) || 0); return t } function t(n, r) { var u = n.children, o = 0; if (u && (a = u.length)) for (var a, c = -1, s = r + 1; ++c < a;) o += t(u[c], s); else i && (o = +i.call(e, n, r) || 0); return i && (n.value = o), o } function e(t) { var e = []; return n(t, 0, e), e } var r = Qu, u = Gu, i = Ku; return e.sort = function (n) { return arguments.length ? (r = n, e) : r }, e.children = function (n) { return arguments.length ? (u = n, e) : u }, e.value = function (n) { return arguments.length ? (i = n, e) : i }, e.revalue = function (n) { return t(n, 0), n }, e }, Go.layout.partition = function () { function n(t, e, r, u) { var i = t.children; if (t.x = e, t.y = t.depth * u, t.dx = r, t.dy = u, i && (o = i.length)) { var o, a, c, s = -1; for (r = t.value ? r / t.value : 0; ++s < o;) n(a = i[s], e, c = a.value * r, u), e += c } } function t(n) { var e = n.children, r = 0; if (e && (u = e.length)) for (var u, i = -1; ++i < u;) r = Math.max(r, t(e[i])); return 1 + r } function e(e, i) { var o = r.call(this, e, i); return n(o[0], 0, u[0], u[1] / t(o[0])), o } var r = Go.layout.hierarchy(), u = [1, 1]; return e.size = function (n) { return arguments.length ? (u = n, e) : u }, Wu(e, r) }, Go.layout.pie = function () { function n(i) { var o = i.map(function (e, r) { return +t.call(n, e, r) }), a = +("function" == typeof r ? r.apply(this, arguments) : r), c = (("function" == typeof u ? u.apply(this, arguments) : u) - a) / Go.sum(o), s = Go.range(i.length); null != e && s.sort(e === hs ? function (n, t) { return o[t] - o[n] } : function (n, t) { return e(i[n], i[t]) }); var l = []; return s.forEach(function (n) { var t; l[n] = { data: i[n], value: t = o[n], startAngle: a, endAngle: a += t * c } }), l } var t = Number, e = hs, r = 0, u = Ca; return n.value = function (e) { return arguments.length ? (t = e, n) : t }, n.sort = function (t) { return arguments.length ? (e = t, n) : e }, n.startAngle = function (t) { return arguments.length ? (r = t, n) : r }, n.endAngle = function (t) { return arguments.length ? (u = t, n) : u }, n }; var hs = {}; Go.layout.stack = function () { function n(a, c) { var s = a.map(function (e, r) { return t.call(n, e, r) }), l = s.map(function (t) { return t.map(function (t, e) { return [i.call(n, t, e), o.call(n, t, e)] }) }), f = e.call(n, l, c); s = Go.permute(s, f), l = Go.permute(l, f); var h, g, p, v = r.call(n, l, c), d = s.length, m = s[0].length; for (g = 0; m > g; ++g) for (u.call(n, s[0][g], p = v[g], l[0][g][1]), h = 1; d > h; ++h) u.call(n, s[h][g], p += l[h - 1][g][1], l[h][g][1]); return a } var t = Nt, e = ui, r = ii, u = ri, i = ti, o = ei; return n.values = function (e) { return arguments.length ? (t = e, n) : t }, n.order = function (t) { return arguments.length ? (e = "function" == typeof t ? t : gs.get(t) || ui, n) : e }, n.offset = function (t) { return arguments.length ? (r = "function" == typeof t ? t : ps.get(t) || ii, n) : r }, n.x = function (t) { return arguments.length ? (i = t, n) : i }, n.y = function (t) { return arguments.length ? (o = t, n) : o }, n.out = function (t) { return arguments.length ? (u = t, n) : u }, n }; var gs = Go.map({ "inside-out": function (n) { var t, e, r = n.length, u = n.map(oi), i = n.map(ai), o = Go.range(r).sort(function (n, t) { return u[n] - u[t] }), a = 0, c = 0, s = [], l = []; for (t = 0; r > t; ++t) e = o[t], c > a ? (a += i[e], s.push(e)) : (c += i[e], l.push(e)); return l.reverse().concat(s) }, reverse: function (n) { return Go.range(n.length).reverse() }, "default": ui }), ps = Go.map({ silhouette: function (n) { var t, e, r, u = n.length, i = n[0].length, o = [], a = 0, c = []; for (e = 0; i > e; ++e) { for (t = 0, r = 0; u > t; t++) r += n[t][e][1]; r > a && (a = r), o.push(r) } for (e = 0; i > e; ++e) c[e] = (a - o[e]) / 2; return c }, wiggle: function (n) { var t, e, r, u, i, o, a, c, s, l = n.length, f = n[0], h = f.length, g = []; for (g[0] = c = s = 0, e = 1; h > e; ++e) { for (t = 0, u = 0; l > t; ++t) u += n[t][e][1]; for (t = 0, i = 0, a = f[e][0] - f[e - 1][0]; l > t; ++t) { for (r = 0, o = (n[t][e][1] - n[t][e - 1][1]) / (2 * a) ; t > r; ++r) o += (n[r][e][1] - n[r][e - 1][1]) / a; i += o * n[t][e][1] } g[e] = c -= u ? i / u * a : 0, s > c && (s = c) } for (e = 0; h > e; ++e) g[e] -= s; return g }, expand: function (n) { var t, e, r, u = n.length, i = n[0].length, o = 1 / u, a = []; for (e = 0; i > e; ++e) { for (t = 0, r = 0; u > t; t++) r += n[t][e][1]; if (r) for (t = 0; u > t; t++) n[t][e][1] /= r; else for (t = 0; u > t; t++) n[t][e][1] = o } for (e = 0; i > e; ++e) a[e] = 0; return a }, zero: ii }); Go.layout.histogram = function () { function n(n, i) { for (var o, a, c = [], s = n.map(e, this), l = r.call(this, s, i), f = u.call(this, l, s, i), i = -1, h = s.length, g = f.length - 1, p = t ? 1 : 1 / h; ++i < g;) o = c[i] = [], o.dx = f[i + 1] - (o.x = f[i]), o.y = 0; if (g > 0) for (i = -1; ++i < h;) a = s[i], a >= l[0] && a <= l[1] && (o = c[Go.bisect(f, a, 1, g) - 1], o.y += p, o.push(n[i])); return c } var t = !0, e = Number, r = fi, u = si; return n.value = function (t) { return arguments.length ? (e = t, n) : e }, n.range = function (t) { return arguments.length ? (r = Et(t), n) : r }, n.bins = function (t) { return arguments.length ? (u = "number" == typeof t ? function (n) { return li(n, t) } : Et(t), n) : u }, n.frequency = function (e) { return arguments.length ? (t = !!e, n) : t }, n }, Go.layout.tree = function () { function n(n, i) { function o(n, t) { var r = n.children, u = n._tree; if (r && (i = r.length)) { for (var i, a, s, l = r[0], f = l, h = -1; ++h < i;) s = r[h], o(s, a), f = c(s, a, f), a = s; Mi(n); var g = .5 * (l._tree.prelim + s._tree.prelim); t ? (u.prelim = t._tree.prelim + e(n, t), u.mod = u.prelim - g) : u.prelim = g } else t && (u.prelim = t._tree.prelim + e(n, t)) } function a(n, t) { n.x = n._tree.prelim + t; var e = n.children; if (e && (r = e.length)) { var r, u = -1; for (t += n._tree.mod; ++u < r;) a(e[u], t) } } function c(n, t, r) { if (t) { for (var u, i = n, o = n, a = t, c = n.parent.children[0], s = i._tree.mod, l = o._tree.mod, f = a._tree.mod, h = c._tree.mod; a = pi(a), i = gi(i), a && i;) c = gi(c), o = pi(o), o._tree.ancestor = n, u = a._tree.prelim + f - i._tree.prelim - s + e(a, i), u > 0 && (_i(bi(a, n, r), n, u), s += u, l += u), f += a._tree.mod, s += i._tree.mod, h += c._tree.mod, l += o._tree.mod; a && !pi(o) && (o._tree.thread = a, o._tree.mod += f - l), i && !gi(c) && (c._tree.thread = i, c._tree.mod += s - h, r = n) } return r } var s = t.call(this, n, i), l = s[0]; xi(l, function (n, t) { n._tree = { ancestor: n, prelim: 0, mod: 0, change: 0, shift: 0, number: t ? t._tree.number + 1 : 0 } }), o(l), a(l, -l._tree.prelim); var f = vi(l, mi), h = vi(l, di), g = vi(l, yi), p = f.x - e(f, h) / 2, v = h.x + e(h, f) / 2, d = g.depth || 1; return xi(l, u ? function (n) { n.x *= r[0], n.y = n.depth * r[1], delete n._tree } : function (n) { n.x = (n.x - p) / (v - p) * r[0], n.y = n.depth / d * r[1], delete n._tree }), s } var t = Go.layout.hierarchy().sort(null).value(null), e = hi, r = [1, 1], u = !1; return n.separation = function (t) { return arguments.length ? (e = t, n) : e }, n.size = function (t) { return arguments.length ? (u = null == (r = t), n) : u ? null : r }, n.nodeSize = function (t) { return arguments.length ? (u = null != (r = t), n) : u ? r : null }, Wu(n, t) }, Go.layout.pack = function () { function n(n, i) { var o = e.call(this, n, i), a = o[0], c = u[0], s = u[1], l = null == t ? Math.sqrt : "function" == typeof t ? t : function () { return t }; if (a.x = a.y = 0, xi(a, function (n) { n.r = +l(n.value) }), xi(a, Ni), r) { var f = r * (t ? 1 : Math.max(2 * a.r / c, 2 * a.r / s)) / 2; xi(a, function (n) { n.r += f }), xi(a, Ni), xi(a, function (n) { n.r -= f }) } return Li(a, c / 2, s / 2, t ? 1 : 1 / Math.max(2 * a.r / c, 2 * a.r / s)), o } var t, e = Go.layout.hierarchy().sort(wi), r = 0, u = [1, 1]; return n.size = function (t) { return arguments.length ? (u = t, n) : u }, n.radius = function (e) { return arguments.length ? (t = null == e || "function" == typeof e ? e : +e, n) : t }, n.padding = function (t) { return arguments.length ? (r = +t, n) : r }, Wu(n, e) }, Go.layout.cluster = function () { function n(n, i) { var o, a = t.call(this, n, i), c = a[0], s = 0; xi(c, function (n) { var t = n.children; t && t.length ? (n.x = zi(t), n.y = qi(t)) : (n.x = o ? s += e(n, o) : 0, n.y = 0, o = n) }); var l = Ri(c), f = Di(c), h = l.x - e(l, f) / 2, g = f.x + e(f, l) / 2; return xi(c, u ? function (n) { n.x = (n.x - c.x) * r[0], n.y = (c.y - n.y) * r[1] } : function (n) { n.x = (n.x - h) / (g - h) * r[0], n.y = (1 - (c.y ? n.y / c.y : 1)) * r[1] }), a } var t = Go.layout.hierarchy().sort(null).value(null), e = hi, r = [1, 1], u = !1; return n.separation = function (t) { return arguments.length ? (e = t, n) : e }, n.size = function (t) { return arguments.length ? (u = null == (r = t), n) : u ? null : r }, n.nodeSize = function (t) { return arguments.length ? (u = null != (r = t), n) : u ? r : null }, Wu(n, t) }, Go.layout.treemap = function () { function n(n, t) { for (var e, r, u = -1, i = n.length; ++u < i;) r = (e = n[u]).value * (0 > t ? 0 : t), e.area = isNaN(r) || 0 >= r ? 0 : r } function t(e) { var i = e.children; if (i && i.length) { var o, a, c, s = f(e), l = [], h = i.slice(), p = 1 / 0, v = "slice" === g ? s.dx : "dice" === g ? s.dy : "slice-dice" === g ? 1 & e.depth ? s.dy : s.dx : Math.min(s.dx, s.dy); for (n(h, s.dx * s.dy / e.value), l.area = 0; (c = h.length) > 0;) l.push(o = h[c - 1]), l.area += o.area, "squarify" !== g || (a = r(l, v)) <= p ? (h.pop(), p = a) : (l.area -= l.pop().area, u(l, v, s, !1), v = Math.min(s.dx, s.dy), l.length = l.area = 0, p = 1 / 0); l.length && (u(l, v, s, !0), l.length = l.area = 0), i.forEach(t) } } function e(t) { var r = t.children; if (r && r.length) { var i, o = f(t), a = r.slice(), c = []; for (n(a, o.dx * o.dy / t.value), c.area = 0; i = a.pop() ;) c.push(i), c.area += i.area, null != i.z && (u(c, i.z ? o.dx : o.dy, o, !a.length), c.length = c.area = 0); r.forEach(e) } } function r(n, t) { for (var e, r = n.area, u = 0, i = 1 / 0, o = -1, a = n.length; ++o < a;) (e = n[o].area) && (i > e && (i = e), e > u && (u = e)); return r *= r, t *= t, r ? Math.max(t * u * p / r, r / (t * i * p)) : 1 / 0 } function u(n, t, e, r) { var u, i = -1, o = n.length, a = e.x, s = e.y, l = t ? c(n.area / t) : 0; if (t == e.dx) { for ((r || l > e.dy) && (l = e.dy) ; ++i < o;) u = n[i], u.x = a, u.y = s, u.dy = l, a += u.dx = Math.min(e.x + e.dx - a, l ? c(u.area / l) : 0); u.z = !0, u.dx += e.x + e.dx - a, e.y += l, e.dy -= l } else { for ((r || l > e.dx) && (l = e.dx) ; ++i < o;) u = n[i], u.x = a, u.y = s, u.dx = l, s += u.dy = Math.min(e.y + e.dy - s, l ? c(u.area / l) : 0); u.z = !1, u.dy += e.y + e.dy - s, e.x += l, e.dx -= l } } function i(r) { var u = o || a(r), i = u[0]; return i.x = 0, i.y = 0, i.dx = s[0], i.dy = s[1], o && a.revalue(i), n([i], i.dx * i.dy / i.value), (o ? e : t)(i), h && (o = u), u } var o, a = Go.layout.hierarchy(), c = Math.round, s = [1, 1], l = null, f = Pi, h = !1, g = "squarify", p = .5 * (1 + Math.sqrt(5)); return i.size = function (n) { return arguments.length ? (s = n, i) : s }, i.padding = function (n) { function t(t) { var e = n.call(i, t, t.depth); return null == e ? Pi(t) : Ui(t, "number" == typeof e ? [e, e, e, e] : e) } function e(t) { return Ui(t, n) } if (!arguments.length) return l; var r; return f = null == (l = n) ? Pi : "function" == (r = typeof n) ? t : "number" === r ? (n = [n, n, n, n], e) : e, i }, i.round = function (n) { return arguments.length ? (c = n ? Math.round : Number, i) : c != Number }, i.sticky = function (n) { return arguments.length ? (h = n, o = null, i) : h }, i.ratio = function (n) { return arguments.length ? (p = n, i) : p }, i.mode = function (n) { return arguments.length ? (g = n + "", i) : g }, Wu(i, a) }, Go.random = { normal: function (n, t) { var e = arguments.length; return 2 > e && (t = 1), 1 > e && (n = 0), function () { var e, r, u; do e = 2 * Math.random() - 1, r = 2 * Math.random() - 1, u = e * e + r * r; while (!u || u > 1); return n + t * e * Math.sqrt(-2 * Math.log(u) / u) } }, logNormal: function () { var n = Go.random.normal.apply(Go, arguments); return function () { return Math.exp(n()) } }, bates: function (n) { var t = Go.random.irwinHall(n); return function () { return t() / n } }, irwinHall: function (n) { return function () { for (var t = 0, e = 0; n > e; e++) t += Math.random(); return t } } }, Go.scale = {}; var vs = { floor: Nt, ceil: Nt }; Go.scale.linear = function () { return Zi([0, 1], [0, 1], du, !1) }; var ds = { s: 1, g: 1, p: 1, r: 1, e: 1 }; Go.scale.log = function () { return Ki(Go.scale.linear().domain([0, 1]), 10, !0, [1, 10]) }; var ms = Go.format(".0e"), ys = { floor: function (n) { return -Math.ceil(-n) }, ceil: function (n) { return -Math.floor(-n) } }; Go.scale.pow = function () { return Qi(Go.scale.linear(), 1, [0, 1]) }, Go.scale.sqrt = function () { return Go.scale.pow().exponent(.5) }, Go.scale.ordinal = function () { return to([], { t: "range", a: [[]] }) }, Go.scale.category10 = function () { return Go.scale.ordinal().range(xs) }, Go.scale.category20 = function () { return Go.scale.ordinal().range(Ms) }, Go.scale.category20b = function () { return Go.scale.ordinal().range(_s) }, Go.scale.category20c = function () { return Go.scale.ordinal().range(bs) }; var xs = [2062260, 16744206, 2924588, 14034728, 9725885, 9197131, 14907330, 8355711, 12369186, 1556175].map(mt), Ms = [2062260, 11454440, 16744206, 16759672, 2924588, 10018698, 14034728, 16750742, 9725885, 12955861, 9197131, 12885140, 14907330, 16234194, 8355711, 13092807, 12369186, 14408589, 1556175, 10410725].map(mt), _s = [3750777, 5395619, 7040719, 10264286, 6519097, 9216594, 11915115, 13556636, 9202993, 12426809, 15186514, 15190932, 8666169, 11356490, 14049643, 15177372, 8077683, 10834324, 13528509, 14589654].map(mt), bs = [3244733, 7057110, 10406625, 13032431, 15095053, 16616764, 16625259, 16634018, 3253076, 7652470, 10607003, 13101504, 7695281, 10394312, 12369372, 14342891, 6513507, 9868950, 12434877, 14277081].map(mt); Go.scale.quantile = function () { return eo([], []) }, Go.scale.quantize = function () { return ro(0, 1, [0, 1]) }, Go.scale.threshold = function () { return uo([.5], [0, 1]) }, Go.scale.identity = function () { return io([0, 1]) }, Go.svg = {}, Go.svg.arc = function () {
            function n() {
                var n = t.apply(this, arguments), i = e.apply(this, arguments), o = r.apply(this, arguments) + ws, a = u.apply(this, arguments) + ws, c = (o > a && (c = o, o = a, a = c), a - o), s = Aa > c ? "0" : "1", l = Math.cos(o), f = Math.sin(o), h = Math.cos(a), g = Math.sin(a);
                return c >= Ss ? n ? "M0," + i + "A" + i + "," + i + " 0 1,1 0," + -i + "A" + i + "," + i + " 0 1,1 0," + i + "M0," + n + "A" + n + "," + n + " 0 1,0 0," + -n + "A" + n + "," + n + " 0 1,0 0," + n + "Z" : "M0," + i + "A" + i + "," + i + " 0 1,1 0," + -i + "A" + i + "," + i + " 0 1,1 0," + i + "Z" : n ? "M" + i * l + "," + i * f + "A" + i + "," + i + " 0 " + s + ",1 " + i * h + "," + i * g + "L" + n * h + "," + n * g + "A" + n + "," + n + " 0 " + s + ",0 " + n * l + "," + n * f + "Z" : "M" + i * l + "," + i * f + "A" + i + "," + i + " 0 " + s + ",1 " + i * h + "," + i * g + "L0,0" + "Z"
            } var t = oo, e = ao, r = co, u = so; return n.innerRadius = function (e) { return arguments.length ? (t = Et(e), n) : t }, n.outerRadius = function (t) { return arguments.length ? (e = Et(t), n) : e }, n.startAngle = function (t) { return arguments.length ? (r = Et(t), n) : r }, n.endAngle = function (t) { return arguments.length ? (u = Et(t), n) : u }, n.centroid = function () { var n = (t.apply(this, arguments) + e.apply(this, arguments)) / 2, i = (r.apply(this, arguments) + u.apply(this, arguments)) / 2 + ws; return [Math.cos(i) * n, Math.sin(i) * n] }, n
        }; var ws = -La, Ss = Ca - Ta; Go.svg.line = function () { return lo(Nt) }; var ks = Go.map({ linear: fo, "linear-closed": ho, step: go, "step-before": po, "step-after": vo, basis: bo, "basis-open": wo, "basis-closed": So, bundle: ko, cardinal: xo, "cardinal-open": mo, "cardinal-closed": yo, monotone: To }); ks.forEach(function (n, t) { t.key = n, t.closed = /-closed$/.test(n) }); var Es = [0, 2 / 3, 1 / 3, 0], Ns = [0, 1 / 3, 2 / 3, 0], As = [0, 1 / 6, 2 / 3, 1 / 6]; Go.svg.line.radial = function () { var n = lo(qo); return n.radius = n.x, delete n.x, n.angle = n.y, delete n.y, n }, po.reverse = vo, vo.reverse = po, Go.svg.area = function () { return zo(Nt) }, Go.svg.area.radial = function () { var n = zo(qo); return n.radius = n.x, delete n.x, n.innerRadius = n.x0, delete n.x0, n.outerRadius = n.x1, delete n.x1, n.angle = n.y, delete n.y, n.startAngle = n.y0, delete n.y0, n.endAngle = n.y1, delete n.y1, n }, Go.svg.chord = function () { function n(n, a) { var c = t(this, i, n, a), s = t(this, o, n, a); return "M" + c.p0 + r(c.r, c.p1, c.a1 - c.a0) + (e(c, s) ? u(c.r, c.p1, c.r, c.p0) : u(c.r, c.p1, s.r, s.p0) + r(s.r, s.p1, s.a1 - s.a0) + u(s.r, s.p1, c.r, c.p0)) + "Z" } function t(n, t, e, r) { var u = t.call(n, e, r), i = a.call(n, u, r), o = c.call(n, u, r) + ws, l = s.call(n, u, r) + ws; return { r: i, a0: o, a1: l, p0: [i * Math.cos(o), i * Math.sin(o)], p1: [i * Math.cos(l), i * Math.sin(l)] } } function e(n, t) { return n.a0 == t.a0 && n.a1 == t.a1 } function r(n, t, e) { return "A" + n + "," + n + " 0 " + +(e > Aa) + ",1 " + t } function u(n, t, e, r) { return "Q 0,0 " + r } var i = mr, o = yr, a = Ro, c = co, s = so; return n.radius = function (t) { return arguments.length ? (a = Et(t), n) : a }, n.source = function (t) { return arguments.length ? (i = Et(t), n) : i }, n.target = function (t) { return arguments.length ? (o = Et(t), n) : o }, n.startAngle = function (t) { return arguments.length ? (c = Et(t), n) : c }, n.endAngle = function (t) { return arguments.length ? (s = Et(t), n) : s }, n }, Go.svg.diagonal = function () { function n(n, u) { var i = t.call(this, n, u), o = e.call(this, n, u), a = (i.y + o.y) / 2, c = [i, { x: i.x, y: a }, { x: o.x, y: a }, o]; return c = c.map(r), "M" + c[0] + "C" + c[1] + " " + c[2] + " " + c[3] } var t = mr, e = yr, r = Do; return n.source = function (e) { return arguments.length ? (t = Et(e), n) : t }, n.target = function (t) { return arguments.length ? (e = Et(t), n) : e }, n.projection = function (t) { return arguments.length ? (r = t, n) : r }, n }, Go.svg.diagonal.radial = function () { var n = Go.svg.diagonal(), t = Do, e = n.projection; return n.projection = function (n) { return arguments.length ? e(Po(t = n)) : t }, n }, Go.svg.symbol = function () { function n(n, r) { return (Cs.get(t.call(this, n, r)) || Ho)(e.call(this, n, r)) } var t = jo, e = Uo; return n.type = function (e) { return arguments.length ? (t = Et(e), n) : t }, n.size = function (t) { return arguments.length ? (e = Et(t), n) : e }, n }; var Cs = Go.map({ circle: Ho, cross: function (n) { var t = Math.sqrt(n / 5) / 2; return "M" + -3 * t + "," + -t + "H" + -t + "V" + -3 * t + "H" + t + "V" + -t + "H" + 3 * t + "V" + t + "H" + t + "V" + 3 * t + "H" + -t + "V" + t + "H" + -3 * t + "Z" }, diamond: function (n) { var t = Math.sqrt(n / (2 * zs)), e = t * zs; return "M0," + -t + "L" + e + ",0" + " 0," + t + " " + -e + ",0" + "Z" }, square: function (n) { var t = Math.sqrt(n) / 2; return "M" + -t + "," + -t + "L" + t + "," + -t + " " + t + "," + t + " " + -t + "," + t + "Z" }, "triangle-down": function (n) { var t = Math.sqrt(n / qs), e = t * qs / 2; return "M0," + e + "L" + t + "," + -e + " " + -t + "," + -e + "Z" }, "triangle-up": function (n) { var t = Math.sqrt(n / qs), e = t * qs / 2; return "M0," + -e + "L" + t + "," + e + " " + -t + "," + e + "Z" } }); Go.svg.symbolTypes = Cs.keys(); var Ls, Ts, qs = Math.sqrt(3), zs = Math.tan(30 * za), Rs = [], Ds = 0; Rs.call = _a.call, Rs.empty = _a.empty, Rs.node = _a.node, Rs.size = _a.size, Go.transition = function (n) { return arguments.length ? Ls ? n.transition() : n : Sa.transition() }, Go.transition.prototype = Rs, Rs.select = function (n) { var t, e, r, u = this.id, i = []; n = b(n); for (var o = -1, a = this.length; ++o < a;) { i.push(t = []); for (var c = this[o], s = -1, l = c.length; ++s < l;) (r = c[s]) && (e = n.call(r, r.__data__, s, o)) ? ("__data__" in r && (e.__data__ = r.__data__), Yo(e, s, u, r.__transition__[u]), t.push(e)) : t.push(null) } return Fo(i, u) }, Rs.selectAll = function (n) { var t, e, r, u, i, o = this.id, a = []; n = w(n); for (var c = -1, s = this.length; ++c < s;) for (var l = this[c], f = -1, h = l.length; ++f < h;) if (r = l[f]) { i = r.__transition__[o], e = n.call(r, r.__data__, f, c), a.push(t = []); for (var g = -1, p = e.length; ++g < p;) (u = e[g]) && Yo(u, g, o, i), t.push(u) } return Fo(a, o) }, Rs.filter = function (n) { var t, e, r, u = []; "function" != typeof n && (n = R(n)); for (var i = 0, o = this.length; o > i; i++) { u.push(t = []); for (var e = this[i], a = 0, c = e.length; c > a; a++) (r = e[a]) && n.call(r, r.__data__, a, i) && t.push(r) } return Fo(u, this.id) }, Rs.tween = function (n, t) { var e = this.id; return arguments.length < 2 ? this.node().__transition__[e].tween.get(n) : P(this, null == t ? function (t) { t.__transition__[e].tween.remove(n) } : function (r) { r.__transition__[e].tween.set(n, t) }) }, Rs.attr = function (n, t) { function e() { this.removeAttribute(a) } function r() { this.removeAttributeNS(a.space, a.local) } function u(n) { return null == n ? e : (n += "", function () { var t, e = this.getAttribute(a); return e !== n && (t = o(e, n), function (n) { this.setAttribute(a, t(n)) }) }) } function i(n) { return null == n ? r : (n += "", function () { var t, e = this.getAttributeNS(a.space, a.local); return e !== n && (t = o(e, n), function (n) { this.setAttributeNS(a.space, a.local, t(n)) }) }) } if (arguments.length < 2) { for (t in n) this.attr(t, n[t]); return this } var o = "transform" == n ? Hu : du, a = Go.ns.qualify(n); return Oo(this, "attr." + n, t, a.local ? i : u) }, Rs.attrTween = function (n, t) { function e(n, e) { var r = t.call(this, n, e, this.getAttribute(u)); return r && function (n) { this.setAttribute(u, r(n)) } } function r(n, e) { var r = t.call(this, n, e, this.getAttributeNS(u.space, u.local)); return r && function (n) { this.setAttributeNS(u.space, u.local, r(n)) } } var u = Go.ns.qualify(n); return this.tween("attr." + n, u.local ? r : e) }, Rs.style = function (n, t, e) { function r() { this.style.removeProperty(n) } function u(t) { return null == t ? r : (t += "", function () { var r, u = ea.getComputedStyle(this, null).getPropertyValue(n); return u !== t && (r = du(u, t), function (t) { this.style.setProperty(n, r(t), e) }) }) } var i = arguments.length; if (3 > i) { if ("string" != typeof n) { 2 > i && (t = ""); for (e in n) this.style(e, n[e], t); return this } e = "" } return Oo(this, "style." + n, t, u) }, Rs.styleTween = function (n, t, e) { function r(r, u) { var i = t.call(this, r, u, ea.getComputedStyle(this, null).getPropertyValue(n)); return i && function (t) { this.style.setProperty(n, i(t), e) } } return arguments.length < 3 && (e = ""), this.tween("style." + n, r) }, Rs.text = function (n) { return Oo(this, "text", n, Io) }, Rs.remove = function () { return this.each("end.transition", function () { var n; this.__transition__.count < 2 && (n = this.parentNode) && n.removeChild(this) }) }, Rs.ease = function (n) { var t = this.id; return arguments.length < 1 ? this.node().__transition__[t].ease : ("function" != typeof n && (n = Go.ease.apply(Go, arguments)), P(this, function (e) { e.__transition__[t].ease = n })) }, Rs.delay = function (n) { var t = this.id; return arguments.length < 1 ? this.node().__transition__[t].delay : P(this, "function" == typeof n ? function (e, r, u) { e.__transition__[t].delay = +n.call(e, e.__data__, r, u) } : (n = +n, function (e) { e.__transition__[t].delay = n })) }, Rs.duration = function (n) { var t = this.id; return arguments.length < 1 ? this.node().__transition__[t].duration : P(this, "function" == typeof n ? function (e, r, u) { e.__transition__[t].duration = Math.max(1, n.call(e, e.__data__, r, u)) } : (n = Math.max(1, n), function (e) { e.__transition__[t].duration = n })) }, Rs.each = function (n, t) { var e = this.id; if (arguments.length < 2) { var r = Ts, u = Ls; Ls = e, P(this, function (t, r, u) { Ts = t.__transition__[e], n.call(t, t.__data__, r, u) }), Ts = r, Ls = u } else P(this, function (r) { var u = r.__transition__[e]; (u.event || (u.event = Go.dispatch("start", "end"))).on(n, t) }); return this }, Rs.transition = function () { for (var n, t, e, r, u = this.id, i = ++Ds, o = [], a = 0, c = this.length; c > a; a++) { o.push(n = []); for (var t = this[a], s = 0, l = t.length; l > s; s++) (e = t[s]) && (r = Object.create(e.__transition__[u]), r.delay += r.duration, Yo(e, s, i, r)), n.push(e) } return Fo(o, i) }, Go.svg.axis = function () { function n(n) { n.each(function () { var n, s = Go.select(this), l = this.__chart__ || e, f = this.__chart__ = e.copy(), h = null == c ? f.ticks ? f.ticks.apply(f, a) : f.domain() : c, g = null == t ? f.tickFormat ? f.tickFormat.apply(f, a) : Nt : t, p = s.selectAll(".tick").data(h, f), v = p.enter().insert("g", ".domain").attr("class", "tick").style("opacity", Ta), d = Go.transition(p.exit()).style("opacity", Ta).remove(), m = Go.transition(p.order()).style("opacity", 1), y = Hi(f), x = s.selectAll(".domain").data([0]), M = (x.enter().append("path").attr("class", "domain"), Go.transition(x)); v.append("line"), v.append("text"); var _ = v.select("line"), b = m.select("line"), w = p.select("text").text(g), S = v.select("text"), k = m.select("text"); switch (r) { case "bottom": n = Zo, _.attr("y2", u), S.attr("y", Math.max(u, 0) + o), b.attr("x2", 0).attr("y2", u), k.attr("x", 0).attr("y", Math.max(u, 0) + o), w.attr("dy", ".71em").style("text-anchor", "middle"), M.attr("d", "M" + y[0] + "," + i + "V0H" + y[1] + "V" + i); break; case "top": n = Zo, _.attr("y2", -u), S.attr("y", -(Math.max(u, 0) + o)), b.attr("x2", 0).attr("y2", -u), k.attr("x", 0).attr("y", -(Math.max(u, 0) + o)), w.attr("dy", "0em").style("text-anchor", "middle"), M.attr("d", "M" + y[0] + "," + -i + "V0H" + y[1] + "V" + -i); break; case "left": n = Vo, _.attr("x2", -u), S.attr("x", -(Math.max(u, 0) + o)), b.attr("x2", -u).attr("y2", 0), k.attr("x", -(Math.max(u, 0) + o)).attr("y", 0), w.attr("dy", ".32em").style("text-anchor", "end"), M.attr("d", "M" + -i + "," + y[0] + "H0V" + y[1] + "H" + -i); break; case "right": n = Vo, _.attr("x2", u), S.attr("x", Math.max(u, 0) + o), b.attr("x2", u).attr("y2", 0), k.attr("x", Math.max(u, 0) + o).attr("y", 0), w.attr("dy", ".32em").style("text-anchor", "start"), M.attr("d", "M" + i + "," + y[0] + "H0V" + y[1] + "H" + i) } if (f.rangeBand) { var E = f, N = E.rangeBand() / 2; l = f = function (n) { return E(n) + N } } else l.rangeBand ? l = f : d.call(n, f); v.call(n, l), m.call(n, f) }) } var t, e = Go.scale.linear(), r = Ps, u = 6, i = 6, o = 3, a = [10], c = null; return n.scale = function (t) { return arguments.length ? (e = t, n) : e }, n.orient = function (t) { return arguments.length ? (r = t in Us ? t + "" : Ps, n) : r }, n.ticks = function () { return arguments.length ? (a = arguments, n) : a }, n.tickValues = function (t) { return arguments.length ? (c = t, n) : c }, n.tickFormat = function (e) { return arguments.length ? (t = e, n) : t }, n.tickSize = function (t) { var e = arguments.length; return e ? (u = +t, i = +arguments[e - 1], n) : u }, n.innerTickSize = function (t) { return arguments.length ? (u = +t, n) : u }, n.outerTickSize = function (t) { return arguments.length ? (i = +t, n) : i }, n.tickPadding = function (t) { return arguments.length ? (o = +t, n) : o }, n.tickSubdivide = function () { return arguments.length && n }, n }; var Ps = "bottom", Us = { top: 1, right: 1, bottom: 1, left: 1 }; Go.svg.brush = function () { function n(i) { i.each(function () { var i = Go.select(this).style("pointer-events", "all").style("-webkit-tap-highlight-color", "rgba(0,0,0,0)").on("mousedown.brush", u).on("touchstart.brush", u), o = i.selectAll(".background").data([0]); o.enter().append("rect").attr("class", "background").style("visibility", "hidden").style("cursor", "crosshair"), i.selectAll(".extent").data([0]).enter().append("rect").attr("class", "extent").style("cursor", "move"); var a = i.selectAll(".resize").data(p, Nt); a.exit().remove(), a.enter().append("g").attr("class", function (n) { return "resize " + n }).style("cursor", function (n) { return js[n] }).append("rect").attr("x", function (n) { return /[ew]$/.test(n) ? -3 : null }).attr("y", function (n) { return /^[ns]/.test(n) ? -3 : null }).attr("width", 6).attr("height", 6).style("visibility", "hidden"), a.style("display", n.empty() ? "none" : null); var l, f = Go.transition(i), h = Go.transition(o); c && (l = Hi(c), h.attr("x", l[0]).attr("width", l[1] - l[0]), e(f)), s && (l = Hi(s), h.attr("y", l[0]).attr("height", l[1] - l[0]), r(f)), t(f) }) } function t(n) { n.selectAll(".resize").attr("transform", function (n) { return "translate(" + l[+/e$/.test(n)] + "," + f[+/^s/.test(n)] + ")" }) } function e(n) { n.select(".extent").attr("x", l[0]), n.selectAll(".extent,.n>rect,.s>rect").attr("width", l[1] - l[0]) } function r(n) { n.select(".extent").attr("y", f[0]), n.selectAll(".extent,.e>rect,.w>rect").attr("height", f[1] - f[0]) } function u() { function u() { 32 == Go.event.keyCode && (A || (x = null, L[0] -= l[1], L[1] -= f[1], A = 2), y()) } function p() { 32 == Go.event.keyCode && 2 == A && (L[0] += l[1], L[1] += f[1], A = 0, y()) } function v() { var n = Go.mouse(_), u = !1; M && (n[0] += M[0], n[1] += M[1]), A || (Go.event.altKey ? (x || (x = [(l[0] + l[1]) / 2, (f[0] + f[1]) / 2]), L[0] = l[+(n[0] < x[0])], L[1] = f[+(n[1] < x[1])]) : x = null), E && d(n, c, 0) && (e(S), u = !0), N && d(n, s, 1) && (r(S), u = !0), u && (t(S), w({ type: "brush", mode: A ? "move" : "resize" })) } function d(n, t, e) { var r, u, a = Hi(t), c = a[0], s = a[1], p = L[e], v = e ? f : l, d = v[1] - v[0]; return A && (c -= p, s -= d + p), r = (e ? g : h) ? Math.max(c, Math.min(s, n[e])) : n[e], A ? u = (r += p) + d : (x && (p = Math.max(c, Math.min(s, 2 * x[e] - r))), r > p ? (u = r, r = p) : u = p), v[0] != r || v[1] != u ? (e ? o = null : i = null, v[0] = r, v[1] = u, !0) : void 0 } function m() { v(), S.style("pointer-events", "all").selectAll(".resize").style("display", n.empty() ? "none" : null), Go.select("body").style("cursor", null), T.on("mousemove.brush", null).on("mouseup.brush", null).on("touchmove.brush", null).on("touchend.brush", null).on("keydown.brush", null).on("keyup.brush", null), C(), w({ type: "brushend" }) } var x, M, _ = this, b = Go.select(Go.event.target), w = a.of(_, arguments), S = Go.select(_), k = b.datum(), E = !/^(n|s)$/.test(k) && c, N = !/^(e|w)$/.test(k) && s, A = b.classed("extent"), C = Y(), L = Go.mouse(_), T = Go.select(ea).on("keydown.brush", u).on("keyup.brush", p); if (Go.event.changedTouches ? T.on("touchmove.brush", v).on("touchend.brush", m) : T.on("mousemove.brush", v).on("mouseup.brush", m), S.interrupt().selectAll("*").interrupt(), A) L[0] = l[0] - L[0], L[1] = f[0] - L[1]; else if (k) { var q = +/w$/.test(k), z = +/^n/.test(k); M = [l[1 - q] - L[0], f[1 - z] - L[1]], L[0] = l[q], L[1] = f[z] } else Go.event.altKey && (x = L.slice()); S.style("pointer-events", "none").selectAll(".resize").style("display", null), Go.select("body").style("cursor", b.style("cursor")), w({ type: "brushstart" }), v() } var i, o, a = M(n, "brushstart", "brush", "brushend"), c = null, s = null, l = [0, 0], f = [0, 0], h = !0, g = !0, p = Hs[0]; return n.event = function (n) { n.each(function () { var n = a.of(this, arguments), t = { x: l, y: f, i: i, j: o }, e = this.__chart__ || t; this.__chart__ = t, Ls ? Go.select(this).transition().each("start.brush", function () { i = e.i, o = e.j, l = e.x, f = e.y, n({ type: "brushstart" }) }).tween("brush:brush", function () { var e = mu(l, t.x), r = mu(f, t.y); return i = o = null, function (u) { l = t.x = e(u), f = t.y = r(u), n({ type: "brush", mode: "resize" }) } }).each("end.brush", function () { i = t.i, o = t.j, n({ type: "brush", mode: "resize" }), n({ type: "brushend" }) }) : (n({ type: "brushstart" }), n({ type: "brush", mode: "resize" }), n({ type: "brushend" })) }) }, n.x = function (t) { return arguments.length ? (c = t, p = Hs[!c << 1 | !s], n) : c }, n.y = function (t) { return arguments.length ? (s = t, p = Hs[!c << 1 | !s], n) : s }, n.clamp = function (t) { return arguments.length ? (c && s ? (h = !!t[0], g = !!t[1]) : c ? h = !!t : s && (g = !!t), n) : c && s ? [h, g] : c ? h : s ? g : null }, n.extent = function (t) { var e, r, u, a, h; return arguments.length ? (c && (e = t[0], r = t[1], s && (e = e[0], r = r[0]), i = [e, r], c.invert && (e = c(e), r = c(r)), e > r && (h = e, e = r, r = h), (e != l[0] || r != l[1]) && (l = [e, r])), s && (u = t[0], a = t[1], c && (u = u[1], a = a[1]), o = [u, a], s.invert && (u = s(u), a = s(a)), u > a && (h = u, u = a, a = h), (u != f[0] || a != f[1]) && (f = [u, a])), n) : (c && (i ? (e = i[0], r = i[1]) : (e = l[0], r = l[1], c.invert && (e = c.invert(e), r = c.invert(r)), e > r && (h = e, e = r, r = h))), s && (o ? (u = o[0], a = o[1]) : (u = f[0], a = f[1], s.invert && (u = s.invert(u), a = s.invert(a)), u > a && (h = u, u = a, a = h))), c && s ? [[e, u], [r, a]] : c ? [e, r] : s && [u, a]) }, n.clear = function () { return n.empty() || (l = [0, 0], f = [0, 0], i = o = null), n }, n.empty = function () { return !!c && l[0] == l[1] || !!s && f[0] == f[1] }, Go.rebind(n, a, "on") }; var js = { n: "ns-resize", e: "ew-resize", s: "ns-resize", w: "ew-resize", nw: "nwse-resize", ne: "nesw-resize", se: "nwse-resize", sw: "nesw-resize" }, Hs = [["n", "e", "s", "w", "nw", "ne", "se", "sw"], ["e", "w"], ["n", "s"], []], Fs = ic.format = fc.timeFormat, Os = Fs.utc, Is = Os("%Y-%m-%dT%H:%M:%S.%LZ"); Fs.iso = Date.prototype.toISOString && +new Date("2000-01-01T00:00:00.000Z") ? $o : Is, $o.parse = function (n) { var t = new Date(n); return isNaN(t) ? null : t }, $o.toString = Is.toString, ic.second = Ht(function (n) { return new oc(1e3 * Math.floor(n / 1e3)) }, function (n, t) { n.setTime(n.getTime() + 1e3 * Math.floor(t)) }, function (n) { return n.getSeconds() }), ic.seconds = ic.second.range, ic.seconds.utc = ic.second.utc.range, ic.minute = Ht(function (n) { return new oc(6e4 * Math.floor(n / 6e4)) }, function (n, t) { n.setTime(n.getTime() + 6e4 * Math.floor(t)) }, function (n) { return n.getMinutes() }), ic.minutes = ic.minute.range, ic.minutes.utc = ic.minute.utc.range, ic.hour = Ht(function (n) { var t = n.getTimezoneOffset() / 60; return new oc(36e5 * (Math.floor(n / 36e5 - t) + t)) }, function (n, t) { n.setTime(n.getTime() + 36e5 * Math.floor(t)) }, function (n) { return n.getHours() }), ic.hours = ic.hour.range, ic.hours.utc = ic.hour.utc.range, ic.month = Ht(function (n) { return n = ic.day(n), n.setDate(1), n }, function (n, t) { n.setMonth(n.getMonth() + t) }, function (n) { return n.getMonth() }), ic.months = ic.month.range, ic.months.utc = ic.month.utc.range; var Ys = [1e3, 5e3, 15e3, 3e4, 6e4, 3e5, 9e5, 18e5, 36e5, 108e5, 216e5, 432e5, 864e5, 1728e5, 6048e5, 2592e6, 7776e6, 31536e6], Zs = [[ic.second, 1], [ic.second, 5], [ic.second, 15], [ic.second, 30], [ic.minute, 1], [ic.minute, 5], [ic.minute, 15], [ic.minute, 30], [ic.hour, 1], [ic.hour, 3], [ic.hour, 6], [ic.hour, 12], [ic.day, 1], [ic.day, 2], [ic.week, 1], [ic.month, 1], [ic.month, 3], [ic.year, 1]], Vs = Fs.multi([[".%L", function (n) { return n.getMilliseconds() }], [":%S", function (n) { return n.getSeconds() }], ["%I:%M", function (n) { return n.getMinutes() }], ["%I %p", function (n) { return n.getHours() }], ["%a %d", function (n) { return n.getDay() && 1 != n.getDate() }], ["%b %d", function (n) { return 1 != n.getDate() }], ["%B", function (n) { return n.getMonth() }], ["%Y", Ne]]), $s = { range: function (n, t, e) { return Go.range(Math.ceil(n / e) * e, +t, e).map(Bo) }, floor: Nt, ceil: Nt }; Zs.year = ic.year, ic.scale = function () { return Xo(Go.scale.linear(), Zs, Vs) }; var Xs = Zs.map(function (n) { return [n[0].utc, n[1]] }), Bs = Os.multi([[".%L", function (n) { return n.getUTCMilliseconds() }], [":%S", function (n) { return n.getUTCSeconds() }], ["%I:%M", function (n) { return n.getUTCMinutes() }], ["%I %p", function (n) { return n.getUTCHours() }], ["%a %d", function (n) { return n.getUTCDay() && 1 != n.getUTCDate() }], ["%b %d", function (n) { return 1 != n.getUTCDate() }], ["%B", function (n) { return n.getUTCMonth() }], ["%Y", Ne]]); Xs.year = ic.year.utc, ic.scale.utc = function () { return Xo(Go.scale.linear(), Xs, Bs) }, Go.text = At(function (n) { return n.responseText }), Go.json = function (n, t) { return Ct(n, "application/json", Jo, t) }, Go.html = function (n, t) { return Ct(n, "text/html", Wo, t) }, Go.xml = At(function (n) { return n.responseXML }), "function" == typeof define && define.amd ? define(Go) : "object" == typeof module && module.exports ? module.exports = Go : this.d3 = Go
    }();

    /*begin demo-bundle.js*/
    !function (e) { if ("object" == typeof exports && "undefined" != typeof module) module.exports = e(); else if ("function" == typeof define && define.amd) define([], e); else { var f; "undefined" != typeof window ? f = window : "undefined" != typeof global ? f = global : "undefined" != typeof self && (f = self), f.demo = e() } }(function () {
        var define, module, exports; return (function e(t, n, r) { function s(o, u) { if (!n[o]) { if (!t[o]) { var a = typeof require == "function" && require; if (!u && a) return a(o, !0); if (i) return i(o, !0); throw new Error("Cannot find module '" + o + "'") } var f = n[o] = { exports: {} }; t[o][0].call(f.exports, function (e) { var n = t[o][1][e]; return s(n ? n : e) }, f, f.exports, e, t, n, r) } return n[o].exports } var i = typeof require == "function" && require; for (var o = 0; o < r.length; o++) s(r[o]); return s })({
            1: [function (_dereq_, module, exports) {

                var nm = _dereq_('../../lib')

                module.exports = {
                    run: runDemo,
                    preload: preload,
                    skins: {
                        wf: _dereq_('../../skins/workflowy'),
                        wb: _dereq_('../../skins/whiteboard')
                    },
                    pl: {
                        Mem: _dereq_('../../lib/pl/mem'),
                        Firebase: _dereq_('../../lib/pl/firebase')
                    }
                }

                function merge(a, b) {
                    for (var c in b) {
                        a[c] = b[c]
                    }
                    return a
                }

                function preload(scripts, cb) {
                    var waiting = 0
                    scripts.forEach(function (name) {
                        waiting += 1
                        var node = document.createElement('script')
                        node.src = name
                        var done = false
                        node.onload = node.onreadystatechange = function () {
                            if (done || (this.readyState && this.readyState !== 'loaded' && this.readyState !== 'complete')) {
                                return
                            }
                            done = true
                            node.onload = node.onreadystatechange = null
                            waiting -= 1
                            if (!waiting) {
                                cb()
                            }
                        }
                        document.body.appendChild(node)
                    })
                }

                function runDemo(options, done) {
                    var o = merge({
                        noTitle: false,
                        title: '',
                        //MD: removed the treeview
                        //el: '',
                        Model: nm.Model,
                        Controller: nm.Controller,
                        View: nm.View,
                        viewOptions: {
                            ViewLayer: nm.ViewLayer,
                            Node: nm.Node
                        },
                        style: [],
                        data: ruleapp_data,
                        ctrlOptions: {},
                        initDB: function () { },
                    }, options)

                    //alert("4");
                    if (!o.noTitle) {
                        document.title = o.title
                        document.getElementById('title').textContent = o.title
                    }

                    o.style.forEach(function (name) {
                        var style = document.createElement('link');
                        style.rel = 'stylesheet'
                        style.href = name
                        document.head.appendChild(style);
                    });

                    var db = o.pl || new module.exports.pl.Mem({});

                    db.init(function (err) {
                        if (err) {
                            return loadFailed(err);
                        }

                        initDB(db, function (err, root, map, wasEmpty) {
                            //alert("1");
                            window.model = new o.Model(root, map, db)
                            window.ctrl = window.controller = new o.Controller(model, o.ctrlOptions)
                            window.view = window.view = ctrl.setView(
                              o.View,
                              o.viewOptions
                            );
                            if (wasEmpty) {
                                //o.data['node'][50] = o.data.content;
                                //ctrl.importData(o.data.content, 50);
                                for (var i = 0; i < o.data.children.length; i++) {
                                    ctrl.importData(o.data.children[i], root.id);
                                }
                                if (options.initDB) options.initDB(window.model)
                                window.view.rebase(root.id);
                            }
                            //MD: commented to remove the treeview
                            //document.getElementById(o.el).appendChild(view.getNode());

                            done && done(window.model, window.ctrl, window.view, db)

                        });
                    });
                }

                function initDB(db, done) {
                    //alert("2");
                    db.findAll('root', function (err, roots) {
                        if (err) return done(err)

                        if (!roots.length) {
                            return loadDefault(db, done)
                        }

                        db.findAll('node', function (err, nodes) {
                            if (err) return done(new Error('Failed to load items'))
                            if (!nodes.length) return done(new Error("Data corrupted - could not find root node"))

                            var map = {}
                            ctrl.actions.changeContent(50, "content");
                            for (var i = 0; i < nodes.length; i++) {
                                map[nodes[i].id] = nodes[i]
                            }

                            done(null, roots[0], map, false)
                        })
                    })
                }

                function loadDefault(db, done) {
                    var ROOT_ID = 50
                    //alert("3");
                    // load default
                    db.save('root', ROOT_ID, { id: ROOT_ID }, function () {
                        var map = {}
                        map[ROOT_ID] = {
                            id: ROOT_ID,
                            children: [],
                            collapsed: false,
                            content: "###Root###",
                            meta: {},
                            depth: 0
                        }

                        db.save('node', ROOT_ID, map[ROOT_ID], function () {
                            done(null, { id: ROOT_ID }, map, true)
                        })
                    })
                }


            }, { "../../lib": 11, "../../lib/pl/firebase": 17, "../../lib/pl/mem": 18, "../../skins/whiteboard": 26, "../../skins/workflowy": 30 }], 2: [function (_dereq_, module, exports) {

                module.exports = BaseNode

                var keys = _dereq_('./keys')
                  , util = _dereq_('./util')

                function BaseNode(content, meta, options, isNew, modelActions) {
                    this.content = content || ''
                    this.isNew = isNew
                    this.modelActions = modelActions
                    this.o = options
                    this.o.keybindings = util.merge(this.default_keys, options.keys)

                    this.editing = false
                    this.setupNode();
                }

                BaseNode.addAction = function (action, binding, func) {
                    if (!this.extra_actions) {
                        this.extra_actions = {}
                    }
                    this.extra_actions[action] = {
                        binding: binding,
                        func: func
                    }
                }

                BaseNode.prototype = {
                    // public
                    startEditing: function (fromStart) {
                    },

                    stopEditing: function () {
                    },

                    addEditText: function (text) {
                    },

                    setMeta: function (meta) {
                    },

                    setAttr: function (attr, value) {
                    },

                    // protexted
                    isAtStart: function () {
                    },

                    isAtEnd: function () {
                    },

                    isAtBottom: function () {
                    },

                    isAtTop: function () {
                    },

                    setupNode: function () {
                    },

                    setInputValue: function (value) {
                    },

                    getInputValue: function () {
                    },

                    setTextContent: function (value) {
                    },

                    getSelectionPosition: function () {
                    },

                    // Should there be a canStopEditing?
                    focus: function () {
                        this.startEditing();
                    },

                    blur: function () {
                        this.stopEditing();
                    },

                    keyHandler: function () {
                        var actions = {}
                          , action
                        for (action in this.o.keybindings) {
                            actions[this.o.keybindings[action]] = this.actions[action]
                        }

                        if (this.extra_actions) {
                            for (action in this.extra_actions) {
                                if (!actions[action]) {
                                    actions[this.extra_actions[action].binding] = this.extra_actions[action].action
                                }
                            }
                        }

                        return keys(actions).bind(this)
                    },

                    default_keys: {
                        'undo': 'ctrl+z',
                        'redo': 'ctrl+shift+z',
                        'collapse': 'alt+left',
                        'uncollapse': 'alt+right',
                        'dedent': 'shift+tab, shift+alt+left',
                        'indent': 'tab, shift+alt+right',
                        'move up': 'shift+alt+up',
                        'move down': 'shift+alt+down',
                        'up': 'up',
                        'down': 'down',
                        'left': 'left',
                        'right': 'right',
                        'add after': 'return',
                        'insert return': 'shift+return',
                        'merge up': 'backspace',
                        'stop editing': 'escape',
                    },

                    actions: {
                        'undo': function () {
                            this.o.undo()
                        },

                        'redo': function () {
                            this.o.redo()
                        },

                        'collapse': function () {
                            this.o.toggleCollapse(true)
                        },

                        'uncollapse': function () {
                            this.o.toggleCollapse(false)
                        },

                        'dedent': function () {
                            this.o.moveLeft()
                        },

                        'indent': function () {
                            this.o.moveRight()
                        },

                        'move up': function () {
                            this.o.moveUp()
                        },

                        'move down': function () {
                            this.o.moveDown()
                        },

                        'up': function () {
                            if (this.isAtTop()) {
                                this.o.goUp();
                            } else {
                                return true
                            }
                        },

                        'down': function () {
                            if (this.isAtBottom()) {
                                this.o.goDown()
                            } else {
                                return true
                            }
                        },

                        'left': function () {
                            if (this.isAtStart()) {
                                return this.o.goUp()
                            }
                            return true
                        },

                        'right': function () {
                            if (this.isAtEnd()) {
                                return this.o.goDown(true)
                            }
                            return true
                        },

                        'insert return': function (e) {
                            return true
                        },

                        'add after': function () {
                            var ss = this.getSelectionPosition()
                              , content = this.getVisibleValue()
                              , rest = null
                            if (this.isMultiLine()) {
                                return true
                            }
                            var rest = this.splitRightOfCursor()
                            if (!this.isNew) {
                                this.stopEditing()
                            }
                            this.o.addAfter(rest, true)
                        },

                        // on backspace
                        'merge up': function () {
                            var value = this.getInputValue()
                            if (!value) {
                                return this.o.remove()
                            }
                            if (!this.isMultiLine() && this.isAtStart()) {
                                return this.o.remove(value)
                            }
                            return true
                        },

                        'stop editing': function () {
                            this.stopEditing();
                        }
                    },
                }


            }, { "./keys": 13, "./util": 21 }], 3: [function (_dereq_, module, exports) {

                var commands = _dereq_('./commands')

                module.exports = Commandeger

                function makeCommand(type, args, commands) {
                    var names = commands[type].args
                      , data = {}
                    for (var i = 0; i < names.length; i++) {
                        data[names[i]] = args[i]
                    }
                    return { type: type, data: data }
                }

                /**
                 * Manages the execution of commands.
                 */
                function Commandeger(model, extra_commands) {
                    this.history = []
                    this.histpos = 0
                    this.view = null
                    this.listeners = {}
                    this.working = false
                    this.model = model
                    this.commands = commands
                    if (extra_commands) {
                        for (var name in extra_commands) {
                            this.commands[name] = extra_commands[name]
                        }
                    }
                }

                Commandeger.prototype = {
                    /**
                     * Execute one or more comments.
                     *
                     * Usage:
                     *
                     * - executeCommands('cmdtype', [args, etc])
                     * - executeCommands('cmdtype', [args, etc], 'nother', [more, args])
                     *
                     * @param {string} type the command to execute
                     * @param {list} args a list of args to pass to the comment
                     */
                    executeCommands: function (type, args) {
                        if (this.working) return
                        var cmds = [];
                        var results = [];
                        var i
                        for (i = 0; i < arguments.length; i += 2) {
                            cmds.push(makeCommand(arguments[i], arguments[i + 1], this.commands))
                        }
                        if (this.histpos > 0) {
                            this.history = this.history.slice(0, -this.histpos)
                            this.histpos = 0
                        }
                        this.history.push(cmds)
                        for (i = 0; i < cmds.length; i++) {
                            results.push(this.doCommand(cmds[i]))
                        }
                        this.trigger('change')
                        return results
                    },

                    /**
                     * Trigger an event on listeners
                     *
                     * @param {string} what the event to trigger
                     */
                    trigger: function (what) {
                        var rest = [].slice.call(arguments, 1)
                        for (var item in this.listeners[what]) {
                            this.listeners[what][item].apply(null, rest)
                        }
                    },

                    /**
                     * Register a listener for an event
                     *
                     * @param {string} what the event type
                     * @param {fn} cb the event handler function
                     */
                    on: function (what, cb) {
                        if (!this.listeners[what]) {
                            this.listeners[what] = []
                        }
                        this.listeners[what].push(cb)
                    },

                    /**
                     * Undo the most recent change, if possible.
                     *
                     * If history is empty, nothing happens.
                     *
                     * @return {bool} whether anything actually happened
                     */
                    undo: function () {
                        document.activeElement.blur()
                        var pos = this.histpos ? this.histpos + 1 : 1
                          , ix = this.history.length - pos
                        if (ix < 0) {
                            return false // no more undo!
                        }
                        var cmds = this.history[ix]
                        for (var i = cmds.length - 1; i >= 0; i--) {
                            this.undoCommand(cmds[i])
                        }
                        this.histpos += 1
                        this.trigger('change')
                        return true
                    },

                    /**
                     * Redo the most recent undo, if any
                     *
                     * @return {bool} whether anothing was redone
                     */
                    redo: function () {
                        var pos = this.histpos ? this.histpos - 1 : -1
                          , ix = this.history.length - 1 - pos
                        if (ix >= this.history.length) {
                            return false // no more to redo!
                        }
                        var cmds = this.history[ix]
                        for (var i = 0; i < cmds.length; i++) {
                            this.redoCommand(cmds[i])
                        }
                        this.histpos -= 1
                        this.trigger('change')
                        return true
                    },

                    // privatish things
                    setView: function (view) {
                        this.view = view
                    },

                    doCommand: function (cmd) {
                        this.working = true
                        var result = this.commands[cmd.type].apply.call(cmd.data, this.view, this.model)
                        this.working = false
                        return result
                    },

                    undoCommand: function (cmd) {
                        this.working = true
                        this.commands[cmd.type].undo.call(cmd.data, this.view, this.model)
                        this.working = false
                    },

                    redoCommand: function (cmd) {
                        this.working = true
                        var c = this.commands[cmd.type]
                        ; (c.redo || c.apply).call(cmd.data, this.view, this.model)
                        this.working = false
                    },
                }


            }, { "./commands": 4 }], 4: [function (_dereq_, module, exports) {

                function copy(one) {
                    if ('object' !== typeof one) return one
                    var two = {}
                    for (var attr in one) {
                        two[attr] = one[attr]
                    }
                    return two
                }

                module.exports = {
                    collapse: {
                        args: ['id', 'doCollapse'],
                        apply: function (view, model) {
                            model.setCollapsed(this.id, this.doCollapse)
                            view.setCollapsed(this.id, this.doCollapse)
                            view.goTo(this.id)
                        },
                        undo: function (view, model) {
                            model.setCollapsed(this.id, !this.doCollapse)
                            view.setCollapsed(this.id, !this.doCollapse)
                            view.goTo(this.id)
                        },
                    },

                    appendText: {
                        args: ['id', 'text'],
                        apply: function (view, model) {
                            this.oldtext = model.ids[this.id].content
                            model.appendText(this.id, this.text)
                            view.appendText(this.id, this.text)
                        },
                        undo: function (view, model) {
                            model.setContent(this.id, this.oldtext)
                            view.setContent(this.id, this.oldtext)
                        }
                    },

                    changeContent: {
                        args: ['id', 'content'],
                        apply: function (view, model) {
                            this.oldcontent = model.ids[this.id].content
                            model.setContent(this.id, this.content)
                            view.setContent(this.id, this.content)
                            view.goTo(this.id)
                        },
                        undo: function (view, model) {
                            model.setContent(this.id, this.oldcontent)
                            view.setContent(this.id, this.oldcontent)
                            view.goTo(this.id)
                        }
                    },

                    changeNodeAttr: {
                        args: ['id', 'attr', 'value'],
                        apply: function (view, model) {
                            this.oldvalue = copy(model.ids[this.id].meta[this.attr])
                            model.setAttr(this.id, this.attr, this.value)
                            view.setAttr(this.id, this.attr, this.value)
                            view.goTo(this.id)
                        },
                        undo: function (view, model) {
                            model.setAttr(this.id, this.attr, this.oldvalue)
                            view.setAttr(this.id, this.attr, this.oldvalue)
                            view.goTo(this.id)
                        }
                    },

                    changeNode: {
                        args: ['id', 'newmeta'],
                        apply: function (view, model) {
                            this.oldmeta = copy(model.ids[this.id].meta)
                            model.setMeta(this.id, this.newmeta)
                            view.setMeta(this.id, this.newmeta)
                            view.goTo(this.id)
                        },

                        undo: function (view, model) {
                            model.setMeta(this.id, this.oldmeta)
                            view.setMeta(this.id, this.oldmeta)
                            view.goTo(this.id)
                        }
                    },

                    newNode: {
                        args: ['pid', 'index', 'text', 'meta', 'type'],
                        apply: function (view, model) {
                            var cr = model.create(this.pid, this.index, this.text, this.type, this.meta)
                            this.id = cr.node.id
                            view.add(cr.node, cr.before)
                            // view.startEditing(cr.node.id)
                        },

                        undo: function (view, model) {
                            var ed = view.editing
                            view.remove(this.id)
                            this.saved = model.remove(this.id)
                            var nid = model.ids[this.pid].children[this.index - 1]
                            if (nid === undefined) nid = this.pid
                            if (ed) {
                                view.startEditing(nid)
                            } else {
                                view.setActive(nid)
                            }
                        },

                        redo: function (view, model) {
                            var before = model.readd(this.saved)
                            view.add(this.saved.node, before)
                        }
                    },

                    move: {
                        args: ['id', 'pid', 'index'],
                        apply: function (view, model) {
                            this.opid = model.ids[this.id].parent
                            this.oindex = model.ids[this.opid].children.indexOf(this.id)
                            var before = model.move(this.id, this.pid, this.index)
                            var parent = model.ids[this.opid]
                              , lastchild = parent.children.length === 0
                            view.move(this.id, this.pid, before, this.opid, lastchild)
                            view.goTo(this.id)
                        },

                        undo: function (view, model) {
                            var before = model.move(this.id, this.opid, this.oindex)
                              , lastchild = model.ids[this.pid].children.length === 0
                            view.move(this.id, this.opid, before, this.pid, lastchild)
                            view.goTo(this.id)
                        }
                    },

                    remove: {
                        args: ['id'],
                        apply: function (view, model) {
                            var closest = model.closestNonChild(this.id)
                            view.remove(this.id)
                            this.saved = model.remove(this.id)
                            view.startEditing(closest)
                        },

                        undo: function (view, model) {
                            var before = model.readd(this.saved)
                            view.addTree(this.saved.node, before)
                        }
                    },

                    copy: {
                        args: ['ids'],
                        apply: function (view, model) {
                            var items = this.ids.map(function (id) {
                                return model.dumpData(id, true)
                            })
                            model.clipboard = items
                        },
                        undo: function (view, model) {
                        }
                    },

                    cut: {
                        args: ['ids'],
                        // ids are always in descending order, where 0 is the first sibling, and
                        // the last item is the last sibling
                        apply: function (view, model) {
                            var items = this.ids.map(function (id) {
                                view.remove(id, true)
                                return model.dumpData(id, true)
                            })
                            model.clipboard = items

                            var id = this.ids[this.ids.length - 1]
                            var closest = model.closestNonChild(id, this.ids)
                            this.saved = this.ids.map(function (id) {
                                return model.remove(id)
                            })

                            if (view.editing) {
                                view.startEditing(closest)
                            } else {
                                view.setActive(closest)
                            }
                        },

                        undo: function (view, model) {
                            var before
                            for (var i = this.saved.length - 1; i >= 0; i--) {
                                before = model.readd(this.saved[i])
                                view.addTree(this.saved[i].node, before)
                            }
                            if (this.ids.length > 1) {
                                view.setSelection(this.ids)
                                view.setActive(this.ids[this.ids.length - 1])
                            }
                        }
                    },

                    importData: {
                        args: ['pid', 'index', 'data'],
                        apply: function (view, model) {
                            //alert("5");
                            var pid = this.pid
                              , index = this.index
                              , ed = view.editing
                              , item = this.data
                            var cr = model.createNodes(pid, index, item)
                            view.addTree(cr.node, cr.before)
                            view.setCollapsed(cr.node.parent, false)
                            model.setCollapsed(cr.node.parent, false)
                            this.newid = cr.node.id
                            if (ed) {
                                view.startEditing(this.newid)
                            } else {
                                view.setActive(this.newid)
                            }
                        },

                        undo: function (view, model) {
                            var id = this.newid
                            var closest = model.closestNonChild(id)
                            view.remove(id)
                            this.saved = model.remove(id)
                            if (view.editing) {
                                view.startEditing(closest)
                            } else {
                                view.setActive(closest)
                            }
                            // view.remove(this.newid)
                            // this.saved = model.remove(this.newid)
                            model.clipboard = this.saved
                        },
                        redo: function (view, model) {
                            // var before = model.readd(this.saved)
                            // view.addTree(this.saved.node, before)
                            var before = model.readd(this.saved)
                            view.addTree(this.saved.node, before)
                            if (view.editing) {
                                view.startEditing(this.newid)
                            } else {
                                view.setActive(this.newid)
                            }
                        }
                    },

                    paste: {
                        args: ['pid', 'index'],
                        apply: function (view, model) {
                            var pid = this.pid
                              , index = this.index
                              , ed = view.editing
                            var ids = model.clipboard.map(function (item) {
                                var cr = model.createNodes(pid, index, item)
                                view.addTree(cr.node, cr.before)
                                if (model.ids[cr.node.parent].collapsed) {
                                    view.setCollapsed(cr.node.parent, false)
                                    model.setCollapsed(cr.node.parent, false)
                                }
                                index += 1
                                return cr.node.id
                            })
                            this.newids = ids
                            if (ids.length == 1) {
                                if (ed) {
                                    view.startEditing(this.newids[0])
                                } else {
                                    view.setActive(this.newids[0])
                                }
                            } else {
                                view.setSelection(ids)
                                view.setActive(ids[ids.length - 1])
                            }
                        },

                        undo: function (view, model) {
                            var id = this.newids[this.newids.length - 1]
                            var closest = model.closestNonChild(id)
                            this.saved = this.newids.map(function (id) {
                                view.remove(id)
                                return model.remove(id)
                            })
                            if (view.editing) {
                                view.startEditing(closest)
                            } else {
                                view.setActive(closest)
                            }
                        },

                        redo: function (view, model) {
                            // var before = model.readd(this.saved)
                            // view.addTree(this.saved.node, before)
                            this.saved.map(function (item) {
                                var before = model.readd(item)
                                view.addTree(item.node, before)
                            })
                        }
                    },

                }


            }, {}], 5: [function (_dereq_, module, exports) {

                module.exports = Controller

                var Commandeger = _dereq_('./commandeger')

                  , util = _dereq_('./util')

                function Controller(model, o) {
                    this.o = util.extend({
                        noCollapseRoot: true,
                        extra_commands: false
                    }, o || {})
                    this.model = model
                    this.cmd = new Commandeger(this.model, this.o.extra_commands)

                    this.model.db.listen('node', this.addFromDb.bind(this), this.updateFromDb.bind(this))

                    var actions = {}
                    for (var action in this.actions) {
                        if ('string' === typeof this.actions[action]) actions[action] = this.actions[action]
                        else actions[action] = this.actions[action].bind(this)
                    }
                    this.actions = actions
                    this.listeners = {}
                }

                Controller.prototype = {
                    addFromDb: function (id, data) {
                        // if (this.model.ids[id]) return
                        this.view.update(id, data)
                        this.model.ids[id] = data
                    },
                    updateFromDb: function (id, data) {
                        this.view.update(id, data)
                        this.model.ids[id] = data
                    },

                    /**
                     * Set the current view
                     *
                     * @param {class} View the View class
                     * @param {object} options the options to pass to the view
                     * @return {View} the view object
                     */
                    setView: function (View, options) {
                        var oview = this.view
                        this.view = new View(
                          this.bindActions.bind(this),
                          this.model, this.actions,
                          options
                        )

                        var root = (oview ? oview.root : this.model.root);
                        var node = this.view.initialize(root)
                        if (oview) {
                            oview.getNode().parentNode.replaceChild(node, oview.getNode());
                        }
                        this.cmd.setView(this.view)
                        return this.view
                    },

                    /**
                     * Undo the most recent comment
                     */
                    undo: function () {
                        this.cmd.undo()
                    },

                    /**
                     * Redo the most recent undo
                     */
                    redo: function () {
                        this.cmd.redo()
                    },

                    /**
                     * Attach a listener
                     */
                    on: function (evt, func) {
                        if (!this.listeners[evt]) {
                            this.listeners[evt] = []
                        }
                        this.listeners[evt].push(func)
                    },

                    /**
                     * Remove a listener
                     */
                    off: function (evt, func) {
                        if (!this.listeners[evt]) return false
                        var i = this.listeners[evt].indexOf(func)
                        if (i === -1) return false
                        this.listeners[evt].splice(i, 1)
                        return true
                    },

                    /**
                     * Trigger an event
                     */
                    trigger: function (evt) {
                        if (!this.listeners[evt]) return
                        var args = [].slice.call(arguments, 1)
                        for (var i = 0; i < this.listeners[evt].length; i++) {
                            this.listeners[evt][i].apply(null, args)
                        }
                    },

                    /**
                     * Create bound versions of each action function for a given id
                     *
                     * @param {string} id this id ts sins things
                     */
                    bindActions: function (id) {
                        var actions = {}
                          , val
                        for (var action in this.actions) {
                            val = this.actions[action]
                            if ('string' === typeof val) {
                                val = this[val][action].bind(this[val], id)
                            } else {
                                val = val.bind(this, id)
                            }
                            actions[action] = val
                        }
                        return actions
                    },

                    importData: function (data, parent) {
                        //alert("6");
                        if (arguments.length === 1) {
                            parent = this.view.getActive();
                        }
                        if (parent === "new") {
                            this.view.removeNew()
                            parent = this.view.root
                        }
                        this.executeCommands('importData', [parent, 0, data])
                        // this.model.createNodes(this.view.getActive(), 0, data)
                        // this.view.rebase(this.view.root)
                    },

                    exportData: function () {
                        return this.model.dumpData(this.model.root, true)
                    },

                    executeCommands: function () {
                        var res
                        if (arguments.length === 1 && Array.isArray(arguments[0])) {
                            res = this.cmd.executeCommands.apply(this.cmd, arguments[0])
                        } else {
                            res = this.cmd.executeCommands.apply(this.cmd, arguments)
                        }
                        this.trigger('change')
                        return res
                    },

                    // public
                    setCollapsed: function (id, doCollapse) {
                        if (this.o.noCollapseRoot && id === this.view.root) return
                        if (!this.model.hasChildren(id)) return
                        if (this.model.isCollapsed(id) === doCollapse) return
                        this.executeCommands('collapse', [id, doCollapse]);
                    },

                    addBefore: function (id, text) {
                        var nw = this.model.idNew(id, true)
                        this.executeCommands('newNode', [nw.pid, nw.index, text])
                    },

                    actions: {
                        trigger: function () {
                            this.trigger.apply(this, arguments)
                        },

                        setActive: function (id) {
                            this.view.setActive(id)
                        },

                        // move focus
                        goUp: function (id) {
                            if (id === this.view.root) return
                            if (id === 'new') return this.view.goTo(this.view.root)
                            // should I check to see if it's ok?
                            var above = this.model.idAbove(id)
                            if (above === undefined) return
                            this.view.startEditing(above);
                        },

                        goDown: function (id, fromStart) {
                            if (id === 'new') return this.view.goTo(this.view.root)
                            var below = this.model.idBelow(id, this.view.root)
                            if (below === undefined) return
                            this.view.startEditing(below, fromStart);
                        },

                        goLeft: function (id) {
                            if (id === 'new') return this.view.goTo(this.view.root)
                            if (id === this.view.root) return
                            var parent = this.model.getParent(id)
                            if (!parent) return
                            this.view.startEditing(parent)
                        },

                        goRight: function (id) {
                            if (id === 'new') return this.view.goTo(this.view.root)
                            var child = this.model.getChild(id)
                            if (!child) return
                            this.view.startEditing(child)
                        },

                        startMoving: function (id) {
                            if (id === 'new') return
                            if (id === this.view.root) return
                            this.view.startMoving(id)
                        },

                        // modification
                        undo: function () { this.cmd.undo() },
                        redo: function () { this.cmd.redo() },

                        // commanders
                        cut: function (ids) {
                            if (ids === this.view.root) return
                            if (!Array.isArray(ids)) {
                                ids = [ids]
                            }
                            this.executeCommands('cut', [ids])
                        },

                        copy: function (ids) {
                            if (!Array.isArray(ids)) {
                                ids = [ids]
                            }
                            this.executeCommands('copy', [ids])
                        },

                        pasteAbove: function (id) {
                            return this.actions.paste(id, true)
                        },

                        paste: function (id, above) {
                            if (!this.model.clipboard) return
                            var nw = this.model.idNew(id, above)
                            this.executeCommands('paste', [nw.pid, nw.index])
                        },

                        changeContent: function (id, content) {
                            if (id === 'new') {
                                if (!content) return
                                var nw = this.view.removeNew()
                                this.executeCommands('newNode', [nw.pid, nw.index, content, {}])
                                return
                            }
                            this.executeCommands('changeContent', [id, content])
                        },

                        changed: function (id, attr, value) {
                            if (id === 'new') {
                                if (!value) return
                                var nw = this.view.removeNew()
                                var meta = {}
                                meta[attr] = value
                                this.executeCommands('newNode', [nw.pid, nw.index, '', meta])
                                return
                            }
                            this.executeCommands('changeNodeAttr', [id, attr, value])
                        },

                        // move node
                        move: function (where, id, target) {
                            var action = {
                                before: 'ToBefore',
                                after: 'ToAfter',
                                child: 'Into',
                                lastChild: 'IntoLast'
                            }[where]
                            this.actions['move' + action](id, target)//target, id)
                        },

                        moveToBefore: function (id, sid) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            var place = this.model.moveBeforePlace(sid, id)
                            if (!place) return
                            // if (this.model.samePlace(id, place)) return
                            this.executeCommands('move', [id, place.pid, place.ix])
                        },

                        moveToAfter: function (id, sid) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            var place = this.model.moveAfterPlace(sid, id)
                            if (!place) return
                            // if (this.model.samePlace(id, place)) return
                            this.executeCommands('move', [id, place.pid, place.ix])
                        },

                        moveInto: function (id, pid) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            if (this.model.samePlace(id, { pid: pid, ix: 0 })) return
                            if (!this.model.isCollapsed(pid)) {
                                return this.executeCommands('move', [id, pid, 0])
                            }
                            this.executeCommands('collapse', [pid, false], 'move', [id, pid, 0])
                        },

                        moveIntoLast: function (id, pid) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            var ix = this.model.ids[pid].children.length
                            if (this.model.samePlace(id, { pid: pid, ix: ix })) return
                            if (!this.model.isCollapsed(pid)) {
                                return this.executeCommands('move', [id, pid, ix])
                            }
                            this.executeCommands('collapse', [pid, false], 'move', [id, pid, ix])
                        },

                        moveRight: function (id) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            var sib = this.model.prevSibling(id, true)
                            if (undefined === sib) return
                            if (!this.model.isCollapsed(sib)) {
                                return this.executeCommands('move', [id, sib, false])
                            }
                            this.executeCommands('collapse', [sib, false], 'move', [id, sib, false])
                        },

                        moveLeft: function (id) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            if (this.model.ids[id].parent === this.view.root) return
                            // TODO handle multiple selected
                            var place = this.model.shiftLeftPlace(id)
                            if (!place) return
                            this.executeCommands('move', [id, place.pid, place.ix])
                        },

                        moveUp: function (id) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            // TODO handle multiple selected
                            var place = this.model.shiftUpPlace(id)
                            if (!place) return
                            if (place.pid === this.model.ids[this.view.root].parent) return
                            this.executeCommands('move', [id, place.pid, place.ix])
                        },

                        moveDown: function (id) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            // TODO handle multiple selected
                            var place = this.model.shiftDownPlace(id)
                            if (!place) return
                            if (place.pid === this.model.ids[this.view.root].parent) return
                            this.executeCommands('move', [id, place.pid, place.ix])
                        },

                        moveToTop: function (id) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            var first = this.model.firstSibling(id)
                            if (undefined === first) return
                            var pid = this.model.ids[first].parent
                            if (pid === undefined) return
                            var ix = this.model.ids[pid].children.indexOf(first)
                            this.executeCommands('move', [id, pid, ix])
                        },

                        moveToBottom: function (id) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            var last = this.model.lastSibling(id)
                            if (undefined === last) return
                            var pid = this.model.ids[last].parent
                            if (pid === undefined) return
                            var ix = this.model.ids[pid].children.indexOf(last)
                            this.executeCommands('move', [id, pid, ix + 1])
                        },

                        toggleCollapse: function (id, yes) {
                            if (this.o.noCollapseRoot && id === this.view.root) return
                            if (id === 'new') return
                            if (arguments.length === 1) {
                                yes = !this.model.hasChildren(id) || !this.model.isCollapsed(id)
                            }
                            if (yes) {
                                id = this.model.findCollapser(id)
                                if (this.o.noCollapseRoot && id === this.view.root) return
                                if (!this.model.hasChildren(id) || this.model.isCollapsed(id)) return
                            } else {
                                if (!this.model.hasChildren(id) || !this.model.isCollapsed(id)) return
                            }
                            this.executeCommands('collapse', [id, yes])
                        },

                        addChild: function (pid, index, content, config) {
                            this.executeCommands('newNode', [pid, index, content, config])
                        },

                        commands: function () {
                            this.executeCommands.apply(this, arguments)
                        },

                        addBefore: function (id, text, focus) {
                            if (id === this.view.root) return
                            if (id === 'new') {
                                // TODO: better behavior here
                                return
                            }
                            var nw = this.model.idNew(id, true)
                            this.executeCommands('newNode', [nw.pid, nw.index, text])
                            if (focus) this.view.startEditing()
                        },

                        addAfter: function (id, text, focus) {
                            var nw
                            var ed = focus || this.view.mode === 'insert'
                            // this.view.stopEditing()
                            if (id === 'new') {
                                // TODO: better behavior here

                                nw = this.view.removeNew()
                                this.executeCommands(
                                  'newNode', [nw.pid, nw.index + 1, '']
                                )
                                if (ed) this.view.startEditing()
                                return
                            }
                            if (id === this.view.root) {
                                var node = this.model.ids[id]
                                if (!node.children || !node.children.length) {
                                    if (this.view.newNode) return this.view.startEditing('new')
                                    this.view.addNew(id, 0)
                                    this.view.startEditing('new')
                                    return
                                }
                            }
                            nw = this.model.idNew(id, false, this.view.root)
                            this.executeCommands('newNode', [nw.pid, nw.index, text])
                            if (ed) this.view.startEditing()
                        },

                        remove: function (id, addText) {
                            if (id === this.view.root) return
                            if (id === 'new') return
                            var before = this.model.idAbove(id)
                            this.executeCommands(
                              'remove', [id],
                              'appendText', [before, addText || '']
                            )
                        },

                        setEditing: 'view',
                        doneEditing: 'view'
                    }
                }


            }, { "./commandeger": 3, "./util": 21 }], 6: [function (_dereq_, module, exports) {

                module.exports = {
                    visual: {
                        'select up': 'k, up',
                        'select down': 'j, down',
                        'select to bottom': 'shift+g',
                        'select to top': 'g g',
                        'stop selecting': 'v, shift+v, escape',
                        'edit': 'a, shift+a',
                        'edit start': 'i, shift+i',
                        'cut': 'd, shift+d, ctrl+x',
                        'copy': 'y, shift+y, ctrl+c',
                        'undo': 'u, ctrl+z',
                        'redo': 'shift+r, ctrl+shift+z'
                    },
                    view: {
                        base: {
                            'cut': 'cmd+x, delete, d d',
                            'copy': 'cmd+c, y y',
                            'paste': 'p, cmd+v',
                            'paste above': 'shift+p, cmd+shift+v',
                            'visual mode': 'v, shift+v',

                            'change': 'c c, shift+c',
                            'edit': 'return, a, shift+a, f2',
                            'edit start': 'i, shift+i',
                            'first sibling': 'shift+[',
                            'last sibling': 'shift+]',
                            'move to first sibling': 'ctrl+shift+[',
                            'move to last sibling': 'ctrl+shift+]',
                            'new after': 'o',
                            'new before': 'shift+o',
                            'jump to top': 'g g',
                            'jump to bottom': 'shift+g',
                            'up': 'up, k',
                            'down': 'down, j',
                            'left': 'left, h',
                            'right': 'right, l',
                            'next sibling': 'alt+j, alt+down',
                            'prev sibling': 'alt+k, alt+up',
                            'toggle collapse': 'z',
                            'collapse': 'alt+h, alt+left',
                            'uncollapse': 'alt+l, alt+right',
                            'indent': 'tab, shift+alt+l, shift+alt+right',
                            'dedent': 'shift+tab, shift+alt+h, shift+alt+left',
                            'move down': 'shift+alt+j, shift+alt+down',
                            'move up': 'shift+alt+k, shift+alt+i, shift+alt+up',
                            'undo': 'ctrl+z, u',
                            'redo': 'ctrl+shift+z, shift+r',
                        },

                        mac: {
                        },
                        pc: {
                        }
                    },
                }



            }, {}], 7: [function (_dereq_, module, exports) {

                module.exports = DefaultNode

                var BaseNode = _dereq_('./base-node')

                if (window.marked) {
                    var renderer = new marked.Renderer()
                    renderer.link = function (href, title, text) {
                        return '<a href="' + href + '" target="_blank" title="' + title + '">' + text + '</a>';
                    }
                    marked.setOptions({
                        gfm: true,
                        sanitize: true,
                        tables: true,
                        breaks: true,
                        pedantic: false,
                        sanitize: false,
                        smartLists: true,
                        smartypants: true,
                        renderer: renderer
                    })
                }

                function DefaultNode(content, meta, options, isNew, modelActions) {
                    BaseNode.call(this, content, meta, options, isNew, modelActions)
                }

                DefaultNode.prototype = Object.create(BaseNode.prototype)
                DefaultNode.prototype.constructor = DefaultNode

                function tmerge(a, b) {
                    for (var c in b) {
                        a[c] = b[c]
                    }
                }

                function escapeHtml(str) {
                    if (!str) return '';
                    var div = document.createElement('div');
                    div.appendChild(document.createTextNode(str));
                    return div.innerHTML;
                };

                function unEscapeHtml(str) {
                    if (!str) return '';
                    return str
                      .replace(/<div>/g, '\n').replace(/<br>/g, '\n')
                      .replace(/<\/div>/g, '')
                      .replace(/\u200b/g, '')
                }

                tmerge(DefaultNode.prototype, {
                    setInputValue: function (value) {
                        this.input.innerHTML = value
                    },

                    getInputValue: function () {
                        return unEscapeHtml(this.input.innerHTML)
                    },

                    getVisibleValue: function () {
                        if (!this.input.firstChild) return ''
                        return this.input.firstChild.textContent
                    },

                    isMultiLine: function () {
                        return this.input.innerHTML.match(/(<div>|<br|\n)/g)
                    },

                    splitRightOfCursor: function () {
                        var text = this.getVisibleValue()
                          , s = this.getSelectionPosition()
                          , left = escapeHtml(text.slice(0, s))
                          , right = escapeHtml(text.slice(s))
                        if (!right) return
                        this.setInputValue(left)
                        this.setTextContent(left)
                        if (!this.isNew) this.o.changeContent(left)
                        return right
                    },

                    setTextContent: function (value) {
                        this.text.innerHTML = value ? marked(value + '') : ''
                    },

                    setupNode: function () {
                        this.node = document.createElement('div')

                        this.input = document.createElement('div')
                        this.input.setAttribute('contenteditable', true)
                        this.input.classList.add('treed__input')

                        this.text = document.createElement('div')
                        this.text.classList.add('treed__text')
                        this.node.classList.add('treed__default-node')

                        this.setTextContent(this.content)
                        this.node.appendChild(this.text)
                        this.registerListeners();
                    },

                    isAtTop: function () {
                        var bb = this.input.getBoundingClientRect()
                          , selr = window.getSelection().getRangeAt(0).getClientRects()[0]
                        return selr.top < bb.top + 5
                    },

                    isAtBottom: function () {
                        var bb = this.input.getBoundingClientRect()
                          , selr = window.getSelection().getRangeAt(0).getClientRects()[0]
                        return selr.bottom > bb.bottom - 5
                    },

                    getSelectionPosition: function () {
                        var sel = window.getSelection()
                          , ran = sel.getRangeAt(0)
                        return ran.startOffset
                    },

                    startEditing: function (fromStart) {
                        if (this.editing) return
                        this.editing = true;
                        this.setInputValue(this.content)
                        this.node.replaceChild(this.input, this.text)
                        this.input.focus();
                        this.setSelection(!fromStart)
                        this.o.setEditing()
                    },

                    stopEditing: function () {
                        if (!this.editing) return
                        console.log('stop eddint', this.isNew)
                        var value = this.getInputValue()
                        this.editing = false
                        this.node.replaceChild(this.text, this.input)
                        this.o.doneEditing();
                        if (this.content != value || this.isNew) {
                            this.setTextContent(value)
                            this.content = value
                            this.o.changeContent(this.content)
                        }
                    },

                    isAtStart: function () {
                        return this.getSelectionPosition() === 0
                    },

                    isAtEnd: function () {
                        console.warn("THIS IS WRONG")
                        return false
                    },

                    addEditText: function (text) {
                        var pl = this.content.length
                        this.content += text
                        this.setInputValue(this.content)
                        this.setTextContent(this.content)
                        if (!this.editing) {
                            this.editing = true;
                            this.node.replaceChild(this.input, this.text)
                            this.o.setEditing();
                        }
                        this.setSelection(pl)
                    },

                    setContent: function (content) {
                        this.content = content
                        this.setInputValue(content)
                        this.setTextContent(content)
                    },

                    registerListeners: function () {
                        this.text.addEventListener('mousedown', function (e) {
                            if (e.target.nodeName == 'A') {
                                return
                            }
                            this.startEditing();
                            e.preventDefault()
                            return false
                        }.bind(this))

                        this.input.addEventListener('blur', function (e) {
                            this.stopEditing();
                            e.preventDefault()
                            return false
                        }.bind(this));

                        var keyHandler = this.keyHandler()

                        this.input.addEventListener('keydown', function (e) {
                            e.stopPropagation()
                            return keyHandler(e)
                        })

                    },

                    setSelection: function (end) {
                        //var sel = window.getSelection()
                        //sel.selectAllChildren(this.input)
                        //try {
                        //  sel['collapseTo' + (end ? 'End' : 'Start')]()
                        //} catch (e) {}
                    },

                })


            }, { "./base-node": 2 }], 8: [function (_dereq_, module, exports) {

                module.exports = DungeonsAndDragons

                function findTarget(targets, e) {
                    for (var i = 0; i < targets.length; i++) {
                        if (targets[i].top > e.clientY) {
                            return targets[i > 0 ? i - 1 : 0]
                        }
                    }
                    return targets[targets.length - 1]
                }

                // Manages Dragging N Dropping
                function DungeonsAndDragons(vl, action, findFunction) {
                    this.vl = vl
                    this.action = action
                    this.findFunction = findFunction || findTarget
                }

                DungeonsAndDragons.prototype = {
                    startMoving: function (targets, id) {
                        this.moving = {
                            targets: targets,
                            shadow: this.vl.makeDropShadow(),
                            current: null
                        }
                        this.vl.setMoving(id, true)

                        var onMove = function (e) {
                            this.drag(id, e)
                        }.bind(this)

                        var onUp = function (e) {
                            document.body.style.cursor = ''
                            document.removeEventListener('mousemove', onMove)
                            document.removeEventListener('mouseup', onUp)
                            this.drop(id, e)
                        }.bind(this)

                        document.body.style.cursor = 'move'
                        document.addEventListener('mousemove', onMove)
                        document.addEventListener('mouseup', onUp)
                    },

                    drag: function (id, e) {
                        if (this.moving.current) {
                            this.vl.setDropping(this.moving.current.id, false, this.moving.current.place === 'child')
                        }
                        var target = this.findFunction(this.moving.targets, e)
                        this.moving.shadow.moveTo(target)
                        this.moving.current = target
                        this.vl.setDropping(target.id, true, this.moving.current.place === 'child')
                    },

                    drop: function (id, e) {
                        this.moving.shadow.remove()
                        var current = this.moving.current
                        this.vl.setMoving(id, false)
                        if (!this.moving.current) return
                        this.vl.setDropping(current.id, false, current.place === 'child')
                        if (current.id === id) return
                        this.action(current.place, id, current.id)
                        this.moving = false
                    },
                }


            }, {}], 9: [function (_dereq_, module, exports) {

                var DropShadow = _dereq_('./drop-shadow')
                  , slideDown = _dereq_('./slide-down')
                  , slideUp = _dereq_('./slide-up')
                  , util = _dereq_('./util')

                module.exports = DomViewLayer

                /**
                 * o: options -> { Node: the class }
                 */
                function DomViewLayer(o) {
                    this.dom = {}
                    this.root = null
                    this.o = util.merge({
                        animate: true
                    }, o)
                }

                DomViewLayer.prototype = {
                    /**
                     * Forget about all nodes - they will be disposed of
                     */
                    clear: function () {
                        this.dom = {}
                    },

                    /**
                     * root: the old root that is to be replaced
                     */
                    rebase: function (root) {
                        if (root.parentNode) {
                            root.parentNode.replaceChild(this.root, root)
                        }
                    },

                    /**
                     * Recursively generate the drop target definitions for all of the visible
                     * nodes under a given root.
                     *
                     * root: the id of the node to start from
                     * model: the model - to find children
                     * moving: the id of the node that's moving - so that you won't drop a node
                     *         inside itself
                     * top: only true the first call, determines if it's the root node (e.g. no
                     *      drop target above)
                     */
                    dropTargets: function (root, model, moving, top) {
                        var targets = []
                          , bc = this.dom[root].head.getBoundingClientRect()
                          , target
                          , childTarget

                        if (!top) {
                            targets.push({
                                id: root,
                                top: bc.top,
                                left: bc.left,
                                width: bc.width,
                                height: bc.height,
                                place: 'before',
                                show: {
                                    left: bc.left,// + 20,
                                    width: bc.width,// - 20,
                                    y: bc.top
                                }
                            })
                        }
                        if (root === moving) return targets

                        if (model.isCollapsed(root) && !top) return targets
                        var ch = model.ids[root].children
                        if (ch) {
                            for (var i = 0; i < ch.length; i++) {
                                targets = targets.concat(this.dropTargets(ch[i], model, moving))
                            }
                        }
                        if (top) {
                            var bodyBox = this.dom[root].ul.getBoundingClientRect()
                            targets.push({
                                id: root,
                                top: bodyBox.bottom,
                                left: bodyBox.left,
                                width: bodyBox.width,
                                height: bc.height,
                                place: 'lastChild',
                                show: {
                                    left: bodyBox.left,// + 20,
                                    width: bodyBox.width,// - 20,
                                    y: bodyBox.bottom
                                }
                            })
                        }
                        return targets
                    },

                    makeDropShadow: function () {
                        return new DropShadow()
                    },

                    /**
                     * Remove a node
                     *
                     * id: the node to remove
                     * pid: the parent id
                     * lastchild: whether the node was the last child
                     */
                    remove: function (id, pid, lastchild) {
                        var n = this.dom[id]
                        if (!n || !n.main.parentNode) return
                        try {
                            n.main.parentNode.removeChild(n.main)
                        } catch (e) {
                            return
                        }
                        delete this.dom[id]
                        if (lastchild) {
                            this.dom[pid].main.classList.remove('treed__item--parent')
                        }
                    },

                    /**
                     * Add a new node - this is public facing
                     *
                     * node: object looks like {id:, content:, meta:, parent:}
                     * bounds: an object of action functions
                     * before: the id before which to add
                     * children: whether the new node has children
                     */
                    addNew: function (node, bounds, modelActions, before, children) {
                        var dom = this.makeNode(node.id, node.content, node.meta, node.depth - this.rootDepth, bounds, modelActions)
                        this.add(node.parent, before, dom, children)
                        if (node.collapsed && node.children.length) {
                            this.setCollapsed(node.id, true)
                        }
                    },

                    /**
                     * Internal function for adding things
                     */
                    add: function (parent, before, dom, children) {
                        var p = this.dom[parent]
                        if (before === false) {
                            p.ul.appendChild(dom)
                        } else {
                            var bef = this.dom[before]
                            p.ul.insertBefore(dom, bef.main)
                        }
                        p.main.classList.add('treed__item--parent')
                        if (children) {
                            dom.classList.add('treed__item--parent')
                        }
                    },

                    clearChildren: function (id) {
                        var ul = this.dom[id].ul
                        while (ul.lastChild) {
                            ul.removeChild(ul.lastChild)
                        }
                    },

                    /**
                     * Get a body
                     */
                    body: function (id) {
                        if (!this.dom[id]) return
                        return this.dom[id].body
                    },

                    /**
                     * Move a node from one place to another
                     *
                     * id:        the id of the node that's moving
                     * pid:       the parent id to move it to
                     * before:    the node id before which to move it. `false` to append
                     * ppid:      the previous parent id
                     * lastchild: whether this was the last child of the previous parent
                     *            (leaving that parent childless)
                     */
                    move: function (id, pid, before, ppid, lastchild) {
                        var d = this.dom[id]
                        d.main.parentNode.removeChild(d.main)
                        if (lastchild) {
                            this.dom[ppid].main.classList.remove('treed__item--parent')
                        }
                        if (before === false) {
                            this.dom[pid].ul.appendChild(d.main)
                        } else {
                            this.dom[pid].ul.insertBefore(d.main, this.dom[before].main)
                        }
                        this.dom[pid].main.classList.add('treed__item--parent')
                    },

                    /**
                     * Remove the selection from a set of nodes
                     *
                     * selection: [id, ...] nodes to deselect
                     */
                    clearSelection: function (selection) {
                        for (var i = 0; i < selection.length; i++) {
                            if (!this.dom[selection[i]]) continue;
                            this.dom[selection[i]].main.classList.remove('selected')
                        }
                    },

                    /**
                     * Show the selection on a set of nodes
                     *
                     * selection: [id, ...] nodes to select
                     */
                    showSelection: function (selection) {
                        if (!selection.length) return
                        // util.ensureInView(this.dom[selection[0]].body.node)
                        for (var i = 0; i < selection.length; i++) {
                            this.dom[selection[i]].main.classList.add('selected')
                        }
                    },

                    clearActive: function (id) {
                        if (!this.dom[id]) return
                        this.dom[id].main.classList.remove('active')
                    },

                    showActive: function (id) {
                        if (!this.dom[id]) return console.warn('Trying to activate a node that is not rendered')
                        util.ensureInView(this.dom[id].body.node)
                        this.dom[id].main.classList.add('active')
                    },

                    setCollapsed: function (id, isCollapsed) {
                        this.dom[id].main.classList[isCollapsed ? 'add' : 'remove']('collapsed')
                    },

                    animateOpen: function (id) {
                        this.setCollapsed(id, false)
                        slideDown(this.dom[id].ul)
                    },

                    animateClosed: function (id, done) {
                        slideUp(this.dom[id].ul, function () {
                            this.setCollapsed(id, true)
                        }.bind(this))
                    },

                    setMoving: function (id, isMoving) {
                        this.root.classList[isMoving ? 'add' : 'remove']('moving')
                        this.dom[id].main.classList[isMoving ? 'add' : 'remove']('moving')
                    },

                    setDropping: function (id, isDropping, isChild) {
                        var cls = 'dropping' + (isChild ? '-child' : '')
                        this.dom[id].main.classList[isDropping ? 'add' : 'remove'](cls)
                    },

                    /**
                     * Create the root node
                     */
                    makeRoot: function (node, bounds, modelActions) {
                        var dom = this.makeNode(node.id, node.content, node.meta, 0, bounds, modelActions)
                          , root = document.createElement('div')
                        root.classList.add('treed')
                        root.appendChild(dom)
                        if (node.children.length) {
                            dom.classList.add('treed__item--parent')
                        }
                        if (node.collapsed && node.children.length) {
                            this.setCollapsed(node.id, true)
                        }
                        this.root = root
                        this.rootDepth = node.depth
                        return root
                    },

                    /**
                     * Make the head for a given node
                     */
                    makeHead: function (body, actions) {
                        var head = document.createElement('div')
                          , collapser = document.createElement('div')

                        collapser.addEventListener('mousedown', function (e) {
                            if (e.button !== 0) return
                            actions.toggleCollapse()
                            e.preventDefault()
                        })
                        collapser.classList.add('treed__collapser')

                        /*
                        //  , mover = document.createElement('div')
                        mover.addEventListener('mousedown', function (e) {
                          if (e.button !== 0) return
                          e.preventDefault()
                          e.stopPropagation()
                          actions.startMoving()
                          return false
                        })
                        mover.classList.add('treed__mover')
                        // head.appendChild(mover)
                        */

                        head.classList.add('treed__head')
                        head.appendChild(collapser)
                        head.appendChild(body.node);
                        return head
                    },

                    /**
                     * Make a node
                     */
                    makeNode: function (id, content, meta, level, bounds, modelActions) {
                        var dom = document.createElement('li')
                          , body = this.bodyFor(id, content, meta, bounds, modelActions)

                        dom.classList.add('treed__item')
                        // dom.classList.add('treed__item--level-' + level)

                        var head = this.makeHead(body, bounds)
                        dom.appendChild(head)

                        var ul = document.createElement('ul')
                        ul.classList.add('treed__children')
                        dom.appendChild(ul)
                        this.dom[id] = { main: dom, body: body, ul: ul, head: head }
                        return dom
                    },

                    /** 
                     * Create a body node
                     *
                     * id: the node if
                     * content: the text
                     * meta: an object of meta data
                     * bounds: bound actions
                     */
                    bodyFor: function (id, content, meta, bounds, modelActions) {
                        var dom = new this.o.Node(content, meta, bounds, id === 'new', modelActions)
                        dom.node.classList.add('treed__body')
                        return dom
                    },

                }


            }, { "./drop-shadow": 10, "./slide-down": 19, "./slide-up": 20, "./util": 21 }], 10: [function (_dereq_, module, exports) {

                module.exports = DropShadow;

                function DropShadow(height, clsName) {
                    this.node = document.createElement('div')
                    this.node.classList.add(clsName || 'treed__drop-shadow')
                    this.height = height || 10
                    document.body.appendChild(this.node)
                }

                DropShadow.prototype = {
                    moveTo: function (target) {
                        this.node.style.top = target.show.y - this.height / 2 + 'px'
                        this.node.style.left = target.show.left + 'px'
                        this.node.style.height = this.height + 'px'
                        // this.node.style.height = target.height + 10 + 'px'
                        this.node.style.width = target.show.width + 'px'
                    },

                    remove: function () {
                        this.node.parentNode.removeChild(this.node)
                    }
                }


            }, {}], 11: [function (_dereq_, module, exports) {

                module.exports = {
                    Node: _dereq_('./default-node'),
                    View: _dereq_('./view'),
                    ViewLayer: _dereq_('./dom-vl'),
                    Model: _dereq_('./model'),
                    Controller: _dereq_('./controller'),
                }


            }, { "./controller": 5, "./default-node": 7, "./dom-vl": 9, "./model": 14, "./view": 23 }], 12: [function (_dereq_, module, exports) {

                module.exports = keyHandler

                /**
                 * Organize the keys definition, the actions definition, and the ctrlactions
                 * all together in one lovely smorgasbord.
                 *
                 * keys: {action: key shortcut definition}
                 * actions: {action: {action definition}}
                 * ctrlactions: {name: function}
                 */
                function keyHandler(keys, actions, ctrlactions) {
                    var bound = {}
                    for (var action in keys) {
                        if (!actions[action]) {
                            throw new Error('invalid configuration: trying to bind unknown action. ' + action)
                        }
                        bound[keys[action]] = bindAction(action, actions[action], ctrlactions)
                    }
                    return bound
                }

                function bindAction(name, action, ctrlactions) {
                    var pre = makePre(action.active)
                    var type = typeof action.action
                    var main
                    switch (typeof action.action) {
                        case 'string': main = ctrlactions[action.action]; break;
                        case 'undefined': main = ctrlactions[camel(name)]; break;
                        case 'function': main = action.action; break;
                        default: throw new Error('unknown action ' + action.action)
                    }

                    if (!main) {
                        throw new Error('Invalid action configuration ' + name)
                    }

                    if (!pre) {
                        return main
                    }

                    return function () {
                        if (!pre.call(this)) return
                        return main.call(this, this.active)
                    }
                }

                function makePre(active) {
                    switch (active) {
                        case true: return function (main) {
                            return this.active
                        }
                        case '!new': return function (main) {
                            return this.active && this.active !== 'new'
                        }
                        case '!root': return function (main) {
                            return this.active && this.active !== this.root
                        }
                        default: return null
                    }
                }

                function camel(string) {
                    return string.replace(/ (\w)/, function (a, x) { return x.toUpperCase() })
                }


            }, {}], 13: [function (_dereq_, module, exports) {

                module.exports = keys

                keys.keyName = keyName

                var KEYS = {
                    8: 'backspace',
                    9: 'tab',
                    13: 'return',
                    27: 'escape',
                    37: 'left',
                    38: 'up',
                    39: 'right',
                    40: 'down',
                    46: 'delete',
                    113: 'f2',
                    219: '[',
                    221: ']'
                }

                function keyName(code) {
                    if (code <= 90 && code >= 65) {
                        return String.fromCharCode(code + 32)
                    }
                    if (code >= 48 && code <= 57) {
                        return String.fromCharCode(code)
                    }
                    return KEYS[code]
                }

                function keys(config) {
                    var kmap = {}
                      , prefixes = {}
                      , cur_prefix = null
                      , parts
                      , part
                      , seq
                    for (var key in config) {
                        parts = key.split(',')
                        for (var i = 0; i < parts.length; i++) {
                            part = parts[i].trim()
                            kmap[part] = config[key]
                            if (part.indexOf(' ') !== -1) {
                                seq = part.split(/\s+/g)
                                var n = ''
                                for (var j = 0; j < seq.length - 1; j++) {
                                    n += seq[j]
                                    prefixes[n] = true
                                }
                            }
                        }
                    }
                    return function (e) {
                        var key = keyName(e.keyCode)
                        //if (!key) {
                        //  return console.log(e.keyCode)
                        //}
                        if (e.altKey) key = 'alt+' + key
                        if (e.shiftKey) key = 'shift+' + key
                        if (e.ctrlKey) key = 'ctrl+' + key
                        if (e.metaKey) key = 'cmd+' + key
                        if (cur_prefix) {
                            key = cur_prefix + ' ' + key
                            cur_prefix = null
                        }
                        if (!kmap[key]) {
                            if (prefixes[key]) {
                                cur_prefix = key
                            } else {
                                cur_prefix = null
                            }
                            return
                        }
                        if (kmap[key].call(this, e) !== true) {
                            e.preventDefault()
                            e.stopPropagation()
                            return false
                        }
                    }
                }



            }, {}], 14: [function (_dereq_, module, exports) {

                var uuid = _dereq_('./uuid')

                module.exports = Model

                function Model(rootNode, ids, db) {
                    this.ids = ids
                    this.root = rootNode.id
                    this.rootNode = rootNode
                    this.db = db
                    this.nextid = 100
                    this.clipboard = false
                    this.boundActions = this.bindActions()
                }

                /**
                 * A single node is
                 * - id:
                 * - parent: id
                 * - children: [id, id, id]
                 * - data: {}
                 */

                Model.prototype = {
                    newid: function () {
                        return uuid();
                        /*
                        while (this.ids[this.nextid]) {
                          this.nextid += 1
                        }
                        var id = this.nextid
                        this.nextid += 1
                        return id + ''
                        */
                    },

                    bindActions: function () {
                        var bound = {}
                        for (var name in this.actions) {
                            bound[name] = this.actions[name].bind(this)
                        }
                        return bound
                    },

                    actions: {},

                    // export all the data currently stored in the model
                    // dumpData() -> all of it
                    // dumpData(id) -> children of the given id
                    // dumpData(id, true) -> include the ids in the dump
                    // {
                    //    id: ??,
                    //    meta: {},
                    //    collapsed: ??,
                    //    content: '',
                    //    children: [recurse, ...]
                    // }
                    dumpData: function (id, noids) {
                        if (arguments.length === 0) {
                            id = this.root
                        }
                        var res = {
                            meta: {},
                        }
                          , n = this.ids[id]
                        res.content = n.content
                        res.created = n.created
                        res.type = n.type
                        res.modified = n.modified
                        for (var attr in n.meta) {
                            res.meta[attr] = n.meta[attr]
                        }
                        if (n.children && n.children.length) {
                            res.children = []
                            for (var i = 0; i < n.children.length; i++) {
                                res.children.push(this.dumpData(n.children[i], noids))
                            }
                        }
                        if (!noids) res.id = id
                        res.collapsed = n.collapsed || false
                        return res
                    },

                    // createNodes(parentId, the index, data as it was dumped)
                    // {
                    //    content: "",
                    //    meta: {}
                    //    ... other datas
                    //    children: [node, ...]
                    // }
                    createNodes: function (pid, index, data) {
                        var cr = this.create(pid, index, data.content, data.type, data.meta)
                        cr.node.collapsed = data.collapsed || false
                        if (data.children) {
                            for (var i = 0; i < data.children.length; i++) {
                                this.createNodes(cr.node.id, i, data.children[i])
                            }
                        }
                        return cr
                    },

                    getBefore: function (pid, index) {
                        var before = false
                        if (index < this.ids[pid].children.length - 1) {
                            before = this.ids[pid].children[index + 1]
                        }
                        return before
                    },

                    // operations
                    create: function (pid, index, text, type, meta) {
                        var node = {
                            id: this.newid(),
                            content: text || '',
                            collapsed: false,
                            type: type || 'base',
                            meta: meta || {},
                            parent: pid,
                            children: []
                        }
                        this.ids[node.id] = node
                        if (!this.ids[pid].children) {
                            this.ids[pid].children = []
                        }
                        this.ids[pid].children.splice(index, 0, node.id)

                        var before = false
                        if (index < this.ids[pid].children.length - 1) {
                            before = this.ids[pid].children[index + 1]
                        }

                        setTimeout(function () {
                            this.db.save('node', node.id, node)
                            this.db.update('node', pid, { children: this.ids[pid].children })
                        }.bind(this))

                        return {
                            node: node,
                            before: before
                        }
                    },

                    remove: function (id) {
                        if (id === this.root) return
                        var n = this.ids[id]
                          , p = this.ids[n.parent]
                          , ix = p.children.indexOf(id)
                        p.children.splice(ix, 1)
                        delete this.ids[id]

                        setTimeout(function () {
                            this.db.remove('node', id)
                            this.db.update('node', n.parent, { children: p.children })
                            // TODO: remove all child nodes
                        }.bind(this))

                        return { id: id, node: n, ix: ix }
                    },

                    setContent: function (id, content) {
                        this.ids[id].content = content
                        this.db.update('node', id, { content: content })
                    },

                    setAttr: function (id, attr, value) {
                        this.ids[id].meta[attr] = value
                        this.db.update('node', id, { meta: this.ids[id].meta })
                    },

                    setMeta: function (id, meta) {
                        for (var attr in meta) {
                            this.ids[id].meta[attr] = meta[attr]
                        }
                        this.db.update('node', id, { meta: meta })
                    },

                    // other stuff
                    setCollapsed: function (id, isCollapsed) {
                        this.ids[id].collapsed = isCollapsed
                        this.db.update('node', id, { collapsed: isCollapsed })
                    },

                    isCollapsed: function (id) {
                        return this.ids[id].collapsed
                    },

                    hasChildren: function (id) {
                        return this.ids[id].children && this.ids[id].children.length
                    },

                    // add back something that was removed
                    readd: function (saved) {
                        this.ids[saved.id] = saved.node
                        var children = this.ids[saved.node.parent].children
                        children.splice(saved.ix, 0, saved.id)
                        var before = false
                        if (saved.ix < children.length - 1) {
                            before = children[saved.ix + 1]
                        }
                        this.db.save('node', saved.node.id, saved.node)
                        this.db.update('node', saved.node.parent, { children: children })
                        return before
                    },

                    move: function (id, pid, index) {
                        var n = this.ids[id]
                          , opid = n.parent
                          , p = this.ids[opid]
                          , ix = p.children.indexOf(id)
                        p.children.splice(ix, 1)
                        if (!this.ids[pid].children) {
                            this.ids[pid].children = []
                        }
                        if (index === false) index = this.ids[pid].children.length
                        this.ids[pid].children.splice(index, 0, id)
                        this.ids[id].parent = pid

                        setTimeout(function () {
                            this.db.update('node', opid, { children: p.children })
                            this.db.update('node', id, { parent: pid })
                            this.db.update('node', pid, { children: this.ids[pid].children })
                        }.bind(this))

                        var before = false
                        if (index < this.ids[pid].children.length - 1) {
                            before = this.ids[pid].children[index + 1]
                        }
                        return before
                    },

                    appendText: function (id, text) {
                        this.ids[id].content += text
                        this.db.update('node', id, { content: this.ids[id].content })
                    },

                    // movement calculation
                    getParent: function (id) {
                        return this.ids[id].parent
                    },

                    commonParent: function (one, two) {
                        if (one === two) return one
                        var ones = [one]
                          , twos = [two]
                        while (this.ids[one].parent || this.ids[two].parent) {
                            if (this.ids[one].parent) {
                                one = this.ids[one].parent
                                if (twos.indexOf(one) !== -1) return one
                                ones.push(one)
                            }
                            if (this.ids[two].parent) {
                                two = this.ids[two].parent
                                if (ones.indexOf(two) !== -1) return two
                                twos.push(two)
                            }
                        }
                        return null
                    },

                    getChild: function (id) {
                        if (this.ids[id].children && this.ids[id].children.length) {
                            return this.ids[id].children[0]
                        }
                        return this.nextSibling(id)
                    },

                    prevSibling: function (id, noparent) {
                        var pid = this.ids[id].parent
                        if (undefined === pid) return
                        var ix = this.ids[pid].children.indexOf(id)
                        if (ix > 0) return this.ids[pid].children[ix - 1]
                        if (!noparent) return pid
                    },

                    closestNonChild: function (id, others) {
                        var closest = this.nextSibling(id, true)
                        if (undefined === closest || closest === false) {
                            if (others) {
                                closest = this.idAbove(others[0])
                            } else {
                                closest = this.idAbove(id)
                            }
                        }
                        return closest
                    },

                    nextSibling: function (id, strict) {
                        var pid = this.ids[id].parent
                        if (undefined === pid) return !strict && this.ids[id].children[0]
                        var ix = this.ids[pid].children.indexOf(id)
                        if (ix < this.ids[pid].children.length - 1) return this.ids[pid].children[ix + 1]
                        if (this.ids[id].collapsed) {
                            return !strict && this.nextSibling(pid, strict)
                        }
                        return !strict && this.ids[id].children[0]
                    },

                    lastSibling: function (id, strict) {
                        var pid = this.ids[id].parent
                        if (undefined === pid) return !strict && this.ids[id].children[0]
                        var ix = this.ids[pid].children.indexOf(id)
                        if (ix === this.ids[pid].children.length - 1) return !strict && this.ids[id].children[0]
                        return this.ids[pid].children[this.ids[pid].children.length - 1]
                    },

                    firstSibling: function (id, strict) {
                        var pid = this.ids[id].parent
                        if (undefined === pid) return // this.ids[id].children[0]
                        var ix = this.ids[pid].children.indexOf(id)
                        if (ix === 0) return !strict && pid
                        return this.ids[pid].children[0]
                    },

                    lastOpen: function (id) {
                        var node = this.ids[id]
                        while (node.children.length && (node.id === id || !node.collapsed)) {
                            node = this.ids[node.children[node.children.length - 1]]
                        }
                        return node.id
                    },

                    idAbove: function (id) {
                        var pid = this.ids[id].parent
                          , parent = this.ids[pid]
                        if (!parent) return
                        var ix = parent.children.indexOf(id)
                        if (ix === 0) {
                            return pid
                        }
                        var previd = parent.children[ix - 1]
                        while (this.ids[previd].children &&
                               this.ids[previd].children.length &&
                               !this.ids[previd].collapsed) {
                            previd = this.ids[previd].children[this.ids[previd].children.length - 1]
                        }
                        return previd
                    },

                    // get the place to shift left to
                    shiftLeftPlace: function (id) {
                        var pid = this.ids[id].parent
                          , parent = this.ids[pid]
                        if (!parent) return
                        var ppid = parent.parent
                          , pparent = this.ids[ppid]
                        if (!pparent) return
                        var pix = pparent.children.indexOf(pid)
                        return {
                            pid: ppid,
                            ix: pix + 1
                        }
                    },

                    shiftUpPlace: function (id) {
                        var pid = this.ids[id].parent
                          , parent = this.ids[pid]
                        if (!parent) return
                        var ix = parent.children.indexOf(id)
                        if (ix === 0) {
                            var pl = this.shiftLeftPlace(id)
                            if (!pl) return
                            pl.ix -= 1
                            return pl
                        }
                        return {
                            pid: pid,
                            ix: ix - 1
                        }
                    },

                    shiftDownPlace: function (id) {
                        var pid = this.ids[id].parent
                          , parent = this.ids[pid]
                        if (!parent) return
                        var ix = parent.children.indexOf(id)
                        if (ix >= parent.children.length - 1) {
                            return this.shiftLeftPlace(id)
                        }
                        return {
                            pid: pid,
                            ix: ix + 1
                        }
                    },

                    moveBeforePlace: function (id, tid) {
                        var sib = this.ids[id]
                          , pid = sib.parent
                          , opid = this.ids[tid].parent
                        if (undefined === pid) return
                        var parent = this.ids[pid]
                        var nix = parent.children.indexOf(id)
                        if (pid === opid && parent.children.indexOf(tid) < nix) {
                            nix -= 1
                        }
                        return {
                            pid: pid,
                            ix: nix
                        }
                    },

                    moveAfterPlace: function (id, oid) {
                        var sib = this.ids[id]
                          , pid = sib.parent
                          , opid = this.ids[oid].parent
                        if (undefined === pid) return
                        var oix = this.ids[opid].children.indexOf(oid)
                        var parent = this.ids[pid]
                          , ix = parent.children.indexOf(id) + 1
                        if (pid === opid && ix > oix) ix -= 1
                        return {
                            pid: pid,
                            ix: ix
                        }
                    },

                    idBelow: function (id, root) {
                        if (this.ids[id].children &&
                            this.ids[id].children.length &&
                            (id === root || !this.ids[id].collapsed)) {
                            return this.ids[id].children[0]
                        }
                        var pid = this.ids[id].parent
                          , parent = this.ids[pid]
                        if (!parent) return
                        var ix = parent.children.indexOf(id)
                        while (ix === parent.children.length - 1) {
                            if (parent.id === root) return
                            parent = this.ids[parent.parent]
                            if (!parent) return
                            ix = parent.children.indexOf(pid)
                            pid = parent.id
                        }
                        return parent.children[ix + 1]
                    },

                    idNew: function (id, before, root) {
                        var pid = this.ids[id].parent
                          , parent
                          , nix
                        if (before) {
                            parent = this.ids[pid]
                            nix = parent.children.indexOf(id)
                        } else if (id === this.root ||
                            root === id ||
                            (this.ids[id].children &&
                            this.ids[id].children.length &&
                            !this.ids[id].collapsed)) {
                            pid = id
                            nix = 0
                        } else {
                            parent = this.ids[pid]
                            nix = parent.children.indexOf(id) + 1
                        }
                        return {
                            pid: pid,
                            index: nix
                        }
                    },

                    samePlace: function (id, place) {
                        var pid = this.ids[id].parent
                        if (!pid || pid !== place.pid) return false
                        var parent = this.ids[pid]
                          , ix = parent.children.indexOf(id)
                        return ix === place.ix
                    },

                    findCollapser: function (id) {
                        if ((!this.ids[id].children ||
                             !this.ids[id].children.length ||
                             this.ids[id].collapsed) &&
                            this.ids[id].parent !== undefined) {
                            id = this.ids[id].parent
                        }
                        return id
                    },
                }


            }, { "./uuid": 22 }], 15: [function (_dereq_, module, exports) {
                /*
                 * true => 
                 */

                module.exports = {
                    // not dealing with the active element
                    'undo': {
                        help: 'Undo the last action',
                    },

                    'redo': {
                        help: 'Undo the last action',
                    },

                    'cut': {
                        help: 'remove the currnetly selected item and place it in the clipboard',
                        active: true,
                    },

                    'copy': {
                        help: 'place the currently selected item in the clipboard',
                        active: true,
                    },

                    'paste': {
                        help: 'insert the contents of the clipboard, into or below the currently selected item',
                        active: true,
                    },

                    'paste above': {
                        help: 'insert the contents of the clipboard above the currently selected item',
                        active: true,
                    },

                    'visual mode': {
                        help: 'enter multi-select mode',
                        active: '!root',
                        action: function () {
                            this.setSelection([this.active])
                        },
                    },

                    'change': {
                        help: 'clear the contents of this node and start editing',
                        active: true,
                        action: function () {
                            this.vl.body(this.active).setContent('')
                            this.vl.body(this.active).startEditing()
                        },
                    },

                    edit: {
                        help: 'start editing this node at the end',
                        active: true,
                        action: function () {
                            this.vl.body(this.active).startEditing()
                        }
                    },

                    'edit start': {
                        help: 'start editing this node at the start',
                        active: true,
                        action: function () {
                            this.vl.body(this.active).startEditing(true)
                        },
                    },

                    // nav
                    'first sibling': {
                        help: 'jump to the first sibling',
                        active: '!new',
                        action: function () {
                            var first = this.model.firstSibling(this.active)
                            if (undefined === first) return
                            this.setActive(first)
                        }
                    },

                    'last sibling': {
                        help: 'jump to the last sibling',
                        active: '!new',
                        action: function () {
                            var last = this.model.lastSibling(this.active)
                            if (undefined === last) return
                            this.setActive(last)
                        },
                    },

                    'jump to top': {
                        help: 'jump to the top',
                        action: function () {
                            this.setActive(this.root)
                        },
                    },

                    'jump to bottom': {
                        help: 'jump to the last node',
                        action: function () {
                            this.setActive(this.model.lastOpen(this.root))
                            console.log('bottom')
                            // pass
                        },
                    },

                    'up': {
                        help: 'go to the previous node',
                        active: true,
                        action: function () {
                            var above
                            if (this.active === 'new') {
                                above = this.root
                            } else {
                                var top = this.active
                                above = this.model.idAbove(top)
                                if (above === undefined) above = top
                            }
                            if (above === this.root && this.o.noSelectRoot) {
                                return
                            }
                            this.setActive(above)
                        },
                    },

                    'down': {
                        help: 'go down to the next node',
                        active: '!new',
                        action: function () {
                            if (this.active === this.root &&
                                !this.model.ids[this.root].children.length) {
                                return this.setActive('new')
                            }
                            var top = this.active
                              , above = this.model.idBelow(top, this.root)
                            if (above === undefined) above = top
                            this.setActive(above)
                        }
                    },

                    'left': {
                        help: 'go up a level to the parent',
                        active: true,
                        action: function () {
                            if (this.active === null) {
                                return this.setActive(this.root)
                            }
                            if (this.active === 'new') return this.setActive(this.root)
                            var left = this.model.getParent(this.active)
                            if (undefined === left) return
                            this.setActive(left)
                        },
                    },

                    'right': {
                        help: 'go down a level to the first child',
                        active: '!now',
                        action: function () {
                            if (this.active === this.root &&
                                !this.model.ids[this.root].children.length) {
                                return this.setActive('new')
                            }
                            var right = this.model.getChild(this.active)
                            if (this.model.isCollapsed(this.active)) return
                            if (undefined === right) return
                            this.setActive(right)
                        },
                    },

                    'next sibling': {
                        help: 'jump to the next sibling (skipping children)',
                        active: '!new',
                        action: function () {
                            var sib = this.model.nextSibling(this.active)
                            if (undefined === sib) return
                            this.setActive(sib)
                        },
                    },

                    'prev sibling': {
                        help: 'jump to the previous sibling (skipping children)',
                        active: '!new',
                        action: function () {
                            var sib = this.model.prevSibling(this.active)
                            if (undefined === sib) return
                            this.setActive(sib)
                        },
                    },

                    'move to first sibling': {
                        help: 'move this node to be the first child if its parent',
                        active: '!new',
                        action: 'moveToTop'
                    },

                    'move to last sibling': {
                        help: 'move this to be the last child of its parent',
                        active: '!new',
                        action: 'moveToBottom'
                    },

                    'new before': {
                        help: 'create a node above this one and start editing',
                        active: true,
                        action: function () {
                            this.ctrlactions.addBefore(this.active, '', true)
                        }
                    },

                    'new after': {
                        help: 'create a node after this one and start editing',
                        active: true,
                        action: function () {
                            if (this.active === 'new') return this.startEditing()
                            this.ctrlactions.addAfter(this.active, '', true)
                        },
                    },

                    // movez!
                    'toggle collapse': {
                        help: 'toggle collapse',
                        active: true,
                    },

                    'collapse': {
                        help: 'collapse the node',
                        active: true,
                        action: function () {
                            this.ctrlactions.toggleCollapse(this.active, true)
                        },
                    },

                    'uncollapse': {
                        help: 'expand the node',
                        active: true,
                        action: function () {
                            this.ctrlactions.toggleCollapse(this.active, false)
                        }
                    },

                    'indent': {
                        help: 'indent the node',
                        active: true,
                        action: function () {
                            this.ctrlactions.moveRight(this.active)
                        },
                    },

                    'dedent': {
                        help: 'dedent the node',
                        active: true,
                        action: function () {
                            this.ctrlactions.moveLeft(this.active)
                        },
                    },

                    'move down': {
                        help: 'move the current node down',
                        active: true
                    },

                    'move up': {
                        help: 'move the current node up',
                        active: true,
                    },
                }


            }, {}], 16: [function (_dereq_, module, exports) {

                function merge(a) {
                    for (var i = 1; i < arguments.length; i++) {
                        for (var name in arguments[i]) {
                            a[name] = arguments[i][name]
                        }
                    }
                    return a
                }

                module.exports = Base

                function noop() {
                    throw new Error("Not implemented!")
                }

                function Base() {
                    this._listeners = {}
                }

                Base.extend = function (fn, obj) {
                    fn.prototype = merge(Object.create(Base.prototype), obj)
                    fn.prototype.constructor = fn
                }

                Base.prototype = {
                    init: function (done) {
                        done()
                    },

                    listen: function (type, add, change) {
                        // noop
                    },

                    save: noop,
                    update: noop,
                    findAll: noop,
                    remove: noop,
                    load: noop,
                    dump: noop,

                    removeBatch: function (type, ids) {
                        for (var i = 0; i < ids.length; i++) {
                            this.remove(type, ids[i])
                        }
                    },

                    // event emitter stuff
                    emit: function (evt) {
                        var args = [].slice.call(arguments, 1)
                        if (!this._listeners[evt]) return false
                        for (var i = 0; i < this._listeners[evt].length; i++) {
                            this._listeners[evt][i].apply(this, args)
                        }
                    },

                    on: function (evt, handler) {
                        if (!this._listeners[evt]) {
                            this._listeners[evt] = []
                        }
                        this._listeners[evt].push(handler)
                    },

                    off: function (evt, handler) {
                        if (!this._listeners[evt]) return false
                        var i = this._listeners[evt].indexOf(handler)
                        if (i === -1) return false
                        this._listeners[evt].splice(i, 1)
                    },
                }


            }, {}], 17: [function (_dereq_, module, exports) {

                var Base = _dereq_('./base')
                var uuid = _dereq_('../uuid')

                module.exports = FirePL

                var COLORS = '#42b9bd #a405fa #7e6c93 #fee901 #a8ff99'.split(' ')
                function randColor() {
                    return COLORS[parseInt(Math.random() * COLORS.length)]
                }

                function FirePL(options) {
                    Base.call(this)
                    this.db = new Firebase(options.url);
                    this.data = {}
                }

                Base.extend(FirePL, {
                    init: function (done) {
                        var id = uuid();
                        this._userid = id
                        this.db.once('value', function (snapshot) {
                            this.data = snapshot.val()
                            var user = this.db.child('users').child(id)
                            user.set({ selection: false, color: randColor() })
                            user.onDisconnect().remove()
                            done();
                        }.bind(this))

                        var users = this.db.child('users')
                        users.on('child_added', function (snapshot) {
                            var id = snapshot.name()
                            var user = snapshot.val()
                            if (id === this._userid) user.self = true
                            this.emit('addActive', id, user)
                        }.bind(this))

                        users.on('child_changed', function (snapshot) {
                            var id = snapshot.name()
                            var user = snapshot.val()
                            if (id === this._userid) user.self = true
                            this.emit('changeActive', id, user)
                        }.bind(this))

                        users.on('child_removed', function (snapshot) {
                            var id = snapshot.name()
                            var user = snapshot.val()
                            if (id === this._userid) user.self = true
                            this.emit('removeActive', id, user)
                        }.bind(this))
                    },

                    setPresence: function (selection) {
                        this.db.child('users').child(this._userid).update({
                            // todo usernames
                            selection: selection
                        })
                    },

                    listen: function (type, onAdd, onChanged) {
                        this.db.child(type).on('child_changed', function (snapshot) {
                            var id = snapshot.name()
                            var data = snapshot.val()
                            this.data[type][id] = data
                            onChanged(id, data)
                        }.bind(this))

                        this.db.child(type).on('child_added', function (snapshot) {
                            var id = snapshot.name()
                            var data = snapshot.val()
                            this.data[type][id] = data
                            onAdd(id, data)
                        }.bind(this))
                    },

                    save: function (type, id, data, done) {
                        this.data[type][id] = data
                        this.db.child(type).child(id).set(data, done)
                    },

                    update: function (type, id, update, done) {
                        this.db.child(type).child(id).update(update, done)
                    },

                    findAll: function (type, done) {
                        this.db.child(type).once('value', function (snapshot) {
                            var items = []
                            var val = snapshot.val()
                            for (var name in val) {
                                items.push(val[name])
                            }
                            done(null, items)
                        })
                    },

                    remove: function (type, id, done) {
                        this.db.child(type).child(id).remove(done)
                    },

                    load: function (data, done, clear) {
                    },

                    dump: function (done) {
                    },
                })


            }, { "../uuid": 22, "./base": 16 }], 18: [function (_dereq_, module, exports) {

                var Base = _dereq_('./base')

                module.exports = MemPL

                function MemPL() {
                    this.data = {}
                }

                Base.extend(MemPL, {
                    init: function (done) {
                        done()
                    },

                    save: function (type, id, data, done) {
                        if (!this.data[type]) {
                            this.data[type] = {}
                        }
                        this.data[type][id] = data
                        done && done()
                    },

                    update: function (type, id, update, done) {
                        for (var attr in update) {
                            this.data[type][id][attr] = update[attr]
                        }
                        done && done()
                    },

                    findAll: function (type, done) {
                        var items = []
                        if (this.data[type]) {
                            for (var id in this.data[type]) {
                                items.push(this.data[type][id])
                            }
                        }
                        done(null, items)
                    },

                    remove: function (type, id, done) {
                        delete this.data[type][id]
                        done && done()
                    },

                    load: function (data, done, clear) {
                        done && done();
                    },

                    dump: function (done) {
                        done(null, { nodes: {} });
                    }
                })


            }, { "./base": 16 }], 19: [function (_dereq_, module, exports) {

                module.exports = function slideDown(node) {
                    var style = window.getComputedStyle(node)
                      , height = style.height
                    if (!parseInt(height)) {
                        return
                    }
                    var speed = parseInt(height) / 700
                    node.style.height = 0
                    node.style.transition = 'height ' + speed + 's ease'
                    node.style.overflow = 'hidden'
                    console.log(height)

                    setTimeout(function () {
                        console.log('y', height)
                        node.style.height = height
                    }, 0)

                    node.addEventListener('transitionend', fin)
                    function fin() {
                        node.removeEventListener('transitionend', fin)
                        node.style.removeProperty('transition')
                        node.style.removeProperty('height')
                        node.style.removeProperty('overflow')
                    }
                }


            }, {}], 20: [function (_dereq_, module, exports) {

                module.exports = function slideUp(node, done) {
                    /*
                    animate(node, {
                      height: {
                        from: 'current',
                        to: 0
                      }
                    }, done)
                    */
                    var style = window.getComputedStyle(node)
                      , height = style.height
                    if (!parseInt(height)) {
                        return
                    }
                    node.style.height = height
                    var speed = parseInt(height) / 700
                    node.style.transition = 'height ' + speed + 's ease'
                    node.style.overflow = 'hidden'

                    setTimeout(function () {
                        node.style.height = 0
                    }, 0)

                    node.addEventListener('transitionend', fin)
                    function fin() {
                        node.removeEventListener('transitionend', fin)
                        node.style.removeProperty('transition')
                        node.style.removeProperty('height')
                        node.style.removeProperty('overflow')
                        done()
                    }
                }

            }, {}], 21: [function (_dereq_, module, exports) {

                module.exports = {
                    extend: extend,
                    merge: merge,
                    ensureInView: ensureInView,
                    make_listed: make_listed,
                    isMac: isMac,
                }

                function isMac() {
                    return window.navigator.platform.indexOf('Mac') === 0
                }

                function merge(a, b) {
                    var c = {}
                      , d
                    for (d in a) {
                        c[d] = a[d]
                    }
                    for (d in b) {
                        c[d] = b[d]
                    }
                    return c
                }

                function ensureInView(item) {
                    var bb = item.getBoundingClientRect()
                    if (bb.top < 0) return item.scrollIntoView()
                    if (bb.bottom > window.innerHeight) {
                        item.scrollIntoView(false)
                    }
                }

                function extend(dest) {
                    [].slice.call(arguments, 1).forEach(function (src) {
                        for (var attr in src) {
                            dest[attr] = src[attr]
                        }
                    })
                    return dest
                }

                function load(db, tree) {
                    var res = make_listed(tree, undefined, true)
                    db.save('root', { id: res.id })
                    for (var i = 0; i < res.tree.length; i++) {
                        db.save('node', res.tree[i])
                    }
                }

                function make_listed(data, nextid, collapse) {
                    var ids = {}
                      , children = []
                      , ndata = {}
                      , res
                      , i
                    if (undefined === nextid) nextid = 100

                    if (data.children) {
                        for (i = 0; i < data.children.length; i++) {
                            res = make_listed(data.children[i], nextid, collapse)
                            for (var id in res.tree) {
                                ids[id] = res.tree[id]
                                ids[id].depth += 1
                            }
                            children.push(res.id)
                            nextid = res.id + 1
                        }
                        // delete data.children
                    }
                    for (var attr in data) {
                        if (attr === 'children') continue;
                        ndata[attr] = data[attr]
                    }
                    ndata.done = false
                    var theid = data.id || nextid
                    ids[theid] = {
                        id: theid,
                        data: ndata,
                        children: children,
                        collapsed: !!collapse,
                        depth: 0
                    }
                    for (i = 0; i < children.length; i++) {
                        ids[children[i]].parent = theid;
                    }
                    return { id: theid, tree: ids }
                }


            }, {}], 22: [function (_dereq_, module, exports) {

                module.exports = uuid

                var CHARS = '0123456789abcdefghijklmnopqrstuvwxyz'
                function uuid(ln) {
                    ln = ln || 32
                    var id = ''
                    for (var i = 0; i < ln; i++) {
                        id += CHARS[parseInt(Math.random() * CHARS.length)]
                    }
                    return id
                }


            }, {}], 23: [function (_dereq_, module, exports) {

                var keyHandler = _dereq_('./key-handler')
                  , normalActions = _dereq_('./normal-actions')
                  , visualActions = _dereq_('./visual-actions')
                  , util = _dereq_('./util')

                module.exports = View

                function eqlist(a, b) {
                    if (a == b) return true
                    if (!a || !b) return false
                    if (a.length !== b.length) {
                        return false
                    }
                    for (var i = 0; i < a.length; i++) {
                        if (a[i] !== b[i]) return false
                    }
                    return true
                }

                var DomViewLayer = _dereq_('./dom-vl')
                  , DefaultNode = _dereq_('./default-node')
                  , DungeonsAndDragons = _dereq_('./dnd')
                  , keys = _dereq_('./keys')
                  , util = _dereq_('./util')
                  , defaultKeys = _dereq_('./default-keys')

                /**
                 * The basic view
                 *
                 * bindActions: fn()
                 * model: the model
                 * actions: the controller actions
                 * options: options hash
                 */
                function View(bindActions, model, actions, options) {
                    options = options || {}
                    this.mode = 'normal'
                    this.selection = null
                    this.sel_inverted = false
                    this.active = null
                    this.o = util.extend({
                        Node: DefaultNode,
                        ViewLayer: DomViewLayer,
                        noSelectRoot: false,
                        animate: true
                    }, options)
                    this.o.keybindings = util.merge(this.getDefaultKeys(), options.keys)
                    this.vl = new this.o.ViewLayer(this.o)
                    this.bindActions = bindActions
                    this.model = model
                    this.ctrlactions = actions
                    this.modelActions = model.boundActions
                    // actually DragAndDrop
                    this.dnd = new DungeonsAndDragons(this.vl, actions.move)
                    this.lazy_children = {}
                    this._listeners = {}

                    this.newNode = null
                    this.attachListeners()
                }

                View.prototype = {
                    getNode: function () {
                        return this.vl.root
                    },

                    emit: function (evt) {
                        var args = [].slice.call(arguments, 1)
                        if (!this._listeners[evt]) return false
                        for (var i = 0; i < this._listeners[evt].length; i++) {
                            this._listeners[evt][i].apply(this, args)
                        }
                    },

                    on: function (evt, handler) {
                        if (!this._listeners[evt]) {
                            this._listeners[evt] = []
                        }
                        this._listeners[evt].push(handler)
                    },

                    off: function (evt, handler) {
                        if (!this._listeners[evt]) return false
                        var i = this._listeners[evt].indexOf(handler)
                        if (i === -1) return false
                        this._listeners[evt].splice(i, 1)
                    },

                    getDefaultKeys: function () {
                        return util.merge(defaultKeys.view.base,
                                          defaultKeys.view[util.isMac() ? 'mac' : 'pc'])
                    },

                    rebase: function (newroot, trigger) {
                        this.vl.clear()
                        //document.activeElement.blur()
                        if (!this.model.ids[newroot]) newroot = this.model.root
                        var root = this.vl.root
                        this.initialize(newroot)
                        this.vl.rebase(root)
                        this.ctrlactions.trigger('rebase', newroot)
                    },

                    initialize: function (root) {
                        var node = this.model.ids[root]
                          , rootNode = this.vl.makeRoot(node, this.bindActions(root), this.modelActions)
                        this.active = null
                        this.selection = null
                        this.lazy_children = {}
                        this.root = root
                        this.populateChildren(root)
                        if (!node.children.length) {
                            this.addNew(this.root, 0)
                        } else {
                            this.removeNew()
                        }
                        this.selectSomething()
                        return rootNode
                    },

                    startMoving: function (id) {
                        var targets = this.vl.dropTargets(this.root, this.model, id, true)
                        this.dnd.startMoving(targets, id)
                    },

                    addNew: function (pid, index) {
                        this.newNode = {
                            pid: pid,
                            index: index
                        }
                        var before = this.model.getBefore(pid, index - 1)
                        this.vl.addNew({
                            id: 'new',
                            content: '',
                            meta: {},
                            parent: pid
                        }, this.bindActions('new'), this.modelActions, before)
                    },

                    removeNew: function () {
                        if (!this.newNode) return false
                        var nw = this.newNode
                          , lastchild = !this.model.ids[nw.pid].children.length
                        this.vl.remove('new', nw.pid, lastchild)
                        this.newNode = null
                        return nw
                    },

                    selectSomething: function () {
                        var child
                        if (!this.model.ids[this.root].children.length) {
                            child = 'new'
                        } else {
                            child = this.model.ids[this.root].children[0]
                        }
                        this.goTo(child)
                    },

                    populateChildren: function (id, node) {
                        node = node || this.model.ids[id]
                        if (!node) return
                        if (node.collapsed && id !== this.root) {
                            this.lazy_children[id] = true
                            return
                        }
                        this.lazy_children[id] = false
                        this.vl.clearChildren(id)
                        if (!node.children || !node.children.length) return
                        for (var i = 0; i < node.children.length; i++) {
                            this.add(this.model.ids[node.children[i]] || { id: node.children[i], parent: id, content: '', children: [] }, false, true)
                            this.populateChildren(node.children[i])
                        }
                    },

                    goTo: function (id) {
                        if (this.mode === 'insert') {
                            this.startEditing(id)
                        } else {
                            this.setActive(id)
                        }
                    },

                    extra_actions: {},

                    keyHandler: function () {
                        var normal = keyHandler(
                          defaultKeys.view.base,
                          normalActions,
                          this.ctrlactions
                        )

                        if (this.extra_actions) {
                            for (var action in this.extra_actions) {
                                normal[this.extra_actions[action].binding] = this.extra_actions[action].action
                            }
                        }

                        var visual = keyHandler(defaultKeys.visual, visualActions, this.ctrlactions)
                        var handlers = {
                            'insert': function () { },
                            'normal': keys(normal),
                            'visual': keys(visual),
                        }

                        return function () {
                            return handlers[this.mode].apply(this, arguments)
                        }.bind(this)
                    },

                    attachListeners: function () {
                        var keydown = this.keyHandler()
                        window.addEventListener('keydown', function (e) {
                            if (e.target.nodeName === 'INPUT') return
                            if (this.mode === 'insert') return
                            keydown.call(this, e)
                        }.bind(this))
                    },

                    addTree: function (node, before) {
                        if (!this.vl.body(node.parent)) {
                            return this.rebase(node.parent, true)
                        }
                        this.removeNew()
                        this.add(node, before)
                        if (!node.children || !node.children.length) return
                        for (var i = 0; i < node.children.length; i++) {
                            this.addTree(this.model.ids[node.children[i]], false)
                        }
                    },

                    // operations
                    add: function (node, before, dontfocus) {
                        var ed = this.mode === 'insert'
                          , children = node.children && !!node.children.length
                        if (!this.vl.body(node.parent)) {
                            return this.rebase(node.parent, true)
                        }
                        this.vl.addNew(node, this.bindActions(node.id), this.modelActions, before, children)
                        if (!dontfocus) {
                            if (ed) {
                                this.vl.body(node.id).startEditing()
                            } else {
                                this.setActive(node.id)
                            }
                        }
                    },

                    update: function (id, node) {
                        var old = this.model.ids[id] || {}
                        console.log('update!', id, node, old)
                        var body = this.vl.body(id)
                        if (!body) return console.warn('no body for update')
                        if (node.content !== old.content) {
                            body.setContent(node.content)
                        }
                        if (!eqlist(node.children, old.children)) {
                            this.populateChildren(id, node)
                            // TODO handle remote deletion of the active node.
                        }
                        body.setMeta(node.meta || {})
                        // this could get annoying
                        if (node.collapsed !== old.collapsed) {
                            this.setCollapsed(id, node.collapsed)
                        }
                    },

                    remove: function (id, ignoreActive) {
                        var pid = this.model.ids[id].parent
                          , parent = this.model.ids[pid]
                        if (!this.vl.body(id)) {
                            return this.rebase(pid, true)
                        }
                        if (id === this.active && !ignoreActive) {
                            this.setActive(this.root)
                        }
                        this.vl.remove(id, pid, parent && parent.children.length === 1)
                        if (parent.children.length === 1) {
                            if (pid === this.root) {
                                setTimeout(function () {
                                    this.addNew(pid, 0)
                                }.bind(this), 0)
                            }
                        }
                    },

                    setContent: function (id, content) {
                        if (!this.vl.body(id)) {
                            return this.rebase(id, true)
                        }
                        this.vl.body(id).setContent(content)
                        if (this.mode === 'insert') {
                            this.vl.body(id).startEditing()
                        }
                    },

                    setAttr: function (id, attr, value, quiet) {
                        if (!this.vl.body(id)) {
                            if (quiet) return
                            return this.rebase(id, true)
                        }
                        this.vl.body(id).setAttr(attr, value)
                        if (this.mode === 'insert' && !quiet) {
                            this.vl.body(id).startEditing()
                        }
                    },

                    replaceMeta: function (id, meta) {
                        this.vl.body(id).replaceMeta(meta)
                        if (this.mode === 'insert') {
                            this.vl.body(id).startEditing()
                        }
                    },

                    appendText: function (id, text) {
                        this.vl.body(id).addEditText(text)
                    },

                    move: function (id, pid, before, ppid, lastchild) {
                        if (!this.vl.body(id)) {
                            return this.rebase(this.model.commonParent(pid, ppid), true)
                        }
                        var ed = this.mode === 'insert'
                        this.vl.move(id, pid, before, ppid, lastchild)
                        if (ed) this.startEditing(id)
                    },

                    startEditing: function (id, fromStart) {
                        if (arguments.length === 0) {
                            id = this.active !== null ? this.active : this.root
                        }
                        if (id === this.root && this.o.noSelectRoot) {
                            return
                        }
                        var body = this.vl.body(id)
                        if (!body) return
                        body.startEditing(fromStart)
                    },

                    stopEditing: function () {
                        if (this.mode !== 'insert') return
                        if (this.active === null) return
                        this.vl.body(this.active).stopEditing()
                    },

                    setEditing: function (id) {
                        if (this.mode === 'visual') {
                            this.stopSelecting()
                        }
                        this.mode = 'insert'
                        this.setActive(id)
                    },

                    doneEditing: function () {
                        this.mode = 'normal'
                    },

                    setActive: function (id) {
                        if (id === this.active) return this.vl.showActive(id)
                        if (this.active !== null) {
                            this.vl.clearActive(this.active)
                        }
                        if (!this.vl.dom[id]) {
                            id = this.root
                        }
                        this.active = id
                        this.vl.showActive(id)
                    },

                    getActive: function () {
                        if (!this.vl.dom[this.active]) {
                            return this.root
                        }
                        return this.active
                    },

                    addToSelection: function (id, invert) {
                        var ix = this.selection.indexOf(id)
                        if (ix === -1) {
                            this.selection.push(id)
                            this.vl.showSelection([id])
                            this.sel_inverted = invert
                        } else {
                            this.vl.clearSelection(this.selection.slice(ix + 1))
                            this.selection = this.selection.slice(0, ix + 1)
                            if (this.selection.length === 1) {
                                this.sel_inverted = false
                            }
                        }
                        this.setActive(id)
                        console.log(this.sel_inverted)
                    },

                    setSelection: function (sel) {
                        this.mode = 'visual'
                        this.sel_inverted = false
                        if (this.selection) {
                            this.vl.clearSelection(this.selection)
                        }
                        this.selection = sel
                        this.vl.showSelection(sel)
                    },

                    stopSelecting: function () {
                        if (this.selection !== null) {
                            this.vl.clearSelection(this.selection)
                            this.selection = null
                        }
                        this.mode = 'normal'
                    },

                    setCollapsed: function (id, what) {
                        /*
                        if (!this.vl.body(id)) {
                          return this.rebase(this.model.ids[id].parent)
                        }
                        */
                        if (what) {
                            if (this.mode === 'insert') {
                                this.startEditing(id)
                            } else {
                                this.setActive(id)
                            }
                            if (this.o.animate) {
                                this.vl.animateClosed(id)
                            } else {
                                this.vl.setCollapsed(id, true)
                            }
                        } else {
                            if (this.lazy_children[id]) {
                                this.populateChildren(id)
                            }
                            if (this.o.animate) {
                                this.vl.animateOpen(id)
                            } else {
                                this.vl.setCollapsed(id, false)
                            }
                        }
                        // TODO: event listeners?
                    },

                    // non-modifying stuff
                    goUp: function (id) {
                        // should I check to see if it's ok?
                        var above = this.model.idAbove(id)
                        if (above === false) return
                        if (above === this.root && this.o.noSelectRoot) {
                            return
                        }
                        this.vl.body(above).body.startEditing();
                    },

                    goDown: function (id, fromStart) {
                        var below = this.model.idBelow(id, this.root)
                        if (below === false) return
                        this.vl.body(below).body.startEditing(fromStart)
                    },
                }


            }, { "./default-keys": 6, "./default-node": 7, "./dnd": 8, "./dom-vl": 9, "./key-handler": 12, "./keys": 13, "./normal-actions": 15, "./util": 21, "./visual-actions": 24 }], 24: [function (_dereq_, module, exports) {

                function reversed(items) {
                    var nw = []
                    for (var i = items.length; i > 0; i--) {
                        nw.push(items[i - 1])
                    }
                    return nw
                }

                module.exports = {
                    // movement
                    'select up': {
                        help: 'move the cursor up',
                        action: function () {
                            var prev = this.model.prevSibling(this.active, true)
                            if (!prev) return
                            this.addToSelection(prev, true)
                        },
                    },

                    'select down': {
                        help: 'move the cursor down',
                        action: function () {
                            var next = this.model.nextSibling(this.active, true)
                            if (!next) return
                            this.addToSelection(next, false)
                        },
                    },

                    'select to bottom': {
                        help: 'move the cursor to the bottom',
                        action: function () {
                            var n = this.model.ids[this.selection[0]]
                              , ch = this.model.ids[n.parent].children
                              , ix = ch.indexOf(this.selection[0])
                            this.setSelection(ch.slice(ix))
                            this.sel_inverted = false
                            this.setActive(ch[ch.length - 1])
                        },
                    },

                    'select to top': {
                        help: 'move the cursor to the top',
                        action: function () {
                            var n = this.model.ids[this.selection[0]]
                              , ch = this.model.ids[n.parent].children
                              , ix = ch.indexOf(this.selection[0])
                              , items = []
                            for (var i = 0; i <= ix; i++) {
                                items.unshift(ch[i])
                            }
                            this.setSelection(items)
                            this.sel_inverted = items.length > 1
                            this.setActive(ch[0])
                        },
                    },

                    'stop selecting': {
                        help: 'quit selection mode',
                        action: function () {
                            this.stopSelecting()
                        },
                    },

                    'edit': {
                        help: 'start editing the active node',
                        action: function () {
                            this.startEditing(this.active)
                        },
                    },

                    'edit start': {
                        help: 'edit at the start of the node',
                        action: function () {
                            this.startEditing(this.active, true)
                        },
                    },

                    // editness
                    'cut': {
                        help: 'cut the current selection',
                        action: function () {
                            var items = this.selection.slice()
                            if (this.sel_inverted) {
                                items = reversed(items)
                            }
                            this.ctrlactions.cut(items)
                            this.stopSelecting()
                        },
                    },

                    'copy': {
                        help: 'copy the current selection',
                        action: function () {
                            var items = this.selection.slice()
                            if (this.sel_inverted) {
                                items = reversed(items)
                            }
                            this.ctrlactions.copy(items)
                            this.stopSelecting()
                        },
                    },

                    'undo': {
                        help: 'undo the last change',
                        action: function () {
                            this.stopSelecting()
                            this.ctrlactions.undo()
                        },
                    },

                    'redo': {
                        help: 'redo the last undo',
                        action: function () {
                            this.stopSelecting()
                            this.ctrlactions.redo()
                        },
                    },
                }


            }, {}], 25: [function (_dereq_, module, exports) {

                module.exports = Block

                function unEscapeHtml(str) {
                    if (!str) return '';
                    return str
                      .replace(/<div>/g, '\n').replace(/<br>/g, '\n')
                      .replace(/<\/div>/g, '')
                      .replace(/\u200b/g, '')
                }

                /**
                 * Config looks like:
                 * {
                 *   top: num,
                 *   left: num, (from meta.whiteboard)
                 *  }
                 * Options looks like:
                 * {
                 *  saveConfig
                 *  saveContent
                 *  changeContent
                 *  startMoving(event, rect, ?shiftMove)
                 *  startMovingChild(event, id, ?shiftMove)
                 *  onZoom
                 * }
                 */
                function Block(data, children, config, options) {
                    this.o = options
                    this.editing = false
                    this._moved = false
                    this.setupNode(data, children)
                    this.reposition(config.left, config.top, true)
                    // this.resize(config.width, config.height, true)
                }

                Block.prototype = {
                    setupNode: function (data, children) {
                        this.node = document.createElement('div')
                        this.node.className = 'whiteboard-item'
                        // this.node.addEventListener('mousedown', this._onMouseDown.bind(this))
                        this.node.addEventListener('mouseup', this._onMouseUp.bind(this))
                        this.node.addEventListener('mousemove', this._onMouseMove.bind(this))
                        this.node.addEventListener('mousedown', this._onMouseDown.bind(this))

                        this.title = document.createElement('div')
                        this.title.className = 'whiteboard-item_title'
                        // this.title.addEventListener('click', this._onClick.bind(this))
                        this.title.addEventListener('click', this._onClick.bind(this))
                        this.title.addEventListener('dblclick', this.o.onZoom)

                        this.input = document.createElement('div')
                        this.input.setAttribute('contenteditable', true)
                        this.input.className = 'whiteboard-item_input'
                        this.input.addEventListener('blur', this._onBlur.bind(this))

                        this.body = document.createElement('ul')
                        this.body.className = 'whiteboard-item_body'

                        var zoom = document.createElement('div')
                        zoom.className = 'whiteboard-item_zoom'
                        zoom.innerHTML = '<i class="fa fa-expand"/>'
                        zoom.addEventListener('click', this.o.onZoom)

                        this.children = {}

                        children.forEach(function (child) {
                            var node = this.createChild(child)
                            // node.addEventListener('mousedown', this._onMouseDownChild.bind(this, child.id))
                            this.body.appendChild(node)
                            this.children[child.id] = node
                        }.bind(this))

                        /*
                        this.footer = document.createElement('div')
                        this.footer.className = 'whiteboard-item_footer'
                        var zoom = document.createElement('i')
                        zoom.className = 'fa fa-expand zoom'
                        zoom.addEventListener('click', this.o.onZoom)
                        this.footer.appendChild(zoom)
                        */

                        this.node.appendChild(this.title)
                        this.node.appendChild(this.body)
                        this.node.appendChild(zoom)
                        // this.node.appendChild(this.footer)

                        this.setTextContent(data.content)
                        this.content = data.content
                        return this.node
                    },

                    remove: function () {
                        this.node.parentNode.removeChild(this.node)
                        return true
                    },

                    /**
                     * pid: the id of this block
                     * cid: the child that is being moved
                     * children: list of child ids
                     */
                    getChildTargets: function (cid, bid, children) {
                        var targets = children ? children.map(this.childTarget.bind(this, bid)) : []
                        targets.push(this.wholeTarget(bid, children.length))
                        return targets
                    },

                    childTarget: function (pid, id, i) {
                        var box = this.children[id].getBoundingClientRect()
                          , magic = 10
                        return {
                            hit: {
                                left: box.left,
                                right: box.right,
                                top: box.top - magic,
                                bottom: box.bottom - magic
                            },
                            pos: i,
                            pid: pid,
                            draw: {
                                left: box.left,
                                width: box.width,
                                top: box.top - magic / 2,
                                height: magic
                            }
                        }
                    },

                    /**
                     * id: the box id
                     * last: the last index in the child list
                     */
                    wholeTarget: function (id, last) {
                        var box = this.node.getBoundingClientRect()
                          , magic = 10
                        return {
                            hit: box,
                            pid: id,
                            pos: last,
                            draw: {
                                top: box.bottom - magic,
                                left: box.left + magic / 2,
                                height: magic,
                                width: box.width - magic
                            }
                        }
                    },


                    // Children!!


                    // Not children!!

                    updateConfig: function (config) {
                        this.reposition(config.left, config.top, true)
                        // this.resize(config.width, config.height, true)
                    },

                    setContent: function (content) {
                        if (content === this.content) return
                        this.setTextContent(content)
                        this.setInputValue(content)
                    },

                    _onBlur: function (e) {
                        this.stopEditing()
                        e.preventDefault()
                        return false
                    },

                    _onMouseMove: function (e) {
                        if (e.target.classList.contains('handle')) {
                            return
                        }
                        if (!e.shiftKey) return
                        var rect = this.node.getBoundingClientRect()
                        if (this.o.startMoving(e, rect, true)) {
                            this.node.classList.add('whiteboard-item--moving')
                        }
                    },

                    _onMouseUp: function (e) {
                    },

                    _onClick: function (e) {
                        if (this._moved) {
                            this._moved = false
                            return
                        }
                        this.startEditing()
                        e.preventDefault()
                        return false
                    },

                    _onMouseMoveChild: function (id, e) {
                        if (!e.shiftKey) return
                        e.preventDefault()
                        var clone = this.children[id].lastChild.cloneNode(true)
                        if (this.o.startMovingChild(e, id, clone, true)) {
                            this.children[id].classList.add('whiteboard-item_child--moving')
                        }
                    },

                    _onMouseDownChild: function (id, e) {
                        e.stopPropagation()
                        e.preventDefault()
                        var clone = this.children[id].lastChild.cloneNode(true)
                        if (this.o.startMovingChild(e, id, clone)) {
                            this.children[id].classList.add('whiteboard-item_child--moving')
                        }
                    },

                    _onMouseDown: function (e) {
                        if (e.button !== 0) {
                            return
                        }
                        this._moved = false
                        if (e.target !== this.input) {
                            e.preventDefault()
                            document.activeElement.blur()
                        }
                        var rect = this.node.getBoundingClientRect()
                        this.node.classList.add('whiteboard-item--moving')
                        this.o.startMoving(e, rect)
                        //, top = e.clientY - rect.top
                        //, left = e.clientX - rect.left
                        /**
                         * TODO: resizability ?
                        if (left > rect.width - 10) {
                          return this.startResizing('x')
                        }
                        if (top > rect.height - 10) {
                          return this.startResizing('y')
                        }
                         */
                        //this.o.startMoving(left, top)
                        return false
                    },

                    removeChild: function (id) {
                        if (!this.children[id]) {
                            return false
                        }
                        this.children[id].parentNode.removeChild(this.children[id])
                        delete this.children[id]
                    },

                    addChild: function (child, id, before) {
                        var node = this.createChild(child)
                        if (before === false) {
                            this.body.appendChild(node)
                        } else {
                            this.body.insertBefore(node, this.children[before])
                        }
                        this.children[id] = node
                    },

                    createChild: function (child) {
                        var node = document.createElement('li')
                        node.className = 'whiteboard-item_child'
                        if (child.children && child.children.length) {
                            node.classList.add('whiteboard-item_child--parent')
                        }
                        var body = document.createElement('div')
                        body.innerHTML = child.content ? marked(child.content) : '<em>Click here to edit</em>'
                        var handle = document.createElement('div')
                        handle.className = 'handle'
                        handle.innerHTML = '<i class="fa fa-circle"/>'
                        handle.addEventListener('mousemove', this._onMouseMoveChild.bind(this, child.id))
                        handle.addEventListener('mousedown', this._onMouseDownChild.bind(this, child.id))
                        node.appendChild(handle)
                        node.appendChild(body)
                        return node
                    },

                    doneMoving: function () {
                        this.node.classList.remove('whiteboard-item--moving')
                    },

                    doneMovingChild: function (id) {
                        this.children[id].classList.remove('whiteboard-item_child--moving')
                    },

                    startEditing: function (fromStart) {
                        if (this.editing) return
                        this.node.classList.add('whiteboard-item--editing')
                        this.editing = true;
                        this.setInputValue(this.content)
                        this.node.replaceChild(this.input, this.title)
                        this.input.focus();
                        this.setSelection(!fromStart)
                    },

                    stopEditing: function () {
                        if (!this.editing) return
                        this.node.classList.remove('whiteboard-item--editing')
                        console.log('stop eddint', this.isNew)
                        var value = this.getInputValue()
                        this.editing = false
                        this.node.replaceChild(this.title, this.input)
                        if (this.content != value) {
                            this.setTextContent(value)
                            this.content = value
                            this.o.changeContent(this.content)
                        }
                    },

                    setSelection: function (end) {
                        var sel = window.getSelection()
                        sel.selectAllChildren(this.input)
                        try {
                            sel['collapseTo' + (end ? 'End' : 'Start')]()
                        } catch (e) { }
                    },

                    focus: function () {
                        this.startEditing()
                    },

                    setTextContent: function (value) {
                        this.title.innerHTML = value ? marked(value) : ''
                    },

                    setInputValue: function (value) {
                        this.input.innerHTML = value
                    },

                    getInputValue: function () {
                        return unEscapeHtml(this.input.innerHTML)
                    },

                    reposition: function (x, y, silent) {
                        if (x !== this.x || y !== this.y) {
                            this._moved = true
                        }
                        this.x = x
                        this.y = y
                        this.node.style.top = y + 'px'
                        this.node.style.left = x + 'px'
                        if (!silent) {
                            this.saveConfig()
                        }
                    },

                    resize: function (width, height, silent) {
                        this.width = width
                        this.height = height
                        this.node.style.width = width + 'px'
                        this.node.style.height = height + 'px'
                        if (!silent) {
                            this.saveConfig()
                        }
                    },

                    saveConfig: function () {
                        this.o.saveConfig({
                            left: this.x,
                            top: this.y,
                            width: this.width,
                            height: this.height
                        })
                    },

                    saveContent: function () {
                        this.o.saveContent(this.content)
                    },

                    mouseMove: function (e) {
                    },

                    mouseUp: function (e) {
                    },

                    click: function (e) {
                        this.startEditing()
                    },

                    blur: function () {
                        this.stopEditing()
                    },

                    keyDown: function (e) {
                    }
                }


            }, {}], 26: [function (_dereq_, module, exports) {

                module.exports = {
                    View: _dereq_('./view')
                }


            }, { "./view": 27 }], 27: [function (_dereq_, module, exports) {

                var DungeonsAndDragons = _dereq_('../../lib/dnd.js')
                var Block = _dereq_('./block')

                module.exports = View

                function View(bindActions, model, actions, options) {
                    this.mode = 'normal'
                    this.active = null
                    this.ids = {}

                    this.bindActions = bindActions
                    this.model = model
                    this.ctrlactions = actions

                    this._boundMove = this._onMouseMove.bind(this)
                    this._boundUp = this._onMouseUp.bind(this)
                    document.addEventListener('keyup', this._onKeyUp.bind(this))
                }

                View.prototype = {
                    initialize: function (root) {
                        var node = this.model.ids[root]
                        this.setupRoot()
                        this.root = root
                        this.makeBlocks(root)
                        return this.rootNode
                    },

                    setupRoot: function () {
                        var rootNode = document.createElement('div')
                        rootNode.className = 'whiteboard'
                        rootNode.addEventListener('click', this._onClick.bind(this))
                        rootNode.addEventListener('mousedown', this._onMouseDown.bind(this))
                        rootNode.addEventListener('wheel', this._onWheel.bind(this))

                        this.head = document.createElement('div')
                        this.head.className = 'whiteboard-head'
                        this.head.addEventListener('click', this._onClickHead.bind(this))

                        this.input = document.createElement('input')
                        this.input.setAttribute('contenteditable', true)
                        this.input.className = 'whiteboard-input-head'
                        this.input.addEventListener('blur', this._onBlurHead.bind(this))

                        this.container = document.createElement('div')
                        this.container.className = 'whiteboard-container'

                        this.controls = document.createElement('div')
                        this.controls.className = 'whiteboard-controls'
                        var b1 = document.createElement('button')
                        b1.innerHTML = '1:1'
                        b1.addEventListener('click', this.resetContainer.bind(this))
                        var b2 = document.createElement('button')
                        b2.innerHTML = '<i class="fa fa-th-large"/>'
                        b2.addEventListener('click', this.resetPositions.bind(this))
                        this.controls.appendChild(b1)
                        this.controls.appendChild(b2)

                        this.dropShadow = document.createElement('div')
                        this.dropShadow.className = 'whiteboard-dropshadow'

                        this.body = document.createElement('div')
                        this.body.appendChild(this.container)
                        this.body.className = 'whiteboard-body'
                        this.body.addEventListener('dblclick', this._onDoubleClick.bind(this))

                        this.vline = document.createElement('div')
                        this.vline.className = 'whiteboard_vline'
                        this.hline = document.createElement('div')
                        this.hline.className = 'whiteboard_hline'
                        this.body.appendChild(this.vline)
                        this.body.appendChild(this.hline)
                        this.body.appendChild(this.dropShadow)
                        this.body.appendChild(this.controls)

                        rootNode.appendChild(this.head)
                        rootNode.appendChild(this.body)

                        this.rootNode = rootNode
                        this.setContainerZoom(1)
                        this.setContainerPos(0, 0)
                    },

                    // Controller / Commands API stuff

                    getActive: function () {
                        return this.root
                    },

                    addTree: function (node, before) {
                        if (node.parent !== this.root) return;
                        this.makeBlock(node.id, 0)
                    },

                    add: function (node, before, dontfocus) {
                        if (node.parent === this.root) {
                            var block = this.makeBlock(node.id, 0)
                            block.node.style.zIndex = Object.keys(this.ids).length
                            if (!dontfocus) {
                                block.focus()
                            }
                            return
                        }
                        if (!this.ids[node.parent]) {
                            return
                        }
                        this.ids[node.parent].addChild(node, this.model)
                    },

                    setCollapsed: function () {
                    },
                    startEditing: function () {
                    },
                    setActive: function () {
                    },
                    setSelection: function () {
                    },

                    move: function (id, pid, before, opid, lastchild) {
                        if (this.ids[opid]) {
                            this.ids[opid].removeChild(id)
                        } else if (opid == this.root) {
                            this.ids[id].remove()
                            delete this.ids[id]
                        }
                        if (this.ids[pid]) {
                            return this.ids[pid].addChild(this.model.ids[id], id, before)
                        }
                        if (pid !== this.root) {
                            return
                        }
                        this.add(this.model.ids[id], before)
                    },

                    remove: function (id) {
                        console.warn("FIX??")
                        this.container.removeChild(this.ids[id].node)
                        delete this.ids[id]
                    },
                    goTo: function () {
                        console.warn('FIX!');
                    },
                    clear: function () {
                        for (var id in this.ids) {
                            this.container.removeChild(this.ids[id].node)
                        }
                        this.ids = {}
                        this.setContainerPos(0, 0)
                        this.setContainerZoom(1);
                    },

                    rebase: function (newroot, trigger) {
                        this.clear()
                        this.root = newroot
                        this.makeBlocks(newroot)
                        this.ctrlactions.trigger('rebase', newroot)
                    },

                    setAttr: function (id, attr, value) {
                        if (!this.ids[id]) {
                            return
                        }
                        if (attr === 'whiteboard') {
                            if (!value || !value.top) {
                                var ch = this.model.ids[this.root].children
                                  , i = ch.indexOf(id)
                                  , defaultWidth = 300
                                  , defaultHeight = 100
                                  , margin = 10
                                value = {
                                    top: 10 + parseInt(i / 4) * (defaultHeight + margin),
                                    left: 10 + (i % 4) * (defaultWidth + margin)
                                }
                            }
                            this.ids[id].updateConfig(value)
                        }
                        // TODO something with done-ness?
                    },

                    setContent: function (id, content) {
                        if (!this.ids[id]) {
                            return
                        }
                        this.ids[id].setContent(content)
                    },

                    setRootContent: function (content) {
                        this.head.innerHTML = marked(content);
                    },

                    makeBlocks: function (root) {
                        this.setRootContent(this.model.ids[root].content);
                        var children = this.model.ids[root].children
                        if (!children) return
                        children.forEach(this.makeBlock.bind(this));
                    },

                    makeBlock: function (id, i) {
                        var node = this.model.ids[id]
                          , config = node.meta.whiteboard
                          // TODO: magic numbers?
                          , defaultWidth = 300
                          , defaultHeight = 100
                          , margin = 10
                        if (!config) {
                            config = {
                                // width: 200,
                                // height: 200,
                                top: 10 + parseInt(i / 4) * (defaultHeight + margin),
                                left: 10 + (i % 4) * (defaultWidth + margin)
                            }
                        }
                        var children = (node.children || []).map(function (id) {
                            return this.model.ids[id]
                        }.bind(this));
                        var block = new Block(node, children, config, {
                            saveConfig: function (config) {
                                this.ctrlactions.changed(node.id, 'whiteboard', config)
                                // this.ctrl.executeCommands('changeNodeAttr', [node.id, 'whiteboard', config]);
                            }.bind(this),
                            saveContent: function (content) {
                                this.ctrlactions.changeContent(node.id, content)
                            }.bind(this),
                            changeContent: function (content) {
                                this.ctrlactions.changeContent(node.id, content)
                            }.bind(this),
                            startMoving: this._onStartMoving.bind(this, node.id),
                            startMovingChild: this._onStartMovingChild.bind(this, node.id),
                            onZoom: function () {
                                this.rebase(node.id)
                            }.bind(this),
                        })
                        this.ids[id] = block
                        this.container.appendChild(block.node)
                        return block
                    },

                    /**
                     * If the current is over a target, show the drop shadow.
                     */
                    updateDropTarget: function (x, y) {
                        var t
                        /*
                        if (this.moving.currentTarget) {
                          t = this.moving.currentTarget
                          if (x >= t.hit.left && x <= t.hit.right &&
                              y >= t.hit.top && y <= t.hit.bottom) {
                            // just keep the current one
                            return
                          }
                        }
                        */
                        for (var i = 0; i < this.moving.targets.length; i++) {
                            t = this.moving.targets[i]
                            if (x >= t.hit.left && x <= t.hit.right &&
                                y >= t.hit.top && y <= t.hit.bottom) {
                                this.moving.currentTarget = t
                                this.showDropShadow(t.draw)
                                return true
                            }
                        }
                        this.moving.currentTarget = null
                        this.hideDropShadow()
                        return false
                    },

                    /**
                     * Collect a list of targets 
                     */
                    findTargets: function (children, id, isChild) {
                        var targets = []
                          , snaps = []
                          , root = this.body.getBoundingClientRect()
                        for (var i = children.length - 1; i >= 0; i--) {
                            if (id == children[i]) continue;
                            var childids = this.model.ids[children[i]].children
                              , child = this.ids[children[i]]
                              , whole = child.wholeTarget(id, childids.length)
                            targets = targets.concat(child.getChildTargets(id, children[i], childids))
                            targets.push(whole)
                            if (!isChild) {
                                snaps.push({
                                    top: whole.hit.top - root.top,
                                    left: whole.hit.left - root.left,
                                    right: whole.hit.right - root.left,
                                    bottom: whole.hit.bottom - root.top
                                })
                            }
                        }
                        return {
                            targets: targets,
                            snaps: snaps
                        }
                    },

                    trySnap: function (x, y) {
                        // convert to screen coords
                        x = x * this._zoom + this.x
                        y = y * this._zoom + this.y
                        var h = this.moving.height
                          , w = this.moving.width
                          , b = y + h
                          , r = x + w
                          , allowance = 20 * this._zoom
                          , space = 10 * this._zoom

                        if (allowance < 2) {
                            return false
                        }

                        // TODO: show guiding lines
                        var lines = []
                          , dx = false
                          , dy = false

                        this.moving.snaps.forEach(function (snap) {
                            if (!dy) {
                                // top
                                if (Math.abs(snap.top - space - b) < allowance) {
                                    y = snap.top - space - h
                                    dy = [snap.left, snap.right, snap.top - space / 2]
                                } else if (Math.abs(snap.top - y) < allowance) {
                                    y = snap.top
                                    dy = [snap.left, snap.right, snap.top - space / 2]
                                } else if (Math.abs(snap.bottom + space - y) < allowance) { // bottom
                                    y = snap.bottom + space
                                    dy = [snap.left, snap.right, snap.bottom + space / 2]
                                } else if (Math.abs(snap.bottom - b) < allowance) {
                                    y = snap.bottom - h
                                    dy = [snap.left, snap.right, snap.bottom + space / 2]
                                }
                            }

                            if (!dx) {
                                // left
                                if (Math.abs(snap.left - space - r) < allowance) {
                                    x = snap.left - space - w
                                    dx = [snap.top, snap.bottom, snap.left - space / 2]
                                } else if (Math.abs(snap.left - x) < allowance) {
                                    x = snap.left
                                    dx = [snap.top, snap.bottom, snap.left - space / 2]
                                } else if (Math.abs(snap.right + space - x) < allowance) { // right
                                    x = snap.right + space
                                    dx = [snap.top, snap.bottom, snap.right + space / 2]
                                } else if (Math.abs(snap.right - r) < allowance) {
                                    x = snap.right - w
                                    dx = [snap.top, snap.bottom, snap.right + space / 2]
                                }
                            }
                        })

                        if (dx) {
                            var ht = Math.min(dx[0], y)
                              , hb = Math.max(dx[1], y + h)
                            this.vline.style.left = dx[2] - 1 + 'px'
                            this.vline.style.top = ht - space / 2 + 'px'
                            this.vline.style.height = (hb - ht) + space + 'px'
                            this.vline.style.display = 'block'
                        } else {
                            this.vline.style.display = 'none'
                        }

                        if (dy) {
                            var vl = Math.min(dy[0], x)
                              , vr = Math.max(dy[1], x + w)
                            this.hline.style.top = dy[2] - 1 + 'px'
                            this.hline.style.left = vl - space / 2 + 'px'
                            this.hline.style.width = (vr - vl) + space + 'px'
                            this.hline.style.display = 'block'
                        } else {
                            this.hline.style.display = 'none'
                        }

                        if (dx || dy) {
                            return {
                                x: (x - this.x) / this._zoom,
                                y: (y - this.y) / this._zoom
                            }
                        }
                        return false
                    },

                    getByZIndex: function () {
                        var items = [];
                        for (var id in this.ids) {
                            items.push([+this.ids[id].node.style.zIndex, id])
                        }
                        items.sort(function (a, b) {
                            return a[0] - b[0]
                        })
                        return items.map(function (item) { return item[1] })
                    },

                    shuffleZIndices: function (top) {
                        var items = this.getByZIndex()
                        for (var i = 0; i < items.length; i++) {
                            this.ids[items[i]].node.style.zIndex = i
                        }
                        this.ids[top].node.style.zIndex = items.length
                        return items
                    },

                    // event handlers

                    _onClickHead: function (e) {
                        e.preventDefault()
                        this.startEditing()
                    },

                    _onBlurHead: function (e) {
                        e.preventDefault()
                        this.stopEditing()
                    },

                    startEditing: function () {
                        this.input.value = this.model.ids[this.root].content
                        this.rootNode.replaceChild(this.input, this.head)
                        this.input.focus()
                        this.input.selectionStart = this.input.selectionEnd = this.input.value.length
                    },

                    stopEditing: function () {
                        this.ctrlactions.changeContent(this.root, this.input.value)
                        this.setRootContent(this.input.value)
                        this.rootNode.replaceChild(this.head, this.input)
                    },

                    _onClick: function (e) {
                        if (e.target === this.rootNode) {
                            document.activeElement.blur()
                        }
                    },

                    _onDoubleClick: function (e) {
                        if (e.target !== this.body) {
                            return
                        }
                        var box = this.container.getBoundingClientRect()
                        var x = e.clientX - 50 - box.left
                          , y = e.clientY - 10 - box.top
                          , idx = this.model.ids[this.root].children.length
                        this.ctrlactions.addChild(this.root, idx, '', {
                            whiteboard: {
                                // width: 200,
                                // height: 200,
                                top: y,
                                left: x
                            }
                        })
                    },

                    _onWheel: function (e) {
                        e.preventDefault()
                        if (this.moving) {
                            return
                        }
                        var x, y
                        var deltaX = -e.deltaX, deltaY = -e.deltaY
                        if (e.shiftKey) {
                            var root = this.body.getBoundingClientRect()
                            x = e.clientX - root.left
                            y = e.clientY - root.top
                            this.zoomMove((deltaY / 500), x, y)
                            return
                        }
                        x = this.x
                        y = this.y
                        this.setContainerPos(x + deltaX, y + deltaY)
                    },

                    _onMouseDown: function (e) {
                        if (e.target !== this.rootNode) {
                            return
                        }
                        var box = this.container.getBoundingClientRect()
                        var x = e.clientX - box.left
                          , y = e.clientY - box.top
                        this.moving = {
                            x: x,
                            y: y,
                        }
                        e.preventDefault()
                        document.addEventListener('mousemove', this._boundMove)
                        document.addEventListener('mouseup', this._boundUp)
                    },

                    _onStartMoving: function (id, e, rect, shiftMove) {
                        if (this.moving) return false;
                        var y = e.clientY / this._zoom - rect.top / this._zoom
                          , x = e.clientX / this._zoom - rect.left / this._zoom
                        var children = this.shuffleZIndices(id)
                        var boxes = this.findTargets(children, id)
                        this.moving = {
                            shift: shiftMove,
                            targets: boxes.targets,
                            snaps: boxes.snaps,
                            width: rect.width,
                            height: rect.height,
                            atx: this.ids[id].x,
                            aty: this.ids[id].y,
                            id: id,
                            x: x,
                            y: y,
                        }
                        document.addEventListener('mousemove', this._boundMove)
                        document.addEventListener('mouseup', this._boundUp)
                        this.rootNode.classList.add('whiteboard--moving')
                        return true
                    },

                    _onStartMovingChild: function (id, e, cid, handle, shiftMove) {
                        if (this.moving) return false;
                        var box = this.container.getBoundingClientRect()
                        var x = e.clientX / this._zoom - box.left / this._zoom
                          , y = e.clientY / this._zoom - box.top / this._zoom
                        var children = this.getByZIndex()
                        var boxes = this.findTargets(children, cid, true)
                        this.moving = {
                            shift: shiftMove,
                            targets: boxes.targets,
                            snaps: boxes.snaps,
                            handle: handle,
                            child: cid,
                            parent_id: id,
                            oty: x,
                            otx: y,
                            x: x,
                            y: y
                        }
                        this.container.appendChild(handle)
                        this.updateDropTarget(e.clientX, e.clientY)
                        handle.className = 'whiteboard_child-handle'
                        handle.style.top = y + 'px'
                        handle.style.left = x + 'px'
                        document.addEventListener('mousemove', this._boundMove)
                        document.addEventListener('mouseup', this._boundUp)
                        this.rootNode.classList.add('whiteboard--moving')
                        return true
                    },

                    _onKeyUp: function (e) {
                        if (e.keyCode === 16 && this.moving && this.moving.shift) {
                            this.stopMoving()
                        }
                    },

                    _onMouseMove: function (e) {
                        if (!this.moving) {
                            return this._onMouseUp(e)
                        }
                        e.preventDefault()

                        if (this.moving.child) {
                            var box = this.container.getBoundingClientRect()
                            var x = e.clientX / this._zoom - box.left / this._zoom
                              , y = e.clientY / this._zoom - box.top / this._zoom
                            this.moving.handle.style.top = y + 'px'
                            this.moving.handle.style.left = x + 'px'
                            this.moving.x = x
                            this.moving.y = y
                            this.updateDropTarget(e.clientX, e.clientY)
                            return false
                        }

                        if (this.moving.id) {
                            var box = this.container.getBoundingClientRect()
                            var x = e.clientX / this._zoom - box.left / this._zoom - this.moving.x
                              , y = e.clientY / this._zoom - box.top / this._zoom - this.moving.y
                            if (!this.updateDropTarget(e.clientX, e.clientY)) {
                                // no drop place was found, let's snap!
                                var pos = this.trySnap(x, y)
                                if (pos) {
                                    x = pos.x
                                    y = pos.y
                                }
                            }
                            this.moving.atx = x
                            this.moving.aty = y
                            this.ids[this.moving.id].reposition(x, y, true)
                            return false
                        }

                        // dragging the canvas
                        var box = this.body.getBoundingClientRect()
                        var x = e.clientX - box.left - this.moving.x
                          , y = e.clientY - box.top - this.moving.y
                        this.setContainerPos(x, y)
                        return false
                    },

                    _onMouseUp: function (e) {
                        e.preventDefault()
                        this.stopMoving()
                        return false
                    },

                    resetContainer: function () {
                        this.setContainerPos(0, 0)
                        this.setContainerZoom(1)
                    },

                    resetPositions: function () {
                        var cmds = []
                        this.model.ids[this.root].children.forEach(function (id) {
                            cmds.push('changeNodeAttr')
                            cmds.push([id, 'whiteboard', null])
                        });
                        this.ctrlactions.commands(cmds)
                    },

                    zoomMove: function (delta, x, y) {
                        var next = this._zoom * delta
                          , nz = this._zoom + next
                          , scale = this._zoom / nz
                          , nx = x - x / scale
                          , ny = y - y / scale
                        this.setContainerPos(this.x / scale + nx, this.y / scale + ny)
                        this.setContainerZoom(nz)
                    },

                    setContainerZoom: function (num) {
                        this._zoom = num
                        this.container.style.WebkitTransform = 'scale(' + num + ')'
                        this.container.style.transform = 'scale(' + num + ')'
                    },

                    setContainerPos: function (x, y) {
                        this.x = x
                        this.y = y
                        this.container.style.left = x + 'px'
                        this.container.style.top = y + 'px'
                    },

                    // other stuff

                    stopMovingChild: function () {
                        // TODO move into
                        this.moving.handle.parentNode.removeChild(this.moving.handle)
                        var pos = this.model.ids[this.root].children.length

                        if (this.moving.currentTarget) {
                            var pos = this.moving.currentTarget.pos
                            if (this.moving.currentTarget.pid == this.moving.parent_id) {
                                if (pos > this.model.ids[this.moving.parent_id].children.indexOf(this.moving.child)) {
                                    pos -= 1
                                }
                            }
                            this.ctrlactions.commands('move', [
                              this.moving.child,
                              this.moving.currentTarget.pid,
                              pos
                            ], 'changeNodeAttr', [
                              this.moving.child,
                              'whiteboard',
                              null
                            ]);
                        } else {

                            this.ctrlactions.commands('changeNodeAttr', [
                              this.moving.child,
                              'whiteboard',
                              { top: this.moving.y, left: this.moving.x }
                            ], 'move', [
                              this.moving.child,
                              this.root,
                              pos
                            ])

                        }

                        this.ids[this.moving.parent_id].doneMoving()
                    },

                    showDropShadow: function (rect) {
                        var box = this.body.getBoundingClientRect()
                          , realheight = rect.height * this._zoom
                          , yoff = (rect.height - realheight) / 2
                        this.dropShadow.style.top = rect.top - box.top + yoff + 'px'
                        this.dropShadow.style.left = rect.left - box.left + 'px'
                        this.dropShadow.style.width = rect.width + 'px'
                        this.dropShadow.style.height = realheight + 'px'
                        this.dropShadow.style.display = 'block'
                    },

                    hideDropShadow: function () {
                        this.dropShadow.style.display = 'none'
                    },

                    stopMovingMain: function () {
                        this.ids[this.moving.id].reposition(this.moving.atx, this.moving.aty)
                        this.ids[this.moving.id].doneMoving()
                        if (this.moving.currentTarget) {
                            this.ctrlactions.commands('move', [
                              this.moving.id,
                              this.moving.currentTarget.pid,
                              this.moving.currentTarget.pos
                            ], 'changeNodeAttr', [
                              this.moving.id,
                              'whiteboard',
                              null
                            ]);
                        }
                    },

                    stopMoving: function () {
                        if (this.moving.child) {
                            this.stopMovingChild()
                        } else if (this.moving.id) {
                            this.stopMovingMain()
                        }
                        if (this.moving.currentTarget) {
                            this.hideDropShadow()
                        }
                        this.moving = null
                        document.removeEventListener('mousemove', this._boundMove)
                        document.removeEventListener('mouseup', this._boundUp)
                        this.vline.style.display = 'none'
                        this.hline.style.display = 'none'
                        this.rootNode.classList.remove('whiteboard--moving')
                    },

                    getNode: function () {
                        return this.rootNode
                    }
                }


            }, { "../../lib/dnd.js": 8, "./block": 25 }], 28: [function (_dereq_, module, exports) {

                module.exports = {
                    addTag: {
                        args: ['name'],
                        apply: function (view, model) {
                            if (!model.hasTagRoot()) {
                                var cr = model.addTagRoot()
                                this.tagRoot = view.add(cr.node, cr.before, true)
                            }
                            var nr = model.addTag(this.name)
                            view.add(nr.node, nr.before, true)
                            this.node = nr.node
                            return this.node
                        },
                        undo: function (view, model) {
                            model.remove(this.node.id)
                            if (this.tagRoot) {
                                model.removeTagRoot()
                                view.remove(this.tagRoot.node.id)
                            }
                        }
                    },
                    setTags: {
                        args: ['id', 'tags'],
                        apply: function (view, model) {
                            this.oldTags = model.setTags(this.id, this.tags)
                            view.setTags(this.id, this.tags, this.oldTags)
                        },
                        undo: function (view, model) {
                            model.setTags(this.id, this.oldTags)
                            view.setTags(this.id, this.oldTags, this.tags)
                        },
                    },
                }


            }, {}], 29: [function (_dereq_, module, exports) {

                var Controller = _dereq_('../../lib/controller')
                  , util = _dereq_('../../lib/util')

                  , WFNode = _dereq_('./node')
                  , WFView = _dereq_('./view')
                  , WFVL = _dereq_('./vl')
                  , commands = _dereq_('./commands')

                module.exports = WFController

                function WFController(model, options) {
                    options.extra_commands = util.extend(options.extra_commands || {}, commands)
                    Controller.call(this, model, options)
                    this.on('rebase', function (id) {
                        this.trigger('bullet', this.model.getLineage(id))
                    }.bind(this))
                }

                WFController.prototype = util.extend(Object.create(Controller.prototype), {
                    refreshBullet: function () {
                        this.trigger('bullet', this.model.getLineage(this.model.root))
                    }
                })

                WFController.prototype.actions = util.extend({
                    clickBullet: function (id) {
                        if (id === 'new') return
                        this.view.rebase(id)
                        // this.trigger('bullet', this.model.getLineage(id))
                    },
                    rebase: function (id, toid) {
                        this.view.rebase(toid)
                    },
                    backALevel: function () {
                        var root = this.view.root
                          , pid = this.model.ids[root].parent
                        if (!this.model.ids[pid]) return
                        this.actions.clickBullet(pid)
                    },
                    setTags: function (id, ids) {
                        this.executeCommands('setTags', [id, ids])
                    },
                    addTag: function (id, contents) {
                        return this.executeCommands('addTag', [contents])[0];
                    },
                }, Controller.prototype.actions)


            }, { "../../lib/controller": 5, "../../lib/util": 21, "./commands": 28, "./node": 32, "./view": 34, "./vl": 35 }], 30: [function (_dereq_, module, exports) {

                module.exports = {
                    Controller: _dereq_('./controller'),
                    Model: _dereq_('./model'),
                    Node: _dereq_('./node'),
                    View: _dereq_('./view'),
                    ViewLayer: _dereq_('./vl'),
                }


            }, { "./controller": 29, "./model": 31, "./node": 32, "./view": 34, "./vl": 35 }], 31: [function (_dereq_, module, exports) {

                var Model = _dereq_('../../lib/model')

                module.exports = WFModel

                function WFModel() {
                    Model.apply(this, arguments)
                }

                WFModel.prototype = Object.create(Model.prototype)

                WFModel.prototype.actions = {
                    resolveTags: function (tags) {
                        if (!tags) return []
                        return tags.map(function (id) {
                            return this.ids[id]
                        }.bind(this))
                    },
                    getAllTags: function () {
                        var tags = []
                        for (var id in this.ids) {
                            tags.push(this.ids[id])
                        }
                        // todo sort by number of references
                        return tags
                    }
                }

                WFModel.prototype.hasTagRoot = function () {
                    return !!this.rootNode.tagRoot
                }

                WFModel.prototype.addTagRoot = function () {
                    var index = this.ids[this.root].children ? this.ids[this.root].children.length : 0
                    var cr = model.create(this.root, index, 'Tags')
                    this.rootNode.tagRoot = cr.node.id
                    this.db.update('root', this.root, { tagRoot: cr.node.id })
                    return cr
                }

                WFModel.prototype.addTag = function (name) {
                    var tagRoot = this.rootNode.tagRoot
                    var index = this.ids[tagRoot].children ? this.ids[tagRoot].children.length : 0
                    var cr = model.create(tagRoot, index, name)
                    return cr
                }

                WFModel.prototype.readd = function (saved) {
                    this.ids[saved.id] = saved.node
                    var children = this.ids[saved.node.parent].children
                    children.splice(saved.ix, 0, saved.id)
                    var before = false
                    if (saved.ix < children.length - 1) {
                        before = children[saved.ix + 1]
                    }

                    var upRefs = {}
                    var upTags = {}
                    var ids = this.ids

                    function process(node) {
                        for (var i = 0; i < node.children.length; i++) {
                            process(ids[node.children[i]])
                        }

                        if (node.meta.tags) {
                            node.meta.tags.forEach(function (id) {
                                var refs = ids[id].meta.references
                                if (!refs) {
                                    refs = ids[id].meta.references = []
                                }
                                if (refs.indexOf(node.id) !== -1) return console.warn('duplicate ref on readd')
                                refs.push(node.id)
                                upRefs[id] = true
                            })
                        }

                        if (node.meta.references) {
                            node.meta.references.forEach(function (id) {
                                ids[id].meta.tags.push(node.id)
                                var tags = ids[id].meta.tags
                                if (!tags) {
                                    tags = ids[id].meta.tags = []
                                }
                                if (tags.indexOf(node.id) !== -1) return console.warn('duplicate tag on readd')
                                tags.push(node.id)
                                upTags[id] = true
                            })
                        }
                    }

                    process(this.ids[saved.id])

                    this.db.save('node', saved.node.id, saved.node)
                    this.db.update('node', saved.node.parent, { children: children })

                    for (id in upTags) {
                        this.db.update('node', id, { tags: this.ids[id].tags })
                    }

                    for (id in upRefs) {
                        this.db.update('node', id, { references: this.ids[id].references })
                    }

                    return before
                }

                WFModel.prototype.dumpData = function (id, noids) {
                    var data = Model.prototype.dumpData.call(this, id, noids)
                    if (!noids) return data
                    delete data.meta.references
                    delete data.meta.tags
                    return data
                }

                WFModel.prototype.remove = function (id) {
                    // remove the references and tags

                    if (id === this.root) return
                    var n = this.ids[id]
                      , p = this.ids[n.parent]
                      , ix = p.children.indexOf(id)

                    var upRefs = {}
                    var upTags = {}
                    var ids = this.ids
                    var removed = []

                    function process(node) {
                        if (node.meta.tags) {
                            node.meta.tags.forEach(function (id) {
                                var refs = ids[id].meta.references
                                upRefs[id] = true
                                refs.splice(refs.indexOf(node.id), 1)
                            })
                        }

                        if (node.meta.references) {
                            node.meta.references.forEach(function (id) {
                                var tags = ids[id].meta.tags
                                upTags[id] = true
                                tags.splice(tags.indexOf(node.id), 1)
                            })
                        }
                        for (var i = 0; i < node.children.length; i++) {
                            process(ids[node.children[i]])
                        }

                        delete ids[node.id]
                        removed.push(node.id)
                    }

                    process(n)

                    p.children.splice(ix, 1)
                    delete this.ids[id]

                    setTimeout(function () {
                        this.db.removeBatch('node', removed)
                        this.db.update('node', n.parent, { children: p.children })


                        if (id === this.rootNode.tagRoot) {
                            delete this.rootNode.tagRoot
                            this.db.update('root', this.root, { tagRoot: null })
                        }

                        for (id in upTags) {
                            if (this.ids[id]) {
                                this.db.update('node', id, { tags: this.ids[id].meta.tags })
                            }
                        }

                        for (id in upRefs) {
                            if (this.ids[id]) {
                                this.db.update('node', id, { references: this.ids[id].meta.references })
                            }
                        }
                    }.bind(this))

                    return { id: id, node: n, ix: ix }
                }

                // TODO should I make references be a dict instead?
                WFModel.prototype.setTags = function (id, tags) {
                    var old = this.ids[id].meta.tags
                    var used = {}
                    if (old) old = old.slice()

                    // add references
                    if (tags) {
                        for (var i = 0; i < tags.length; i++) {
                            used[tags[i]] = true
                            var refs = this.ids[tags[i]].meta.references
                            if (!refs) {
                                refs = this.ids[tags[i]].meta.references = []
                            }
                            if (refs.indexOf(id) === -1) {
                                refs.push(id)
                            }
                        }
                    }

                    // remove old references that were removed
                    if (old) {
                        for (var i = 0; i < old.length; i++) {
                            if (used[old[i]]) continue;
                            var refs = this.ids[old[i]].meta.references
                            refs.splice(refs.indexOf(id), 1)
                            used[old[i]] = true
                        }
                    }

                    this.ids[id].meta.tags = tags
                    // update things
                    this.db.update(id, { meta: this.ids[id].meta })
                    for (var oid in used) {
                        this.db.update(oid, { meta: this.ids[oid].meta })
                    }
                    return old
                }

                WFModel.prototype.getLineage = function (id) {
                    var lineage = []
                    while (this.ids[id]) {
                        lineage.unshift({
                            content: this.ids[id].content,
                            id: id
                        })
                        id = this.ids[id].parent
                    }
                    return lineage
                }

                WFModel.prototype.search = function (text) {
                    var items = []
                      , frontier = [this.root]
                    text = text.toLowerCase()
                    while (frontier.length) {
                        var next = []
                        for (var i = 0; i < frontier.length; i++) {
                            var content = this.ids[frontier[i]].content
                            if (content && content.toLowerCase().indexOf(text) !== -1) {
                                items.push({ id: frontier[i], text: this.ids[frontier[i]].content })
                            }
                            var children = this.ids[frontier[i]].children
                            if (children) {
                                next = next.concat(children)
                            }
                        }
                        frontier = next
                    }
                    return items
                }


            }, { "../../lib/model": 14 }], 32: [function (_dereq_, module, exports) {

                var DefaultNode = _dereq_('../../lib/default-node')
                var Tags = _dereq_('./tags')

                module.exports = WFNode

                function WFNode(content, meta, actions, isNew, modelActions) {
                    DefaultNode.call(this, content, meta, actions, isNew, modelActions)
                    this.done = meta.done
                    this.tags = new Tags(modelActions.resolveTags(meta.tags), actions, modelActions)
                    this.node.appendChild(this.tags.node)
                    if (meta.done) {
                        this.node.classList.add('treed__default-node--done')
                    }
                }

                WFNode.prototype = Object.create(DefaultNode.prototype)
                WFNode.prototype.constructor = WFNode

                WFNode.prototype.setAttr = function (attr, value) {
                    if (attr === 'tags') {
                        return this.setTags(value)
                    }
                    if (attr === 'done') {
                        return this.setDone(value)
                    }
                    DefaultNode.prototype.setAttr.call(this, attr, value)
                }

                WFNode.prototype.addTag = function (node) {
                    this.tags.add(node)
                }

                WFNode.prototype.removeTag = function (tid) {
                    this.tags.removeFull(tid)
                }

                WFNode.prototype.setTags = function (tags) {
                    this.tags.set(this.modelActions.resolveTags(tags))
                }

                WFNode.prototype.setDone = function (isDone) {
                    this.done = isDone
                    if (isDone) {
                        this.node.classList.add('treed__default-node--done')
                    } else {
                        this.node.classList.remove('treed__default-node--done')
                    }
                }

                WFNode.prototype.extra_actions = {
                    'rebase': {
                        binding: 'alt+return',
                        action: function () {
                            this.o.clickBullet()
                        }
                    },
                    'back a level': {
                        binding: 'shift+alt+return',
                        action: function () {
                            this.o.backALevel()
                        }
                    },
                    'toggle done': {
                        binding: 'ctrl+return',
                        action: function () {
                            this.blur()
                            this.o.changed('done', !this.done)
                            this.focus()
                            if (this.done) {
                                this.o.goDown()
                            }
                        }
                    }
                }


            }, { "../../lib/default-node": 7, "./tags": 33 }], 33: [function (_dereq_, module, exports) {

                module.exports = Tags

                function Tags(tags, actions, modelactions) {
                    this.actions = actions
                    this.modelactions = modelactions
                    this.setupNode()
                    this.set(tags)
                }

                Tags.prototype = {
                    setupNode: function () {
                        this.node = document.createElement('div')
                        this.node.className = 'treed_tags'

                        this.handle = document.createElement('div')
                        this.handle.className = 'treed_tags_handle'
                        this.handle.addEventListener('click', this.startEditing.bind(this))
                        this.handle.innerHTML = '<i class="fa fa-tag"/>'

                        this.tags = document.createElement('div')
                        this.tags.className = 'treed_tags_list'

                        this.editor = document.createElement('div')
                        this.editor.className = 'treed_tags_editor'

                        this.input = document.createElement('input')
                        this.input.className = 'treed_tags_input'

                        this.input.addEventListener('keydown', this.keyDown.bind(this))
                        this.input.addEventListener('keyup', this.keyUp.bind(this))
                        this.input.addEventListener('blur', this.onBlur.bind(this))

                        this.resultsNode = document.createElement('ul')
                        this.resultsNode.className = 'treed_tags_results'
                        this.tags.addEventListener('mousedown', function (e) { e.preventDefault() })
                        this.resultsNode.addEventListener('mousedown', function (e) { e.preventDefault() })

                        this.newNode = document.createElement('div')
                        this.newNode.className = 'treed_tags_new'
                        this.newNode.addEventListener('mousedown', function (e) { e.preventDefault() })
                        this.newNode.addEventListener('click', this.onNew.bind(this))
                        this.newNode.innerText = 'Create new tag'

                        this.node.appendChild(this.tags)
                        this.node.appendChild(this.handle)
                        this.node.appendChild(this.editor)

                        this.editor.appendChild(this.input)
                        this.editor.appendChild(this.resultsNode)
                        this.editor.appendChild(this.newNode)

                        this.dom = {}
                    },

                    startEditing: function (e) {
                        if (this.editing) return
                        this.actions.setActive()
                        this.editing = true
                        this.node.classList.add('treed_tags--open')
                        this.fullResults = this.modelactions.getAllTags()
                        this.filterBy('')
                        this.selection = 0
                        this.input.value = ''
                        this.input.focus()
                        this.showResults()
                        // todo show everything first? I think I'll wait for first key change
                    },

                    doneEditing: function (e) {
                        if (!this.editing) return
                        this.editing = false
                        this.node.classList.remove('treed_tags--open')
                        this.actions.setTags(this.value.map(function (x) { return x.id }))
                    },

                    onBlur: function () {
                        this.doneEditing()
                    },

                    keys: {
                        27: function (e) { // escape
                            e.preventDefault()
                            this.doneEditing()
                        },
                        9: function (e) { // tab
                            e.preventDefault()
                            this.addCurrent()
                        },
                        13: function (e) { // return
                            e.preventDefault()
                            this.addCurrent()
                            this.doneEditing()
                        },
                        8: function (e) { // backspace
                            if (!this.input.value) {
                                e.preventDefault()
                                this.removeLast()
                            }
                        },
                    },

                    keyDown: function (e) {
                        var action = this.keys[e.keyCode]
                        if (action) return action.call(this, e)
                    },

                    keyUp: function (e) {
                        this.filterBy(this.input.value)
                        this.showResults()
                    },

                    filterBy: function (needle) {
                        var used = {}
                        for (var i = 0; i < this.value.length; i++) {
                            used[this.value[i].id] = true
                        }
                        if (!needle) {
                            this.results = this.fullResults.filter(function (tag) {
                                return !used[tag.id]
                            })
                        } else {
                            needle = needle.toLowerCase()
                            this.results = this.fullResults.filter(function (tag) {
                                return !used[tag.id] && tag.content.toLowerCase().indexOf(needle) !== -1
                            })
                        }
                    },

                    showResults: function () {
                        while (this.resultsNode.lastChild) {
                            this.resultsNode.removeChild(this.resultsNode.lastChild)
                        }
                        var num = 5
                        if (num > this.results.length) num = this.results.length
                        var click = function (tag, e) {
                            e.preventDefault()
                            this.addCurrent(tag)
                        }
                        for (var i = 0; i < num; i++) {
                            var node = document.createElement('li')
                            node.innerText = this.results[i].content
                            node.className = 'treed_tags_result'
                            node.addEventListener('click', click.bind(this, this.results[i]))
                            this.resultsNode.appendChild(node)
                        }
                    },

                    onNew: function () {
                        if (!this.input.value.length) return
                        var tag = this.actions.addTag(this.input.value)
                        this.addCurrent(tag)
                    },

                    addCurrent: function (tag) {
                        if (!tag) {
                            if (!this.input.value.length) return
                            if (!this.results.length) {
                                tag = this.actions.addTag(this.input.value)
                            } else {
                                tag = this.results[this.selection]
                            }
                        }
                        if (this.value.indexOf(tag) !== -1) return this.resetSearch()
                        this.value.push(tag)
                        this.add(tag)
                        this.resetSearch()
                    },

                    resetSearch: function () {
                        this.input.value = ''
                        this.filterBy('')
                        this.selection = 0
                        this.showResults()
                    },

                    removeLast: function () {
                        if (!this.value.length) return
                        var last = this.value.pop()
                        this.remove(last.id)
                        this.resetSearch()
                    },

                    remove: function (id) {
                        this.tags.removeChild(this.dom[id])
                        delete this.dom[id]
                    },

                    removeFull: function (id) {
                        for (var i = 0; i < this.value.length; i++) {
                            if (this.value[i].id === id) {
                                this.value.splice(i, 1)
                                this.remove(id)
                                this.resetSearch()
                                return
                            }
                        }
                    },

                    set: function (tags) {
                        this.value = tags || []
                        while (this.tags.lastChild) this.tags.removeChild(this.tags.lastChild)
                        this.dom = {}
                        this.value.map(this.add.bind(this))
                    },

                    add: function (tag) {
                        if (this.dom[tag.id]) return console.warn('tried to add duplicate tag')
                        var node = document.createElement('div')
                        this.dom[tag.id] = node
                        node.className = 'treed_tag'

                        var content = document.createElement('span')
                        content.innerText = tag.content
                        node.appendChild(content)

                        var remove = document.createElement('span')
                        remove.className = 'treed_tag_remove'
                        remove.innerHTML = ' &times;'
                        var rmFunc = this.removeFull.bind(this, tag.id)
                        remove.addEventListener('click', function (e) {
                            e.preventDefault()
                            e.stopPropagation()
                            rmFunc()
                        })

                        node.appendChild(remove)

                        node.addEventListener('click', function (e) {
                            e.preventDefault()
                            e.stopPropagation()
                            if (this.editing) return
                            this.actions.rebase(tag.id)
                        }.bind(this))
                        this.tags.appendChild(node)
                    },
                }


            }, {}], 34: [function (_dereq_, module, exports) {

                var View = _dereq_('../../lib/view')

                module.exports = WFView

                function WFView() {
                    View.apply(this, arguments)
                }

                WFView.prototype = Object.create(View.prototype)

                WFView.prototype.initialize = function (root) {
                    var rootNode = View.prototype.initialize.call(this, root)
                      , node = this.model.ids[root]
                    if (node.meta.references) {
                        this.vl.setReferences(node.meta.references.map(function (id) {
                            return this.model.ids[id]
                        }.bind(this)), this.rebase.bind(this))
                    }
                    return rootNode
                }

                WFView.prototype.addTree = function (node, before) {
                    if (!this.vl.body(node.parent)) {
                        return this.rebase(node.parent, true)
                    }
                    this.add(node, before)

                    if (node.meta.tags) {
                        node.meta.tags.forEach(function (id) {
                            if (id === this.root) {
                                this.vl.addReference(this.model.ids[node.id], this.rebase.bind(this, node.id))
                            }
                        }.bind(this))
                    }

                    if (node.meta.references) {
                        node.meta.references.forEach(function (id) {
                            this.vl.addTag(id, node)
                        }.bind(this))
                    }

                    if (!node.children || !node.children.length) return
                    for (var i = 0; i < node.children.length; i++) {
                        this.addTree(this.model.ids[node.children[i]], false)
                    }
                }

                WFView.prototype.remove = function (id, ignoreActive) {
                    var node = this.model.ids[id]
                      , pid = node.parent
                      , parent = this.model.ids[pid]

                    if (!this.vl.body(id)) {
                        return this.rebase(pid, true)
                    }
                    if (id === this.active && !ignoreActive) {
                        this.setActive(this.root)
                    }

                    this.vl.remove(id, pid, parent && parent.children.length === 1)
                    if (parent.children.length === 1) {
                        if (pid === this.root) {
                            setTimeout(function () {
                                this.addNew(pid, 0)
                            }.bind(this), 0)
                        }
                    }

                    // remove the references and tags

                    var ids = this.model.ids

                    function process(node) {
                        for (var i = 0; i < node.children.length; i++) {
                            process.call(this, ids[node.children[i]])
                        }

                        if (node.meta.references) {
                            node.meta.references.forEach(function (rid) {
                                this.vl.removeTag(rid, node.id)
                            }.bind(this))
                        }

                        if (node.meta.tags) {
                            node.meta.tags.forEach(function (tid) {
                                this.vl.removeReference(tid, node.id)
                            }.bind(this))
                        }
                    }

                    process.call(this, node)
                }

                WFView.prototype.setAttr = function (id, attr, value, quiet) {
                    var res = View.prototype.setAttr.apply(this, arguments)
                    if (attr !== 'references') return res
                    if (id !== this.root) return
                    this.vl.setReferences(value && value.map(function (id) {
                        return this.model.ids[id]
                    }.bind(this)), this.rebase.bind(this))
                    return res
                }

                WFView.prototype.setTags = function (id, tags, oldTags) {
                    var used = {}
                    for (var i = 0; i < tags.length; i++) {
                        used[tags[i]] = true
                    }
                    this.setAttr(id, 'tags', tags)
                    for (var i = 0; i < tags.length; i++) {
                        this.setAttr(tags[i], 'references', this.model.ids[tags[i]].meta.references, true)
                    }
                    if (oldTags) {
                        for (var i = 0; i < oldTags.length; i++) {
                            if (used[oldTags[i]]) continue;
                            this.setAttr(oldTags[i], 'references', this.model.ids[oldTags[i]].meta.references, true)
                        }
                    }
                }

                WFView.prototype.extra_actions = {
                    'edit tags': {
                        binding: 'shift+3',
                        action: function () {
                            this.vl.editTags(this.active)
                        },
                    },
                    'rebase': {
                        binding: 'alt+return',
                        action: function () {
                            this.ctrlactions.clickBullet(this.active)
                        }
                    },
                    'back a level': {
                        binding: 'shift+alt+return',
                        action: function () {
                            this.ctrlactions.backALevel()
                        }
                    },

                    'toggle done': {
                        binding: 'ctrl+return',
                        action: function () {
                            if (this.active === null) return
                            var id = this.active
                              , done = !this.model.ids[id].meta.done
                              , next = this.model.idBelow(id, this.root)
                            if (next === undefined) next = id
                            this.ctrlactions.changed(this.active, 'done', done)
                            if (done) {
                                this.goTo(next)
                            }
                        }
                    }
                }


            }, { "../../lib/view": 23 }], 35: [function (_dereq_, module, exports) {

                var DomViewLayer = _dereq_('../../lib/dom-vl')

                module.exports = WFVL

                function WFVL() {
                    DomViewLayer.apply(this, arguments)
                }

                WFVL.prototype = Object.create(DomViewLayer.prototype)

                WFVL.prototype.removeTag = function (id, tid) {
                    var body = this.body(id)
                    if (!body) return
                    body.removeTag(tid)
                }

                WFVL.prototype.addTag = function (id, node) {
                    var body = this.body(id)
                    if (!body) return
                    body.addTag(node)
                }

                WFVL.prototype.editTags = function (id) {
                    this.body(id).tags.startEditing()
                }

                WFVL.prototype.makeHead = function (body, actions) {
                    var head = DomViewLayer.prototype.makeHead.call(this, body, actions)
                      , bullet = document.createElement('div')
                    bullet.classList.add('treed__bullet')
                    bullet.addEventListener('mousedown', actions.clickBullet)
                    head.insertBefore(bullet, head.childNodes[1])
                    return head
                }

                WFVL.prototype.makeRoot = function (node, bounds, modelActions) {
                    var root = DomViewLayer.prototype.makeRoot.call(this, node, bounds, modelActions)
                    var refContainer = document.createElement('div')
                    refContainer.className = 'treed_references'
                    refContainer.innerHTML = '<h1 class="treed_references_title">References</h1>'
                    this.references = document.createElement('div')
                    this.references.className = 'treed_references_list'
                    this.rfs = {}
                    refContainer.appendChild(this.references)
                    root.appendChild(refContainer)
                    this.refContainer = refContainer
                    return root
                }

                WFVL.prototype.setReferences = function (nodes, action) {
                    this.clearReferences()
                    if (!nodes || !nodes.length) {
                        this.refContainer.classList.remove('treed_references--shown')
                        return
                    }
                    this.refContainer.classList.add('treed_references--shown')
                    nodes.forEach(function (node) {
                        this.addReference(node, action.bind(null, node.id))
                    }.bind(this))
                }

                WFVL.prototype.clearReferences = function () {
                    while (this.references.lastChild) {
                        this.references.removeChild(this.references.lastChild)
                    }
                    this.rfs = {}
                }

                WFVL.prototype.addReference = function (node, action) {
                    this.refContainer.classList.add('treed_references--shown')
                    var div = document.createElement('div')
                    div.className = 'treed_reference'
                    div.innerHTML = marked(node.content)
                    div.addEventListener('click', action)
                    this.rfs[node.id] = div
                    this.references.appendChild(div)
                }

                WFVL.prototype.removeReference = function (id, rid) {
                    // TODO fill this in
                }


            }, { "../../lib/dom-vl": 9 }]
        }, {}, [1])
        //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3IvbG9jYWwvbGliL25vZGVfbW9kdWxlcy93YXRjaGlmeS9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwiL1VzZXJzL2toYW5pbnRlcm4xL2Nsb25lL3RyZWVkL2RlbW8vdHBsL2RlbW8uanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL2Jhc2Utbm9kZS5qcyIsIi9Vc2Vycy9raGFuaW50ZXJuMS9jbG9uZS90cmVlZC9saWIvY29tbWFuZGVnZXIuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL2NvbW1hbmRzLmpzIiwiL1VzZXJzL2toYW5pbnRlcm4xL2Nsb25lL3RyZWVkL2xpYi9jb250cm9sbGVyLmpzIiwiL1VzZXJzL2toYW5pbnRlcm4xL2Nsb25lL3RyZWVkL2xpYi9kZWZhdWx0LWtleXMuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL2RlZmF1bHQtbm9kZS5qcyIsIi9Vc2Vycy9raGFuaW50ZXJuMS9jbG9uZS90cmVlZC9saWIvZG5kLmpzIiwiL1VzZXJzL2toYW5pbnRlcm4xL2Nsb25lL3RyZWVkL2xpYi9kb20tdmwuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL2Ryb3Atc2hhZG93LmpzIiwiL1VzZXJzL2toYW5pbnRlcm4xL2Nsb25lL3RyZWVkL2xpYi9pbmRleC5qcyIsIi9Vc2Vycy9raGFuaW50ZXJuMS9jbG9uZS90cmVlZC9saWIva2V5LWhhbmRsZXIuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL2tleXMuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL21vZGVsLmpzIiwiL1VzZXJzL2toYW5pbnRlcm4xL2Nsb25lL3RyZWVkL2xpYi9ub3JtYWwtYWN0aW9ucy5qcyIsIi9Vc2Vycy9raGFuaW50ZXJuMS9jbG9uZS90cmVlZC9saWIvcGwvYmFzZS5qcyIsIi9Vc2Vycy9raGFuaW50ZXJuMS9jbG9uZS90cmVlZC9saWIvcGwvZmlyZWJhc2UuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL3BsL21lbS5qcyIsIi9Vc2Vycy9raGFuaW50ZXJuMS9jbG9uZS90cmVlZC9saWIvc2xpZGUtZG93bi5qcyIsIi9Vc2Vycy9raGFuaW50ZXJuMS9jbG9uZS90cmVlZC9saWIvc2xpZGUtdXAuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL3V0aWwuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL3V1aWQuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL3ZpZXcuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvbGliL3Zpc3VhbC1hY3Rpb25zLmpzIiwiL1VzZXJzL2toYW5pbnRlcm4xL2Nsb25lL3RyZWVkL3NraW5zL3doaXRlYm9hcmQvYmxvY2suanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvc2tpbnMvd2hpdGVib2FyZC9pbmRleC5qcyIsIi9Vc2Vycy9raGFuaW50ZXJuMS9jbG9uZS90cmVlZC9za2lucy93aGl0ZWJvYXJkL3ZpZXcuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvc2tpbnMvd29ya2Zsb3d5L2NvbW1hbmRzLmpzIiwiL1VzZXJzL2toYW5pbnRlcm4xL2Nsb25lL3RyZWVkL3NraW5zL3dvcmtmbG93eS9jb250cm9sbGVyLmpzIiwiL1VzZXJzL2toYW5pbnRlcm4xL2Nsb25lL3RyZWVkL3NraW5zL3dvcmtmbG93eS9pbmRleC5qcyIsIi9Vc2Vycy9raGFuaW50ZXJuMS9jbG9uZS90cmVlZC9za2lucy93b3JrZmxvd3kvbW9kZWwuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvc2tpbnMvd29ya2Zsb3d5L25vZGUuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvc2tpbnMvd29ya2Zsb3d5L3RhZ3MuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvc2tpbnMvd29ya2Zsb3d5L3ZpZXcuanMiLCIvVXNlcnMva2hhbmludGVybjEvY2xvbmUvdHJlZWQvc2tpbnMvd29ya2Zsb3d5L3ZsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDek5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDelNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0VkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM2NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdnRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5T0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxudmFyIG5tID0gcmVxdWlyZSgnLi4vLi4vbGliJylcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHJ1bjogcnVuRGVtbyxcbiAgcHJlbG9hZDogcHJlbG9hZCxcbiAgc2tpbnM6IHtcbiAgICB3ZjogcmVxdWlyZSgnLi4vLi4vc2tpbnMvd29ya2Zsb3d5JyksXG4gICAgd2I6IHJlcXVpcmUoJy4uLy4uL3NraW5zL3doaXRlYm9hcmQnKVxuICB9LFxuICBwbDoge1xuICAgIE1lbTogcmVxdWlyZSgnLi4vLi4vbGliL3BsL21lbScpLFxuICAgIEZpcmViYXNlOiByZXF1aXJlKCcuLi8uLi9saWIvcGwvZmlyZWJhc2UnKVxuICB9XG59XG5cbmZ1bmN0aW9uIG1lcmdlKGEsIGIpIHtcbiAgZm9yICh2YXIgYyBpbiBiKSB7XG4gICAgYVtjXSA9IGJbY11cbiAgfVxuICByZXR1cm4gYVxufVxuXG5mdW5jdGlvbiBwcmVsb2FkKHNjcmlwdHMsIGNiKSB7XG4gIHZhciB3YWl0aW5nID0gMFxuICBzY3JpcHRzLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHtcbiAgICB3YWl0aW5nICs9IDFcbiAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpXG4gICAgbm9kZS5zcmMgPSBuYW1lXG4gICAgdmFyIGRvbmUgPSBmYWxzZVxuICAgIG5vZGUub25sb2FkID0gbm9kZS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoZG9uZSB8fCAodGhpcy5yZWFkeVN0YXRlICYmIHRoaXMucmVhZHlTdGF0ZSAhPT0gJ2xvYWRlZCcgJiYgdGhpcy5yZWFkeVN0YXRlICE9PSAnY29tcGxldGUnKSkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgIGRvbmUgPSB0cnVlXG4gICAgICBub2RlLm9ubG9hZCA9IG5vZGUub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbFxuICAgICAgd2FpdGluZyAtPSAxXG4gICAgICBpZiAoIXdhaXRpbmcpIHtcbiAgICAgICAgY2IoKVxuICAgICAgfVxuICAgIH1cbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG5vZGUpXG4gIH0pXG59XG5cbmZ1bmN0aW9uIHJ1bkRlbW8ob3B0aW9ucywgZG9uZSkge1xuICB2YXIgbyA9IG1lcmdlKHtcbiAgICBub1RpdGxlOiBmYWxzZSxcbiAgICB0aXRsZTogJ1RyZWVkIEV4YW1wbGUnLFxuICAgIGVsOiAnZXhhbXBsZScsXG4gICAgTW9kZWw6IG5tLk1vZGVsLFxuICAgIENvbnRyb2xsZXI6IG5tLkNvbnRyb2xsZXIsXG4gICAgVmlldzogbm0uVmlldyxcbiAgICB2aWV3T3B0aW9uczoge1xuICAgICAgVmlld0xheWVyOiBubS5WaWV3TGF5ZXIsXG4gICAgICBOb2RlOiBubS5Ob2RlXG4gICAgfSxcbiAgICBzdHlsZTogW10sXG4gICAgZGF0YTogZGVtb0RhdGEsXG4gICAgY3RybE9wdGlvbnM6IHt9LFxuICAgIGluaXREQjogZnVuY3Rpb24gKCkge30sXG4gIH0sIG9wdGlvbnMpXG5cbiAgaWYgKCFvLm5vVGl0bGUpIHtcbiAgICBkb2N1bWVudC50aXRsZSA9IG8udGl0bGVcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGUnKS50ZXh0Q29udGVudCA9IG8udGl0bGVcbiAgfVxuXG4gIG8uc3R5bGUuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkge1xuICAgIHZhciBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTtcbiAgICBzdHlsZS5yZWwgPSAnc3R5bGVzaGVldCdcbiAgICBzdHlsZS5ocmVmID0gbmFtZVxuICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuICB9KTtcblxuICB2YXIgZGIgPSBvLnBsIHx8IG5ldyBtb2R1bGUuZXhwb3J0cy5wbC5NZW0oe30pO1xuXG4gIGRiLmluaXQoZnVuY3Rpb24gKGVycikge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBsb2FkRmFpbGVkKGVycik7XG4gICAgfVxuXG4gICAgaW5pdERCKGRiLCBmdW5jdGlvbiAoZXJyLCByb290LCBtYXAsIHdhc0VtcHR5KSB7XG5cbiAgICAgIHdpbmRvdy5tb2RlbCA9IG5ldyBvLk1vZGVsKHJvb3QsIG1hcCwgZGIpXG4gICAgICB3aW5kb3cuY3RybCA9IHdpbmRvdy5jb250cm9sbGVyID0gbmV3IG8uQ29udHJvbGxlcihtb2RlbCwgby5jdHJsT3B0aW9ucylcbiAgICAgIHdpbmRvdy52aWV3ID0gd2luZG93LnZpZXcgPSBjdHJsLnNldFZpZXcoXG4gICAgICAgIG8uVmlldyxcbiAgICAgICAgby52aWV3T3B0aW9uc1xuICAgICAgKTtcbiAgICAgIGlmICh3YXNFbXB0eSkge1xuICAgICAgICBmb3IgKHZhciBpPTA7aTxvLmRhdGEuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjdHJsLmltcG9ydERhdGEoby5kYXRhLmNoaWxkcmVuW2ldLCByb290LmlkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5pbml0REIpIG9wdGlvbnMuaW5pdERCKHdpbmRvdy5tb2RlbClcbiAgICAgICAgd2luZG93LnZpZXcucmViYXNlKHJvb3QuaWQpO1xuICAgICAgfVxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoby5lbCkuYXBwZW5kQ2hpbGQodmlldy5nZXROb2RlKCkpO1xuXG4gICAgICBkb25lICYmIGRvbmUod2luZG93Lm1vZGVsLCB3aW5kb3cuY3RybCwgd2luZG93LnZpZXcsIGRiKVxuXG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBpbml0REIoZGIsIGRvbmUpIHtcbiAgZGIuZmluZEFsbCgncm9vdCcsIGZ1bmN0aW9uIChlcnIsIHJvb3RzKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGRvbmUoZXJyKVxuXG4gICAgaWYgKCFyb290cy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBsb2FkRGVmYXVsdChkYiwgZG9uZSlcbiAgICB9XG5cbiAgICBkYi5maW5kQWxsKCdub2RlJywgZnVuY3Rpb24gKGVyciwgbm9kZXMpIHtcbiAgICAgIGlmIChlcnIpIHJldHVybiBkb25lKG5ldyBFcnJvcignRmFpbGVkIHRvIGxvYWQgaXRlbXMnKSlcbiAgICAgIGlmICghbm9kZXMubGVuZ3RoKSByZXR1cm4gZG9uZShuZXcgRXJyb3IoXCJEYXRhIGNvcnJ1cHRlZCAtIGNvdWxkIG5vdCBmaW5kIHJvb3Qgbm9kZVwiKSlcblxuICAgICAgdmFyIG1hcCA9IHt9XG4gICAgICBmb3IgKHZhciBpPTA7IGk8bm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbWFwW25vZGVzW2ldLmlkXSA9IG5vZGVzW2ldXG4gICAgICB9XG4gICAgICBkb25lKG51bGwsIHJvb3RzWzBdLCBtYXAsIGZhbHNlKVxuICAgIH0pXG4gIH0pXG59XG5cbmZ1bmN0aW9uIGxvYWREZWZhdWx0KGRiLCBkb25lKSB7XG4gIHZhciBST09UX0lEID0gNTBcblxuICAvLyBsb2FkIGRlZmF1bHRcbiAgZGIuc2F2ZSgncm9vdCcsIFJPT1RfSUQsIHtpZDogUk9PVF9JRH0sIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbWFwID0ge31cbiAgICBtYXBbUk9PVF9JRF0gPSB7XG4gICAgICBpZDogUk9PVF9JRCxcbiAgICAgIGNoaWxkcmVuOiBbXSxcbiAgICAgIGNvbGxhcHNlZDogZmFsc2UsXG4gICAgICBjb250ZW50OiBcIkhvbWVcIixcbiAgICAgIG1ldGE6IHt9LFxuICAgICAgZGVwdGg6IDBcbiAgICB9XG5cbiAgICBkYi5zYXZlKCdub2RlJywgUk9PVF9JRCwgbWFwW1JPT1RfSURdLCBmdW5jdGlvbiAoKSB7XG4gICAgICBkb25lKG51bGwsIHtpZDogUk9PVF9JRH0sIG1hcCwgdHJ1ZSlcbiAgICB9KVxuICB9KVxufVxuXG4iLCJcbm1vZHVsZS5leHBvcnRzID0gQmFzZU5vZGVcblxudmFyIGtleXMgPSByZXF1aXJlKCcuL2tleXMnKVxuICAsIHV0aWwgPSByZXF1aXJlKCcuL3V0aWwnKVxuXG5mdW5jdGlvbiBCYXNlTm9kZShjb250ZW50LCBtZXRhLCBvcHRpb25zLCBpc05ldywgbW9kZWxBY3Rpb25zKSB7XG4gIHRoaXMuY29udGVudCA9IGNvbnRlbnQgfHwgJydcbiAgdGhpcy5pc05ldyA9IGlzTmV3XG4gIHRoaXMubW9kZWxBY3Rpb25zID0gbW9kZWxBY3Rpb25zXG4gIHRoaXMubyA9IG9wdGlvbnNcbiAgdGhpcy5vLmtleWJpbmRpbmdzID0gdXRpbC5tZXJnZSh0aGlzLmRlZmF1bHRfa2V5cywgb3B0aW9ucy5rZXlzKVxuXG4gIHRoaXMuZWRpdGluZyA9IGZhbHNlXG4gIHRoaXMuc2V0dXBOb2RlKCk7XG59XG5cbkJhc2VOb2RlLmFkZEFjdGlvbiA9IGZ1bmN0aW9uIChhY3Rpb24sIGJpbmRpbmcsIGZ1bmMpIHtcbiAgaWYgKCF0aGlzLmV4dHJhX2FjdGlvbnMpIHtcbiAgICB0aGlzLmV4dHJhX2FjdGlvbnMgPSB7fVxuICB9XG4gIHRoaXMuZXh0cmFfYWN0aW9uc1thY3Rpb25dID0ge1xuICAgIGJpbmRpbmc6IGJpbmRpbmcsXG4gICAgZnVuYzogZnVuY1xuICB9XG59XG5cbkJhc2VOb2RlLnByb3RvdHlwZSA9IHtcbiAgLy8gcHVibGljXG4gIHN0YXJ0RWRpdGluZzogZnVuY3Rpb24gKGZyb21TdGFydCkge1xuICB9LFxuXG4gIHN0b3BFZGl0aW5nOiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgYWRkRWRpdFRleHQ6IGZ1bmN0aW9uICh0ZXh0KSB7XG4gIH0sXG5cbiAgc2V0TWV0YTogZnVuY3Rpb24gKG1ldGEpIHtcbiAgfSxcblxuICBzZXRBdHRyOiBmdW5jdGlvbiAoYXR0ciwgdmFsdWUpIHtcbiAgfSxcblxuICAvLyBwcm90ZXh0ZWRcbiAgaXNBdFN0YXJ0OiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgaXNBdEVuZDogZnVuY3Rpb24gKCkge1xuICB9LFxuXG4gIGlzQXRCb3R0b206IGZ1bmN0aW9uICgpIHtcbiAgfSxcblxuICBpc0F0VG9wOiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgc2V0dXBOb2RlOiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgc2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gIH0sXG5cbiAgZ2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gKCkge1xuICB9LFxuXG4gIHNldFRleHRDb250ZW50OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgfSxcblxuICBnZXRTZWxlY3Rpb25Qb3NpdGlvbjogZnVuY3Rpb24gKCkge1xuICB9LFxuXG4gIC8vIFNob3VsZCB0aGVyZSBiZSBhIGNhblN0b3BFZGl0aW5nP1xuICBmb2N1czogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc3RhcnRFZGl0aW5nKCk7XG4gIH0sXG5cbiAgYmx1cjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc3RvcEVkaXRpbmcoKTtcbiAgfSxcblxuICBrZXlIYW5kbGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGFjdGlvbnMgPSB7fVxuICAgICAgLCBhY3Rpb25cbiAgICBmb3IgKGFjdGlvbiBpbiB0aGlzLm8ua2V5YmluZGluZ3MpIHtcbiAgICAgIGFjdGlvbnNbdGhpcy5vLmtleWJpbmRpbmdzW2FjdGlvbl1dID0gdGhpcy5hY3Rpb25zW2FjdGlvbl1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5leHRyYV9hY3Rpb25zKSB7XG4gICAgICBmb3IgKGFjdGlvbiBpbiB0aGlzLmV4dHJhX2FjdGlvbnMpIHtcbiAgICAgICAgaWYgKCFhY3Rpb25zW2FjdGlvbl0pIHtcbiAgICAgICAgICBhY3Rpb25zW3RoaXMuZXh0cmFfYWN0aW9uc1thY3Rpb25dLmJpbmRpbmddID0gdGhpcy5leHRyYV9hY3Rpb25zW2FjdGlvbl0uYWN0aW9uXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ga2V5cyhhY3Rpb25zKS5iaW5kKHRoaXMpXG4gIH0sXG5cbiAgZGVmYXVsdF9rZXlzOiB7XG4gICAgJ3VuZG8nOiAnY3RybCt6JyxcbiAgICAncmVkbyc6ICdjdHJsK3NoaWZ0K3onLFxuICAgICdjb2xsYXBzZSc6ICdhbHQrbGVmdCcsXG4gICAgJ3VuY29sbGFwc2UnOiAnYWx0K3JpZ2h0JyxcbiAgICAnZGVkZW50JzogJ3NoaWZ0K3RhYiwgc2hpZnQrYWx0K2xlZnQnLFxuICAgICdpbmRlbnQnOiAndGFiLCBzaGlmdCthbHQrcmlnaHQnLFxuICAgICdtb3ZlIHVwJzogJ3NoaWZ0K2FsdCt1cCcsXG4gICAgJ21vdmUgZG93bic6ICdzaGlmdCthbHQrZG93bicsXG4gICAgJ3VwJzogJ3VwJyxcbiAgICAnZG93bic6ICdkb3duJyxcbiAgICAnbGVmdCc6ICdsZWZ0JyxcbiAgICAncmlnaHQnOiAncmlnaHQnLFxuICAgICdhZGQgYWZ0ZXInOiAncmV0dXJuJyxcbiAgICAnaW5zZXJ0IHJldHVybic6ICdzaGlmdCtyZXR1cm4nLFxuICAgICdtZXJnZSB1cCc6ICdiYWNrc3BhY2UnLFxuICAgICdzdG9wIGVkaXRpbmcnOiAnZXNjYXBlJyxcbiAgfSxcblxuICBhY3Rpb25zOiB7XG4gICAgJ3VuZG8nOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm8udW5kbygpXG4gICAgfSxcblxuICAgICdyZWRvJzogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5vLnJlZG8oKVxuICAgIH0sXG5cbiAgICAnY29sbGFwc2UnOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm8udG9nZ2xlQ29sbGFwc2UodHJ1ZSlcbiAgICB9LFxuXG4gICAgJ3VuY29sbGFwc2UnOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm8udG9nZ2xlQ29sbGFwc2UoZmFsc2UpXG4gICAgfSxcblxuICAgICdkZWRlbnQnOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm8ubW92ZUxlZnQoKVxuICAgIH0sXG5cbiAgICAnaW5kZW50JzogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5vLm1vdmVSaWdodCgpXG4gICAgfSxcblxuICAgICdtb3ZlIHVwJzogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5vLm1vdmVVcCgpXG4gICAgfSxcblxuICAgICdtb3ZlIGRvd24nOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm8ubW92ZURvd24oKVxuICAgIH0sXG5cbiAgICAndXAnOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5pc0F0VG9wKCkpIHtcbiAgICAgICAgdGhpcy5vLmdvVXAoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgfSxcblxuICAgICdkb3duJzogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuaXNBdEJvdHRvbSgpKSB7XG4gICAgICAgIHRoaXMuby5nb0Rvd24oKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgJ2xlZnQnOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5pc0F0U3RhcnQoKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5vLmdvVXAoKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9LFxuXG4gICAgJ3JpZ2h0JzogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuaXNBdEVuZCgpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm8uZ29Eb3duKHRydWUpXG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG5cbiAgICAnaW5zZXJ0IHJldHVybic6IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG5cbiAgICAnYWRkIGFmdGVyJzogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHNzID0gdGhpcy5nZXRTZWxlY3Rpb25Qb3NpdGlvbigpXG4gICAgICAgICwgY29udGVudCA9IHRoaXMuZ2V0VmlzaWJsZVZhbHVlKClcbiAgICAgICAgLCByZXN0ID0gbnVsbFxuICAgICAgaWYgKHRoaXMuaXNNdWx0aUxpbmUoKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgICAgdmFyIHJlc3QgPSB0aGlzLnNwbGl0UmlnaHRPZkN1cnNvcigpXG4gICAgICBpZiAoIXRoaXMuaXNOZXcpIHtcbiAgICAgICAgdGhpcy5zdG9wRWRpdGluZygpXG4gICAgICB9XG4gICAgICB0aGlzLm8uYWRkQWZ0ZXIocmVzdCwgdHJ1ZSlcbiAgICB9LFxuXG4gICAgLy8gb24gYmFja3NwYWNlXG4gICAgJ21lcmdlIHVwJzogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKClcbiAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuby5yZW1vdmUoKVxuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLmlzTXVsdGlMaW5lKCkgJiYgdGhpcy5pc0F0U3RhcnQoKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5vLnJlbW92ZSh2YWx1ZSlcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSxcblxuICAgICdzdG9wIGVkaXRpbmcnOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnN0b3BFZGl0aW5nKCk7XG4gICAgfVxuICB9LFxufVxuXG4iLCJcbnZhciBjb21tYW5kcyA9IHJlcXVpcmUoJy4vY29tbWFuZHMnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IENvbW1hbmRlZ2VyXG5cbmZ1bmN0aW9uIG1ha2VDb21tYW5kKHR5cGUsIGFyZ3MsIGNvbW1hbmRzKSB7XG4gIHZhciBuYW1lcyA9IGNvbW1hbmRzW3R5cGVdLmFyZ3NcbiAgICAsIGRhdGEgPSB7fVxuICBmb3IgKHZhciBpPTA7IGk8bmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICBkYXRhW25hbWVzW2ldXSA9IGFyZ3NbaV1cbiAgfVxuICByZXR1cm4ge3R5cGU6IHR5cGUsIGRhdGE6IGRhdGF9XG59XG5cbi8qKlxuICogTWFuYWdlcyB0aGUgZXhlY3V0aW9uIG9mIGNvbW1hbmRzLlxuICovXG5mdW5jdGlvbiBDb21tYW5kZWdlcihtb2RlbCwgZXh0cmFfY29tbWFuZHMpIHtcbiAgdGhpcy5oaXN0b3J5ID0gW11cbiAgdGhpcy5oaXN0cG9zID0gMFxuICB0aGlzLnZpZXcgPSBudWxsXG4gIHRoaXMubGlzdGVuZXJzID0ge31cbiAgdGhpcy53b3JraW5nID0gZmFsc2VcbiAgdGhpcy5tb2RlbCA9IG1vZGVsXG4gIHRoaXMuY29tbWFuZHMgPSBjb21tYW5kc1xuICBpZiAoZXh0cmFfY29tbWFuZHMpIHtcbiAgICBmb3IgKHZhciBuYW1lIGluIGV4dHJhX2NvbW1hbmRzKSB7XG4gICAgICB0aGlzLmNvbW1hbmRzW25hbWVdID0gZXh0cmFfY29tbWFuZHNbbmFtZV1cbiAgICB9XG4gIH1cbn1cblxuQ29tbWFuZGVnZXIucHJvdG90eXBlID0ge1xuICAvKipcbiAgICogRXhlY3V0ZSBvbmUgb3IgbW9yZSBjb21tZW50cy5cbiAgICpcbiAgICogVXNhZ2U6XG4gICAqXG4gICAqIC0gZXhlY3V0ZUNvbW1hbmRzKCdjbWR0eXBlJywgW2FyZ3MsIGV0Y10pXG4gICAqIC0gZXhlY3V0ZUNvbW1hbmRzKCdjbWR0eXBlJywgW2FyZ3MsIGV0Y10sICdub3RoZXInLCBbbW9yZSwgYXJnc10pXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIHRoZSBjb21tYW5kIHRvIGV4ZWN1dGVcbiAgICogQHBhcmFtIHtsaXN0fSBhcmdzIGEgbGlzdCBvZiBhcmdzIHRvIHBhc3MgdG8gdGhlIGNvbW1lbnRcbiAgICovXG4gIGV4ZWN1dGVDb21tYW5kczogZnVuY3Rpb24gKHR5cGUsIGFyZ3MpIHtcbiAgICBpZiAodGhpcy53b3JraW5nKSByZXR1cm5cbiAgICB2YXIgY21kcyA9IFtdO1xuICAgIHZhciByZXN1bHRzID0gW107XG4gICAgdmFyIGlcbiAgICBmb3IgKGk9MDsgaTxhcmd1bWVudHMubGVuZ3RoOyBpKz0yKSB7XG4gICAgICBjbWRzLnB1c2gobWFrZUNvbW1hbmQoYXJndW1lbnRzW2ldLCBhcmd1bWVudHNbaSsxXSwgdGhpcy5jb21tYW5kcykpXG4gICAgfVxuICAgIGlmICh0aGlzLmhpc3Rwb3MgPiAwKSB7XG4gICAgICB0aGlzLmhpc3RvcnkgPSB0aGlzLmhpc3Rvcnkuc2xpY2UoMCwgLXRoaXMuaGlzdHBvcylcbiAgICAgIHRoaXMuaGlzdHBvcyA9IDBcbiAgICB9XG4gICAgdGhpcy5oaXN0b3J5LnB1c2goY21kcylcbiAgICBmb3IgKGk9MDsgaTxjbWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICByZXN1bHRzLnB1c2godGhpcy5kb0NvbW1hbmQoY21kc1tpXSkpXG4gICAgfVxuICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJylcbiAgICByZXR1cm4gcmVzdWx0c1xuICB9LFxuXG4gIC8qKlxuICAgKiBUcmlnZ2VyIGFuIGV2ZW50IG9uIGxpc3RlbmVyc1xuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gd2hhdCB0aGUgZXZlbnQgdG8gdHJpZ2dlclxuICAgKi9cbiAgdHJpZ2dlcjogZnVuY3Rpb24gKHdoYXQpIHtcbiAgICB2YXIgcmVzdCA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKVxuICAgIGZvciAodmFyIGl0ZW0gaW4gdGhpcy5saXN0ZW5lcnNbd2hhdF0pIHtcbiAgICAgIHRoaXMubGlzdGVuZXJzW3doYXRdW2l0ZW1dLmFwcGx5KG51bGwsIHJlc3QpXG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIGxpc3RlbmVyIGZvciBhbiBldmVudFxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gd2hhdCB0aGUgZXZlbnQgdHlwZVxuICAgKiBAcGFyYW0ge2ZufSBjYiB0aGUgZXZlbnQgaGFuZGxlciBmdW5jdGlvblxuICAgKi9cbiAgb246IGZ1bmN0aW9uICh3aGF0LCBjYikge1xuICAgIGlmICghdGhpcy5saXN0ZW5lcnNbd2hhdF0pIHtcbiAgICAgIHRoaXMubGlzdGVuZXJzW3doYXRdID0gW11cbiAgICB9XG4gICAgdGhpcy5saXN0ZW5lcnNbd2hhdF0ucHVzaChjYilcbiAgfSxcblxuICAvKipcbiAgICogVW5kbyB0aGUgbW9zdCByZWNlbnQgY2hhbmdlLCBpZiBwb3NzaWJsZS5cbiAgICpcbiAgICogSWYgaGlzdG9yeSBpcyBlbXB0eSwgbm90aGluZyBoYXBwZW5zLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sfSB3aGV0aGVyIGFueXRoaW5nIGFjdHVhbGx5IGhhcHBlbmVkXG4gICAqL1xuICB1bmRvOiBmdW5jdGlvbiAoKSB7XG4gICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKClcbiAgICB2YXIgcG9zID0gdGhpcy5oaXN0cG9zID8gdGhpcy5oaXN0cG9zICsgMSA6IDFcbiAgICAgICwgaXggPSB0aGlzLmhpc3RvcnkubGVuZ3RoIC0gcG9zXG4gICAgaWYgKGl4IDwgMCkge1xuICAgICAgcmV0dXJuIGZhbHNlIC8vIG5vIG1vcmUgdW5kbyFcbiAgICB9XG4gICAgdmFyIGNtZHMgPSB0aGlzLmhpc3RvcnlbaXhdXG4gICAgZm9yICh2YXIgaT1jbWRzLmxlbmd0aC0xOyBpPj0wOyBpLS0pIHtcbiAgICAgIHRoaXMudW5kb0NvbW1hbmQoY21kc1tpXSlcbiAgICB9XG4gICAgdGhpcy5oaXN0cG9zICs9IDFcbiAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZScpXG4gICAgcmV0dXJuIHRydWVcbiAgfSxcblxuICAvKipcbiAgICogUmVkbyB0aGUgbW9zdCByZWNlbnQgdW5kbywgaWYgYW55XG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2x9IHdoZXRoZXIgYW5vdGhpbmcgd2FzIHJlZG9uZVxuICAgKi9cbiAgcmVkbzogZnVuY3Rpb24gKCkge1xuICAgIHZhciBwb3MgPSB0aGlzLmhpc3Rwb3MgPyB0aGlzLmhpc3Rwb3MgLSAxIDogLTFcbiAgICAgICwgaXggPSB0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMSAtIHBvc1xuICAgIGlmIChpeCA+PSB0aGlzLmhpc3RvcnkubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2UgLy8gbm8gbW9yZSB0byByZWRvIVxuICAgIH1cbiAgICB2YXIgY21kcyA9IHRoaXMuaGlzdG9yeVtpeF1cbiAgICBmb3IgKHZhciBpPTA7IGk8Y21kcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5yZWRvQ29tbWFuZChjbWRzW2ldKVxuICAgIH1cbiAgICB0aGlzLmhpc3Rwb3MgLT0gMVxuICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJylcbiAgICByZXR1cm4gdHJ1ZVxuICB9LFxuXG4gIC8vIHByaXZhdGlzaCB0aGluZ3NcbiAgc2V0VmlldzogZnVuY3Rpb24gKHZpZXcpIHtcbiAgICB0aGlzLnZpZXcgPSB2aWV3XG4gIH0sXG5cbiAgZG9Db21tYW5kOiBmdW5jdGlvbiAoY21kKSB7XG4gICAgdGhpcy53b3JraW5nID0gdHJ1ZVxuICAgIHZhciByZXN1bHQgPSB0aGlzLmNvbW1hbmRzW2NtZC50eXBlXS5hcHBseS5jYWxsKGNtZC5kYXRhLCB0aGlzLnZpZXcsIHRoaXMubW9kZWwpXG4gICAgdGhpcy53b3JraW5nID0gZmFsc2VcbiAgICByZXR1cm4gcmVzdWx0XG4gIH0sXG5cbiAgdW5kb0NvbW1hbmQ6IGZ1bmN0aW9uIChjbWQpIHtcbiAgICB0aGlzLndvcmtpbmcgPSB0cnVlXG4gICAgdGhpcy5jb21tYW5kc1tjbWQudHlwZV0udW5kby5jYWxsKGNtZC5kYXRhLCB0aGlzLnZpZXcsIHRoaXMubW9kZWwpXG4gICAgdGhpcy53b3JraW5nID0gZmFsc2VcbiAgfSxcblxuICByZWRvQ29tbWFuZDogZnVuY3Rpb24gKGNtZCkge1xuICAgIHRoaXMud29ya2luZyA9IHRydWVcbiAgICB2YXIgYyA9IHRoaXMuY29tbWFuZHNbY21kLnR5cGVdXG4gICAgOyhjLnJlZG8gfHwgYy5hcHBseSkuY2FsbChjbWQuZGF0YSwgdGhpcy52aWV3LCB0aGlzLm1vZGVsKVxuICAgIHRoaXMud29ya2luZyA9IGZhbHNlXG4gIH0sXG59XG5cbiIsIlxuZnVuY3Rpb24gY29weShvbmUpIHtcbiAgaWYgKCdvYmplY3QnICE9PSB0eXBlb2Ygb25lKSByZXR1cm4gb25lXG4gIHZhciB0d28gPSB7fVxuICBmb3IgKHZhciBhdHRyIGluIG9uZSkge1xuICAgIHR3b1thdHRyXSA9IG9uZVthdHRyXVxuICB9XG4gIHJldHVybiB0d29cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNvbGxhcHNlOiB7XG4gICAgYXJnczogWydpZCcsICdkb0NvbGxhcHNlJ10sXG4gICAgYXBwbHk6IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgbW9kZWwuc2V0Q29sbGFwc2VkKHRoaXMuaWQsIHRoaXMuZG9Db2xsYXBzZSlcbiAgICAgIHZpZXcuc2V0Q29sbGFwc2VkKHRoaXMuaWQsIHRoaXMuZG9Db2xsYXBzZSlcbiAgICAgIHZpZXcuZ29Ubyh0aGlzLmlkKVxuICAgIH0sXG4gICAgdW5kbzogZnVuY3Rpb24gKHZpZXcsIG1vZGVsKSB7XG4gICAgICBtb2RlbC5zZXRDb2xsYXBzZWQodGhpcy5pZCwgIXRoaXMuZG9Db2xsYXBzZSlcbiAgICAgIHZpZXcuc2V0Q29sbGFwc2VkKHRoaXMuaWQsICF0aGlzLmRvQ29sbGFwc2UpXG4gICAgICB2aWV3LmdvVG8odGhpcy5pZClcbiAgICB9LFxuICB9LFxuXG4gIGFwcGVuZFRleHQ6IHtcbiAgICBhcmdzOiBbJ2lkJywgJ3RleHQnXSxcbiAgICBhcHBseTogZnVuY3Rpb24gKHZpZXcsIG1vZGVsKSB7XG4gICAgICB0aGlzLm9sZHRleHQgPSBtb2RlbC5pZHNbdGhpcy5pZF0uY29udGVudFxuICAgICAgbW9kZWwuYXBwZW5kVGV4dCh0aGlzLmlkLCB0aGlzLnRleHQpXG4gICAgICB2aWV3LmFwcGVuZFRleHQodGhpcy5pZCwgdGhpcy50ZXh0KVxuICAgIH0sXG4gICAgdW5kbzogZnVuY3Rpb24gKHZpZXcsIG1vZGVsKSB7XG4gICAgICBtb2RlbC5zZXRDb250ZW50KHRoaXMuaWQsIHRoaXMub2xkdGV4dClcbiAgICAgIHZpZXcuc2V0Q29udGVudCh0aGlzLmlkLCB0aGlzLm9sZHRleHQpXG4gICAgfVxuICB9LFxuXG4gIGNoYW5nZUNvbnRlbnQ6IHtcbiAgICBhcmdzOiBbJ2lkJywgJ2NvbnRlbnQnXSxcbiAgICBhcHBseTogZnVuY3Rpb24gKHZpZXcsIG1vZGVsKSB7XG4gICAgICB0aGlzLm9sZGNvbnRlbnQgPSBtb2RlbC5pZHNbdGhpcy5pZF0uY29udGVudFxuICAgICAgbW9kZWwuc2V0Q29udGVudCh0aGlzLmlkLCB0aGlzLmNvbnRlbnQpXG4gICAgICB2aWV3LnNldENvbnRlbnQodGhpcy5pZCwgdGhpcy5jb250ZW50KVxuICAgICAgdmlldy5nb1RvKHRoaXMuaWQpXG4gICAgfSxcbiAgICB1bmRvOiBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcbiAgICAgIG1vZGVsLnNldENvbnRlbnQodGhpcy5pZCwgdGhpcy5vbGRjb250ZW50KVxuICAgICAgdmlldy5zZXRDb250ZW50KHRoaXMuaWQsIHRoaXMub2xkY29udGVudClcbiAgICAgIHZpZXcuZ29Ubyh0aGlzLmlkKVxuICAgIH1cbiAgfSxcblxuICBjaGFuZ2VOb2RlQXR0cjoge1xuICAgIGFyZ3M6IFsnaWQnLCAnYXR0cicsICd2YWx1ZSddLFxuICAgIGFwcGx5OiBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcbiAgICAgIHRoaXMub2xkdmFsdWUgPSBjb3B5KG1vZGVsLmlkc1t0aGlzLmlkXS5tZXRhW3RoaXMuYXR0cl0pXG4gICAgICBtb2RlbC5zZXRBdHRyKHRoaXMuaWQsIHRoaXMuYXR0ciwgdGhpcy52YWx1ZSlcbiAgICAgIHZpZXcuc2V0QXR0cih0aGlzLmlkLCB0aGlzLmF0dHIsIHRoaXMudmFsdWUpXG4gICAgICB2aWV3LmdvVG8odGhpcy5pZClcbiAgICB9LFxuICAgIHVuZG86IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgbW9kZWwuc2V0QXR0cih0aGlzLmlkLCB0aGlzLmF0dHIsIHRoaXMub2xkdmFsdWUpXG4gICAgICB2aWV3LnNldEF0dHIodGhpcy5pZCwgdGhpcy5hdHRyLCB0aGlzLm9sZHZhbHVlKVxuICAgICAgdmlldy5nb1RvKHRoaXMuaWQpXG4gICAgfVxuICB9LFxuXG4gIGNoYW5nZU5vZGU6IHtcbiAgICBhcmdzOiBbJ2lkJywgJ25ld21ldGEnXSxcbiAgICBhcHBseTogZnVuY3Rpb24gKHZpZXcsIG1vZGVsKSB7XG4gICAgICB0aGlzLm9sZG1ldGEgPSBjb3B5KG1vZGVsLmlkc1t0aGlzLmlkXS5tZXRhKVxuICAgICAgbW9kZWwuc2V0TWV0YSh0aGlzLmlkLCB0aGlzLm5ld21ldGEpXG4gICAgICB2aWV3LnNldE1ldGEodGhpcy5pZCwgdGhpcy5uZXdtZXRhKVxuICAgICAgdmlldy5nb1RvKHRoaXMuaWQpXG4gICAgfSxcblxuICAgIHVuZG86IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgbW9kZWwuc2V0TWV0YSh0aGlzLmlkLCB0aGlzLm9sZG1ldGEpXG4gICAgICB2aWV3LnNldE1ldGEodGhpcy5pZCwgdGhpcy5vbGRtZXRhKVxuICAgICAgdmlldy5nb1RvKHRoaXMuaWQpXG4gICAgfVxuICB9LFxuXG4gIG5ld05vZGU6IHtcbiAgICBhcmdzOiBbJ3BpZCcsICdpbmRleCcsICd0ZXh0JywgJ21ldGEnLCAndHlwZSddLFxuICAgIGFwcGx5OiBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcbiAgICAgIHZhciBjciA9IG1vZGVsLmNyZWF0ZSh0aGlzLnBpZCwgdGhpcy5pbmRleCwgdGhpcy50ZXh0LCB0aGlzLnR5cGUsIHRoaXMubWV0YSlcbiAgICAgIHRoaXMuaWQgPSBjci5ub2RlLmlkXG4gICAgICB2aWV3LmFkZChjci5ub2RlLCBjci5iZWZvcmUpXG4gICAgICAvLyB2aWV3LnN0YXJ0RWRpdGluZyhjci5ub2RlLmlkKVxuICAgIH0sXG5cbiAgICB1bmRvOiBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcbiAgICAgIHZhciBlZCA9IHZpZXcuZWRpdGluZ1xuICAgICAgdmlldy5yZW1vdmUodGhpcy5pZClcbiAgICAgIHRoaXMuc2F2ZWQgPSBtb2RlbC5yZW1vdmUodGhpcy5pZClcbiAgICAgIHZhciBuaWQgPSBtb2RlbC5pZHNbdGhpcy5waWRdLmNoaWxkcmVuW3RoaXMuaW5kZXgtMV1cbiAgICAgIGlmIChuaWQgPT09IHVuZGVmaW5lZCkgbmlkID0gdGhpcy5waWRcbiAgICAgIGlmIChlZCkge1xuICAgICAgICB2aWV3LnN0YXJ0RWRpdGluZyhuaWQpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2aWV3LnNldEFjdGl2ZShuaWQpXG4gICAgICB9XG4gICAgfSxcblxuICAgIHJlZG86IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgdmFyIGJlZm9yZSA9IG1vZGVsLnJlYWRkKHRoaXMuc2F2ZWQpXG4gICAgICB2aWV3LmFkZCh0aGlzLnNhdmVkLm5vZGUsIGJlZm9yZSlcbiAgICB9XG4gIH0sXG5cbiAgbW92ZToge1xuICAgIGFyZ3M6IFsnaWQnLCAncGlkJywgJ2luZGV4J10sXG4gICAgYXBwbHk6IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgdGhpcy5vcGlkID0gbW9kZWwuaWRzW3RoaXMuaWRdLnBhcmVudFxuICAgICAgdGhpcy5vaW5kZXggPSBtb2RlbC5pZHNbdGhpcy5vcGlkXS5jaGlsZHJlbi5pbmRleE9mKHRoaXMuaWQpXG4gICAgICB2YXIgYmVmb3JlID0gbW9kZWwubW92ZSh0aGlzLmlkLCB0aGlzLnBpZCwgdGhpcy5pbmRleClcbiAgICAgIHZhciBwYXJlbnQgPSBtb2RlbC5pZHNbdGhpcy5vcGlkXVxuICAgICAgICAsIGxhc3RjaGlsZCA9IHBhcmVudC5jaGlsZHJlbi5sZW5ndGggPT09IDBcbiAgICAgIHZpZXcubW92ZSh0aGlzLmlkLCB0aGlzLnBpZCwgYmVmb3JlLCB0aGlzLm9waWQsIGxhc3RjaGlsZClcbiAgICAgIHZpZXcuZ29Ubyh0aGlzLmlkKVxuICAgIH0sXG5cbiAgICB1bmRvOiBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcbiAgICAgIHZhciBiZWZvcmUgPSBtb2RlbC5tb3ZlKHRoaXMuaWQsIHRoaXMub3BpZCwgdGhpcy5vaW5kZXgpXG4gICAgICAgICwgbGFzdGNoaWxkID0gbW9kZWwuaWRzW3RoaXMucGlkXS5jaGlsZHJlbi5sZW5ndGggPT09IDBcbiAgICAgIHZpZXcubW92ZSh0aGlzLmlkLCB0aGlzLm9waWQsIGJlZm9yZSwgdGhpcy5waWQsIGxhc3RjaGlsZClcbiAgICAgIHZpZXcuZ29Ubyh0aGlzLmlkKVxuICAgIH1cbiAgfSxcblxuICByZW1vdmU6IHtcbiAgICBhcmdzOiBbJ2lkJ10sXG4gICAgYXBwbHk6IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgdmFyIGNsb3Nlc3QgPSBtb2RlbC5jbG9zZXN0Tm9uQ2hpbGQodGhpcy5pZClcbiAgICAgIHZpZXcucmVtb3ZlKHRoaXMuaWQpXG4gICAgICB0aGlzLnNhdmVkID0gbW9kZWwucmVtb3ZlKHRoaXMuaWQpXG4gICAgICB2aWV3LnN0YXJ0RWRpdGluZyhjbG9zZXN0KVxuICAgIH0sXG5cbiAgICB1bmRvOiBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcbiAgICAgIHZhciBiZWZvcmUgPSBtb2RlbC5yZWFkZCh0aGlzLnNhdmVkKVxuICAgICAgdmlldy5hZGRUcmVlKHRoaXMuc2F2ZWQubm9kZSwgYmVmb3JlKVxuICAgIH1cbiAgfSxcblxuICBjb3B5OiB7XG4gICAgYXJnczogWydpZHMnXSxcbiAgICBhcHBseTogZnVuY3Rpb24gKHZpZXcsIG1vZGVsKSB7XG4gICAgICB2YXIgaXRlbXMgPSB0aGlzLmlkcy5tYXAoZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHJldHVybiBtb2RlbC5kdW1wRGF0YShpZCwgdHJ1ZSlcbiAgICAgIH0pXG4gICAgICBtb2RlbC5jbGlwYm9hcmQgPSBpdGVtc1xuICAgIH0sXG4gICAgdW5kbzogZnVuY3Rpb24gKHZpZXcsIG1vZGVsKSB7XG4gICAgfVxuICB9LFxuXG4gIGN1dDoge1xuICAgIGFyZ3M6IFsnaWRzJ10sXG4gICAgLy8gaWRzIGFyZSBhbHdheXMgaW4gZGVzY2VuZGluZyBvcmRlciwgd2hlcmUgMCBpcyB0aGUgZmlyc3Qgc2libGluZywgYW5kXG4gICAgLy8gdGhlIGxhc3QgaXRlbSBpcyB0aGUgbGFzdCBzaWJsaW5nXG4gICAgYXBwbHk6IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgdmFyIGl0ZW1zID0gdGhpcy5pZHMubWFwKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2aWV3LnJlbW92ZShpZCwgdHJ1ZSlcbiAgICAgICAgcmV0dXJuIG1vZGVsLmR1bXBEYXRhKGlkLCB0cnVlKVxuICAgICAgfSlcbiAgICAgIG1vZGVsLmNsaXBib2FyZCA9IGl0ZW1zXG5cbiAgICAgIHZhciBpZCA9IHRoaXMuaWRzW3RoaXMuaWRzLmxlbmd0aC0xXVxuICAgICAgdmFyIGNsb3Nlc3QgPSBtb2RlbC5jbG9zZXN0Tm9uQ2hpbGQoaWQsIHRoaXMuaWRzKVxuICAgICAgdGhpcy5zYXZlZCA9IHRoaXMuaWRzLm1hcChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgcmV0dXJuIG1vZGVsLnJlbW92ZShpZClcbiAgICAgIH0pXG5cbiAgICAgIGlmICh2aWV3LmVkaXRpbmcpIHtcbiAgICAgICAgdmlldy5zdGFydEVkaXRpbmcoY2xvc2VzdClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZpZXcuc2V0QWN0aXZlKGNsb3Nlc3QpXG4gICAgICB9XG4gICAgfSxcblxuICAgIHVuZG86IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgdmFyIGJlZm9yZVxuICAgICAgZm9yICh2YXIgaT10aGlzLnNhdmVkLmxlbmd0aC0xOyBpPj0wOyBpLS0pIHtcbiAgICAgICAgYmVmb3JlID0gbW9kZWwucmVhZGQodGhpcy5zYXZlZFtpXSlcbiAgICAgICAgdmlldy5hZGRUcmVlKHRoaXMuc2F2ZWRbaV0ubm9kZSwgYmVmb3JlKVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuaWRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdmlldy5zZXRTZWxlY3Rpb24odGhpcy5pZHMpXG4gICAgICAgIHZpZXcuc2V0QWN0aXZlKHRoaXMuaWRzW3RoaXMuaWRzLmxlbmd0aC0xXSlcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgaW1wb3J0RGF0YToge1xuICAgIGFyZ3M6IFsncGlkJywgJ2luZGV4JywgJ2RhdGEnXSxcbiAgICBhcHBseTogZnVuY3Rpb24gKHZpZXcsIG1vZGVsKSB7XG4gICAgICB2YXIgcGlkID0gdGhpcy5waWRcbiAgICAgICAgLCBpbmRleCA9IHRoaXMuaW5kZXhcbiAgICAgICAgLCBlZCA9IHZpZXcuZWRpdGluZ1xuICAgICAgICAsIGl0ZW0gPSB0aGlzLmRhdGFcbiAgICAgIHZhciBjciA9IG1vZGVsLmNyZWF0ZU5vZGVzKHBpZCwgaW5kZXgsIGl0ZW0pXG4gICAgICB2aWV3LmFkZFRyZWUoY3Iubm9kZSwgY3IuYmVmb3JlKVxuICAgICAgdmlldy5zZXRDb2xsYXBzZWQoY3Iubm9kZS5wYXJlbnQsIGZhbHNlKVxuICAgICAgbW9kZWwuc2V0Q29sbGFwc2VkKGNyLm5vZGUucGFyZW50LCBmYWxzZSlcbiAgICAgIHRoaXMubmV3aWQgPSBjci5ub2RlLmlkXG4gICAgICBpZiAoZWQpIHtcbiAgICAgICAgdmlldy5zdGFydEVkaXRpbmcodGhpcy5uZXdpZClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZpZXcuc2V0QWN0aXZlKHRoaXMubmV3aWQpXG4gICAgICB9XG4gICAgfSxcblxuICAgIHVuZG86IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgdmFyIGlkID0gdGhpcy5uZXdpZFxuICAgICAgdmFyIGNsb3Nlc3QgPSBtb2RlbC5jbG9zZXN0Tm9uQ2hpbGQoaWQpXG4gICAgICB2aWV3LnJlbW92ZShpZClcbiAgICAgIHRoaXMuc2F2ZWQgPSBtb2RlbC5yZW1vdmUoaWQpXG4gICAgICBpZiAodmlldy5lZGl0aW5nKSB7XG4gICAgICAgIHZpZXcuc3RhcnRFZGl0aW5nKGNsb3Nlc3QpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2aWV3LnNldEFjdGl2ZShjbG9zZXN0KVxuICAgICAgfVxuICAgICAgLy8gdmlldy5yZW1vdmUodGhpcy5uZXdpZClcbiAgICAgIC8vIHRoaXMuc2F2ZWQgPSBtb2RlbC5yZW1vdmUodGhpcy5uZXdpZClcbiAgICAgIG1vZGVsLmNsaXBib2FyZCA9IHRoaXMuc2F2ZWRcbiAgICB9LFxuICAgIHJlZG86IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgLy8gdmFyIGJlZm9yZSA9IG1vZGVsLnJlYWRkKHRoaXMuc2F2ZWQpXG4gICAgICAvLyB2aWV3LmFkZFRyZWUodGhpcy5zYXZlZC5ub2RlLCBiZWZvcmUpXG4gICAgICB2YXIgYmVmb3JlID0gbW9kZWwucmVhZGQodGhpcy5zYXZlZClcbiAgICAgIHZpZXcuYWRkVHJlZSh0aGlzLnNhdmVkLm5vZGUsIGJlZm9yZSlcbiAgICAgIGlmICh2aWV3LmVkaXRpbmcpIHtcbiAgICAgICAgdmlldy5zdGFydEVkaXRpbmcodGhpcy5uZXdpZClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZpZXcuc2V0QWN0aXZlKHRoaXMubmV3aWQpXG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIHBhc3RlOiB7XG4gICAgYXJnczogWydwaWQnLCAnaW5kZXgnXSxcbiAgICBhcHBseTogZnVuY3Rpb24gKHZpZXcsIG1vZGVsKSB7XG4gICAgICB2YXIgcGlkID0gdGhpcy5waWRcbiAgICAgICAgLCBpbmRleCA9IHRoaXMuaW5kZXhcbiAgICAgICAgLCBlZCA9IHZpZXcuZWRpdGluZ1xuICAgICAgdmFyIGlkcyA9IG1vZGVsLmNsaXBib2FyZC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgdmFyIGNyID0gbW9kZWwuY3JlYXRlTm9kZXMocGlkLCBpbmRleCwgaXRlbSlcbiAgICAgICAgdmlldy5hZGRUcmVlKGNyLm5vZGUsIGNyLmJlZm9yZSlcbiAgICAgICAgaWYgKG1vZGVsLmlkc1tjci5ub2RlLnBhcmVudF0uY29sbGFwc2VkKSB7XG4gICAgICAgICAgdmlldy5zZXRDb2xsYXBzZWQoY3Iubm9kZS5wYXJlbnQsIGZhbHNlKVxuICAgICAgICAgIG1vZGVsLnNldENvbGxhcHNlZChjci5ub2RlLnBhcmVudCwgZmFsc2UpXG4gICAgICAgIH1cbiAgICAgICAgaW5kZXggKz0gMVxuICAgICAgICByZXR1cm4gY3Iubm9kZS5pZFxuICAgICAgfSlcbiAgICAgIHRoaXMubmV3aWRzID0gaWRzXG4gICAgICBpZiAoaWRzLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgIGlmIChlZCkge1xuICAgICAgICAgIHZpZXcuc3RhcnRFZGl0aW5nKHRoaXMubmV3aWRzWzBdKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZpZXcuc2V0QWN0aXZlKHRoaXMubmV3aWRzWzBdKVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2aWV3LnNldFNlbGVjdGlvbihpZHMpXG4gICAgICAgIHZpZXcuc2V0QWN0aXZlKGlkc1tpZHMubGVuZ3RoLTFdKVxuICAgICAgfVxuICAgIH0sXG5cbiAgICB1bmRvOiBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcbiAgICAgIHZhciBpZCA9IHRoaXMubmV3aWRzW3RoaXMubmV3aWRzLmxlbmd0aC0xXVxuICAgICAgdmFyIGNsb3Nlc3QgPSBtb2RlbC5jbG9zZXN0Tm9uQ2hpbGQoaWQpXG4gICAgICB0aGlzLnNhdmVkID0gdGhpcy5uZXdpZHMubWFwKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2aWV3LnJlbW92ZShpZClcbiAgICAgICAgcmV0dXJuIG1vZGVsLnJlbW92ZShpZClcbiAgICAgIH0pXG4gICAgICBpZiAodmlldy5lZGl0aW5nKSB7XG4gICAgICAgIHZpZXcuc3RhcnRFZGl0aW5nKGNsb3Nlc3QpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2aWV3LnNldEFjdGl2ZShjbG9zZXN0KVxuICAgICAgfVxuICAgIH0sXG5cbiAgICByZWRvOiBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcbiAgICAgIC8vIHZhciBiZWZvcmUgPSBtb2RlbC5yZWFkZCh0aGlzLnNhdmVkKVxuICAgICAgLy8gdmlldy5hZGRUcmVlKHRoaXMuc2F2ZWQubm9kZSwgYmVmb3JlKVxuICAgICAgdGhpcy5zYXZlZC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgdmFyIGJlZm9yZSA9IG1vZGVsLnJlYWRkKGl0ZW0pXG4gICAgICAgIHZpZXcuYWRkVHJlZShpdGVtLm5vZGUsIGJlZm9yZSlcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG59XG5cbiIsIlxubW9kdWxlLmV4cG9ydHMgPSBDb250cm9sbGVyXG5cbnZhciBDb21tYW5kZWdlciA9IHJlcXVpcmUoJy4vY29tbWFuZGVnZXInKVxuXG4gICwgdXRpbCA9IHJlcXVpcmUoJy4vdXRpbCcpXG5cbmZ1bmN0aW9uIENvbnRyb2xsZXIobW9kZWwsIG8pIHtcbiAgdGhpcy5vID0gdXRpbC5leHRlbmQoe1xuICAgIG5vQ29sbGFwc2VSb290OiB0cnVlLFxuICAgIGV4dHJhX2NvbW1hbmRzOiBmYWxzZVxuICB9LCBvIHx8IHt9KVxuICB0aGlzLm1vZGVsID0gbW9kZWxcbiAgdGhpcy5jbWQgPSBuZXcgQ29tbWFuZGVnZXIodGhpcy5tb2RlbCwgdGhpcy5vLmV4dHJhX2NvbW1hbmRzKVxuXG4gIHRoaXMubW9kZWwuZGIubGlzdGVuKCdub2RlJywgdGhpcy5hZGRGcm9tRGIuYmluZCh0aGlzKSwgdGhpcy51cGRhdGVGcm9tRGIuYmluZCh0aGlzKSlcblxuICB2YXIgYWN0aW9ucyA9IHt9XG4gIGZvciAodmFyIGFjdGlvbiBpbiB0aGlzLmFjdGlvbnMpIHtcbiAgICBpZiAoJ3N0cmluZycgPT09IHR5cGVvZiB0aGlzLmFjdGlvbnNbYWN0aW9uXSkgYWN0aW9uc1thY3Rpb25dID0gdGhpcy5hY3Rpb25zW2FjdGlvbl1cbiAgICBlbHNlIGFjdGlvbnNbYWN0aW9uXSA9IHRoaXMuYWN0aW9uc1thY3Rpb25dLmJpbmQodGhpcylcbiAgfVxuICB0aGlzLmFjdGlvbnMgPSBhY3Rpb25zXG4gIHRoaXMubGlzdGVuZXJzID0ge31cbn1cblxuQ29udHJvbGxlci5wcm90b3R5cGUgPSB7XG4gIGFkZEZyb21EYjogZnVuY3Rpb24gKGlkLCBkYXRhKSB7XG4gICAgLy8gaWYgKHRoaXMubW9kZWwuaWRzW2lkXSkgcmV0dXJuXG4gICAgdGhpcy52aWV3LnVwZGF0ZShpZCwgZGF0YSlcbiAgICB0aGlzLm1vZGVsLmlkc1tpZF0gPSBkYXRhXG4gIH0sXG4gIHVwZGF0ZUZyb21EYjogZnVuY3Rpb24gKGlkLCBkYXRhKSB7XG4gICAgdGhpcy52aWV3LnVwZGF0ZShpZCwgZGF0YSlcbiAgICB0aGlzLm1vZGVsLmlkc1tpZF0gPSBkYXRhXG4gIH0sXG5cbiAgLyoqXG4gICAqIFNldCB0aGUgY3VycmVudCB2aWV3XG4gICAqXG4gICAqIEBwYXJhbSB7Y2xhc3N9IFZpZXcgdGhlIFZpZXcgY2xhc3NcbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgdGhlIG9wdGlvbnMgdG8gcGFzcyB0byB0aGUgdmlld1xuICAgKiBAcmV0dXJuIHtWaWV3fSB0aGUgdmlldyBvYmplY3RcbiAgICovXG4gIHNldFZpZXc6IGZ1bmN0aW9uIChWaWV3LCBvcHRpb25zKSB7XG4gICAgdmFyIG92aWV3ID0gdGhpcy52aWV3XG4gICAgdGhpcy52aWV3ID0gbmV3IFZpZXcoXG4gICAgICB0aGlzLmJpbmRBY3Rpb25zLmJpbmQodGhpcyksXG4gICAgICB0aGlzLm1vZGVsLCB0aGlzLmFjdGlvbnMsXG4gICAgICBvcHRpb25zXG4gICAgKVxuXG4gICAgdmFyIHJvb3QgPSAob3ZpZXcgPyBvdmlldy5yb290IDogdGhpcy5tb2RlbC5yb290KTtcbiAgICB2YXIgbm9kZSA9IHRoaXMudmlldy5pbml0aWFsaXplKHJvb3QpXG4gICAgaWYgKG92aWV3KSB7XG4gICAgICBvdmlldy5nZXROb2RlKCkucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobm9kZSwgb3ZpZXcuZ2V0Tm9kZSgpKTtcbiAgICB9XG4gICAgdGhpcy5jbWQuc2V0Vmlldyh0aGlzLnZpZXcpXG4gICAgcmV0dXJuIHRoaXMudmlld1xuICB9LFxuXG4gIC8qKlxuICAgKiBVbmRvIHRoZSBtb3N0IHJlY2VudCBjb21tZW50XG4gICAqL1xuICB1bmRvOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jbWQudW5kbygpXG4gIH0sXG5cbiAgLyoqXG4gICAqIFJlZG8gdGhlIG1vc3QgcmVjZW50IHVuZG9cbiAgICovXG4gIHJlZG86IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNtZC5yZWRvKClcbiAgfSxcblxuICAvKipcbiAgICogQXR0YWNoIGEgbGlzdGVuZXJcbiAgICovXG4gIG9uOiBmdW5jdGlvbiAoZXZ0LCBmdW5jKSB7XG4gICAgaWYgKCF0aGlzLmxpc3RlbmVyc1tldnRdKSB7XG4gICAgICB0aGlzLmxpc3RlbmVyc1tldnRdID0gW11cbiAgICB9XG4gICAgdGhpcy5saXN0ZW5lcnNbZXZ0XS5wdXNoKGZ1bmMpXG4gIH0sXG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhIGxpc3RlbmVyXG4gICAqL1xuICBvZmY6IGZ1bmN0aW9uIChldnQsIGZ1bmMpIHtcbiAgICBpZiAoIXRoaXMubGlzdGVuZXJzW2V2dF0pIHJldHVybiBmYWxzZVxuICAgIHZhciBpID0gdGhpcy5saXN0ZW5lcnNbZXZ0XS5pbmRleE9mKGZ1bmMpXG4gICAgaWYgKGkgPT09IC0xKSByZXR1cm4gZmFsc2VcbiAgICB0aGlzLmxpc3RlbmVyc1tldnRdLnNwbGljZShpLCAxKVxuICAgIHJldHVybiB0cnVlXG4gIH0sXG5cbiAgLyoqXG4gICAqIFRyaWdnZXIgYW4gZXZlbnRcbiAgICovXG4gIHRyaWdnZXI6IGZ1bmN0aW9uIChldnQpIHtcbiAgICBpZiAoIXRoaXMubGlzdGVuZXJzW2V2dF0pIHJldHVyblxuICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpXG4gICAgZm9yICh2YXIgaT0wOyBpPHRoaXMubGlzdGVuZXJzW2V2dF0ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMubGlzdGVuZXJzW2V2dF1baV0uYXBwbHkobnVsbCwgYXJncylcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIENyZWF0ZSBib3VuZCB2ZXJzaW9ucyBvZiBlYWNoIGFjdGlvbiBmdW5jdGlvbiBmb3IgYSBnaXZlbiBpZFxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaWQgdGhpcyBpZCB0cyBzaW5zIHRoaW5nc1xuICAgKi9cbiAgYmluZEFjdGlvbnM6IGZ1bmN0aW9uIChpZCkge1xuICAgIHZhciBhY3Rpb25zID0ge31cbiAgICAgICwgdmFsXG4gICAgZm9yICh2YXIgYWN0aW9uIGluIHRoaXMuYWN0aW9ucykge1xuICAgICAgdmFsID0gdGhpcy5hY3Rpb25zW2FjdGlvbl1cbiAgICAgIGlmICgnc3RyaW5nJyA9PT0gdHlwZW9mIHZhbCkge1xuICAgICAgICB2YWwgPSB0aGlzW3ZhbF1bYWN0aW9uXS5iaW5kKHRoaXNbdmFsXSwgaWQpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWwgPSB2YWwuYmluZCh0aGlzLCBpZClcbiAgICAgIH1cbiAgICAgIGFjdGlvbnNbYWN0aW9uXSA9IHZhbFxuICAgIH1cbiAgICByZXR1cm4gYWN0aW9uc1xuICB9LFxuXG4gIGltcG9ydERhdGE6IGZ1bmN0aW9uIChkYXRhLCBwYXJlbnQpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgcGFyZW50ID0gdGhpcy52aWV3LmdldEFjdGl2ZSgpO1xuICAgIH1cbiAgICBpZiAocGFyZW50ID09PSBcIm5ld1wiKSB7XG4gICAgICAgIHRoaXMudmlldy5yZW1vdmVOZXcoKVxuICAgICAgICBwYXJlbnQgPSB0aGlzLnZpZXcucm9vdFxuICAgIH1cbiAgICB0aGlzLmV4ZWN1dGVDb21tYW5kcygnaW1wb3J0RGF0YScsIFtwYXJlbnQsIDAsIGRhdGFdKVxuICAgIC8vIHRoaXMubW9kZWwuY3JlYXRlTm9kZXModGhpcy52aWV3LmdldEFjdGl2ZSgpLCAwLCBkYXRhKVxuICAgIC8vIHRoaXMudmlldy5yZWJhc2UodGhpcy52aWV3LnJvb3QpXG4gIH0sXG5cbiAgZXhwb3J0RGF0YTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLm1vZGVsLmR1bXBEYXRhKHRoaXMubW9kZWwucm9vdCwgdHJ1ZSlcbiAgfSxcblxuICBleGVjdXRlQ29tbWFuZHM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcmVzXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG4gICAgICByZXMgPSB0aGlzLmNtZC5leGVjdXRlQ29tbWFuZHMuYXBwbHkodGhpcy5jbWQsIGFyZ3VtZW50c1swXSlcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzID0gdGhpcy5jbWQuZXhlY3V0ZUNvbW1hbmRzLmFwcGx5KHRoaXMuY21kLCBhcmd1bWVudHMpXG4gICAgfVxuICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJylcbiAgICByZXR1cm4gcmVzXG4gIH0sXG5cbiAgLy8gcHVibGljXG4gIHNldENvbGxhcHNlZDogZnVuY3Rpb24gKGlkLCBkb0NvbGxhcHNlKSB7XG4gICAgaWYgKHRoaXMuby5ub0NvbGxhcHNlUm9vdCAmJiBpZCA9PT0gdGhpcy52aWV3LnJvb3QpIHJldHVyblxuICAgIGlmICghdGhpcy5tb2RlbC5oYXNDaGlsZHJlbihpZCkpIHJldHVyblxuICAgIGlmICh0aGlzLm1vZGVsLmlzQ29sbGFwc2VkKGlkKSA9PT0gZG9Db2xsYXBzZSkgcmV0dXJuXG4gICAgdGhpcy5leGVjdXRlQ29tbWFuZHMoJ2NvbGxhcHNlJywgW2lkLCBkb0NvbGxhcHNlXSk7XG4gIH0sXG5cbiAgYWRkQmVmb3JlOiBmdW5jdGlvbiAoaWQsIHRleHQpIHtcbiAgICB2YXIgbncgPSB0aGlzLm1vZGVsLmlkTmV3KGlkLCB0cnVlKVxuICAgIHRoaXMuZXhlY3V0ZUNvbW1hbmRzKCduZXdOb2RlJywgW253LnBpZCwgbncuaW5kZXgsIHRleHRdKVxuICB9LFxuXG4gIGFjdGlvbnM6IHtcbiAgICB0cmlnZ2VyOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnRyaWdnZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuICAgIH0sXG5cbiAgICBzZXRBY3RpdmU6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgdGhpcy52aWV3LnNldEFjdGl2ZShpZClcbiAgICB9LFxuXG4gICAgLy8gbW92ZSBmb2N1c1xuICAgIGdvVXA6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgaWYgKGlkID09PSB0aGlzLnZpZXcucm9vdCkgcmV0dXJuXG4gICAgICBpZiAoaWQgPT09ICduZXcnKSByZXR1cm4gdGhpcy52aWV3LmdvVG8odGhpcy52aWV3LnJvb3QpXG4gICAgICAvLyBzaG91bGQgSSBjaGVjayB0byBzZWUgaWYgaXQncyBvaz9cbiAgICAgIHZhciBhYm92ZSA9IHRoaXMubW9kZWwuaWRBYm92ZShpZClcbiAgICAgIGlmIChhYm92ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm5cbiAgICAgIHRoaXMudmlldy5zdGFydEVkaXRpbmcoYWJvdmUpO1xuICAgIH0sXG5cbiAgICBnb0Rvd246IGZ1bmN0aW9uIChpZCwgZnJvbVN0YXJ0KSB7XG4gICAgICBpZiAoaWQgPT09ICduZXcnKSByZXR1cm4gdGhpcy52aWV3LmdvVG8odGhpcy52aWV3LnJvb3QpXG4gICAgICB2YXIgYmVsb3cgPSB0aGlzLm1vZGVsLmlkQmVsb3coaWQsIHRoaXMudmlldy5yb290KVxuICAgICAgaWYgKGJlbG93ID09PSB1bmRlZmluZWQpIHJldHVyblxuICAgICAgdGhpcy52aWV3LnN0YXJ0RWRpdGluZyhiZWxvdywgZnJvbVN0YXJ0KTtcbiAgICB9LFxuXG4gICAgZ29MZWZ0OiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIGlmIChpZCA9PT0gJ25ldycpIHJldHVybiB0aGlzLnZpZXcuZ29Ubyh0aGlzLnZpZXcucm9vdClcbiAgICAgIGlmIChpZCA9PT0gdGhpcy52aWV3LnJvb3QpIHJldHVyblxuICAgICAgdmFyIHBhcmVudCA9IHRoaXMubW9kZWwuZ2V0UGFyZW50KGlkKVxuICAgICAgaWYgKCFwYXJlbnQpIHJldHVyblxuICAgICAgdGhpcy52aWV3LnN0YXJ0RWRpdGluZyhwYXJlbnQpXG4gICAgfSxcblxuICAgIGdvUmlnaHQ6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgaWYgKGlkID09PSAnbmV3JykgcmV0dXJuIHRoaXMudmlldy5nb1RvKHRoaXMudmlldy5yb290KVxuICAgICAgdmFyIGNoaWxkID0gdGhpcy5tb2RlbC5nZXRDaGlsZChpZClcbiAgICAgIGlmICghY2hpbGQpIHJldHVyblxuICAgICAgdGhpcy52aWV3LnN0YXJ0RWRpdGluZyhjaGlsZClcbiAgICB9LFxuXG4gICAgc3RhcnRNb3Zpbmc6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgaWYgKGlkID09PSAnbmV3JykgcmV0dXJuXG4gICAgICBpZiAoaWQgPT09IHRoaXMudmlldy5yb290KSByZXR1cm5cbiAgICAgIHRoaXMudmlldy5zdGFydE1vdmluZyhpZClcbiAgICB9LFxuXG4gICAgLy8gbW9kaWZpY2F0aW9uXG4gICAgdW5kbzogZnVuY3Rpb24gKCkge3RoaXMuY21kLnVuZG8oKX0sXG4gICAgcmVkbzogZnVuY3Rpb24gKCkge3RoaXMuY21kLnJlZG8oKX0sXG5cbiAgICAvLyBjb21tYW5kZXJzXG4gICAgY3V0OiBmdW5jdGlvbiAoaWRzKSB7XG4gICAgICBpZiAoaWRzID09PSB0aGlzLnZpZXcucm9vdCkgcmV0dXJuXG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkoaWRzKSkge1xuICAgICAgICBpZHMgPSBbaWRzXVxuICAgICAgfVxuICAgICAgdGhpcy5leGVjdXRlQ29tbWFuZHMoJ2N1dCcsIFtpZHNdKVxuICAgIH0sXG5cbiAgICBjb3B5OiBmdW5jdGlvbiAoaWRzKSB7XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkoaWRzKSkge1xuICAgICAgICBpZHMgPSBbaWRzXVxuICAgICAgfVxuICAgICAgdGhpcy5leGVjdXRlQ29tbWFuZHMoJ2NvcHknLCBbaWRzXSlcbiAgICB9LFxuXG4gICAgcGFzdGVBYm92ZTogZnVuY3Rpb24gKGlkKSB7XG4gICAgICByZXR1cm4gdGhpcy5hY3Rpb25zLnBhc3RlKGlkLCB0cnVlKVxuICAgIH0sXG5cbiAgICBwYXN0ZTogZnVuY3Rpb24gKGlkLCBhYm92ZSkge1xuICAgICAgaWYgKCF0aGlzLm1vZGVsLmNsaXBib2FyZCkgcmV0dXJuXG4gICAgICB2YXIgbncgPSB0aGlzLm1vZGVsLmlkTmV3KGlkLCBhYm92ZSlcbiAgICAgIHRoaXMuZXhlY3V0ZUNvbW1hbmRzKCdwYXN0ZScsIFtudy5waWQsIG53LmluZGV4XSlcbiAgICB9LFxuXG4gICAgY2hhbmdlQ29udGVudDogZnVuY3Rpb24gKGlkLCBjb250ZW50KSB7XG4gICAgICBpZiAoaWQgPT09ICduZXcnKSB7XG4gICAgICAgIGlmICghY29udGVudCkgcmV0dXJuXG4gICAgICAgIHZhciBudyA9IHRoaXMudmlldy5yZW1vdmVOZXcoKVxuICAgICAgICB0aGlzLmV4ZWN1dGVDb21tYW5kcygnbmV3Tm9kZScsIFtudy5waWQsIG53LmluZGV4LCBjb250ZW50LCB7fV0pXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgICAgdGhpcy5leGVjdXRlQ29tbWFuZHMoJ2NoYW5nZUNvbnRlbnQnLCBbaWQsIGNvbnRlbnRdKVxuICAgIH0sXG5cbiAgICBjaGFuZ2VkOiBmdW5jdGlvbiAoaWQsIGF0dHIsIHZhbHVlKSB7XG4gICAgICBpZiAoaWQgPT09ICduZXcnKSB7XG4gICAgICAgIGlmICghdmFsdWUpIHJldHVyblxuICAgICAgICB2YXIgbncgPSB0aGlzLnZpZXcucmVtb3ZlTmV3KClcbiAgICAgICAgdmFyIG1ldGEgPSB7fVxuICAgICAgICBtZXRhW2F0dHJdID0gdmFsdWVcbiAgICAgICAgdGhpcy5leGVjdXRlQ29tbWFuZHMoJ25ld05vZGUnLCBbbncucGlkLCBudy5pbmRleCwgJycsIG1ldGFdKVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgIHRoaXMuZXhlY3V0ZUNvbW1hbmRzKCdjaGFuZ2VOb2RlQXR0cicsIFtpZCwgYXR0ciwgdmFsdWVdKVxuICAgIH0sXG5cbiAgICAvLyBtb3ZlIG5vZGVcbiAgICBtb3ZlOiBmdW5jdGlvbiAod2hlcmUsIGlkLCB0YXJnZXQpIHtcbiAgICAgIHZhciBhY3Rpb24gPSB7XG4gICAgICAgIGJlZm9yZTogJ1RvQmVmb3JlJyxcbiAgICAgICAgYWZ0ZXI6ICdUb0FmdGVyJyxcbiAgICAgICAgY2hpbGQ6ICdJbnRvJyxcbiAgICAgICAgbGFzdENoaWxkOiAnSW50b0xhc3QnXG4gICAgICB9W3doZXJlXVxuICAgICAgdGhpcy5hY3Rpb25zWydtb3ZlJyArIGFjdGlvbl0oaWQsIHRhcmdldCkvL3RhcmdldCwgaWQpXG4gICAgfSxcblxuICAgIG1vdmVUb0JlZm9yZTogZnVuY3Rpb24gKGlkLCBzaWQpIHtcbiAgICAgIGlmIChpZCA9PT0gdGhpcy52aWV3LnJvb3QpIHJldHVyblxuICAgICAgaWYgKGlkID09PSAnbmV3JykgcmV0dXJuXG4gICAgICB2YXIgcGxhY2UgPSB0aGlzLm1vZGVsLm1vdmVCZWZvcmVQbGFjZShzaWQsIGlkKVxuICAgICAgaWYgKCFwbGFjZSkgcmV0dXJuXG4gICAgICAvLyBpZiAodGhpcy5tb2RlbC5zYW1lUGxhY2UoaWQsIHBsYWNlKSkgcmV0dXJuXG4gICAgICB0aGlzLmV4ZWN1dGVDb21tYW5kcygnbW92ZScsIFtpZCwgcGxhY2UucGlkLCBwbGFjZS5peF0pXG4gICAgfSxcblxuICAgIG1vdmVUb0FmdGVyOiBmdW5jdGlvbiAoaWQsIHNpZCkge1xuICAgICAgaWYgKGlkID09PSB0aGlzLnZpZXcucm9vdCkgcmV0dXJuXG4gICAgICBpZiAoaWQgPT09ICduZXcnKSByZXR1cm5cbiAgICAgIHZhciBwbGFjZSA9IHRoaXMubW9kZWwubW92ZUFmdGVyUGxhY2Uoc2lkLCBpZClcbiAgICAgIGlmICghcGxhY2UpIHJldHVyblxuICAgICAgLy8gaWYgKHRoaXMubW9kZWwuc2FtZVBsYWNlKGlkLCBwbGFjZSkpIHJldHVyblxuICAgICAgdGhpcy5leGVjdXRlQ29tbWFuZHMoJ21vdmUnLCBbaWQsIHBsYWNlLnBpZCwgcGxhY2UuaXhdKVxuICAgIH0sXG5cbiAgICBtb3ZlSW50bzogZnVuY3Rpb24gKGlkLCBwaWQpIHtcbiAgICAgIGlmIChpZCA9PT0gdGhpcy52aWV3LnJvb3QpIHJldHVyblxuICAgICAgaWYgKGlkID09PSAnbmV3JykgcmV0dXJuXG4gICAgICBpZiAodGhpcy5tb2RlbC5zYW1lUGxhY2UoaWQsIHtwaWQ6IHBpZCwgaXg6IDB9KSkgcmV0dXJuXG4gICAgICBpZiAoIXRoaXMubW9kZWwuaXNDb2xsYXBzZWQocGlkKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5leGVjdXRlQ29tbWFuZHMoJ21vdmUnLCBbaWQsIHBpZCwgMF0pXG4gICAgICB9XG4gICAgICB0aGlzLmV4ZWN1dGVDb21tYW5kcygnY29sbGFwc2UnLCBbcGlkLCBmYWxzZV0sICdtb3ZlJywgW2lkLCBwaWQsIDBdKVxuICAgIH0sXG5cbiAgICBtb3ZlSW50b0xhc3Q6IGZ1bmN0aW9uIChpZCwgcGlkKSB7XG4gICAgICBpZiAoaWQgPT09IHRoaXMudmlldy5yb290KSByZXR1cm5cbiAgICAgIGlmIChpZCA9PT0gJ25ldycpIHJldHVyblxuICAgICAgdmFyIGl4ID0gdGhpcy5tb2RlbC5pZHNbcGlkXS5jaGlsZHJlbi5sZW5ndGhcbiAgICAgIGlmICh0aGlzLm1vZGVsLnNhbWVQbGFjZShpZCwge3BpZDogcGlkLCBpeDogaXh9KSkgcmV0dXJuXG4gICAgICBpZiAoIXRoaXMubW9kZWwuaXNDb2xsYXBzZWQocGlkKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5leGVjdXRlQ29tbWFuZHMoJ21vdmUnLCBbaWQsIHBpZCwgaXhdKVxuICAgICAgfVxuICAgICAgdGhpcy5leGVjdXRlQ29tbWFuZHMoJ2NvbGxhcHNlJywgW3BpZCwgZmFsc2VdLCAnbW92ZScsIFtpZCwgcGlkLCBpeF0pXG4gICAgfSxcblxuICAgIG1vdmVSaWdodDogZnVuY3Rpb24gKGlkKSB7XG4gICAgICBpZiAoaWQgPT09IHRoaXMudmlldy5yb290KSByZXR1cm5cbiAgICAgIGlmIChpZCA9PT0gJ25ldycpIHJldHVyblxuICAgICAgdmFyIHNpYiA9IHRoaXMubW9kZWwucHJldlNpYmxpbmcoaWQsIHRydWUpXG4gICAgICBpZiAodW5kZWZpbmVkID09PSBzaWIpIHJldHVyblxuICAgICAgaWYgKCF0aGlzLm1vZGVsLmlzQ29sbGFwc2VkKHNpYikpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXhlY3V0ZUNvbW1hbmRzKCdtb3ZlJywgW2lkLCBzaWIsIGZhbHNlXSlcbiAgICAgIH1cbiAgICAgIHRoaXMuZXhlY3V0ZUNvbW1hbmRzKCdjb2xsYXBzZScsIFtzaWIsIGZhbHNlXSwgJ21vdmUnLCBbaWQsIHNpYiwgZmFsc2VdKVxuICAgIH0sXG5cbiAgICBtb3ZlTGVmdDogZnVuY3Rpb24gKGlkKSB7XG4gICAgICBpZiAoaWQgPT09IHRoaXMudmlldy5yb290KSByZXR1cm5cbiAgICAgIGlmIChpZCA9PT0gJ25ldycpIHJldHVyblxuICAgICAgaWYgKHRoaXMubW9kZWwuaWRzW2lkXS5wYXJlbnQgPT09IHRoaXMudmlldy5yb290KSByZXR1cm5cbiAgICAgIC8vIFRPRE8gaGFuZGxlIG11bHRpcGxlIHNlbGVjdGVkXG4gICAgICB2YXIgcGxhY2UgPSB0aGlzLm1vZGVsLnNoaWZ0TGVmdFBsYWNlKGlkKVxuICAgICAgaWYgKCFwbGFjZSkgcmV0dXJuXG4gICAgICB0aGlzLmV4ZWN1dGVDb21tYW5kcygnbW92ZScsIFtpZCwgcGxhY2UucGlkLCBwbGFjZS5peF0pXG4gICAgfSxcblxuICAgIG1vdmVVcDogZnVuY3Rpb24gKGlkKSB7XG4gICAgICBpZiAoaWQgPT09IHRoaXMudmlldy5yb290KSByZXR1cm5cbiAgICAgIGlmIChpZCA9PT0gJ25ldycpIHJldHVyblxuICAgICAgLy8gVE9ETyBoYW5kbGUgbXVsdGlwbGUgc2VsZWN0ZWRcbiAgICAgIHZhciBwbGFjZSA9IHRoaXMubW9kZWwuc2hpZnRVcFBsYWNlKGlkKVxuICAgICAgaWYgKCFwbGFjZSkgcmV0dXJuXG4gICAgICBpZiAocGxhY2UucGlkID09PSB0aGlzLm1vZGVsLmlkc1t0aGlzLnZpZXcucm9vdF0ucGFyZW50KSByZXR1cm5cbiAgICAgIHRoaXMuZXhlY3V0ZUNvbW1hbmRzKCdtb3ZlJywgW2lkLCBwbGFjZS5waWQsIHBsYWNlLml4XSlcbiAgICB9LFxuXG4gICAgbW92ZURvd246IGZ1bmN0aW9uIChpZCkge1xuICAgICAgaWYgKGlkID09PSB0aGlzLnZpZXcucm9vdCkgcmV0dXJuXG4gICAgICBpZiAoaWQgPT09ICduZXcnKSByZXR1cm5cbiAgICAgIC8vIFRPRE8gaGFuZGxlIG11bHRpcGxlIHNlbGVjdGVkXG4gICAgICB2YXIgcGxhY2UgPSB0aGlzLm1vZGVsLnNoaWZ0RG93blBsYWNlKGlkKVxuICAgICAgaWYgKCFwbGFjZSkgcmV0dXJuXG4gICAgICBpZiAocGxhY2UucGlkID09PSB0aGlzLm1vZGVsLmlkc1t0aGlzLnZpZXcucm9vdF0ucGFyZW50KSByZXR1cm5cbiAgICAgIHRoaXMuZXhlY3V0ZUNvbW1hbmRzKCdtb3ZlJywgW2lkLCBwbGFjZS5waWQsIHBsYWNlLml4XSlcbiAgICB9LFxuXG4gICAgbW92ZVRvVG9wOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIGlmIChpZCA9PT0gdGhpcy52aWV3LnJvb3QpIHJldHVyblxuICAgICAgaWYgKGlkID09PSAnbmV3JykgcmV0dXJuXG4gICAgICB2YXIgZmlyc3QgPSB0aGlzLm1vZGVsLmZpcnN0U2libGluZyhpZClcbiAgICAgIGlmICh1bmRlZmluZWQgPT09IGZpcnN0KSByZXR1cm5cbiAgICAgIHZhciBwaWQgPSB0aGlzLm1vZGVsLmlkc1tmaXJzdF0ucGFyZW50XG4gICAgICBpZiAocGlkID09PSB1bmRlZmluZWQpIHJldHVyblxuICAgICAgdmFyIGl4ID0gdGhpcy5tb2RlbC5pZHNbcGlkXS5jaGlsZHJlbi5pbmRleE9mKGZpcnN0KVxuICAgICAgdGhpcy5leGVjdXRlQ29tbWFuZHMoJ21vdmUnLCBbaWQsIHBpZCwgaXhdKVxuICAgIH0sXG5cbiAgICBtb3ZlVG9Cb3R0b206IGZ1bmN0aW9uIChpZCkge1xuICAgICAgaWYgKGlkID09PSB0aGlzLnZpZXcucm9vdCkgcmV0dXJuXG4gICAgICBpZiAoaWQgPT09ICduZXcnKSByZXR1cm5cbiAgICAgIHZhciBsYXN0ID0gdGhpcy5tb2RlbC5sYXN0U2libGluZyhpZClcbiAgICAgIGlmICh1bmRlZmluZWQgPT09IGxhc3QpIHJldHVyblxuICAgICAgdmFyIHBpZCA9IHRoaXMubW9kZWwuaWRzW2xhc3RdLnBhcmVudFxuICAgICAgaWYgKHBpZCA9PT0gdW5kZWZpbmVkKSByZXR1cm5cbiAgICAgIHZhciBpeCA9IHRoaXMubW9kZWwuaWRzW3BpZF0uY2hpbGRyZW4uaW5kZXhPZihsYXN0KVxuICAgICAgdGhpcy5leGVjdXRlQ29tbWFuZHMoJ21vdmUnLCBbaWQsIHBpZCwgaXggKyAxXSlcbiAgICB9LFxuXG4gICAgdG9nZ2xlQ29sbGFwc2U6IGZ1bmN0aW9uIChpZCwgeWVzKSB7XG4gICAgICBpZiAodGhpcy5vLm5vQ29sbGFwc2VSb290ICYmIGlkID09PSB0aGlzLnZpZXcucm9vdCkgcmV0dXJuXG4gICAgICBpZiAoaWQgPT09ICduZXcnKSByZXR1cm5cbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHllcyA9ICF0aGlzLm1vZGVsLmhhc0NoaWxkcmVuKGlkKSB8fCAhdGhpcy5tb2RlbC5pc0NvbGxhcHNlZChpZClcbiAgICAgIH1cbiAgICAgIGlmICh5ZXMpIHtcbiAgICAgICAgaWQgPSB0aGlzLm1vZGVsLmZpbmRDb2xsYXBzZXIoaWQpXG4gICAgICAgIGlmICh0aGlzLm8ubm9Db2xsYXBzZVJvb3QgJiYgaWQgPT09IHRoaXMudmlldy5yb290KSByZXR1cm5cbiAgICAgICAgaWYgKCF0aGlzLm1vZGVsLmhhc0NoaWxkcmVuKGlkKSB8fCB0aGlzLm1vZGVsLmlzQ29sbGFwc2VkKGlkKSkgcmV0dXJuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIXRoaXMubW9kZWwuaGFzQ2hpbGRyZW4oaWQpIHx8ICF0aGlzLm1vZGVsLmlzQ29sbGFwc2VkKGlkKSkgcmV0dXJuXG4gICAgICB9XG4gICAgICB0aGlzLmV4ZWN1dGVDb21tYW5kcygnY29sbGFwc2UnLCBbaWQsIHllc10pXG4gICAgfSxcblxuICAgIGFkZENoaWxkOiBmdW5jdGlvbiAocGlkLCBpbmRleCwgY29udGVudCwgY29uZmlnKSB7XG4gICAgICB0aGlzLmV4ZWN1dGVDb21tYW5kcygnbmV3Tm9kZScsIFtwaWQsIGluZGV4LCBjb250ZW50LCBjb25maWddKVxuICAgIH0sXG5cbiAgICBjb21tYW5kczogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5leGVjdXRlQ29tbWFuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuICAgIH0sXG5cbiAgICBhZGRCZWZvcmU6IGZ1bmN0aW9uIChpZCwgdGV4dCwgZm9jdXMpIHtcbiAgICAgIGlmIChpZCA9PT0gdGhpcy52aWV3LnJvb3QpIHJldHVyblxuICAgICAgaWYgKGlkID09PSAnbmV3Jykge1xuICAgICAgICAvLyBUT0RPOiBiZXR0ZXIgYmVoYXZpb3IgaGVyZVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgIHZhciBudyA9IHRoaXMubW9kZWwuaWROZXcoaWQsIHRydWUpXG4gICAgICB0aGlzLmV4ZWN1dGVDb21tYW5kcygnbmV3Tm9kZScsIFtudy5waWQsIG53LmluZGV4LCB0ZXh0XSlcbiAgICAgIGlmIChmb2N1cykgdGhpcy52aWV3LnN0YXJ0RWRpdGluZygpXG4gICAgfSxcblxuICAgIGFkZEFmdGVyOiBmdW5jdGlvbiAoaWQsIHRleHQsIGZvY3VzKSB7XG4gICAgICB2YXIgbndcbiAgICAgIHZhciBlZCA9IGZvY3VzIHx8IHRoaXMudmlldy5tb2RlID09PSAnaW5zZXJ0J1xuICAgICAgLy8gdGhpcy52aWV3LnN0b3BFZGl0aW5nKClcbiAgICAgIGlmIChpZCA9PT0gJ25ldycpIHtcbiAgICAgICAgLy8gVE9ETzogYmV0dGVyIGJlaGF2aW9yIGhlcmVcblxuICAgICAgICBudyA9IHRoaXMudmlldy5yZW1vdmVOZXcoKVxuICAgICAgICB0aGlzLmV4ZWN1dGVDb21tYW5kcyhcbiAgICAgICAgICAnbmV3Tm9kZScsIFtudy5waWQsIG53LmluZGV4KzEsICcnXVxuICAgICAgICApXG4gICAgICAgIGlmIChlZCkgdGhpcy52aWV3LnN0YXJ0RWRpdGluZygpXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgICAgaWYgKGlkID09PSB0aGlzLnZpZXcucm9vdCkge1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMubW9kZWwuaWRzW2lkXVxuICAgICAgICBpZiAoIW5vZGUuY2hpbGRyZW4gfHwgIW5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgaWYgKHRoaXMudmlldy5uZXdOb2RlKSByZXR1cm4gdGhpcy52aWV3LnN0YXJ0RWRpdGluZygnbmV3JylcbiAgICAgICAgICB0aGlzLnZpZXcuYWRkTmV3KGlkLCAwKVxuICAgICAgICAgIHRoaXMudmlldy5zdGFydEVkaXRpbmcoJ25ldycpXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIG53ID0gdGhpcy5tb2RlbC5pZE5ldyhpZCwgZmFsc2UsIHRoaXMudmlldy5yb290KVxuICAgICAgdGhpcy5leGVjdXRlQ29tbWFuZHMoJ25ld05vZGUnLCBbbncucGlkLCBudy5pbmRleCwgdGV4dF0pXG4gICAgICBpZiAoZWQpIHRoaXMudmlldy5zdGFydEVkaXRpbmcoKVxuICAgIH0sXG5cbiAgICByZW1vdmU6IGZ1bmN0aW9uIChpZCwgYWRkVGV4dCkge1xuICAgICAgaWYgKGlkID09PSB0aGlzLnZpZXcucm9vdCkgcmV0dXJuXG4gICAgICBpZiAoaWQgPT09ICduZXcnKSByZXR1cm5cbiAgICAgIHZhciBiZWZvcmUgPSB0aGlzLm1vZGVsLmlkQWJvdmUoaWQpXG4gICAgICB0aGlzLmV4ZWN1dGVDb21tYW5kcyhcbiAgICAgICAgJ3JlbW92ZScsIFtpZF0sXG4gICAgICAgICdhcHBlbmRUZXh0JywgW2JlZm9yZSwgYWRkVGV4dCB8fCAnJ11cbiAgICAgIClcbiAgICB9LFxuXG4gICAgc2V0RWRpdGluZzogJ3ZpZXcnLFxuICAgIGRvbmVFZGl0aW5nOiAndmlldydcbiAgfVxufVxuXG4iLCJcbm1vZHVsZS5leHBvcnRzID0ge1xuICB2aXN1YWw6IHtcbiAgICAnc2VsZWN0IHVwJzogJ2ssIHVwJyxcbiAgICAnc2VsZWN0IGRvd24nOiAnaiwgZG93bicsXG4gICAgJ3NlbGVjdCB0byBib3R0b20nOiAnc2hpZnQrZycsXG4gICAgJ3NlbGVjdCB0byB0b3AnOiAnZyBnJyxcbiAgICAnc3RvcCBzZWxlY3RpbmcnOiAndiwgc2hpZnQrdiwgZXNjYXBlJyxcbiAgICAnZWRpdCc6ICdhLCBzaGlmdCthJyxcbiAgICAnZWRpdCBzdGFydCc6ICdpLCBzaGlmdCtpJyxcbiAgICAnY3V0JzogJ2QsIHNoaWZ0K2QsIGN0cmwreCcsXG4gICAgJ2NvcHknOiAneSwgc2hpZnQreSwgY3RybCtjJyxcbiAgICAndW5kbyc6ICd1LCBjdHJsK3onLFxuICAgICdyZWRvJzogJ3NoaWZ0K3IsIGN0cmwrc2hpZnQreidcbiAgfSxcbiAgdmlldzoge1xuICAgIGJhc2U6IHtcbiAgICAgICdjdXQnOiAnY21kK3gsIGRlbGV0ZSwgZCBkJyxcbiAgICAgICdjb3B5JzogJ2NtZCtjLCB5IHknLFxuICAgICAgJ3Bhc3RlJzogJ3AsIGNtZCt2JyxcbiAgICAgICdwYXN0ZSBhYm92ZSc6ICdzaGlmdCtwLCBjbWQrc2hpZnQrdicsXG4gICAgICAndmlzdWFsIG1vZGUnOiAndiwgc2hpZnQrdicsXG5cbiAgICAgICdjaGFuZ2UnOiAnYyBjLCBzaGlmdCtjJyxcbiAgICAgICdlZGl0JzogJ3JldHVybiwgYSwgc2hpZnQrYSwgZjInLFxuICAgICAgJ2VkaXQgc3RhcnQnOiAnaSwgc2hpZnQraScsXG4gICAgICAnZmlyc3Qgc2libGluZyc6ICdzaGlmdCtbJyxcbiAgICAgICdsYXN0IHNpYmxpbmcnOiAnc2hpZnQrXScsXG4gICAgICAnbW92ZSB0byBmaXJzdCBzaWJsaW5nJzogJ2N0cmwrc2hpZnQrWycsXG4gICAgICAnbW92ZSB0byBsYXN0IHNpYmxpbmcnOiAnY3RybCtzaGlmdCtdJyxcbiAgICAgICduZXcgYWZ0ZXInOiAnbycsXG4gICAgICAnbmV3IGJlZm9yZSc6ICdzaGlmdCtvJyxcbiAgICAgICdqdW1wIHRvIHRvcCc6ICdnIGcnLFxuICAgICAgJ2p1bXAgdG8gYm90dG9tJzogJ3NoaWZ0K2cnLFxuICAgICAgJ3VwJzogJ3VwLCBrJyxcbiAgICAgICdkb3duJzogJ2Rvd24sIGonLFxuICAgICAgJ2xlZnQnOiAnbGVmdCwgaCcsXG4gICAgICAncmlnaHQnOiAncmlnaHQsIGwnLFxuICAgICAgJ25leHQgc2libGluZyc6ICdhbHQraiwgYWx0K2Rvd24nLFxuICAgICAgJ3ByZXYgc2libGluZyc6ICdhbHQraywgYWx0K3VwJyxcbiAgICAgICd0b2dnbGUgY29sbGFwc2UnOiAneicsXG4gICAgICAnY29sbGFwc2UnOiAnYWx0K2gsIGFsdCtsZWZ0JyxcbiAgICAgICd1bmNvbGxhcHNlJzogJ2FsdCtsLCBhbHQrcmlnaHQnLFxuICAgICAgJ2luZGVudCc6ICd0YWIsIHNoaWZ0K2FsdCtsLCBzaGlmdCthbHQrcmlnaHQnLFxuICAgICAgJ2RlZGVudCc6ICdzaGlmdCt0YWIsIHNoaWZ0K2FsdCtoLCBzaGlmdCthbHQrbGVmdCcsXG4gICAgICAnbW92ZSBkb3duJzogJ3NoaWZ0K2FsdCtqLCBzaGlmdCthbHQrZG93bicsXG4gICAgICAnbW92ZSB1cCc6ICdzaGlmdCthbHQraywgc2hpZnQrYWx0K2ksIHNoaWZ0K2FsdCt1cCcsXG4gICAgICAndW5kbyc6ICdjdHJsK3osIHUnLFxuICAgICAgJ3JlZG8nOiAnY3RybCtzaGlmdCt6LCBzaGlmdCtyJyxcbiAgICB9LFxuXG4gICAgbWFjOiB7XG4gICAgfSxcbiAgICBwYzoge1xuICAgIH1cbiAgfSxcbn1cblxuXG4iLCJcbm1vZHVsZS5leHBvcnRzID0gRGVmYXVsdE5vZGVcblxudmFyIEJhc2VOb2RlID0gcmVxdWlyZSgnLi9iYXNlLW5vZGUnKVxuXG5pZiAod2luZG93Lm1hcmtlZCkge1xuICB2YXIgcmVuZGVyZXIgPSBuZXcgbWFya2VkLlJlbmRlcmVyKClcbiAgcmVuZGVyZXIubGluayA9IGZ1bmN0aW9uIChocmVmLCB0aXRsZSwgdGV4dCkge1xuICAgIHJldHVybiAnPGEgaHJlZj1cIicgKyBocmVmICsgJ1wiIHRhcmdldD1cIl9ibGFua1wiIHRpdGxlPVwiJyArIHRpdGxlICsgJ1wiPicgKyB0ZXh0ICsgJzwvYT4nO1xuICB9XG4gIG1hcmtlZC5zZXRPcHRpb25zKHtcbiAgICBnZm06IHRydWUsXG4gICAgc2FuaXRpemU6IHRydWUsXG4gICAgdGFibGVzOiB0cnVlLFxuICAgIGJyZWFrczogdHJ1ZSxcbiAgICBwZWRhbnRpYzogZmFsc2UsXG4gICAgc2FuaXRpemU6IGZhbHNlLFxuICAgIHNtYXJ0TGlzdHM6IHRydWUsXG4gICAgc21hcnR5cGFudHM6IHRydWUsXG4gICAgcmVuZGVyZXI6IHJlbmRlcmVyXG4gIH0pXG59XG5cbmZ1bmN0aW9uIERlZmF1bHROb2RlKGNvbnRlbnQsIG1ldGEsIG9wdGlvbnMsIGlzTmV3LCBtb2RlbEFjdGlvbnMpIHtcbiAgQmFzZU5vZGUuY2FsbCh0aGlzLCBjb250ZW50LCBtZXRhLCBvcHRpb25zLCBpc05ldywgbW9kZWxBY3Rpb25zKVxufVxuXG5EZWZhdWx0Tm9kZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEJhc2VOb2RlLnByb3RvdHlwZSlcbkRlZmF1bHROb2RlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IERlZmF1bHROb2RlXG5cbmZ1bmN0aW9uIHRtZXJnZShhLCBiKSB7XG4gIGZvciAodmFyIGMgaW4gYikge1xuICAgIGFbY10gPSBiW2NdXG4gIH1cbn1cblxuZnVuY3Rpb24gZXNjYXBlSHRtbChzdHIpIHtcbiAgaWYgKCFzdHIpIHJldHVybiAnJztcbiAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBkaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoc3RyKSk7XG4gIHJldHVybiBkaXYuaW5uZXJIVE1MO1xufTtcblxuZnVuY3Rpb24gdW5Fc2NhcGVIdG1sKHN0cikge1xuICBpZiAoIXN0cikgcmV0dXJuICcnO1xuICByZXR1cm4gc3RyXG4gICAgLnJlcGxhY2UoLzxkaXY+L2csICdcXG4nKS5yZXBsYWNlKC88YnI+L2csICdcXG4nKVxuICAgIC5yZXBsYWNlKC88XFwvZGl2Pi9nLCAnJylcbiAgICAucmVwbGFjZSgvXFx1MjAwYi9nLCAnJylcbn1cblxudG1lcmdlKERlZmF1bHROb2RlLnByb3RvdHlwZSwge1xuICBzZXRJbnB1dFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLmlucHV0LmlubmVySFRNTCA9IHZhbHVlXG4gIH0sXG5cbiAgZ2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB1bkVzY2FwZUh0bWwodGhpcy5pbnB1dC5pbm5lckhUTUwpXG4gIH0sXG5cbiAgZ2V0VmlzaWJsZVZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLmlucHV0LmZpcnN0Q2hpbGQpIHJldHVybiAnJ1xuICAgIHJldHVybiB0aGlzLmlucHV0LmZpcnN0Q2hpbGQudGV4dENvbnRlbnRcbiAgfSxcblxuICBpc011bHRpTGluZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmlucHV0LmlubmVySFRNTC5tYXRjaCgvKDxkaXY+fDxicnxcXG4pL2cpXG4gIH0sXG5cbiAgc3BsaXRSaWdodE9mQ3Vyc29yOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRleHQgPSB0aGlzLmdldFZpc2libGVWYWx1ZSgpXG4gICAgICAsIHMgPSB0aGlzLmdldFNlbGVjdGlvblBvc2l0aW9uKClcbiAgICAgICwgbGVmdCA9IGVzY2FwZUh0bWwodGV4dC5zbGljZSgwLCBzKSlcbiAgICAgICwgcmlnaHQgPSBlc2NhcGVIdG1sKHRleHQuc2xpY2UocykpXG4gICAgaWYgKCFyaWdodCkgcmV0dXJuXG4gICAgdGhpcy5zZXRJbnB1dFZhbHVlKGxlZnQpXG4gICAgdGhpcy5zZXRUZXh0Q29udGVudChsZWZ0KVxuICAgIGlmICghdGhpcy5pc05ldykgdGhpcy5vLmNoYW5nZUNvbnRlbnQobGVmdClcbiAgICByZXR1cm4gcmlnaHRcbiAgfSxcblxuICBzZXRUZXh0Q29udGVudDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy50ZXh0LmlubmVySFRNTCA9IHZhbHVlID8gbWFya2VkKHZhbHVlICsgJycpIDogJydcbiAgfSxcblxuICBzZXR1cE5vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuXG4gICAgdGhpcy5pbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy5pbnB1dC5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScsIHRydWUpXG4gICAgdGhpcy5pbnB1dC5jbGFzc0xpc3QuYWRkKCd0cmVlZF9faW5wdXQnKVxuXG4gICAgdGhpcy50ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLnRleHQuY2xhc3NMaXN0LmFkZCgndHJlZWRfX3RleHQnKVxuICAgIHRoaXMubm9kZS5jbGFzc0xpc3QuYWRkKCd0cmVlZF9fZGVmYXVsdC1ub2RlJylcblxuICAgIHRoaXMuc2V0VGV4dENvbnRlbnQodGhpcy5jb250ZW50KVxuICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZCh0aGlzLnRleHQpXG4gICAgdGhpcy5yZWdpc3Rlckxpc3RlbmVycygpO1xuICB9LFxuXG4gIGlzQXRUb3A6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYmIgPSB0aGlzLmlucHV0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICAsIHNlbHIgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKS5nZXRDbGllbnRSZWN0cygpWzBdXG4gICAgcmV0dXJuIHNlbHIudG9wIDwgYmIudG9wICsgNVxuICB9LFxuXG4gIGlzQXRCb3R0b206IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYmIgPSB0aGlzLmlucHV0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICAsIHNlbHIgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKS5nZXRDbGllbnRSZWN0cygpWzBdXG4gICAgcmV0dXJuIHNlbHIuYm90dG9tID4gYmIuYm90dG9tIC0gNVxuICB9LFxuXG4gIGdldFNlbGVjdGlvblBvc2l0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKVxuICAgICAgLCByYW4gPSBzZWwuZ2V0UmFuZ2VBdCgwKVxuICAgIHJldHVybiByYW4uc3RhcnRPZmZzZXRcbiAgfSxcblxuICBzdGFydEVkaXRpbmc6IGZ1bmN0aW9uIChmcm9tU3RhcnQpIHtcbiAgICBpZiAodGhpcy5lZGl0aW5nKSByZXR1cm5cbiAgICB0aGlzLmVkaXRpbmcgPSB0cnVlO1xuICAgIHRoaXMuc2V0SW5wdXRWYWx1ZSh0aGlzLmNvbnRlbnQpXG4gICAgdGhpcy5ub2RlLnJlcGxhY2VDaGlsZCh0aGlzLmlucHV0LCB0aGlzLnRleHQpXG4gICAgdGhpcy5pbnB1dC5mb2N1cygpO1xuICAgIHRoaXMuc2V0U2VsZWN0aW9uKCFmcm9tU3RhcnQpXG4gICAgdGhpcy5vLnNldEVkaXRpbmcoKVxuICB9LFxuXG4gIHN0b3BFZGl0aW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLmVkaXRpbmcpIHJldHVyblxuICAgIGNvbnNvbGUubG9nKCdzdG9wIGVkZGludCcsIHRoaXMuaXNOZXcpXG4gICAgdmFyIHZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKClcbiAgICB0aGlzLmVkaXRpbmcgPSBmYWxzZVxuICAgIHRoaXMubm9kZS5yZXBsYWNlQ2hpbGQodGhpcy50ZXh0LCB0aGlzLmlucHV0KVxuICAgIHRoaXMuby5kb25lRWRpdGluZygpO1xuICAgIGlmICh0aGlzLmNvbnRlbnQgIT0gdmFsdWUgfHwgdGhpcy5pc05ldykge1xuICAgICAgdGhpcy5zZXRUZXh0Q29udGVudCh2YWx1ZSlcbiAgICAgIHRoaXMuY29udGVudCA9IHZhbHVlXG4gICAgICB0aGlzLm8uY2hhbmdlQ29udGVudCh0aGlzLmNvbnRlbnQpXG4gICAgfVxuICB9LFxuXG4gIGlzQXRTdGFydDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFNlbGVjdGlvblBvc2l0aW9uKCkgPT09IDBcbiAgfSxcblxuICBpc0F0RW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS53YXJuKFwiVEhJUyBJUyBXUk9OR1wiKVxuICAgIHJldHVybiBmYWxzZVxuICB9LFxuXG4gIGFkZEVkaXRUZXh0OiBmdW5jdGlvbiAodGV4dCkge1xuICAgIHZhciBwbCA9IHRoaXMuY29udGVudC5sZW5ndGhcbiAgICB0aGlzLmNvbnRlbnQgKz0gdGV4dFxuICAgIHRoaXMuc2V0SW5wdXRWYWx1ZSh0aGlzLmNvbnRlbnQpXG4gICAgdGhpcy5zZXRUZXh0Q29udGVudCh0aGlzLmNvbnRlbnQpXG4gICAgaWYgKCF0aGlzLmVkaXRpbmcpIHtcbiAgICAgIHRoaXMuZWRpdGluZyA9IHRydWU7XG4gICAgICB0aGlzLm5vZGUucmVwbGFjZUNoaWxkKHRoaXMuaW5wdXQsIHRoaXMudGV4dClcbiAgICAgIHRoaXMuby5zZXRFZGl0aW5nKCk7XG4gICAgfVxuICAgIHRoaXMuc2V0U2VsZWN0aW9uKHBsKVxuICB9LFxuXG4gIHNldENvbnRlbnQ6IGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgdGhpcy5jb250ZW50ID0gY29udGVudFxuICAgIHRoaXMuc2V0SW5wdXRWYWx1ZShjb250ZW50KVxuICAgIHRoaXMuc2V0VGV4dENvbnRlbnQoY29udGVudClcbiAgfSxcblxuICByZWdpc3Rlckxpc3RlbmVyczogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudGV4dC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0Lm5vZGVOYW1lID09ICdBJykge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgIHRoaXMuc3RhcnRFZGl0aW5nKCk7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH0uYmluZCh0aGlzKSlcblxuICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLnN0b3BFZGl0aW5nKCk7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICB2YXIga2V5SGFuZGxlciA9IHRoaXMua2V5SGFuZGxlcigpXG5cbiAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgcmV0dXJuIGtleUhhbmRsZXIoZSlcbiAgICB9KVxuXG4gIH0sXG5cbiAgc2V0U2VsZWN0aW9uOiBmdW5jdGlvbiAoZW5kKSB7XG4gICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKVxuICAgIHNlbC5zZWxlY3RBbGxDaGlsZHJlbih0aGlzLmlucHV0KVxuICAgIHRyeSB7XG4gICAgICBzZWxbJ2NvbGxhcHNlVG8nICsgKGVuZCA/ICdFbmQnIDogJ1N0YXJ0JyldKClcbiAgICB9IGNhdGNoIChlKSB7fVxuICB9LFxuXG59KVxuXG4iLCJcbm1vZHVsZS5leHBvcnRzID0gRHVuZ2VvbnNBbmREcmFnb25zXG5cbmZ1bmN0aW9uIGZpbmRUYXJnZXQodGFyZ2V0cywgZSkge1xuICBmb3IgKHZhciBpPTA7IGk8dGFyZ2V0cy5sZW5ndGg7IGkrKykge1xuICAgIGlmICh0YXJnZXRzW2ldLnRvcCA+IGUuY2xpZW50WSkge1xuICAgICAgcmV0dXJuIHRhcmdldHNbaSA+IDAgPyBpLTEgOiAwXVxuICAgIH1cbiAgfVxuICByZXR1cm4gdGFyZ2V0c1t0YXJnZXRzLmxlbmd0aC0xXVxufVxuXG4vLyBNYW5hZ2VzIERyYWdnaW5nIE4gRHJvcHBpbmdcbmZ1bmN0aW9uIER1bmdlb25zQW5kRHJhZ29ucyh2bCwgYWN0aW9uLCBmaW5kRnVuY3Rpb24pIHtcbiAgdGhpcy52bCA9IHZsXG4gIHRoaXMuYWN0aW9uID0gYWN0aW9uXG4gIHRoaXMuZmluZEZ1bmN0aW9uID0gZmluZEZ1bmN0aW9uIHx8IGZpbmRUYXJnZXRcbn1cblxuRHVuZ2VvbnNBbmREcmFnb25zLnByb3RvdHlwZSA9IHtcbiAgc3RhcnRNb3Zpbmc6IGZ1bmN0aW9uICh0YXJnZXRzLCBpZCkge1xuICAgIHRoaXMubW92aW5nID0ge1xuICAgICAgdGFyZ2V0czogdGFyZ2V0cyxcbiAgICAgIHNoYWRvdzogdGhpcy52bC5tYWtlRHJvcFNoYWRvdygpLFxuICAgICAgY3VycmVudDogbnVsbFxuICAgIH1cbiAgICB0aGlzLnZsLnNldE1vdmluZyhpZCwgdHJ1ZSlcblxuICAgIHZhciBvbk1vdmUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpcy5kcmFnKGlkLCBlKVxuICAgIH0uYmluZCh0aGlzKVxuXG4gICAgdmFyIG9uVXAgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnJ1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgb25Nb3ZlKVxuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIG9uVXApXG4gICAgICB0aGlzLmRyb3AoaWQsIGUpXG4gICAgfS5iaW5kKHRoaXMpXG5cbiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICdtb3ZlJ1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG9uTW92ZSlcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgb25VcClcbiAgfSxcblxuICBkcmFnOiBmdW5jdGlvbiAoaWQsIGUpIHtcbiAgICBpZiAodGhpcy5tb3ZpbmcuY3VycmVudCkge1xuICAgICAgdGhpcy52bC5zZXREcm9wcGluZyh0aGlzLm1vdmluZy5jdXJyZW50LmlkLCBmYWxzZSwgdGhpcy5tb3ZpbmcuY3VycmVudC5wbGFjZSA9PT0gJ2NoaWxkJylcbiAgICB9XG4gICAgdmFyIHRhcmdldCA9IHRoaXMuZmluZEZ1bmN0aW9uKHRoaXMubW92aW5nLnRhcmdldHMsIGUpXG4gICAgdGhpcy5tb3Zpbmcuc2hhZG93Lm1vdmVUbyh0YXJnZXQpXG4gICAgdGhpcy5tb3ZpbmcuY3VycmVudCA9IHRhcmdldFxuICAgIHRoaXMudmwuc2V0RHJvcHBpbmcodGFyZ2V0LmlkLCB0cnVlLCB0aGlzLm1vdmluZy5jdXJyZW50LnBsYWNlID09PSAnY2hpbGQnKVxuICB9LFxuXG4gIGRyb3A6IGZ1bmN0aW9uIChpZCwgZSkge1xuICAgIHRoaXMubW92aW5nLnNoYWRvdy5yZW1vdmUoKVxuICAgIHZhciBjdXJyZW50ID0gdGhpcy5tb3ZpbmcuY3VycmVudFxuICAgIHRoaXMudmwuc2V0TW92aW5nKGlkLCBmYWxzZSlcbiAgICBpZiAoIXRoaXMubW92aW5nLmN1cnJlbnQpIHJldHVyblxuICAgIHRoaXMudmwuc2V0RHJvcHBpbmcoY3VycmVudC5pZCwgZmFsc2UsIGN1cnJlbnQucGxhY2UgPT09ICdjaGlsZCcpXG4gICAgaWYgKGN1cnJlbnQuaWQgPT09IGlkKSByZXR1cm5cbiAgICB0aGlzLmFjdGlvbihjdXJyZW50LnBsYWNlLCBpZCwgY3VycmVudC5pZClcbiAgICB0aGlzLm1vdmluZyA9IGZhbHNlXG4gIH0sXG59XG5cbiIsIlxudmFyIERyb3BTaGFkb3cgPSByZXF1aXJlKCcuL2Ryb3Atc2hhZG93JylcbiAgLCBzbGlkZURvd24gPSByZXF1aXJlKCcuL3NsaWRlLWRvd24nKVxuICAsIHNsaWRlVXAgPSByZXF1aXJlKCcuL3NsaWRlLXVwJylcbiAgLCB1dGlsID0gcmVxdWlyZSgnLi91dGlsJylcblxubW9kdWxlLmV4cG9ydHMgPSBEb21WaWV3TGF5ZXJcblxuLyoqXG4gKiBvOiBvcHRpb25zIC0+IHsgTm9kZTogdGhlIGNsYXNzIH1cbiAqL1xuZnVuY3Rpb24gRG9tVmlld0xheWVyKG8pIHtcbiAgdGhpcy5kb20gPSB7fVxuICB0aGlzLnJvb3QgPSBudWxsXG4gIHRoaXMubyA9IHV0aWwubWVyZ2Uoe1xuICAgIGFuaW1hdGU6IHRydWVcbiAgfSwgbylcbn1cblxuRG9tVmlld0xheWVyLnByb3RvdHlwZSA9IHtcbiAgLyoqXG4gICAqIEZvcmdldCBhYm91dCBhbGwgbm9kZXMgLSB0aGV5IHdpbGwgYmUgZGlzcG9zZWQgb2ZcbiAgICovXG4gIGNsZWFyOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5kb20gPSB7fVxuICB9LFxuXG4gIC8qKlxuICAgKiByb290OiB0aGUgb2xkIHJvb3QgdGhhdCBpcyB0byBiZSByZXBsYWNlZFxuICAgKi9cbiAgcmViYXNlOiBmdW5jdGlvbiAocm9vdCkge1xuICAgIGlmIChyb290LnBhcmVudE5vZGUpIHtcbiAgICAgIHJvb3QucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQodGhpcy5yb290LCByb290KVxuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogUmVjdXJzaXZlbHkgZ2VuZXJhdGUgdGhlIGRyb3AgdGFyZ2V0IGRlZmluaXRpb25zIGZvciBhbGwgb2YgdGhlIHZpc2libGVcbiAgICogbm9kZXMgdW5kZXIgYSBnaXZlbiByb290LlxuICAgKlxuICAgKiByb290OiB0aGUgaWQgb2YgdGhlIG5vZGUgdG8gc3RhcnQgZnJvbVxuICAgKiBtb2RlbDogdGhlIG1vZGVsIC0gdG8gZmluZCBjaGlsZHJlblxuICAgKiBtb3Zpbmc6IHRoZSBpZCBvZiB0aGUgbm9kZSB0aGF0J3MgbW92aW5nIC0gc28gdGhhdCB5b3Ugd29uJ3QgZHJvcCBhIG5vZGVcbiAgICogICAgICAgICBpbnNpZGUgaXRzZWxmXG4gICAqIHRvcDogb25seSB0cnVlIHRoZSBmaXJzdCBjYWxsLCBkZXRlcm1pbmVzIGlmIGl0J3MgdGhlIHJvb3Qgbm9kZSAoZS5nLiBub1xuICAgKiAgICAgIGRyb3AgdGFyZ2V0IGFib3ZlKVxuICAgKi9cbiAgZHJvcFRhcmdldHM6IGZ1bmN0aW9uIChyb290LCBtb2RlbCwgbW92aW5nLCB0b3ApIHtcbiAgICB2YXIgdGFyZ2V0cyA9IFtdXG4gICAgICAsIGJjID0gdGhpcy5kb21bcm9vdF0uaGVhZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgICAgLCB0YXJnZXRcbiAgICAgICwgY2hpbGRUYXJnZXRcblxuICAgIGlmICghdG9wKSB7XG4gICAgICB0YXJnZXRzLnB1c2goe1xuICAgICAgICBpZDogcm9vdCxcbiAgICAgICAgdG9wOiBiYy50b3AsXG4gICAgICAgIGxlZnQ6IGJjLmxlZnQsXG4gICAgICAgIHdpZHRoOiBiYy53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBiYy5oZWlnaHQsXG4gICAgICAgIHBsYWNlOiAnYmVmb3JlJyxcbiAgICAgICAgc2hvdzoge1xuICAgICAgICAgIGxlZnQ6IGJjLmxlZnQsLy8gKyAyMCxcbiAgICAgICAgICB3aWR0aDogYmMud2lkdGgsLy8gLSAyMCxcbiAgICAgICAgICB5OiBiYy50b3BcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gICAgaWYgKHJvb3QgPT09IG1vdmluZykgcmV0dXJuIHRhcmdldHNcblxuICAgIGlmIChtb2RlbC5pc0NvbGxhcHNlZChyb290KSAmJiAhdG9wKSByZXR1cm4gdGFyZ2V0c1xuICAgIHZhciBjaCA9IG1vZGVsLmlkc1tyb290XS5jaGlsZHJlblxuICAgIGlmIChjaCkge1xuICAgICAgZm9yICh2YXIgaT0wOyBpPGNoLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRhcmdldHMgPSB0YXJnZXRzLmNvbmNhdCh0aGlzLmRyb3BUYXJnZXRzKGNoW2ldLCBtb2RlbCwgbW92aW5nKSlcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRvcCkge1xuICAgICAgdmFyIGJvZHlCb3ggPSB0aGlzLmRvbVtyb290XS51bC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgICAgdGFyZ2V0cy5wdXNoKHtcbiAgICAgICAgaWQ6IHJvb3QsXG4gICAgICAgIHRvcDogYm9keUJveC5ib3R0b20sXG4gICAgICAgIGxlZnQ6IGJvZHlCb3gubGVmdCxcbiAgICAgICAgd2lkdGg6IGJvZHlCb3gud2lkdGgsXG4gICAgICAgIGhlaWdodDogYmMuaGVpZ2h0LFxuICAgICAgICBwbGFjZTogJ2xhc3RDaGlsZCcsXG4gICAgICAgIHNob3c6IHtcbiAgICAgICAgICBsZWZ0OiBib2R5Qm94LmxlZnQsLy8gKyAyMCxcbiAgICAgICAgICB3aWR0aDogYm9keUJveC53aWR0aCwvLyAtIDIwLFxuICAgICAgICAgIHk6IGJvZHlCb3guYm90dG9tXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuICAgIHJldHVybiB0YXJnZXRzXG4gIH0sXG5cbiAgbWFrZURyb3BTaGFkb3c6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IERyb3BTaGFkb3coKVxuICB9LFxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYSBub2RlXG4gICAqXG4gICAqIGlkOiB0aGUgbm9kZSB0byByZW1vdmVcbiAgICogcGlkOiB0aGUgcGFyZW50IGlkXG4gICAqIGxhc3RjaGlsZDogd2hldGhlciB0aGUgbm9kZSB3YXMgdGhlIGxhc3QgY2hpbGRcbiAgICovXG4gIHJlbW92ZTogZnVuY3Rpb24gKGlkLCBwaWQsIGxhc3RjaGlsZCkge1xuICAgIHZhciBuID0gdGhpcy5kb21baWRdXG4gICAgaWYgKCFuIHx8ICFuLm1haW4ucGFyZW50Tm9kZSkgcmV0dXJuXG4gICAgdHJ5IHtcbiAgICAgIG4ubWFpbi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG4ubWFpbilcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgZGVsZXRlIHRoaXMuZG9tW2lkXVxuICAgIGlmIChsYXN0Y2hpbGQpIHtcbiAgICAgIHRoaXMuZG9tW3BpZF0ubWFpbi5jbGFzc0xpc3QucmVtb3ZlKCd0cmVlZF9faXRlbS0tcGFyZW50JylcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIEFkZCBhIG5ldyBub2RlIC0gdGhpcyBpcyBwdWJsaWMgZmFjaW5nXG4gICAqXG4gICAqIG5vZGU6IG9iamVjdCBsb29rcyBsaWtlIHtpZDosIGNvbnRlbnQ6LCBtZXRhOiwgcGFyZW50On1cbiAgICogYm91bmRzOiBhbiBvYmplY3Qgb2YgYWN0aW9uIGZ1bmN0aW9uc1xuICAgKiBiZWZvcmU6IHRoZSBpZCBiZWZvcmUgd2hpY2ggdG8gYWRkXG4gICAqIGNoaWxkcmVuOiB3aGV0aGVyIHRoZSBuZXcgbm9kZSBoYXMgY2hpbGRyZW5cbiAgICovXG4gIGFkZE5ldzogZnVuY3Rpb24gKG5vZGUsIGJvdW5kcywgbW9kZWxBY3Rpb25zLCBiZWZvcmUsIGNoaWxkcmVuKSB7XG4gICAgdmFyIGRvbSA9IHRoaXMubWFrZU5vZGUobm9kZS5pZCwgbm9kZS5jb250ZW50LCBub2RlLm1ldGEsIG5vZGUuZGVwdGggLSB0aGlzLnJvb3REZXB0aCwgYm91bmRzLCBtb2RlbEFjdGlvbnMpXG4gICAgdGhpcy5hZGQobm9kZS5wYXJlbnQsIGJlZm9yZSwgZG9tLCBjaGlsZHJlbilcbiAgICBpZiAobm9kZS5jb2xsYXBzZWQgJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgIHRoaXMuc2V0Q29sbGFwc2VkKG5vZGUuaWQsIHRydWUpXG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBmdW5jdGlvbiBmb3IgYWRkaW5nIHRoaW5nc1xuICAgKi9cbiAgYWRkOiBmdW5jdGlvbiAocGFyZW50LCBiZWZvcmUsIGRvbSwgY2hpbGRyZW4pIHtcbiAgICB2YXIgcCA9IHRoaXMuZG9tW3BhcmVudF1cbiAgICBpZiAoYmVmb3JlID09PSBmYWxzZSkge1xuICAgICAgcC51bC5hcHBlbmRDaGlsZChkb20pXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBiZWYgPSB0aGlzLmRvbVtiZWZvcmVdXG4gICAgICBwLnVsLmluc2VydEJlZm9yZShkb20sIGJlZi5tYWluKVxuICAgIH1cbiAgICBwLm1haW4uY2xhc3NMaXN0LmFkZCgndHJlZWRfX2l0ZW0tLXBhcmVudCcpXG4gICAgaWYgKGNoaWxkcmVuKSB7XG4gICAgICBkb20uY2xhc3NMaXN0LmFkZCgndHJlZWRfX2l0ZW0tLXBhcmVudCcpXG4gICAgfVxuICB9LFxuXG4gIGNsZWFyQ2hpbGRyZW46IGZ1bmN0aW9uIChpZCkge1xuICAgIHZhciB1bCA9IHRoaXMuZG9tW2lkXS51bFxuICAgIHdoaWxlICh1bC5sYXN0Q2hpbGQpIHtcbiAgICAgIHVsLnJlbW92ZUNoaWxkKHVsLmxhc3RDaGlsZClcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldCBhIGJvZHlcbiAgICovXG4gIGJvZHk6IGZ1bmN0aW9uIChpZCkge1xuICAgIGlmICghdGhpcy5kb21baWRdKSByZXR1cm5cbiAgICByZXR1cm4gdGhpcy5kb21baWRdLmJvZHlcbiAgfSxcblxuICAvKipcbiAgICogTW92ZSBhIG5vZGUgZnJvbSBvbmUgcGxhY2UgdG8gYW5vdGhlclxuICAgKlxuICAgKiBpZDogICAgICAgIHRoZSBpZCBvZiB0aGUgbm9kZSB0aGF0J3MgbW92aW5nXG4gICAqIHBpZDogICAgICAgdGhlIHBhcmVudCBpZCB0byBtb3ZlIGl0IHRvXG4gICAqIGJlZm9yZTogICAgdGhlIG5vZGUgaWQgYmVmb3JlIHdoaWNoIHRvIG1vdmUgaXQuIGBmYWxzZWAgdG8gYXBwZW5kXG4gICAqIHBwaWQ6ICAgICAgdGhlIHByZXZpb3VzIHBhcmVudCBpZFxuICAgKiBsYXN0Y2hpbGQ6IHdoZXRoZXIgdGhpcyB3YXMgdGhlIGxhc3QgY2hpbGQgb2YgdGhlIHByZXZpb3VzIHBhcmVudFxuICAgKiAgICAgICAgICAgIChsZWF2aW5nIHRoYXQgcGFyZW50IGNoaWxkbGVzcylcbiAgICovXG4gIG1vdmU6IGZ1bmN0aW9uIChpZCwgcGlkLCBiZWZvcmUsIHBwaWQsIGxhc3RjaGlsZCkge1xuICAgIHZhciBkID0gdGhpcy5kb21baWRdXG4gICAgZC5tYWluLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZC5tYWluKVxuICAgIGlmIChsYXN0Y2hpbGQpIHtcbiAgICAgIHRoaXMuZG9tW3BwaWRdLm1haW4uY2xhc3NMaXN0LnJlbW92ZSgndHJlZWRfX2l0ZW0tLXBhcmVudCcpXG4gICAgfVxuICAgIGlmIChiZWZvcmUgPT09IGZhbHNlKSB7XG4gICAgICB0aGlzLmRvbVtwaWRdLnVsLmFwcGVuZENoaWxkKGQubWFpbilcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kb21bcGlkXS51bC5pbnNlcnRCZWZvcmUoZC5tYWluLCB0aGlzLmRvbVtiZWZvcmVdLm1haW4pXG4gICAgfVxuICAgIHRoaXMuZG9tW3BpZF0ubWFpbi5jbGFzc0xpc3QuYWRkKCd0cmVlZF9faXRlbS0tcGFyZW50JylcbiAgfSxcblxuICAvKipcbiAgICogUmVtb3ZlIHRoZSBzZWxlY3Rpb24gZnJvbSBhIHNldCBvZiBub2Rlc1xuICAgKlxuICAgKiBzZWxlY3Rpb246IFtpZCwgLi4uXSBub2RlcyB0byBkZXNlbGVjdFxuICAgKi9cbiAgY2xlYXJTZWxlY3Rpb246IGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcbiAgICBmb3IgKHZhciBpPTA7IGk8c2VsZWN0aW9uLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIXRoaXMuZG9tW3NlbGVjdGlvbltpXV0pIGNvbnRpbnVlO1xuICAgICAgdGhpcy5kb21bc2VsZWN0aW9uW2ldXS5tYWluLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJylcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFNob3cgdGhlIHNlbGVjdGlvbiBvbiBhIHNldCBvZiBub2Rlc1xuICAgKlxuICAgKiBzZWxlY3Rpb246IFtpZCwgLi4uXSBub2RlcyB0byBzZWxlY3RcbiAgICovXG4gIHNob3dTZWxlY3Rpb246IGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcbiAgICBpZiAoIXNlbGVjdGlvbi5sZW5ndGgpIHJldHVyblxuICAgIC8vIHV0aWwuZW5zdXJlSW5WaWV3KHRoaXMuZG9tW3NlbGVjdGlvblswXV0uYm9keS5ub2RlKVxuICAgIGZvciAodmFyIGk9MDsgaTxzZWxlY3Rpb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMuZG9tW3NlbGVjdGlvbltpXV0ubWFpbi5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpXG4gICAgfVxuICB9LFxuXG4gIGNsZWFyQWN0aXZlOiBmdW5jdGlvbiAoaWQpIHtcbiAgICBpZiAoIXRoaXMuZG9tW2lkXSkgcmV0dXJuXG4gICAgdGhpcy5kb21baWRdLm1haW4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJylcbiAgfSxcblxuICBzaG93QWN0aXZlOiBmdW5jdGlvbiAoaWQpIHtcbiAgICBpZiAoIXRoaXMuZG9tW2lkXSkgcmV0dXJuIGNvbnNvbGUud2FybignVHJ5aW5nIHRvIGFjdGl2YXRlIGEgbm9kZSB0aGF0IGlzIG5vdCByZW5kZXJlZCcpXG4gICAgdXRpbC5lbnN1cmVJblZpZXcodGhpcy5kb21baWRdLmJvZHkubm9kZSlcbiAgICB0aGlzLmRvbVtpZF0ubWFpbi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKVxuICB9LFxuXG4gIHNldENvbGxhcHNlZDogZnVuY3Rpb24gKGlkLCBpc0NvbGxhcHNlZCkge1xuICAgIHRoaXMuZG9tW2lkXS5tYWluLmNsYXNzTGlzdFtpc0NvbGxhcHNlZCA/ICdhZGQnIDogJ3JlbW92ZSddKCdjb2xsYXBzZWQnKVxuICB9LFxuXG4gIGFuaW1hdGVPcGVuOiBmdW5jdGlvbiAoaWQpIHtcbiAgICB0aGlzLnNldENvbGxhcHNlZChpZCwgZmFsc2UpXG4gICAgc2xpZGVEb3duKHRoaXMuZG9tW2lkXS51bClcbiAgfSxcblxuICBhbmltYXRlQ2xvc2VkOiBmdW5jdGlvbiAoaWQsIGRvbmUpIHtcbiAgICBzbGlkZVVwKHRoaXMuZG9tW2lkXS51bCwgZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5zZXRDb2xsYXBzZWQoaWQsIHRydWUpXG4gICAgfS5iaW5kKHRoaXMpKVxuICB9LFxuXG4gIHNldE1vdmluZzogZnVuY3Rpb24gKGlkLCBpc01vdmluZykge1xuICAgIHRoaXMucm9vdC5jbGFzc0xpc3RbaXNNb3ZpbmcgPyAnYWRkJyA6ICdyZW1vdmUnXSgnbW92aW5nJylcbiAgICB0aGlzLmRvbVtpZF0ubWFpbi5jbGFzc0xpc3RbaXNNb3ZpbmcgPyAnYWRkJyA6ICdyZW1vdmUnXSgnbW92aW5nJylcbiAgfSxcblxuICBzZXREcm9wcGluZzogZnVuY3Rpb24gKGlkLCBpc0Ryb3BwaW5nLCBpc0NoaWxkKSB7XG4gICAgdmFyIGNscyA9ICdkcm9wcGluZycgKyAoaXNDaGlsZCA/ICctY2hpbGQnIDogJycpXG4gICAgdGhpcy5kb21baWRdLm1haW4uY2xhc3NMaXN0W2lzRHJvcHBpbmcgPyAnYWRkJyA6ICdyZW1vdmUnXShjbHMpXG4gIH0sXG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgcm9vdCBub2RlXG4gICAqL1xuICBtYWtlUm9vdDogZnVuY3Rpb24gKG5vZGUsIGJvdW5kcywgbW9kZWxBY3Rpb25zKSB7XG4gICAgdmFyIGRvbSA9IHRoaXMubWFrZU5vZGUobm9kZS5pZCwgbm9kZS5jb250ZW50LCBub2RlLm1ldGEsIDAsIGJvdW5kcywgbW9kZWxBY3Rpb25zKVxuICAgICAgLCByb290ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICByb290LmNsYXNzTGlzdC5hZGQoJ3RyZWVkJylcbiAgICByb290LmFwcGVuZENoaWxkKGRvbSlcbiAgICBpZiAobm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgIGRvbS5jbGFzc0xpc3QuYWRkKCd0cmVlZF9faXRlbS0tcGFyZW50JylcbiAgICB9XG4gICAgaWYgKG5vZGUuY29sbGFwc2VkICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICB0aGlzLnNldENvbGxhcHNlZChub2RlLmlkLCB0cnVlKVxuICAgIH1cbiAgICB0aGlzLnJvb3QgPSByb290XG4gICAgdGhpcy5yb290RGVwdGggPSBub2RlLmRlcHRoXG4gICAgcmV0dXJuIHJvb3RcbiAgfSxcblxuICAvKipcbiAgICogTWFrZSB0aGUgaGVhZCBmb3IgYSBnaXZlbiBub2RlXG4gICAqL1xuICBtYWtlSGVhZDogZnVuY3Rpb24gKGJvZHksIGFjdGlvbnMpIHtcbiAgICB2YXIgaGVhZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgICAsIGNvbGxhcHNlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG5cbiAgICBjb2xsYXBzZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLmJ1dHRvbiAhPT0gMCkgcmV0dXJuXG4gICAgICBhY3Rpb25zLnRvZ2dsZUNvbGxhcHNlKClcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIH0pXG4gICAgY29sbGFwc2VyLmNsYXNzTGlzdC5hZGQoJ3RyZWVkX19jb2xsYXBzZXInKVxuXG4gICAgLypcbiAgICAvLyAgLCBtb3ZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgbW92ZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLmJ1dHRvbiAhPT0gMCkgcmV0dXJuXG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgICAgIGFjdGlvbnMuc3RhcnRNb3ZpbmcoKVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfSlcbiAgICBtb3Zlci5jbGFzc0xpc3QuYWRkKCd0cmVlZF9fbW92ZXInKVxuICAgIC8vIGhlYWQuYXBwZW5kQ2hpbGQobW92ZXIpXG4gICAgKi9cblxuICAgIGhlYWQuY2xhc3NMaXN0LmFkZCgndHJlZWRfX2hlYWQnKVxuICAgIGhlYWQuYXBwZW5kQ2hpbGQoY29sbGFwc2VyKVxuICAgIGhlYWQuYXBwZW5kQ2hpbGQoYm9keS5ub2RlKTtcbiAgICByZXR1cm4gaGVhZFxuICB9LFxuXG4gIC8qKlxuICAgKiBNYWtlIGEgbm9kZVxuICAgKi9cbiAgbWFrZU5vZGU6IGZ1bmN0aW9uIChpZCwgY29udGVudCwgbWV0YSwgbGV2ZWwsIGJvdW5kcywgbW9kZWxBY3Rpb25zKSB7XG4gICAgdmFyIGRvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJylcbiAgICAgICwgYm9keSA9IHRoaXMuYm9keUZvcihpZCwgY29udGVudCwgbWV0YSwgYm91bmRzLCBtb2RlbEFjdGlvbnMpXG5cbiAgICBkb20uY2xhc3NMaXN0LmFkZCgndHJlZWRfX2l0ZW0nKVxuICAgIC8vIGRvbS5jbGFzc0xpc3QuYWRkKCd0cmVlZF9faXRlbS0tbGV2ZWwtJyArIGxldmVsKVxuXG4gICAgdmFyIGhlYWQgPSB0aGlzLm1ha2VIZWFkKGJvZHksIGJvdW5kcylcbiAgICBkb20uYXBwZW5kQ2hpbGQoaGVhZClcblxuICAgIHZhciB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJylcbiAgICB1bC5jbGFzc0xpc3QuYWRkKCd0cmVlZF9fY2hpbGRyZW4nKVxuICAgIGRvbS5hcHBlbmRDaGlsZCh1bClcbiAgICB0aGlzLmRvbVtpZF0gPSB7bWFpbjogZG9tLCBib2R5OiBib2R5LCB1bDogdWwsIGhlYWQ6IGhlYWR9XG4gICAgcmV0dXJuIGRvbVxuICB9LFxuXG4gIC8qKiBcbiAgICogQ3JlYXRlIGEgYm9keSBub2RlXG4gICAqXG4gICAqIGlkOiB0aGUgbm9kZSBpZlxuICAgKiBjb250ZW50OiB0aGUgdGV4dFxuICAgKiBtZXRhOiBhbiBvYmplY3Qgb2YgbWV0YSBkYXRhXG4gICAqIGJvdW5kczogYm91bmQgYWN0aW9uc1xuICAgKi9cbiAgYm9keUZvcjogZnVuY3Rpb24gKGlkLCBjb250ZW50LCBtZXRhLCBib3VuZHMsIG1vZGVsQWN0aW9ucykge1xuICAgIHZhciBkb20gPSBuZXcgdGhpcy5vLk5vZGUoY29udGVudCwgbWV0YSwgYm91bmRzLCBpZCA9PT0gJ25ldycsIG1vZGVsQWN0aW9ucylcbiAgICBkb20ubm9kZS5jbGFzc0xpc3QuYWRkKCd0cmVlZF9fYm9keScpXG4gICAgcmV0dXJuIGRvbVxuICB9LFxuXG59XG5cbiIsIlxubW9kdWxlLmV4cG9ydHMgPSBEcm9wU2hhZG93O1xuXG5mdW5jdGlvbiBEcm9wU2hhZG93KGhlaWdodCwgY2xzTmFtZSkge1xuICB0aGlzLm5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICB0aGlzLm5vZGUuY2xhc3NMaXN0LmFkZChjbHNOYW1lIHx8ICd0cmVlZF9fZHJvcC1zaGFkb3cnKVxuICB0aGlzLmhlaWdodCA9IGhlaWdodCB8fCAxMFxuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubm9kZSlcbn1cblxuRHJvcFNoYWRvdy5wcm90b3R5cGUgPSB7XG4gIG1vdmVUbzogZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIHRoaXMubm9kZS5zdHlsZS50b3AgPSB0YXJnZXQuc2hvdy55IC0gdGhpcy5oZWlnaHQvMiArICdweCdcbiAgICB0aGlzLm5vZGUuc3R5bGUubGVmdCA9IHRhcmdldC5zaG93LmxlZnQgKyAncHgnXG4gICAgdGhpcy5ub2RlLnN0eWxlLmhlaWdodCA9IHRoaXMuaGVpZ2h0ICsgJ3B4J1xuICAgIC8vIHRoaXMubm9kZS5zdHlsZS5oZWlnaHQgPSB0YXJnZXQuaGVpZ2h0ICsgMTAgKyAncHgnXG4gICAgdGhpcy5ub2RlLnN0eWxlLndpZHRoID0gdGFyZ2V0LnNob3cud2lkdGggKyAncHgnXG4gIH0sXG5cbiAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5ub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5ub2RlKVxuICB9XG59XG5cbiIsIlxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIE5vZGU6IHJlcXVpcmUoJy4vZGVmYXVsdC1ub2RlJyksXG4gIFZpZXc6IHJlcXVpcmUoJy4vdmlldycpLFxuICBWaWV3TGF5ZXI6IHJlcXVpcmUoJy4vZG9tLXZsJyksXG4gIE1vZGVsOiByZXF1aXJlKCcuL21vZGVsJyksXG4gIENvbnRyb2xsZXI6IHJlcXVpcmUoJy4vY29udHJvbGxlcicpLFxufVxuXG4iLCJcbm1vZHVsZS5leHBvcnRzID0ga2V5SGFuZGxlclxuXG4vKipcbiAqIE9yZ2FuaXplIHRoZSBrZXlzIGRlZmluaXRpb24sIHRoZSBhY3Rpb25zIGRlZmluaXRpb24sIGFuZCB0aGUgY3RybGFjdGlvbnNcbiAqIGFsbCB0b2dldGhlciBpbiBvbmUgbG92ZWx5IHNtb3JnYXNib3JkLlxuICpcbiAqIGtleXM6IHthY3Rpb246IGtleSBzaG9ydGN1dCBkZWZpbml0aW9ufVxuICogYWN0aW9uczoge2FjdGlvbjoge2FjdGlvbiBkZWZpbml0aW9ufX1cbiAqIGN0cmxhY3Rpb25zOiB7bmFtZTogZnVuY3Rpb259XG4gKi9cbmZ1bmN0aW9uIGtleUhhbmRsZXIoa2V5cywgYWN0aW9ucywgY3RybGFjdGlvbnMpIHtcbiAgdmFyIGJvdW5kID0ge31cbiAgZm9yICh2YXIgYWN0aW9uIGluIGtleXMpIHtcbiAgICBpZiAoIWFjdGlvbnNbYWN0aW9uXSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIGNvbmZpZ3VyYXRpb246IHRyeWluZyB0byBiaW5kIHVua25vd24gYWN0aW9uLiAnICsgYWN0aW9uKVxuICAgIH1cbiAgICBib3VuZFtrZXlzW2FjdGlvbl1dID0gYmluZEFjdGlvbihhY3Rpb24sIGFjdGlvbnNbYWN0aW9uXSwgY3RybGFjdGlvbnMpXG4gIH1cbiAgcmV0dXJuIGJvdW5kXG59XG5cbmZ1bmN0aW9uIGJpbmRBY3Rpb24obmFtZSwgYWN0aW9uLCBjdHJsYWN0aW9ucykge1xuICB2YXIgcHJlID0gbWFrZVByZShhY3Rpb24uYWN0aXZlKVxuICB2YXIgdHlwZSA9IHR5cGVvZiBhY3Rpb24uYWN0aW9uXG4gIHZhciBtYWluXG4gIHN3aXRjaCAodHlwZW9mIGFjdGlvbi5hY3Rpb24pIHtcbiAgICBjYXNlICdzdHJpbmcnOiBtYWluID0gY3RybGFjdGlvbnNbYWN0aW9uLmFjdGlvbl07IGJyZWFrO1xuICAgIGNhc2UgJ3VuZGVmaW5lZCc6IG1haW4gPSBjdHJsYWN0aW9uc1tjYW1lbChuYW1lKV07IGJyZWFrO1xuICAgIGNhc2UgJ2Z1bmN0aW9uJzogbWFpbiA9IGFjdGlvbi5hY3Rpb247IGJyZWFrO1xuICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcigndW5rbm93biBhY3Rpb24gJyArIGFjdGlvbi5hY3Rpb24pXG4gIH1cblxuICBpZiAoIW1haW4pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgYWN0aW9uIGNvbmZpZ3VyYXRpb24gJyArIG5hbWUpXG4gIH1cblxuICBpZiAoIXByZSkge1xuICAgIHJldHVybiBtYWluXG4gIH1cblxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIGlmICghcHJlLmNhbGwodGhpcykpIHJldHVyblxuICAgIHJldHVybiBtYWluLmNhbGwodGhpcywgdGhpcy5hY3RpdmUpXG4gIH1cbn1cblxuZnVuY3Rpb24gbWFrZVByZShhY3RpdmUpIHtcbiAgc3dpdGNoIChhY3RpdmUpIHtcbiAgICBjYXNlIHRydWU6IHJldHVybiBmdW5jdGlvbihtYWluKSB7XG4gICAgICByZXR1cm4gdGhpcy5hY3RpdmVcbiAgICB9XG4gICAgY2FzZSAnIW5ldyc6IHJldHVybiBmdW5jdGlvbiAobWFpbikge1xuICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlICYmIHRoaXMuYWN0aXZlICE9PSAnbmV3J1xuICAgIH1cbiAgICBjYXNlICchcm9vdCc6IHJldHVybiBmdW5jdGlvbiAobWFpbikge1xuICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlICYmIHRoaXMuYWN0aXZlICE9PSB0aGlzLnJvb3RcbiAgICB9XG4gICAgZGVmYXVsdDogcmV0dXJuIG51bGxcbiAgfVxufVxuXG5mdW5jdGlvbiBjYW1lbChzdHJpbmcpIHtcbiAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKC8gKFxcdykvLCBmdW5jdGlvbiAoYSwgeCkgeyByZXR1cm4geC50b1VwcGVyQ2FzZSgpIH0pXG59XG5cbiIsIlxubW9kdWxlLmV4cG9ydHMgPSBrZXlzXG5cbmtleXMua2V5TmFtZSA9IGtleU5hbWVcblxudmFyIEtFWVMgPSB7XG4gIDg6ICdiYWNrc3BhY2UnLFxuICA5OiAndGFiJyxcbiAgMTM6ICdyZXR1cm4nLFxuICAyNzogJ2VzY2FwZScsXG4gIDM3OiAnbGVmdCcsXG4gIDM4OiAndXAnLFxuICAzOTogJ3JpZ2h0JyxcbiAgNDA6ICdkb3duJyxcbiAgNDY6ICdkZWxldGUnLFxuICAxMTM6ICdmMicsXG4gIDIxOTogJ1snLFxuICAyMjE6ICddJ1xufVxuXG5mdW5jdGlvbiBrZXlOYW1lKGNvZGUpIHtcbiAgaWYgKGNvZGUgPD0gOTAgJiYgY29kZSA+PSA2NSkge1xuICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUgKyAzMilcbiAgfVxuICBpZiAoY29kZSA+PSA0OCAmJiBjb2RlIDw9IDU3KSB7XG4gICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSlcbiAgfVxuICByZXR1cm4gS0VZU1tjb2RlXVxufVxuXG5mdW5jdGlvbiBrZXlzKGNvbmZpZykge1xuICB2YXIga21hcCA9IHt9XG4gICAgLCBwcmVmaXhlcyA9IHt9XG4gICAgLCBjdXJfcHJlZml4ID0gbnVsbFxuICAgICwgcGFydHNcbiAgICAsIHBhcnRcbiAgICAsIHNlcVxuICBmb3IgKHZhciBrZXkgaW4gY29uZmlnKSB7XG4gICAgcGFydHMgPSBrZXkuc3BsaXQoJywnKVxuICAgIGZvciAodmFyIGk9MDtpPHBhcnRzLmxlbmd0aDtpKyspIHtcbiAgICAgIHBhcnQgPSBwYXJ0c1tpXS50cmltKClcbiAgICAgIGttYXBbcGFydF0gPSBjb25maWdba2V5XVxuICAgICAgaWYgKHBhcnQuaW5kZXhPZignICcpICE9PSAtMSkge1xuICAgICAgICBzZXEgPSBwYXJ0LnNwbGl0KC9cXHMrL2cpXG4gICAgICAgIHZhciBuID0gJydcbiAgICAgICAgZm9yICh2YXIgaj0wOyBqPHNlcS5sZW5ndGgtMTsgaisrKSB7XG4gICAgICAgICAgbiArPSBzZXFbal1cbiAgICAgICAgICBwcmVmaXhlc1tuXSA9IHRydWVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIga2V5ID0ga2V5TmFtZShlLmtleUNvZGUpXG4gICAgaWYgKCFrZXkpIHtcbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhlLmtleUNvZGUpXG4gICAgfVxuICAgIGlmIChlLmFsdEtleSkga2V5ID0gJ2FsdCsnICsga2V5XG4gICAgaWYgKGUuc2hpZnRLZXkpIGtleSA9ICdzaGlmdCsnICsga2V5XG4gICAgaWYgKGUuY3RybEtleSkga2V5ID0gJ2N0cmwrJyArIGtleVxuICAgIGlmIChlLm1ldGFLZXkpIGtleSA9ICdjbWQrJyArIGtleVxuICAgIGlmIChjdXJfcHJlZml4KSB7XG4gICAgICBrZXkgPSBjdXJfcHJlZml4ICsgJyAnICsga2V5XG4gICAgICBjdXJfcHJlZml4ID0gbnVsbFxuICAgIH1cbiAgICBpZiAoIWttYXBba2V5XSkge1xuICAgICAgaWYgKHByZWZpeGVzW2tleV0pIHtcbiAgICAgICAgY3VyX3ByZWZpeCA9IGtleVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3VyX3ByZWZpeCA9IG51bGxcbiAgICAgIH1cbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBpZiAoa21hcFtrZXldLmNhbGwodGhpcywgZSkgIT09IHRydWUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICB9XG59XG5cblxuIiwiXG52YXIgdXVpZCA9IHJlcXVpcmUoJy4vdXVpZCcpXG5cbm1vZHVsZS5leHBvcnRzID0gTW9kZWxcblxuZnVuY3Rpb24gTW9kZWwocm9vdE5vZGUsIGlkcywgZGIpIHtcbiAgdGhpcy5pZHMgPSBpZHNcbiAgdGhpcy5yb290ID0gcm9vdE5vZGUuaWRcbiAgdGhpcy5yb290Tm9kZSA9IHJvb3ROb2RlXG4gIHRoaXMuZGIgPSBkYlxuICB0aGlzLm5leHRpZCA9IDEwMFxuICB0aGlzLmNsaXBib2FyZCA9IGZhbHNlXG4gIHRoaXMuYm91bmRBY3Rpb25zID0gdGhpcy5iaW5kQWN0aW9ucygpXG59XG5cbi8qKlxuICogQSBzaW5nbGUgbm9kZSBpc1xuICogLSBpZDpcbiAqIC0gcGFyZW50OiBpZFxuICogLSBjaGlsZHJlbjogW2lkLCBpZCwgaWRdXG4gKiAtIGRhdGE6IHt9XG4gKi9cblxuTW9kZWwucHJvdG90eXBlID0ge1xuICBuZXdpZDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB1dWlkKCk7XG4gICAgLypcbiAgICB3aGlsZSAodGhpcy5pZHNbdGhpcy5uZXh0aWRdKSB7XG4gICAgICB0aGlzLm5leHRpZCArPSAxXG4gICAgfVxuICAgIHZhciBpZCA9IHRoaXMubmV4dGlkXG4gICAgdGhpcy5uZXh0aWQgKz0gMVxuICAgIHJldHVybiBpZCArICcnXG4gICAgKi9cbiAgfSxcblxuICBiaW5kQWN0aW9uczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBib3VuZCA9IHt9XG4gICAgZm9yICh2YXIgbmFtZSBpbiB0aGlzLmFjdGlvbnMpIHtcbiAgICAgIGJvdW5kW25hbWVdID0gdGhpcy5hY3Rpb25zW25hbWVdLmJpbmQodGhpcylcbiAgICB9XG4gICAgcmV0dXJuIGJvdW5kXG4gIH0sXG5cbiAgYWN0aW9uczoge30sXG5cbiAgLy8gZXhwb3J0IGFsbCB0aGUgZGF0YSBjdXJyZW50bHkgc3RvcmVkIGluIHRoZSBtb2RlbFxuICAvLyBkdW1wRGF0YSgpIC0+IGFsbCBvZiBpdFxuICAvLyBkdW1wRGF0YShpZCkgLT4gY2hpbGRyZW4gb2YgdGhlIGdpdmVuIGlkXG4gIC8vIGR1bXBEYXRhKGlkLCB0cnVlKSAtPiBpbmNsdWRlIHRoZSBpZHMgaW4gdGhlIGR1bXBcbiAgLy8ge1xuICAvLyAgICBpZDogPz8sXG4gIC8vICAgIG1ldGE6IHt9LFxuICAvLyAgICBjb2xsYXBzZWQ6ID8/LFxuICAvLyAgICBjb250ZW50OiAnJyxcbiAgLy8gICAgY2hpbGRyZW46IFtyZWN1cnNlLCAuLi5dXG4gIC8vIH1cbiAgZHVtcERhdGE6IGZ1bmN0aW9uIChpZCwgbm9pZHMpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgaWQgPSB0aGlzLnJvb3RcbiAgICB9XG4gICAgdmFyIHJlcyA9IHtcbiAgICAgICAgICBtZXRhOiB7fSxcbiAgICAgICAgfVxuICAgICAgLCBuID0gdGhpcy5pZHNbaWRdXG4gICAgcmVzLmNvbnRlbnQgPSBuLmNvbnRlbnRcbiAgICByZXMuY3JlYXRlZCA9IG4uY3JlYXRlZFxuICAgIHJlcy50eXBlID0gbi50eXBlXG4gICAgcmVzLm1vZGlmaWVkID0gbi5tb2RpZmllZFxuICAgIGZvciAodmFyIGF0dHIgaW4gbi5tZXRhKSB7XG4gICAgICByZXMubWV0YVthdHRyXSA9IG4ubWV0YVthdHRyXVxuICAgIH1cbiAgICBpZiAobi5jaGlsZHJlbiAmJiBuLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgcmVzLmNoaWxkcmVuID0gW11cbiAgICAgIGZvciAodmFyIGk9MDsgaTxuLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHJlcy5jaGlsZHJlbi5wdXNoKHRoaXMuZHVtcERhdGEobi5jaGlsZHJlbltpXSwgbm9pZHMpKVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIW5vaWRzKSByZXMuaWQgPSBpZFxuICAgIHJlcy5jb2xsYXBzZWQgPSBuLmNvbGxhcHNlZCB8fCBmYWxzZVxuICAgIHJldHVybiByZXNcbiAgfSxcblxuICAvLyBjcmVhdGVOb2RlcyhwYXJlbnRJZCwgdGhlIGluZGV4LCBkYXRhIGFzIGl0IHdhcyBkdW1wZWQpXG4gIC8vIHtcbiAgLy8gICAgY29udGVudDogXCJcIixcbiAgLy8gICAgbWV0YToge31cbiAgLy8gICAgLi4uIG90aGVyIGRhdGFzXG4gIC8vICAgIGNoaWxkcmVuOiBbbm9kZSwgLi4uXVxuICAvLyB9XG4gIGNyZWF0ZU5vZGVzOiBmdW5jdGlvbiAocGlkLCBpbmRleCwgZGF0YSkge1xuICAgIHZhciBjciA9IHRoaXMuY3JlYXRlKHBpZCwgaW5kZXgsIGRhdGEuY29udGVudCwgZGF0YS50eXBlLCBkYXRhLm1ldGEpXG4gICAgY3Iubm9kZS5jb2xsYXBzZWQgPSBkYXRhLmNvbGxhcHNlZCB8fCBmYWxzZVxuICAgIGlmIChkYXRhLmNoaWxkcmVuKSB7XG4gICAgICBmb3IgKHZhciBpPTA7IGk8ZGF0YS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICB0aGlzLmNyZWF0ZU5vZGVzKGNyLm5vZGUuaWQsIGksIGRhdGEuY2hpbGRyZW5baV0pXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjclxuICB9LFxuXG4gIGdldEJlZm9yZTogZnVuY3Rpb24gKHBpZCwgaW5kZXgpIHtcbiAgICB2YXIgYmVmb3JlID0gZmFsc2VcbiAgICBpZiAoaW5kZXggPCB0aGlzLmlkc1twaWRdLmNoaWxkcmVuLmxlbmd0aCAtIDEpIHtcbiAgICAgIGJlZm9yZSA9IHRoaXMuaWRzW3BpZF0uY2hpbGRyZW5baW5kZXggKyAxXVxuICAgIH1cbiAgICByZXR1cm4gYmVmb3JlXG4gIH0sXG5cbiAgLy8gb3BlcmF0aW9uc1xuICBjcmVhdGU6IGZ1bmN0aW9uIChwaWQsIGluZGV4LCB0ZXh0LCB0eXBlLCBtZXRhKSB7XG4gICAgdmFyIG5vZGUgPSB7XG4gICAgICBpZDogdGhpcy5uZXdpZCgpLFxuICAgICAgY29udGVudDogdGV4dCB8fCAnJyxcbiAgICAgIGNvbGxhcHNlZDogZmFsc2UsXG4gICAgICB0eXBlOiB0eXBlIHx8ICdiYXNlJyxcbiAgICAgIG1ldGE6IG1ldGEgfHwge30sXG4gICAgICBwYXJlbnQ6IHBpZCxcbiAgICAgIGNoaWxkcmVuOiBbXVxuICAgIH1cbiAgICB0aGlzLmlkc1tub2RlLmlkXSA9IG5vZGVcbiAgICBpZiAoIXRoaXMuaWRzW3BpZF0uY2hpbGRyZW4pIHtcbiAgICAgIHRoaXMuaWRzW3BpZF0uY2hpbGRyZW4gPSBbXVxuICAgIH1cbiAgICB0aGlzLmlkc1twaWRdLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgbm9kZS5pZClcblxuICAgIHZhciBiZWZvcmUgPSBmYWxzZVxuICAgIGlmIChpbmRleCA8IHRoaXMuaWRzW3BpZF0uY2hpbGRyZW4ubGVuZ3RoIC0gMSkge1xuICAgICAgYmVmb3JlID0gdGhpcy5pZHNbcGlkXS5jaGlsZHJlbltpbmRleCArIDFdXG4gICAgfVxuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5kYi5zYXZlKCdub2RlJywgbm9kZS5pZCwgbm9kZSlcbiAgICB0aGlzLmRiLnVwZGF0ZSgnbm9kZScsIHBpZCwge2NoaWxkcmVuOiB0aGlzLmlkc1twaWRdLmNoaWxkcmVufSlcbiAgICB9LmJpbmQodGhpcykpXG5cbiAgICByZXR1cm4ge1xuICAgICAgbm9kZTogbm9kZSxcbiAgICAgIGJlZm9yZTogYmVmb3JlXG4gICAgfVxuICB9LFxuXG4gIHJlbW92ZTogZnVuY3Rpb24gKGlkKSB7XG4gICAgaWYgKGlkID09PSB0aGlzLnJvb3QpIHJldHVyblxuICAgIHZhciBuID0gdGhpcy5pZHNbaWRdXG4gICAgICAsIHAgPSB0aGlzLmlkc1tuLnBhcmVudF1cbiAgICAgICwgaXggPSBwLmNoaWxkcmVuLmluZGV4T2YoaWQpXG4gICAgcC5jaGlsZHJlbi5zcGxpY2UoaXgsIDEpXG4gICAgZGVsZXRlIHRoaXMuaWRzW2lkXVxuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmRiLnJlbW92ZSgnbm9kZScsIGlkKVxuICAgICAgdGhpcy5kYi51cGRhdGUoJ25vZGUnLCBuLnBhcmVudCwge2NoaWxkcmVuOiBwLmNoaWxkcmVufSlcbiAgICAgIC8vIFRPRE86IHJlbW92ZSBhbGwgY2hpbGQgbm9kZXNcbiAgICB9LmJpbmQodGhpcykpXG5cbiAgICByZXR1cm4ge2lkOiBpZCwgbm9kZTogbiwgaXg6IGl4fVxuICB9LFxuXG4gIHNldENvbnRlbnQ6IGZ1bmN0aW9uIChpZCwgY29udGVudCkge1xuICAgIHRoaXMuaWRzW2lkXS5jb250ZW50ID0gY29udGVudFxuICAgIHRoaXMuZGIudXBkYXRlKCdub2RlJywgaWQsIHtjb250ZW50OiBjb250ZW50fSlcbiAgfSxcblxuICBzZXRBdHRyOiBmdW5jdGlvbiAoaWQsIGF0dHIsIHZhbHVlKSB7XG4gICAgdGhpcy5pZHNbaWRdLm1ldGFbYXR0cl0gPSB2YWx1ZVxuICAgIHRoaXMuZGIudXBkYXRlKCdub2RlJywgaWQsIHttZXRhOiB0aGlzLmlkc1tpZF0ubWV0YX0pXG4gIH0sXG5cbiAgc2V0TWV0YTogZnVuY3Rpb24gKGlkLCBtZXRhKSB7XG4gICAgZm9yICh2YXIgYXR0ciBpbiBtZXRhKSB7XG4gICAgICB0aGlzLmlkc1tpZF0ubWV0YVthdHRyXSA9IG1ldGFbYXR0cl1cbiAgICB9XG4gICAgdGhpcy5kYi51cGRhdGUoJ25vZGUnLCBpZCwge21ldGE6IG1ldGF9KVxuICB9LFxuXG4gIC8vIG90aGVyIHN0dWZmXG4gIHNldENvbGxhcHNlZDogZnVuY3Rpb24gKGlkLCBpc0NvbGxhcHNlZCkge1xuICAgIHRoaXMuaWRzW2lkXS5jb2xsYXBzZWQgPSBpc0NvbGxhcHNlZFxuICAgIHRoaXMuZGIudXBkYXRlKCdub2RlJywgaWQsIHtjb2xsYXBzZWQ6IGlzQ29sbGFwc2VkfSlcbiAgfSxcblxuICBpc0NvbGxhcHNlZDogZnVuY3Rpb24gKGlkKSB7XG4gICAgcmV0dXJuIHRoaXMuaWRzW2lkXS5jb2xsYXBzZWRcbiAgfSxcblxuICBoYXNDaGlsZHJlbjogZnVuY3Rpb24gKGlkKSB7XG4gICAgcmV0dXJuIHRoaXMuaWRzW2lkXS5jaGlsZHJlbiAmJiB0aGlzLmlkc1tpZF0uY2hpbGRyZW4ubGVuZ3RoXG4gIH0sXG5cbiAgLy8gYWRkIGJhY2sgc29tZXRoaW5nIHRoYXQgd2FzIHJlbW92ZWRcbiAgcmVhZGQ6IGZ1bmN0aW9uIChzYXZlZCkge1xuICAgIHRoaXMuaWRzW3NhdmVkLmlkXSA9IHNhdmVkLm5vZGVcbiAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmlkc1tzYXZlZC5ub2RlLnBhcmVudF0uY2hpbGRyZW5cbiAgICBjaGlsZHJlbi5zcGxpY2Uoc2F2ZWQuaXgsIDAsIHNhdmVkLmlkKVxuICAgIHZhciBiZWZvcmUgPSBmYWxzZVxuICAgIGlmIChzYXZlZC5peCA8IGNoaWxkcmVuLmxlbmd0aCAtIDEpIHtcbiAgICAgIGJlZm9yZSA9IGNoaWxkcmVuW3NhdmVkLml4ICsgMV1cbiAgICB9XG4gICAgdGhpcy5kYi5zYXZlKCdub2RlJywgc2F2ZWQubm9kZS5pZCwgc2F2ZWQubm9kZSlcbiAgICB0aGlzLmRiLnVwZGF0ZSgnbm9kZScsIHNhdmVkLm5vZGUucGFyZW50LCB7Y2hpbGRyZW46IGNoaWxkcmVufSlcbiAgICByZXR1cm4gYmVmb3JlXG4gIH0sXG5cbiAgbW92ZTogZnVuY3Rpb24gKGlkLCBwaWQsIGluZGV4KSB7XG4gICAgdmFyIG4gPSB0aGlzLmlkc1tpZF1cbiAgICAgICwgb3BpZCA9IG4ucGFyZW50XG4gICAgICAsIHAgPSB0aGlzLmlkc1tvcGlkXVxuICAgICAgLCBpeCA9IHAuY2hpbGRyZW4uaW5kZXhPZihpZClcbiAgICBwLmNoaWxkcmVuLnNwbGljZShpeCwgMSlcbiAgICBpZiAoIXRoaXMuaWRzW3BpZF0uY2hpbGRyZW4pIHtcbiAgICAgIHRoaXMuaWRzW3BpZF0uY2hpbGRyZW4gPSBbXVxuICAgIH1cbiAgICBpZiAoaW5kZXggPT09IGZhbHNlKSBpbmRleCA9IHRoaXMuaWRzW3BpZF0uY2hpbGRyZW4ubGVuZ3RoXG4gICAgdGhpcy5pZHNbcGlkXS5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDAsIGlkKVxuICAgIHRoaXMuaWRzW2lkXS5wYXJlbnQgPSBwaWRcblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZGIudXBkYXRlKCdub2RlJywgb3BpZCwge2NoaWxkcmVuOiBwLmNoaWxkcmVufSlcbiAgICB0aGlzLmRiLnVwZGF0ZSgnbm9kZScsIGlkLCB7cGFyZW50OiBwaWR9KVxuICAgIHRoaXMuZGIudXBkYXRlKCdub2RlJywgcGlkLCB7Y2hpbGRyZW46IHRoaXMuaWRzW3BpZF0uY2hpbGRyZW59KVxuICAgIH0uYmluZCh0aGlzKSlcblxuICAgIHZhciBiZWZvcmUgPSBmYWxzZVxuICAgIGlmIChpbmRleCA8IHRoaXMuaWRzW3BpZF0uY2hpbGRyZW4ubGVuZ3RoIC0gMSkge1xuICAgICAgYmVmb3JlID0gdGhpcy5pZHNbcGlkXS5jaGlsZHJlbltpbmRleCArIDFdXG4gICAgfVxuICAgIHJldHVybiBiZWZvcmVcbiAgfSxcblxuICBhcHBlbmRUZXh0OiBmdW5jdGlvbiAoaWQsIHRleHQpIHtcbiAgICB0aGlzLmlkc1tpZF0uY29udGVudCArPSB0ZXh0XG4gICAgdGhpcy5kYi51cGRhdGUoJ25vZGUnLCBpZCwge2NvbnRlbnQ6IHRoaXMuaWRzW2lkXS5jb250ZW50fSlcbiAgfSxcblxuICAvLyBtb3ZlbWVudCBjYWxjdWxhdGlvblxuICBnZXRQYXJlbnQ6IGZ1bmN0aW9uIChpZCkge1xuICAgIHJldHVybiB0aGlzLmlkc1tpZF0ucGFyZW50XG4gIH0sXG5cbiAgY29tbW9uUGFyZW50OiBmdW5jdGlvbiAob25lLCB0d28pIHtcbiAgICBpZiAob25lID09PSB0d28pIHJldHVybiBvbmVcbiAgICB2YXIgb25lcyA9IFtvbmVdXG4gICAgICAsIHR3b3MgPSBbdHdvXVxuICAgIHdoaWxlICh0aGlzLmlkc1tvbmVdLnBhcmVudCB8fCB0aGlzLmlkc1t0d29dLnBhcmVudCkge1xuICAgICAgaWYgKHRoaXMuaWRzW29uZV0ucGFyZW50KSB7XG4gICAgICAgIG9uZSA9IHRoaXMuaWRzW29uZV0ucGFyZW50XG4gICAgICAgIGlmICh0d29zLmluZGV4T2Yob25lKSAhPT0gLTEpIHJldHVybiBvbmVcbiAgICAgICAgb25lcy5wdXNoKG9uZSlcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmlkc1t0d29dLnBhcmVudCkge1xuICAgICAgICB0d28gPSB0aGlzLmlkc1t0d29dLnBhcmVudFxuICAgICAgICBpZiAob25lcy5pbmRleE9mKHR3bykgIT09IC0xKSByZXR1cm4gdHdvXG4gICAgICAgIHR3b3MucHVzaCh0d28pXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsXG4gIH0sXG5cbiAgZ2V0Q2hpbGQ6IGZ1bmN0aW9uIChpZCkge1xuICAgIGlmICh0aGlzLmlkc1tpZF0uY2hpbGRyZW4gJiYgdGhpcy5pZHNbaWRdLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHRoaXMuaWRzW2lkXS5jaGlsZHJlblswXVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5uZXh0U2libGluZyhpZClcbiAgfSxcblxuICBwcmV2U2libGluZzogZnVuY3Rpb24gKGlkLCBub3BhcmVudCkge1xuICAgIHZhciBwaWQgPSB0aGlzLmlkc1tpZF0ucGFyZW50XG4gICAgaWYgKHVuZGVmaW5lZCA9PT0gcGlkKSByZXR1cm5cbiAgICB2YXIgaXggPSB0aGlzLmlkc1twaWRdLmNoaWxkcmVuLmluZGV4T2YoaWQpXG4gICAgaWYgKGl4ID4gMCkgcmV0dXJuIHRoaXMuaWRzW3BpZF0uY2hpbGRyZW5baXgtMV1cbiAgICBpZiAoIW5vcGFyZW50KSByZXR1cm4gcGlkXG4gIH0sXG5cbiAgY2xvc2VzdE5vbkNoaWxkOiBmdW5jdGlvbiAoaWQsIG90aGVycykge1xuICAgIHZhciBjbG9zZXN0ID0gdGhpcy5uZXh0U2libGluZyhpZCwgdHJ1ZSlcbiAgICBpZiAodW5kZWZpbmVkID09PSBjbG9zZXN0IHx8IGNsb3Nlc3QgPT09IGZhbHNlKSB7XG4gICAgICBpZiAob3RoZXJzKSB7XG4gICAgICAgIGNsb3Nlc3QgPSB0aGlzLmlkQWJvdmUob3RoZXJzWzBdKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2xvc2VzdCA9IHRoaXMuaWRBYm92ZShpZClcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNsb3Nlc3RcbiAgfSxcblxuICBuZXh0U2libGluZzogZnVuY3Rpb24gKGlkLCBzdHJpY3QpIHtcbiAgICB2YXIgcGlkID0gdGhpcy5pZHNbaWRdLnBhcmVudFxuICAgIGlmICh1bmRlZmluZWQgPT09IHBpZCkgcmV0dXJuICFzdHJpY3QgJiYgdGhpcy5pZHNbaWRdLmNoaWxkcmVuWzBdXG4gICAgdmFyIGl4ID0gdGhpcy5pZHNbcGlkXS5jaGlsZHJlbi5pbmRleE9mKGlkKVxuICAgIGlmIChpeCA8IHRoaXMuaWRzW3BpZF0uY2hpbGRyZW4ubGVuZ3RoIC0gMSkgcmV0dXJuIHRoaXMuaWRzW3BpZF0uY2hpbGRyZW5baXggKyAxXVxuICAgIGlmICh0aGlzLmlkc1tpZF0uY29sbGFwc2VkKSB7XG4gICAgICByZXR1cm4gIXN0cmljdCAmJiB0aGlzLm5leHRTaWJsaW5nKHBpZCwgc3RyaWN0KVxuICAgIH1cbiAgICByZXR1cm4gIXN0cmljdCAmJiB0aGlzLmlkc1tpZF0uY2hpbGRyZW5bMF1cbiAgfSxcblxuICBsYXN0U2libGluZzogZnVuY3Rpb24gKGlkLCBzdHJpY3QpIHtcbiAgICB2YXIgcGlkID0gdGhpcy5pZHNbaWRdLnBhcmVudFxuICAgIGlmICh1bmRlZmluZWQgPT09IHBpZCkgcmV0dXJuICFzdHJpY3QgJiYgdGhpcy5pZHNbaWRdLmNoaWxkcmVuWzBdXG4gICAgdmFyIGl4ID0gdGhpcy5pZHNbcGlkXS5jaGlsZHJlbi5pbmRleE9mKGlkKVxuICAgIGlmIChpeCA9PT0gdGhpcy5pZHNbcGlkXS5jaGlsZHJlbi5sZW5ndGggLSAxKSByZXR1cm4gIXN0cmljdCAmJiB0aGlzLmlkc1tpZF0uY2hpbGRyZW5bMF1cbiAgICByZXR1cm4gdGhpcy5pZHNbcGlkXS5jaGlsZHJlblt0aGlzLmlkc1twaWRdLmNoaWxkcmVuLmxlbmd0aCAtIDFdXG4gIH0sXG5cbiAgZmlyc3RTaWJsaW5nOiBmdW5jdGlvbiAoaWQsIHN0cmljdCkge1xuICAgIHZhciBwaWQgPSB0aGlzLmlkc1tpZF0ucGFyZW50XG4gICAgaWYgKHVuZGVmaW5lZCA9PT0gcGlkKSByZXR1cm4gLy8gdGhpcy5pZHNbaWRdLmNoaWxkcmVuWzBdXG4gICAgdmFyIGl4ID0gdGhpcy5pZHNbcGlkXS5jaGlsZHJlbi5pbmRleE9mKGlkKVxuICAgIGlmIChpeCA9PT0gMCkgcmV0dXJuICFzdHJpY3QgJiYgcGlkXG4gICAgcmV0dXJuIHRoaXMuaWRzW3BpZF0uY2hpbGRyZW5bMF1cbiAgfSxcblxuICBsYXN0T3BlbjogZnVuY3Rpb24gKGlkKSB7XG4gICAgdmFyIG5vZGUgPSB0aGlzLmlkc1tpZF1cbiAgICB3aGlsZSAobm9kZS5jaGlsZHJlbi5sZW5ndGggJiYgKG5vZGUuaWQgPT09IGlkIHx8ICFub2RlLmNvbGxhcHNlZCkpIHtcbiAgICAgIG5vZGUgPSB0aGlzLmlkc1tub2RlLmNoaWxkcmVuW25vZGUuY2hpbGRyZW4ubGVuZ3RoIC0gMV1dXG4gICAgfVxuICAgIHJldHVybiBub2RlLmlkXG4gIH0sXG5cbiAgaWRBYm92ZTogZnVuY3Rpb24gKGlkKSB7XG4gICAgdmFyIHBpZCA9IHRoaXMuaWRzW2lkXS5wYXJlbnRcbiAgICAgICwgcGFyZW50ID0gdGhpcy5pZHNbcGlkXVxuICAgIGlmICghcGFyZW50KSByZXR1cm5cbiAgICB2YXIgaXggPSBwYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihpZClcbiAgICBpZiAoaXggPT09IDApIHtcbiAgICAgIHJldHVybiBwaWRcbiAgICB9XG4gICAgdmFyIHByZXZpZCA9IHBhcmVudC5jaGlsZHJlbltpeCAtIDFdXG4gICAgd2hpbGUgKHRoaXMuaWRzW3ByZXZpZF0uY2hpbGRyZW4gJiZcbiAgICAgICAgICAgdGhpcy5pZHNbcHJldmlkXS5jaGlsZHJlbi5sZW5ndGggJiZcbiAgICAgICAgICAgIXRoaXMuaWRzW3ByZXZpZF0uY29sbGFwc2VkKSB7XG4gICAgICBwcmV2aWQgPSB0aGlzLmlkc1twcmV2aWRdLmNoaWxkcmVuW3RoaXMuaWRzW3ByZXZpZF0uY2hpbGRyZW4ubGVuZ3RoIC0gMV1cbiAgICB9XG4gICAgcmV0dXJuIHByZXZpZFxuICB9LFxuXG4gIC8vIGdldCB0aGUgcGxhY2UgdG8gc2hpZnQgbGVmdCB0b1xuICBzaGlmdExlZnRQbGFjZTogZnVuY3Rpb24gKGlkKSB7XG4gICAgdmFyIHBpZCA9IHRoaXMuaWRzW2lkXS5wYXJlbnRcbiAgICAgICwgcGFyZW50ID0gdGhpcy5pZHNbcGlkXVxuICAgIGlmICghcGFyZW50KSByZXR1cm5cbiAgICB2YXIgcHBpZCA9IHBhcmVudC5wYXJlbnRcbiAgICAgICwgcHBhcmVudCA9IHRoaXMuaWRzW3BwaWRdXG4gICAgaWYgKCFwcGFyZW50KSByZXR1cm5cbiAgICB2YXIgcGl4ID0gcHBhcmVudC5jaGlsZHJlbi5pbmRleE9mKHBpZClcbiAgICByZXR1cm4ge1xuICAgICAgcGlkOiBwcGlkLFxuICAgICAgaXg6IHBpeCArIDFcbiAgICB9XG4gIH0sXG5cbiAgc2hpZnRVcFBsYWNlOiBmdW5jdGlvbiAoaWQpIHtcbiAgICB2YXIgcGlkID0gdGhpcy5pZHNbaWRdLnBhcmVudFxuICAgICAgLCBwYXJlbnQgPSB0aGlzLmlkc1twaWRdXG4gICAgaWYgKCFwYXJlbnQpIHJldHVyblxuICAgIHZhciBpeCA9IHBhcmVudC5jaGlsZHJlbi5pbmRleE9mKGlkKVxuICAgIGlmIChpeCA9PT0gMCkge1xuICAgICAgdmFyIHBsID0gdGhpcy5zaGlmdExlZnRQbGFjZShpZClcbiAgICAgIGlmICghcGwpIHJldHVyblxuICAgICAgcGwuaXggLT0gMVxuICAgICAgcmV0dXJuIHBsXG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBwaWQ6IHBpZCxcbiAgICAgIGl4OiBpeCAtIDFcbiAgICB9XG4gIH0sXG5cbiAgc2hpZnREb3duUGxhY2U6IGZ1bmN0aW9uIChpZCkge1xuICAgIHZhciBwaWQgPSB0aGlzLmlkc1tpZF0ucGFyZW50XG4gICAgICAsIHBhcmVudCA9IHRoaXMuaWRzW3BpZF1cbiAgICBpZiAoIXBhcmVudCkgcmV0dXJuXG4gICAgdmFyIGl4ID0gcGFyZW50LmNoaWxkcmVuLmluZGV4T2YoaWQpXG4gICAgaWYgKGl4ID49IHBhcmVudC5jaGlsZHJlbi5sZW5ndGggLSAxKSB7XG4gICAgICByZXR1cm4gdGhpcy5zaGlmdExlZnRQbGFjZShpZClcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHBpZDogcGlkLFxuICAgICAgaXg6IGl4ICsgMVxuICAgIH1cbiAgfSxcblxuICBtb3ZlQmVmb3JlUGxhY2U6IGZ1bmN0aW9uIChpZCwgdGlkKSB7XG4gICAgdmFyIHNpYiA9IHRoaXMuaWRzW2lkXVxuICAgICAgLCBwaWQgPSBzaWIucGFyZW50XG4gICAgICAsIG9waWQgPSB0aGlzLmlkc1t0aWRdLnBhcmVudFxuICAgIGlmICh1bmRlZmluZWQgPT09IHBpZCkgcmV0dXJuXG4gICAgdmFyIHBhcmVudCA9IHRoaXMuaWRzW3BpZF1cbiAgICB2YXIgbml4ID0gcGFyZW50LmNoaWxkcmVuLmluZGV4T2YoaWQpXG4gICAgaWYgKHBpZCA9PT0gb3BpZCAmJiBwYXJlbnQuY2hpbGRyZW4uaW5kZXhPZih0aWQpIDwgbml4KSB7XG4gICAgICBuaXggLT0gMVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgcGlkOiBwaWQsXG4gICAgICBpeDogbml4XG4gICAgfVxuICB9LFxuXG4gIG1vdmVBZnRlclBsYWNlOiBmdW5jdGlvbiAoaWQsIG9pZCkge1xuICAgIHZhciBzaWIgPSB0aGlzLmlkc1tpZF1cbiAgICAgICwgcGlkID0gc2liLnBhcmVudFxuICAgICAgLCBvcGlkID0gdGhpcy5pZHNbb2lkXS5wYXJlbnRcbiAgICBpZiAodW5kZWZpbmVkID09PSBwaWQpIHJldHVyblxuICAgIHZhciBvaXggPSB0aGlzLmlkc1tvcGlkXS5jaGlsZHJlbi5pbmRleE9mKG9pZClcbiAgICB2YXIgcGFyZW50ID0gdGhpcy5pZHNbcGlkXVxuICAgICAgLCBpeCA9IHBhcmVudC5jaGlsZHJlbi5pbmRleE9mKGlkKSArIDFcbiAgICBpZiAoIHBpZCA9PT0gb3BpZCAmJiBpeCA+IG9peCkgaXggLT0gMVxuICAgIHJldHVybiB7XG4gICAgICBwaWQ6IHBpZCxcbiAgICAgIGl4OiBpeFxuICAgIH1cbiAgfSxcblxuICBpZEJlbG93OiBmdW5jdGlvbiAoaWQsIHJvb3QpIHtcbiAgICBpZiAodGhpcy5pZHNbaWRdLmNoaWxkcmVuICYmXG4gICAgICAgIHRoaXMuaWRzW2lkXS5jaGlsZHJlbi5sZW5ndGggJiZcbiAgICAgICAgKGlkID09PSByb290IHx8ICF0aGlzLmlkc1tpZF0uY29sbGFwc2VkKSkge1xuICAgICAgcmV0dXJuIHRoaXMuaWRzW2lkXS5jaGlsZHJlblswXVxuICAgIH1cbiAgICB2YXIgcGlkID0gdGhpcy5pZHNbaWRdLnBhcmVudFxuICAgICAgLCBwYXJlbnQgPSB0aGlzLmlkc1twaWRdXG4gICAgaWYgKCFwYXJlbnQpIHJldHVyblxuICAgIHZhciBpeCA9IHBhcmVudC5jaGlsZHJlbi5pbmRleE9mKGlkKVxuICAgIHdoaWxlIChpeCA9PT0gcGFyZW50LmNoaWxkcmVuLmxlbmd0aCAtIDEpIHtcbiAgICAgIGlmIChwYXJlbnQuaWQgPT09IHJvb3QpIHJldHVyblxuICAgICAgcGFyZW50ID0gdGhpcy5pZHNbcGFyZW50LnBhcmVudF1cbiAgICAgIGlmICghcGFyZW50KSByZXR1cm5cbiAgICAgIGl4ID0gcGFyZW50LmNoaWxkcmVuLmluZGV4T2YocGlkKVxuICAgICAgcGlkID0gcGFyZW50LmlkXG4gICAgfVxuICAgIHJldHVybiBwYXJlbnQuY2hpbGRyZW5baXggKyAxXVxuICB9LFxuXG4gIGlkTmV3OiBmdW5jdGlvbiAoaWQsIGJlZm9yZSwgcm9vdCkge1xuICAgIHZhciBwaWQgPSB0aGlzLmlkc1tpZF0ucGFyZW50XG4gICAgICAsIHBhcmVudFxuICAgICAgLCBuaXhcbiAgICBpZiAoYmVmb3JlKSB7XG4gICAgICBwYXJlbnQgPSB0aGlzLmlkc1twaWRdXG4gICAgICBuaXggPSBwYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihpZClcbiAgICB9IGVsc2UgaWYgKGlkID09PSB0aGlzLnJvb3QgfHxcbiAgICAgICAgcm9vdCA9PT0gaWQgfHxcbiAgICAgICAgKHRoaXMuaWRzW2lkXS5jaGlsZHJlbiAmJlxuICAgICAgICB0aGlzLmlkc1tpZF0uY2hpbGRyZW4ubGVuZ3RoICYmXG4gICAgICAgICF0aGlzLmlkc1tpZF0uY29sbGFwc2VkKSkge1xuICAgICAgcGlkID0gaWRcbiAgICAgIG5peCA9IDBcbiAgICB9IGVsc2Uge1xuICAgICAgcGFyZW50ID0gdGhpcy5pZHNbcGlkXVxuICAgICAgbml4ID0gcGFyZW50LmNoaWxkcmVuLmluZGV4T2YoaWQpICsgMVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgcGlkOiBwaWQsXG4gICAgICBpbmRleDogbml4XG4gICAgfVxuICB9LFxuXG4gIHNhbWVQbGFjZTogZnVuY3Rpb24gKGlkLCBwbGFjZSkge1xuICAgIHZhciBwaWQgPSB0aGlzLmlkc1tpZF0ucGFyZW50XG4gICAgaWYgKCFwaWQgfHwgcGlkICE9PSBwbGFjZS5waWQpIHJldHVybiBmYWxzZVxuICAgIHZhciBwYXJlbnQgPSB0aGlzLmlkc1twaWRdXG4gICAgICAsIGl4ID0gcGFyZW50LmNoaWxkcmVuLmluZGV4T2YoaWQpXG4gICAgcmV0dXJuIGl4ID09PSBwbGFjZS5peFxuICB9LFxuXG4gIGZpbmRDb2xsYXBzZXI6IGZ1bmN0aW9uIChpZCkge1xuICAgIGlmICgoIXRoaXMuaWRzW2lkXS5jaGlsZHJlbiB8fFxuICAgICAgICAgIXRoaXMuaWRzW2lkXS5jaGlsZHJlbi5sZW5ndGggfHxcbiAgICAgICAgIHRoaXMuaWRzW2lkXS5jb2xsYXBzZWQpICYmXG4gICAgICAgIHRoaXMuaWRzW2lkXS5wYXJlbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWQgPSB0aGlzLmlkc1tpZF0ucGFyZW50XG4gICAgfVxuICAgIHJldHVybiBpZFxuICB9LFxufVxuXG4iLCIvKlxuICogdHJ1ZSA9PiBcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgLy8gbm90IGRlYWxpbmcgd2l0aCB0aGUgYWN0aXZlIGVsZW1lbnRcbiAgJ3VuZG8nOiB7XG4gICAgaGVscDogJ1VuZG8gdGhlIGxhc3QgYWN0aW9uJyxcbiAgfSxcblxuICAncmVkbyc6IHtcbiAgICBoZWxwOiAnVW5kbyB0aGUgbGFzdCBhY3Rpb24nLFxuICB9LFxuXG4gICdjdXQnOiB7XG4gICAgaGVscDogJ3JlbW92ZSB0aGUgY3Vycm5ldGx5IHNlbGVjdGVkIGl0ZW0gYW5kIHBsYWNlIGl0IGluIHRoZSBjbGlwYm9hcmQnLFxuICAgIGFjdGl2ZTogdHJ1ZSxcbiAgfSxcblxuICAnY29weSc6IHtcbiAgICBoZWxwOiAncGxhY2UgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBpdGVtIGluIHRoZSBjbGlwYm9hcmQnLFxuICAgIGFjdGl2ZTogdHJ1ZSxcbiAgfSxcblxuICAncGFzdGUnOiB7XG4gICAgaGVscDogJ2luc2VydCB0aGUgY29udGVudHMgb2YgdGhlIGNsaXBib2FyZCwgaW50byBvciBiZWxvdyB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGl0ZW0nLFxuICAgIGFjdGl2ZTogdHJ1ZSxcbiAgfSxcblxuICAncGFzdGUgYWJvdmUnOiB7XG4gICAgaGVscDogJ2luc2VydCB0aGUgY29udGVudHMgb2YgdGhlIGNsaXBib2FyZCBhYm92ZSB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGl0ZW0nLFxuICAgIGFjdGl2ZTogdHJ1ZSxcbiAgfSxcblxuICAndmlzdWFsIG1vZGUnOiB7XG4gICAgaGVscDogJ2VudGVyIG11bHRpLXNlbGVjdCBtb2RlJyxcbiAgICBhY3RpdmU6ICchcm9vdCcsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnNldFNlbGVjdGlvbihbdGhpcy5hY3RpdmVdKVxuICAgIH0sXG4gIH0sXG5cbiAgJ2NoYW5nZSc6IHtcbiAgICBoZWxwOiAnY2xlYXIgdGhlIGNvbnRlbnRzIG9mIHRoaXMgbm9kZSBhbmQgc3RhcnQgZWRpdGluZycsXG4gICAgYWN0aXZlOiB0cnVlLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy52bC5ib2R5KHRoaXMuYWN0aXZlKS5zZXRDb250ZW50KCcnKVxuICAgICAgdGhpcy52bC5ib2R5KHRoaXMuYWN0aXZlKS5zdGFydEVkaXRpbmcoKVxuICAgIH0sXG4gIH0sXG5cbiAgZWRpdDoge1xuICAgIGhlbHA6ICdzdGFydCBlZGl0aW5nIHRoaXMgbm9kZSBhdCB0aGUgZW5kJyxcbiAgICBhY3RpdmU6IHRydWUsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnZsLmJvZHkodGhpcy5hY3RpdmUpLnN0YXJ0RWRpdGluZygpXG4gICAgfVxuICB9LFxuXG4gICdlZGl0IHN0YXJ0Jzoge1xuICAgIGhlbHA6ICdzdGFydCBlZGl0aW5nIHRoaXMgbm9kZSBhdCB0aGUgc3RhcnQnLFxuICAgIGFjdGl2ZTogdHJ1ZSxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMudmwuYm9keSh0aGlzLmFjdGl2ZSkuc3RhcnRFZGl0aW5nKHRydWUpXG4gICAgfSxcbiAgfSxcblxuICAvLyBuYXZcbiAgJ2ZpcnN0IHNpYmxpbmcnOiB7XG4gICAgaGVscDogJ2p1bXAgdG8gdGhlIGZpcnN0IHNpYmxpbmcnLFxuICAgIGFjdGl2ZTogJyFuZXcnLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGZpcnN0ID0gdGhpcy5tb2RlbC5maXJzdFNpYmxpbmcodGhpcy5hY3RpdmUpXG4gICAgICBpZiAodW5kZWZpbmVkID09PSBmaXJzdCkgcmV0dXJuXG4gICAgICB0aGlzLnNldEFjdGl2ZShmaXJzdClcbiAgICB9XG4gIH0sXG5cbiAgJ2xhc3Qgc2libGluZyc6IHtcbiAgICBoZWxwOiAnanVtcCB0byB0aGUgbGFzdCBzaWJsaW5nJyxcbiAgICBhY3RpdmU6ICchbmV3JyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBsYXN0ID0gdGhpcy5tb2RlbC5sYXN0U2libGluZyh0aGlzLmFjdGl2ZSlcbiAgICAgIGlmICh1bmRlZmluZWQgPT09IGxhc3QpIHJldHVyblxuICAgICAgdGhpcy5zZXRBY3RpdmUobGFzdClcbiAgICB9LFxuICB9LFxuXG4gICdqdW1wIHRvIHRvcCc6IHtcbiAgICBoZWxwOiAnanVtcCB0byB0aGUgdG9wJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuc2V0QWN0aXZlKHRoaXMucm9vdClcbiAgICB9LFxuICB9LFxuXG4gICdqdW1wIHRvIGJvdHRvbSc6IHtcbiAgICBoZWxwOiAnanVtcCB0byB0aGUgbGFzdCBub2RlJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuc2V0QWN0aXZlKHRoaXMubW9kZWwubGFzdE9wZW4odGhpcy5yb290KSlcbiAgICAgIGNvbnNvbGUubG9nKCdib3R0b20nKVxuICAgICAgLy8gcGFzc1xuICAgIH0sXG4gIH0sXG5cbiAgJ3VwJzoge1xuICAgIGhlbHA6ICdnbyB0byB0aGUgcHJldmlvdXMgbm9kZScsXG4gICAgYWN0aXZlOiB0cnVlLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGFib3ZlXG4gICAgICBpZiAodGhpcy5hY3RpdmUgPT09ICduZXcnKSB7XG4gICAgICAgIGFib3ZlID0gdGhpcy5yb290XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdG9wID0gdGhpcy5hY3RpdmVcbiAgICAgICAgYWJvdmUgPSB0aGlzLm1vZGVsLmlkQWJvdmUodG9wKVxuICAgICAgICBpZiAoYWJvdmUgPT09IHVuZGVmaW5lZCkgYWJvdmUgPSB0b3BcbiAgICAgIH1cbiAgICAgIGlmIChhYm92ZSA9PT0gdGhpcy5yb290ICYmIHRoaXMuby5ub1NlbGVjdFJvb3QpIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG4gICAgICB0aGlzLnNldEFjdGl2ZShhYm92ZSlcbiAgICB9LFxuICB9LFxuXG4gICdkb3duJzoge1xuICAgIGhlbHA6ICdnbyBkb3duIHRvIHRoZSBuZXh0IG5vZGUnLFxuICAgIGFjdGl2ZTogJyFuZXcnLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuYWN0aXZlID09PSB0aGlzLnJvb3QgJiZcbiAgICAgICAgICAhdGhpcy5tb2RlbC5pZHNbdGhpcy5yb290XS5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2V0QWN0aXZlKCduZXcnKVxuICAgICAgfVxuICAgICAgdmFyIHRvcCA9IHRoaXMuYWN0aXZlXG4gICAgICAgICwgYWJvdmUgPSB0aGlzLm1vZGVsLmlkQmVsb3codG9wLCB0aGlzLnJvb3QpXG4gICAgICBpZiAoYWJvdmUgPT09IHVuZGVmaW5lZCkgYWJvdmUgPSB0b3BcbiAgICAgIHRoaXMuc2V0QWN0aXZlKGFib3ZlKVxuICAgIH1cbiAgfSxcblxuICAnbGVmdCc6IHtcbiAgICBoZWxwOiAnZ28gdXAgYSBsZXZlbCB0byB0aGUgcGFyZW50JyxcbiAgICBhY3RpdmU6IHRydWUsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5hY3RpdmUgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2V0QWN0aXZlKHRoaXMucm9vdClcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmFjdGl2ZSA9PT0gJ25ldycpIHJldHVybiB0aGlzLnNldEFjdGl2ZSh0aGlzLnJvb3QpXG4gICAgICB2YXIgbGVmdCA9IHRoaXMubW9kZWwuZ2V0UGFyZW50KHRoaXMuYWN0aXZlKVxuICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbGVmdCkgcmV0dXJuXG4gICAgICB0aGlzLnNldEFjdGl2ZShsZWZ0KVxuICAgIH0sXG4gIH0sXG5cbiAgJ3JpZ2h0Jzoge1xuICAgIGhlbHA6ICdnbyBkb3duIGEgbGV2ZWwgdG8gdGhlIGZpcnN0IGNoaWxkJyxcbiAgICBhY3RpdmU6ICchbm93JyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLmFjdGl2ZSA9PT0gdGhpcy5yb290ICYmXG4gICAgICAgICAgIXRoaXMubW9kZWwuaWRzW3RoaXMucm9vdF0uY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNldEFjdGl2ZSgnbmV3JylcbiAgICAgIH1cbiAgICAgIHZhciByaWdodCA9IHRoaXMubW9kZWwuZ2V0Q2hpbGQodGhpcy5hY3RpdmUpXG4gICAgICBpZiAodGhpcy5tb2RlbC5pc0NvbGxhcHNlZCh0aGlzLmFjdGl2ZSkpIHJldHVyblxuICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcmlnaHQpIHJldHVyblxuICAgICAgdGhpcy5zZXRBY3RpdmUocmlnaHQpXG4gICAgfSxcbiAgfSxcblxuICAnbmV4dCBzaWJsaW5nJzoge1xuICAgIGhlbHA6ICdqdW1wIHRvIHRoZSBuZXh0IHNpYmxpbmcgKHNraXBwaW5nIGNoaWxkcmVuKScsXG4gICAgYWN0aXZlOiAnIW5ldycsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgc2liID0gdGhpcy5tb2RlbC5uZXh0U2libGluZyh0aGlzLmFjdGl2ZSlcbiAgICAgIGlmICh1bmRlZmluZWQgPT09IHNpYikgcmV0dXJuXG4gICAgICB0aGlzLnNldEFjdGl2ZShzaWIpXG4gICAgfSxcbiAgfSxcblxuICAncHJldiBzaWJsaW5nJzoge1xuICAgIGhlbHA6ICdqdW1wIHRvIHRoZSBwcmV2aW91cyBzaWJsaW5nIChza2lwcGluZyBjaGlsZHJlbiknLFxuICAgIGFjdGl2ZTogJyFuZXcnLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHNpYiA9IHRoaXMubW9kZWwucHJldlNpYmxpbmcodGhpcy5hY3RpdmUpXG4gICAgICBpZiAodW5kZWZpbmVkID09PSBzaWIpIHJldHVyblxuICAgICAgdGhpcy5zZXRBY3RpdmUoc2liKVxuICAgIH0sXG4gIH0sXG5cbiAgJ21vdmUgdG8gZmlyc3Qgc2libGluZyc6IHtcbiAgICBoZWxwOiAnbW92ZSB0aGlzIG5vZGUgdG8gYmUgdGhlIGZpcnN0IGNoaWxkIGlmIGl0cyBwYXJlbnQnLFxuICAgIGFjdGl2ZTogJyFuZXcnLFxuICAgIGFjdGlvbjogJ21vdmVUb1RvcCdcbiAgfSxcblxuICAnbW92ZSB0byBsYXN0IHNpYmxpbmcnOiB7XG4gICAgaGVscDogJ21vdmUgdGhpcyB0byBiZSB0aGUgbGFzdCBjaGlsZCBvZiBpdHMgcGFyZW50JyxcbiAgICBhY3RpdmU6ICchbmV3JyxcbiAgICBhY3Rpb246ICdtb3ZlVG9Cb3R0b20nXG4gIH0sXG5cbiAgJ25ldyBiZWZvcmUnOiB7XG4gICAgaGVscDogJ2NyZWF0ZSBhIG5vZGUgYWJvdmUgdGhpcyBvbmUgYW5kIHN0YXJ0IGVkaXRpbmcnLFxuICAgIGFjdGl2ZTogdHJ1ZSxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuY3RybGFjdGlvbnMuYWRkQmVmb3JlKHRoaXMuYWN0aXZlLCAnJywgdHJ1ZSlcbiAgICB9XG4gIH0sXG5cbiAgJ25ldyBhZnRlcic6IHtcbiAgICBoZWxwOiAnY3JlYXRlIGEgbm9kZSBhZnRlciB0aGlzIG9uZSBhbmQgc3RhcnQgZWRpdGluZycsXG4gICAgYWN0aXZlOiB0cnVlLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuYWN0aXZlID09PSAnbmV3JykgcmV0dXJuIHRoaXMuc3RhcnRFZGl0aW5nKClcbiAgICAgIHRoaXMuY3RybGFjdGlvbnMuYWRkQWZ0ZXIodGhpcy5hY3RpdmUsICcnLCB0cnVlKVxuICAgIH0sXG4gIH0sXG5cbiAgLy8gbW92ZXohXG4gICd0b2dnbGUgY29sbGFwc2UnOiB7XG4gICAgaGVscDogJ3RvZ2dsZSBjb2xsYXBzZScsXG4gICAgYWN0aXZlOiB0cnVlLFxuICB9LFxuXG4gICdjb2xsYXBzZSc6IHtcbiAgICBoZWxwOiAnY29sbGFwc2UgdGhlIG5vZGUnLFxuICAgIGFjdGl2ZTogdHJ1ZSxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuY3RybGFjdGlvbnMudG9nZ2xlQ29sbGFwc2UodGhpcy5hY3RpdmUsIHRydWUpXG4gICAgfSxcbiAgfSxcblxuICAndW5jb2xsYXBzZSc6IHtcbiAgICBoZWxwOiAnZXhwYW5kIHRoZSBub2RlJyxcbiAgICBhY3RpdmU6IHRydWUsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmN0cmxhY3Rpb25zLnRvZ2dsZUNvbGxhcHNlKHRoaXMuYWN0aXZlLCBmYWxzZSlcbiAgICB9XG4gIH0sXG5cbiAgJ2luZGVudCc6IHtcbiAgICBoZWxwOiAnaW5kZW50IHRoZSBub2RlJyxcbiAgICBhY3RpdmU6IHRydWUsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmN0cmxhY3Rpb25zLm1vdmVSaWdodCh0aGlzLmFjdGl2ZSlcbiAgICB9LFxuICB9LFxuXG4gICdkZWRlbnQnOiB7XG4gICAgaGVscDogJ2RlZGVudCB0aGUgbm9kZScsXG4gICAgYWN0aXZlOiB0cnVlLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5jdHJsYWN0aW9ucy5tb3ZlTGVmdCh0aGlzLmFjdGl2ZSlcbiAgICB9LFxuICB9LFxuXG4gICdtb3ZlIGRvd24nOiB7XG4gICAgaGVscDogJ21vdmUgdGhlIGN1cnJlbnQgbm9kZSBkb3duJyxcbiAgICBhY3RpdmU6IHRydWVcbiAgfSxcblxuICAnbW92ZSB1cCc6IHtcbiAgICBoZWxwOiAnbW92ZSB0aGUgY3VycmVudCBub2RlIHVwJyxcbiAgICBhY3RpdmU6IHRydWUsXG4gIH0sXG59XG5cbiIsIlxuZnVuY3Rpb24gbWVyZ2UoYSkge1xuICBmb3IgKHZhciBpPTE7IGk8YXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgZm9yICh2YXIgbmFtZSBpbiBhcmd1bWVudHNbaV0pIHtcbiAgICAgIGFbbmFtZV0gPSBhcmd1bWVudHNbaV1bbmFtZV1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGFcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBCYXNlXG5cbmZ1bmN0aW9uIG5vb3AoKSB7XG4gIHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRlZCFcIilcbn1cblxuZnVuY3Rpb24gQmFzZSgpIHtcbiAgdGhpcy5fbGlzdGVuZXJzID0ge31cbn1cblxuQmFzZS5leHRlbmQgPSBmdW5jdGlvbiAoZm4sIG9iaikge1xuICBmbi5wcm90b3R5cGUgPSBtZXJnZShPYmplY3QuY3JlYXRlKEJhc2UucHJvdG90eXBlKSwgb2JqKVxuICBmbi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBmblxufVxuXG5CYXNlLnByb3RvdHlwZSA9IHtcbiAgaW5pdDogZnVuY3Rpb24gKGRvbmUpIHtcbiAgICBkb25lKClcbiAgfSxcblxuICBsaXN0ZW46IGZ1bmN0aW9uICh0eXBlLCBhZGQsIGNoYW5nZSkge1xuICAgIC8vIG5vb3BcbiAgfSxcblxuICBzYXZlOiBub29wLFxuICB1cGRhdGU6IG5vb3AsXG4gIGZpbmRBbGw6IG5vb3AsXG4gIHJlbW92ZTogbm9vcCxcbiAgbG9hZDogbm9vcCxcbiAgZHVtcDogbm9vcCxcblxuICByZW1vdmVCYXRjaDogZnVuY3Rpb24gKHR5cGUsIGlkcykge1xuICAgIGZvciAodmFyIGk9MDsgaTxpZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMucmVtb3ZlKHR5cGUsIGlkc1tpXSlcbiAgICB9XG4gIH0sXG5cbiAgLy8gZXZlbnQgZW1pdHRlciBzdHVmZlxuICBlbWl0OiBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSlcbiAgICBpZiAoIXRoaXMuX2xpc3RlbmVyc1tldnRdKSByZXR1cm4gZmFsc2VcbiAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5fbGlzdGVuZXJzW2V2dF0ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMuX2xpc3RlbmVyc1tldnRdW2ldLmFwcGx5KHRoaXMsIGFyZ3MpXG4gICAgfVxuICB9LFxuXG4gIG9uOiBmdW5jdGlvbiAoZXZ0LCBoYW5kbGVyKSB7XG4gICAgaWYgKCF0aGlzLl9saXN0ZW5lcnNbZXZ0XSkge1xuICAgICAgdGhpcy5fbGlzdGVuZXJzW2V2dF0gPSBbXVxuICAgIH1cbiAgICB0aGlzLl9saXN0ZW5lcnNbZXZ0XS5wdXNoKGhhbmRsZXIpXG4gIH0sXG5cbiAgb2ZmOiBmdW5jdGlvbiAoZXZ0LCBoYW5kbGVyKSB7XG4gICAgaWYgKCF0aGlzLl9saXN0ZW5lcnNbZXZ0XSkgcmV0dXJuIGZhbHNlXG4gICAgdmFyIGkgPSB0aGlzLl9saXN0ZW5lcnNbZXZ0XS5pbmRleE9mKGhhbmRsZXIpXG4gICAgaWYgKGkgPT09IC0xKSByZXR1cm4gZmFsc2VcbiAgICB0aGlzLl9saXN0ZW5lcnNbZXZ0XS5zcGxpY2UoaSwgMSlcbiAgfSxcbn1cblxuIiwiXG52YXIgQmFzZSA9IHJlcXVpcmUoJy4vYmFzZScpXG52YXIgdXVpZCA9IHJlcXVpcmUoJy4uL3V1aWQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZpcmVQTFxuXG52YXIgQ09MT1JTID0gJyM0MmI5YmQgI2E0MDVmYSAjN2U2YzkzICNmZWU5MDEgI2E4ZmY5OScuc3BsaXQoJyAnKVxuZnVuY3Rpb24gcmFuZENvbG9yKCkge1xuICByZXR1cm4gQ09MT1JTW3BhcnNlSW50KE1hdGgucmFuZG9tKCkgKiBDT0xPUlMubGVuZ3RoKV1cbn1cblxuZnVuY3Rpb24gRmlyZVBMKG9wdGlvbnMpIHtcbiAgQmFzZS5jYWxsKHRoaXMpXG4gIHRoaXMuZGIgPSBuZXcgRmlyZWJhc2Uob3B0aW9ucy51cmwpO1xuICB0aGlzLmRhdGEgPSB7fVxufVxuXG5CYXNlLmV4dGVuZChGaXJlUEwsIHtcbiAgaW5pdDogZnVuY3Rpb24gKGRvbmUpIHtcbiAgICB2YXIgaWQgPSB1dWlkKCk7XG4gICAgdGhpcy5fdXNlcmlkID0gaWRcbiAgICB0aGlzLmRiLm9uY2UoJ3ZhbHVlJywgZnVuY3Rpb24gKHNuYXBzaG90KSB7XG4gICAgICB0aGlzLmRhdGEgPSBzbmFwc2hvdC52YWwoKVxuICAgICAgdmFyIHVzZXIgPSB0aGlzLmRiLmNoaWxkKCd1c2VycycpLmNoaWxkKGlkKVxuICAgICAgdXNlci5zZXQoe3NlbGVjdGlvbjogZmFsc2UsIGNvbG9yOiByYW5kQ29sb3IoKX0pXG4gICAgICB1c2VyLm9uRGlzY29ubmVjdCgpLnJlbW92ZSgpXG4gICAgICBkb25lKCk7XG4gICAgfS5iaW5kKHRoaXMpKVxuXG4gICAgdmFyIHVzZXJzID0gdGhpcy5kYi5jaGlsZCgndXNlcnMnKVxuICAgIHVzZXJzLm9uKCdjaGlsZF9hZGRlZCcsIGZ1bmN0aW9uIChzbmFwc2hvdCkge1xuICAgICAgdmFyIGlkID0gc25hcHNob3QubmFtZSgpXG4gICAgICB2YXIgdXNlciA9IHNuYXBzaG90LnZhbCgpXG4gICAgICBpZiAoaWQgPT09IHRoaXMuX3VzZXJpZCkgdXNlci5zZWxmID0gdHJ1ZVxuICAgICAgdGhpcy5lbWl0KCdhZGRBY3RpdmUnLCBpZCwgdXNlcilcbiAgICB9LmJpbmQodGhpcykpXG5cbiAgICB1c2Vycy5vbignY2hpbGRfY2hhbmdlZCcsIGZ1bmN0aW9uIChzbmFwc2hvdCkge1xuICAgICAgdmFyIGlkID0gc25hcHNob3QubmFtZSgpXG4gICAgICB2YXIgdXNlciA9IHNuYXBzaG90LnZhbCgpXG4gICAgICBpZiAoaWQgPT09IHRoaXMuX3VzZXJpZCkgdXNlci5zZWxmID0gdHJ1ZVxuICAgICAgdGhpcy5lbWl0KCdjaGFuZ2VBY3RpdmUnLCBpZCwgdXNlcilcbiAgICB9LmJpbmQodGhpcykpXG5cbiAgICB1c2Vycy5vbignY2hpbGRfcmVtb3ZlZCcsIGZ1bmN0aW9uIChzbmFwc2hvdCkge1xuICAgICAgdmFyIGlkID0gc25hcHNob3QubmFtZSgpXG4gICAgICB2YXIgdXNlciA9IHNuYXBzaG90LnZhbCgpXG4gICAgICBpZiAoaWQgPT09IHRoaXMuX3VzZXJpZCkgdXNlci5zZWxmID0gdHJ1ZVxuICAgICAgdGhpcy5lbWl0KCdyZW1vdmVBY3RpdmUnLCBpZCwgdXNlcilcbiAgICB9LmJpbmQodGhpcykpXG4gIH0sXG5cbiAgc2V0UHJlc2VuY2U6IGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcbiAgICB0aGlzLmRiLmNoaWxkKCd1c2VycycpLmNoaWxkKHRoaXMuX3VzZXJpZCkudXBkYXRlKHtcbiAgICAgIC8vIHRvZG8gdXNlcm5hbWVzXG4gICAgICBzZWxlY3Rpb246IHNlbGVjdGlvblxuICAgIH0pXG4gIH0sXG5cbiAgbGlzdGVuOiBmdW5jdGlvbiAodHlwZSwgb25BZGQsIG9uQ2hhbmdlZCkge1xuICAgIHRoaXMuZGIuY2hpbGQodHlwZSkub24oJ2NoaWxkX2NoYW5nZWQnLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgIHZhciBpZCA9IHNuYXBzaG90Lm5hbWUoKVxuICAgICAgdmFyIGRhdGEgPSBzbmFwc2hvdC52YWwoKVxuICAgICAgdGhpcy5kYXRhW3R5cGVdW2lkXSA9IGRhdGFcbiAgICAgICBvbkNoYW5nZWQoaWQsIGRhdGEpXG4gICAgfS5iaW5kKHRoaXMpKVxuXG4gICAgdGhpcy5kYi5jaGlsZCh0eXBlKS5vbignY2hpbGRfYWRkZWQnLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgIHZhciBpZCA9IHNuYXBzaG90Lm5hbWUoKVxuICAgICAgdmFyIGRhdGEgPSBzbmFwc2hvdC52YWwoKVxuICAgICAgdGhpcy5kYXRhW3R5cGVdW2lkXSA9IGRhdGFcbiAgICAgIG9uQWRkKGlkLCBkYXRhKVxuICAgIH0uYmluZCh0aGlzKSlcbiAgfSxcblxuICBzYXZlOiBmdW5jdGlvbiAodHlwZSwgaWQsIGRhdGEsIGRvbmUpIHtcbiAgICB0aGlzLmRhdGFbdHlwZV1baWRdID0gZGF0YVxuICAgIHRoaXMuZGIuY2hpbGQodHlwZSkuY2hpbGQoaWQpLnNldChkYXRhLCBkb25lKVxuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKHR5cGUsIGlkLCB1cGRhdGUsIGRvbmUpIHtcbiAgICB0aGlzLmRiLmNoaWxkKHR5cGUpLmNoaWxkKGlkKS51cGRhdGUodXBkYXRlLCBkb25lKVxuICB9LFxuXG4gIGZpbmRBbGw6IGZ1bmN0aW9uICh0eXBlLCBkb25lKSB7XG4gICAgdGhpcy5kYi5jaGlsZCh0eXBlKS5vbmNlKCd2YWx1ZScsIGZ1bmN0aW9uIChzbmFwc2hvdCkge1xuICAgICAgdmFyIGl0ZW1zID0gW11cbiAgICAgIHZhciB2YWwgPSBzbmFwc2hvdC52YWwoKVxuICAgICAgZm9yICh2YXIgbmFtZSBpbiB2YWwpIHtcbiAgICAgICAgaXRlbXMucHVzaCh2YWxbbmFtZV0pXG4gICAgICB9XG4gICAgICBkb25lKG51bGwsIGl0ZW1zKVxuICAgIH0pXG4gIH0sXG5cbiAgcmVtb3ZlOiBmdW5jdGlvbiAodHlwZSwgaWQsIGRvbmUpIHtcbiAgICB0aGlzLmRiLmNoaWxkKHR5cGUpLmNoaWxkKGlkKS5yZW1vdmUoZG9uZSlcbiAgfSxcblxuICBsb2FkOiBmdW5jdGlvbiAoZGF0YSwgZG9uZSwgY2xlYXIpIHtcbiAgfSxcblxuICBkdW1wOiBmdW5jdGlvbiAoZG9uZSkge1xuICB9LFxufSlcblxuIiwiXG52YXIgQmFzZSA9IHJlcXVpcmUoJy4vYmFzZScpXG5cbm1vZHVsZS5leHBvcnRzID0gTWVtUExcblxuZnVuY3Rpb24gTWVtUEwoKSB7XG4gIHRoaXMuZGF0YSA9IHt9XG59XG5cbkJhc2UuZXh0ZW5kKE1lbVBMLCB7XG4gIGluaXQ6IGZ1bmN0aW9uIChkb25lKSB7XG4gICAgZG9uZSgpXG4gIH0sXG5cbiAgc2F2ZTogZnVuY3Rpb24gKHR5cGUsIGlkLCBkYXRhLCBkb25lKSB7XG4gICAgaWYgKCF0aGlzLmRhdGFbdHlwZV0pIHtcbiAgICAgIHRoaXMuZGF0YVt0eXBlXSA9IHt9XG4gICAgfVxuICAgIHRoaXMuZGF0YVt0eXBlXVtpZF0gPSBkYXRhXG4gICAgZG9uZSAmJiBkb25lKClcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICh0eXBlLCBpZCwgdXBkYXRlLCBkb25lKSB7XG4gICAgZm9yICh2YXIgYXR0ciBpbiB1cGRhdGUpIHtcbiAgICAgIHRoaXMuZGF0YVt0eXBlXVtpZF1bYXR0cl0gPSB1cGRhdGVbYXR0cl1cbiAgICB9XG4gICAgZG9uZSAmJiBkb25lKClcbiAgfSxcblxuICBmaW5kQWxsOiBmdW5jdGlvbiAodHlwZSwgZG9uZSkge1xuICAgIHZhciBpdGVtcyA9IFtdXG4gICAgaWYgKHRoaXMuZGF0YVt0eXBlXSkge1xuICAgICAgZm9yICh2YXIgaWQgaW4gdGhpcy5kYXRhW3R5cGVdKSB7XG4gICAgICAgIGl0ZW1zLnB1c2godGhpcy5kYXRhW3R5cGVdW2lkXSlcbiAgICAgIH1cbiAgICB9XG4gICAgZG9uZShudWxsLCBpdGVtcylcbiAgfSxcblxuICByZW1vdmU6IGZ1bmN0aW9uICh0eXBlLCBpZCwgZG9uZSkge1xuICAgIGRlbGV0ZSB0aGlzLmRhdGFbdHlwZV1baWRdXG4gICAgZG9uZSAmJiBkb25lKClcbiAgfSxcblxuICBsb2FkOiBmdW5jdGlvbiAoZGF0YSwgZG9uZSwgY2xlYXIpIHtcbiAgICBkb25lICYmIGRvbmUoKTtcbiAgfSxcblxuICBkdW1wOiBmdW5jdGlvbiAoZG9uZSkge1xuICAgIGRvbmUobnVsbCwge25vZGVzOiB7fX0pO1xuICB9XG59KVxuXG4iLCJcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gc2xpZGVEb3duKG5vZGUpIHtcbiAgdmFyIHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUobm9kZSlcbiAgICAsIGhlaWdodCA9IHN0eWxlLmhlaWdodFxuICBpZiAoIXBhcnNlSW50KGhlaWdodCkpIHtcbiAgICByZXR1cm5cbiAgfVxuICB2YXIgc3BlZWQgPSBwYXJzZUludChoZWlnaHQpIC8gNzAwXG4gIG5vZGUuc3R5bGUuaGVpZ2h0ID0gMFxuICBub2RlLnN0eWxlLnRyYW5zaXRpb24gPSAnaGVpZ2h0ICcgKyBzcGVlZCArICdzIGVhc2UnXG4gIG5vZGUuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJ1xuICBjb25zb2xlLmxvZyhoZWlnaHQpXG5cbiAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS5sb2coJ3knLCBoZWlnaHQpXG4gICAgbm9kZS5zdHlsZS5oZWlnaHQgPSBoZWlnaHRcbiAgfSwgMClcblxuICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCBmaW4pXG4gIGZ1bmN0aW9uIGZpbigpIHtcbiAgICBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCBmaW4pXG4gICAgbm9kZS5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgndHJhbnNpdGlvbicpXG4gICAgbm9kZS5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgnaGVpZ2h0JylcbiAgICBub2RlLnN0eWxlLnJlbW92ZVByb3BlcnR5KCdvdmVyZmxvdycpXG4gIH1cbn1cblxuIiwiXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHNsaWRlVXAobm9kZSwgZG9uZSkge1xuICAvKlxuICBhbmltYXRlKG5vZGUsIHtcbiAgICBoZWlnaHQ6IHtcbiAgICAgIGZyb206ICdjdXJyZW50JyxcbiAgICAgIHRvOiAwXG4gICAgfVxuICB9LCBkb25lKVxuICAqL1xuICB2YXIgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShub2RlKVxuICAgICwgaGVpZ2h0ID0gc3R5bGUuaGVpZ2h0XG4gIGlmICghcGFyc2VJbnQoaGVpZ2h0KSkge1xuICAgIHJldHVyblxuICB9XG4gIG5vZGUuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0XG4gIHZhciBzcGVlZCA9IHBhcnNlSW50KGhlaWdodCkgLyA3MDBcbiAgbm9kZS5zdHlsZS50cmFuc2l0aW9uID0gJ2hlaWdodCAnICsgc3BlZWQgKyAncyBlYXNlJ1xuICBub2RlLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbidcblxuICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICBub2RlLnN0eWxlLmhlaWdodCA9IDBcbiAgfSwgMClcblxuICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCBmaW4pXG4gIGZ1bmN0aW9uIGZpbigpIHtcbiAgICBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCBmaW4pXG4gICAgbm9kZS5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgndHJhbnNpdGlvbicpXG4gICAgbm9kZS5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgnaGVpZ2h0JylcbiAgICBub2RlLnN0eWxlLnJlbW92ZVByb3BlcnR5KCdvdmVyZmxvdycpXG4gICAgZG9uZSgpXG4gIH1cbn1cbiIsIlxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGV4dGVuZDogZXh0ZW5kLFxuICBtZXJnZTogbWVyZ2UsXG4gIGVuc3VyZUluVmlldzogZW5zdXJlSW5WaWV3LFxuICBtYWtlX2xpc3RlZDogbWFrZV9saXN0ZWQsXG4gIGlzTWFjOiBpc01hYyxcbn1cblxuZnVuY3Rpb24gaXNNYWMoKSB7XG4gIHJldHVybiB3aW5kb3cubmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoJ01hYycpID09PSAwXG59XG5cbmZ1bmN0aW9uIG1lcmdlKGEsIGIpIHtcbiAgdmFyIGMgPSB7fVxuICAgICwgZFxuICBmb3IgKGQgaW4gYSkge1xuICAgIGNbZF0gPSBhW2RdXG4gIH1cbiAgZm9yIChkIGluIGIpIHtcbiAgICBjW2RdID0gYltkXVxuICB9XG4gIHJldHVybiBjXG59XG5cbmZ1bmN0aW9uIGVuc3VyZUluVmlldyhpdGVtKSB7XG4gIHZhciBiYiA9IGl0ZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgaWYgKGJiLnRvcCA8IDApIHJldHVybiBpdGVtLnNjcm9sbEludG9WaWV3KClcbiAgaWYgKGJiLmJvdHRvbSA+IHdpbmRvdy5pbm5lckhlaWdodCkge1xuICAgIGl0ZW0uc2Nyb2xsSW50b1ZpZXcoZmFsc2UpXG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0ZW5kKGRlc3QpIHtcbiAgW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLmZvckVhY2goZnVuY3Rpb24gKHNyYykge1xuICAgIGZvciAodmFyIGF0dHIgaW4gc3JjKSB7XG4gICAgICAgIGRlc3RbYXR0cl0gPSBzcmNbYXR0cl1cbiAgICB9XG4gIH0pXG4gIHJldHVybiBkZXN0XG59XG5cbmZ1bmN0aW9uIGxvYWQoZGIsIHRyZWUpIHtcbiAgdmFyIHJlcyA9IG1ha2VfbGlzdGVkKHRyZWUsIHVuZGVmaW5lZCwgdHJ1ZSlcbiAgZGIuc2F2ZSgncm9vdCcsIHtpZDogcmVzLmlkfSlcbiAgZm9yICh2YXIgaT0wOyBpPHJlcy50cmVlLmxlbmd0aDsgaSsrKSB7XG4gICAgZGIuc2F2ZSgnbm9kZScsIHJlcy50cmVlW2ldKVxuICB9XG59XG5cbmZ1bmN0aW9uIG1ha2VfbGlzdGVkKGRhdGEsIG5leHRpZCwgY29sbGFwc2UpIHtcbiAgdmFyIGlkcyA9IHt9XG4gICAgLCBjaGlsZHJlbiA9IFtdXG4gICAgLCBuZGF0YSA9IHt9XG4gICAgLCByZXNcbiAgICAsIGlcbiAgaWYgKHVuZGVmaW5lZCA9PT0gbmV4dGlkKSBuZXh0aWQgPSAxMDBcblxuICBpZiAoZGF0YS5jaGlsZHJlbikge1xuICAgIGZvciAoaT0wOyBpPGRhdGEuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlcyA9IG1ha2VfbGlzdGVkKGRhdGEuY2hpbGRyZW5baV0sIG5leHRpZCwgY29sbGFwc2UpXG4gICAgICBmb3IgKHZhciBpZCBpbiByZXMudHJlZSkge1xuICAgICAgICBpZHNbaWRdID0gcmVzLnRyZWVbaWRdXG4gICAgICAgIGlkc1tpZF0uZGVwdGggKz0gMVxuICAgICAgfVxuICAgICAgY2hpbGRyZW4ucHVzaChyZXMuaWQpXG4gICAgICBuZXh0aWQgPSByZXMuaWQgKyAxXG4gICAgfVxuICAgIC8vIGRlbGV0ZSBkYXRhLmNoaWxkcmVuXG4gIH1cbiAgZm9yICh2YXIgYXR0ciBpbiBkYXRhKSB7XG4gICAgaWYgKGF0dHIgPT09ICdjaGlsZHJlbicpIGNvbnRpbnVlO1xuICAgIG5kYXRhW2F0dHJdID0gZGF0YVthdHRyXVxuICB9XG4gIG5kYXRhLmRvbmUgPSBmYWxzZVxuICB2YXIgdGhlaWQgPSBkYXRhLmlkIHx8IG5leHRpZFxuICBpZHNbdGhlaWRdID0ge1xuICAgIGlkOiB0aGVpZCxcbiAgICBkYXRhOiBuZGF0YSxcbiAgICBjaGlsZHJlbjogY2hpbGRyZW4sXG4gICAgY29sbGFwc2VkOiAhIWNvbGxhcHNlLFxuICAgIGRlcHRoOiAwXG4gIH1cbiAgZm9yIChpPTA7IGk8Y2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICBpZHNbY2hpbGRyZW5baV1dLnBhcmVudCA9IHRoZWlkO1xuICB9XG4gIHJldHVybiB7aWQ6IHRoZWlkLCB0cmVlOiBpZHN9XG59XG5cbiIsIlxubW9kdWxlLmV4cG9ydHMgPSB1dWlkXG5cbnZhciBDSEFSUyA9ICcwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonXG5mdW5jdGlvbiB1dWlkKGxuKSB7XG4gIGxuID0gbG4gfHwgMzJcbiAgdmFyIGlkID0gJydcbiAgZm9yICh2YXIgaT0wOyBpPGxuOyBpKyspIHtcbiAgICBpZCArPSBDSEFSU1twYXJzZUludChNYXRoLnJhbmRvbSgpICogQ0hBUlMubGVuZ3RoKV1cbiAgfVxuICByZXR1cm4gaWRcbn1cblxuIiwiXG52YXIga2V5SGFuZGxlciA9IHJlcXVpcmUoJy4va2V5LWhhbmRsZXInKVxuICAsIG5vcm1hbEFjdGlvbnMgPSByZXF1aXJlKCcuL25vcm1hbC1hY3Rpb25zJylcbiAgLCB2aXN1YWxBY3Rpb25zID0gcmVxdWlyZSgnLi92aXN1YWwtYWN0aW9ucycpXG4gICwgdXRpbCA9IHJlcXVpcmUoJy4vdXRpbCcpXG5cbm1vZHVsZS5leHBvcnRzID0gVmlld1xuXG5mdW5jdGlvbiBlcWxpc3QoYSwgYikge1xuICBpZiAoYSA9PSBiKSByZXR1cm4gdHJ1ZVxuICBpZiAoIWEgfHwgIWIpIHJldHVybiBmYWxzZVxuICBpZiAoYS5sZW5ndGggIT09IGIubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbiAgZm9yICh2YXIgaT0wOyBpPGEubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoYVtpXSAhPT0gYltpXSkgcmV0dXJuIGZhbHNlXG4gIH1cbiAgcmV0dXJuIHRydWVcbn1cblxudmFyIERvbVZpZXdMYXllciA9IHJlcXVpcmUoJy4vZG9tLXZsJylcbiAgLCBEZWZhdWx0Tm9kZSA9IHJlcXVpcmUoJy4vZGVmYXVsdC1ub2RlJylcbiAgLCBEdW5nZW9uc0FuZERyYWdvbnMgPSByZXF1aXJlKCcuL2RuZCcpXG4gICwga2V5cyA9IHJlcXVpcmUoJy4va2V5cycpXG4gICwgdXRpbCA9IHJlcXVpcmUoJy4vdXRpbCcpXG4gICwgZGVmYXVsdEtleXMgPSByZXF1aXJlKCcuL2RlZmF1bHQta2V5cycpXG5cbi8qKlxuICogVGhlIGJhc2ljIHZpZXdcbiAqXG4gKiBiaW5kQWN0aW9uczogZm4oKVxuICogbW9kZWw6IHRoZSBtb2RlbFxuICogYWN0aW9uczogdGhlIGNvbnRyb2xsZXIgYWN0aW9uc1xuICogb3B0aW9uczogb3B0aW9ucyBoYXNoXG4gKi9cbmZ1bmN0aW9uIFZpZXcoYmluZEFjdGlvbnMsIG1vZGVsLCBhY3Rpb25zLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9XG4gIHRoaXMubW9kZSA9ICdub3JtYWwnXG4gIHRoaXMuc2VsZWN0aW9uID0gbnVsbFxuICB0aGlzLnNlbF9pbnZlcnRlZCA9IGZhbHNlXG4gIHRoaXMuYWN0aXZlID0gbnVsbFxuICB0aGlzLm8gPSB1dGlsLmV4dGVuZCh7XG4gICAgTm9kZTogRGVmYXVsdE5vZGUsXG4gICAgVmlld0xheWVyOiBEb21WaWV3TGF5ZXIsXG4gICAgbm9TZWxlY3RSb290OiBmYWxzZSxcbiAgICBhbmltYXRlOiB0cnVlXG4gIH0sIG9wdGlvbnMpXG4gIHRoaXMuby5rZXliaW5kaW5ncyA9IHV0aWwubWVyZ2UodGhpcy5nZXREZWZhdWx0S2V5cygpLCBvcHRpb25zLmtleXMpXG4gIHRoaXMudmwgPSBuZXcgdGhpcy5vLlZpZXdMYXllcih0aGlzLm8pXG4gIHRoaXMuYmluZEFjdGlvbnMgPSBiaW5kQWN0aW9uc1xuICB0aGlzLm1vZGVsID0gbW9kZWxcbiAgdGhpcy5jdHJsYWN0aW9ucyA9IGFjdGlvbnNcbiAgdGhpcy5tb2RlbEFjdGlvbnMgPSBtb2RlbC5ib3VuZEFjdGlvbnNcbiAgLy8gYWN0dWFsbHkgRHJhZ0FuZERyb3BcbiAgdGhpcy5kbmQgPSBuZXcgRHVuZ2VvbnNBbmREcmFnb25zKHRoaXMudmwsIGFjdGlvbnMubW92ZSlcbiAgdGhpcy5sYXp5X2NoaWxkcmVuID0ge31cbiAgdGhpcy5fbGlzdGVuZXJzID0ge31cblxuICB0aGlzLm5ld05vZGUgPSBudWxsXG4gIHRoaXMuYXR0YWNoTGlzdGVuZXJzKClcbn1cblxuVmlldy5wcm90b3R5cGUgPSB7XG4gIGdldE5vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy52bC5yb290XG4gIH0sXG5cbiAgZW1pdDogZnVuY3Rpb24gKGV2dCkge1xuICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpXG4gICAgaWYgKCF0aGlzLl9saXN0ZW5lcnNbZXZ0XSkgcmV0dXJuIGZhbHNlXG4gICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuX2xpc3RlbmVyc1tldnRdLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLl9saXN0ZW5lcnNbZXZ0XVtpXS5hcHBseSh0aGlzLCBhcmdzKVxuICAgIH1cbiAgfSxcblxuICBvbjogZnVuY3Rpb24gKGV2dCwgaGFuZGxlcikge1xuICAgIGlmICghdGhpcy5fbGlzdGVuZXJzW2V2dF0pIHtcbiAgICAgIHRoaXMuX2xpc3RlbmVyc1tldnRdID0gW11cbiAgICB9XG4gICAgdGhpcy5fbGlzdGVuZXJzW2V2dF0ucHVzaChoYW5kbGVyKVxuICB9LFxuXG4gIG9mZjogZnVuY3Rpb24gKGV2dCwgaGFuZGxlcikge1xuICAgIGlmICghdGhpcy5fbGlzdGVuZXJzW2V2dF0pIHJldHVybiBmYWxzZVxuICAgIHZhciBpID0gdGhpcy5fbGlzdGVuZXJzW2V2dF0uaW5kZXhPZihoYW5kbGVyKVxuICAgIGlmIChpID09PSAtMSkgcmV0dXJuIGZhbHNlXG4gICAgdGhpcy5fbGlzdGVuZXJzW2V2dF0uc3BsaWNlKGksIDEpXG4gIH0sXG5cbiAgZ2V0RGVmYXVsdEtleXM6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdXRpbC5tZXJnZShkZWZhdWx0S2V5cy52aWV3LmJhc2UsXG4gICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdEtleXMudmlld1t1dGlsLmlzTWFjKCkgPyAnbWFjJyA6ICdwYyddKVxuICB9LFxuXG4gIHJlYmFzZTogZnVuY3Rpb24gKG5ld3Jvb3QsIHRyaWdnZXIpIHtcbiAgICB0aGlzLnZsLmNsZWFyKClcbiAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKVxuICAgIGlmICghdGhpcy5tb2RlbC5pZHNbbmV3cm9vdF0pIG5ld3Jvb3QgPSB0aGlzLm1vZGVsLnJvb3RcbiAgICB2YXIgcm9vdCA9IHRoaXMudmwucm9vdFxuICAgIHRoaXMuaW5pdGlhbGl6ZShuZXdyb290KVxuICAgIHRoaXMudmwucmViYXNlKHJvb3QpXG4gICAgdGhpcy5jdHJsYWN0aW9ucy50cmlnZ2VyKCdyZWJhc2UnLCBuZXdyb290KVxuICB9LFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChyb290KSB7XG4gICAgdmFyIG5vZGUgPSB0aGlzLm1vZGVsLmlkc1tyb290XVxuICAgICAgLCByb290Tm9kZSA9IHRoaXMudmwubWFrZVJvb3Qobm9kZSwgdGhpcy5iaW5kQWN0aW9ucyhyb290KSwgdGhpcy5tb2RlbEFjdGlvbnMpXG4gICAgdGhpcy5hY3RpdmUgPSBudWxsXG4gICAgdGhpcy5zZWxlY3Rpb24gPSBudWxsXG4gICAgdGhpcy5sYXp5X2NoaWxkcmVuID0ge31cbiAgICB0aGlzLnJvb3QgPSByb290XG4gICAgdGhpcy5wb3B1bGF0ZUNoaWxkcmVuKHJvb3QpXG4gICAgaWYgKCFub2RlLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgdGhpcy5hZGROZXcodGhpcy5yb290LCAwKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbW92ZU5ldygpXG4gICAgfVxuICAgIHRoaXMuc2VsZWN0U29tZXRoaW5nKClcbiAgICByZXR1cm4gcm9vdE5vZGVcbiAgfSxcblxuICBzdGFydE1vdmluZzogZnVuY3Rpb24gKGlkKSB7XG4gICAgdmFyIHRhcmdldHMgPSB0aGlzLnZsLmRyb3BUYXJnZXRzKHRoaXMucm9vdCwgdGhpcy5tb2RlbCwgaWQsIHRydWUpXG4gICAgdGhpcy5kbmQuc3RhcnRNb3ZpbmcodGFyZ2V0cywgaWQpXG4gIH0sXG5cbiAgYWRkTmV3OiBmdW5jdGlvbiAocGlkLCBpbmRleCkge1xuICAgIHRoaXMubmV3Tm9kZSA9IHtcbiAgICAgIHBpZDogcGlkLFxuICAgICAgaW5kZXg6IGluZGV4XG4gICAgfVxuICAgIHZhciBiZWZvcmUgPSB0aGlzLm1vZGVsLmdldEJlZm9yZShwaWQsIGluZGV4LTEpXG4gICAgdGhpcy52bC5hZGROZXcoe1xuICAgICAgaWQ6ICduZXcnLFxuICAgICAgY29udGVudDogJycsXG4gICAgICBtZXRhOiB7fSxcbiAgICAgIHBhcmVudDogcGlkXG4gICAgfSwgdGhpcy5iaW5kQWN0aW9ucygnbmV3JyksIHRoaXMubW9kZWxBY3Rpb25zLCBiZWZvcmUpXG4gIH0sXG5cbiAgcmVtb3ZlTmV3OiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLm5ld05vZGUpIHJldHVybiBmYWxzZVxuICAgIHZhciBudyA9IHRoaXMubmV3Tm9kZVxuICAgICAgLCBsYXN0Y2hpbGQgPSAhdGhpcy5tb2RlbC5pZHNbbncucGlkXS5jaGlsZHJlbi5sZW5ndGhcbiAgICB0aGlzLnZsLnJlbW92ZSgnbmV3JywgbncucGlkLCBsYXN0Y2hpbGQpXG4gICAgdGhpcy5uZXdOb2RlID0gbnVsbFxuICAgIHJldHVybiBud1xuICB9LFxuXG4gIHNlbGVjdFNvbWV0aGluZzogZnVuY3Rpb24gKCkge1xuICAgIHZhciBjaGlsZFxuICAgIGlmICghdGhpcy5tb2RlbC5pZHNbdGhpcy5yb290XS5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgIGNoaWxkID0gJ25ldydcbiAgICB9IGVsc2Uge1xuICAgICAgY2hpbGQgPSB0aGlzLm1vZGVsLmlkc1t0aGlzLnJvb3RdLmNoaWxkcmVuWzBdXG4gICAgfVxuICAgIHRoaXMuZ29UbyhjaGlsZClcbiAgfSxcblxuICBwb3B1bGF0ZUNoaWxkcmVuOiBmdW5jdGlvbiAoaWQsIG5vZGUpIHtcbiAgICBub2RlID0gbm9kZSB8fCB0aGlzLm1vZGVsLmlkc1tpZF1cbiAgICBpZiAoIW5vZGUpIHJldHVyblxuICAgIGlmIChub2RlLmNvbGxhcHNlZCAmJiBpZCAhPT0gdGhpcy5yb290KSB7XG4gICAgICB0aGlzLmxhenlfY2hpbGRyZW5baWRdID0gdHJ1ZVxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIHRoaXMubGF6eV9jaGlsZHJlbltpZF0gPSBmYWxzZVxuICAgIHRoaXMudmwuY2xlYXJDaGlsZHJlbihpZClcbiAgICBpZiAoIW5vZGUuY2hpbGRyZW4gfHwgIW5vZGUuY2hpbGRyZW4ubGVuZ3RoKSByZXR1cm5cbiAgICBmb3IgKHZhciBpPTA7IGk8bm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5hZGQodGhpcy5tb2RlbC5pZHNbbm9kZS5jaGlsZHJlbltpXV0gfHwge2lkOiBub2RlLmNoaWxkcmVuW2ldLCBwYXJlbnQ6IGlkLCBjb250ZW50OiAnJywgY2hpbGRyZW46IFtdfSwgZmFsc2UsIHRydWUpXG4gICAgICB0aGlzLnBvcHVsYXRlQ2hpbGRyZW4obm9kZS5jaGlsZHJlbltpXSlcbiAgICB9XG4gIH0sXG5cbiAgZ29UbzogZnVuY3Rpb24gKGlkKSB7XG4gICAgaWYgKHRoaXMubW9kZSA9PT0gJ2luc2VydCcpIHtcbiAgICAgIHRoaXMuc3RhcnRFZGl0aW5nKGlkKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldEFjdGl2ZShpZClcbiAgICB9XG4gIH0sXG5cbiAgZXh0cmFfYWN0aW9uczoge30sXG5cbiAga2V5SGFuZGxlcjogZnVuY3Rpb24gKCkge1xuICAgIHZhciBub3JtYWwgPSBrZXlIYW5kbGVyKFxuICAgICAgZGVmYXVsdEtleXMudmlldy5iYXNlLFxuICAgICAgbm9ybWFsQWN0aW9ucyxcbiAgICAgIHRoaXMuY3RybGFjdGlvbnNcbiAgICApXG5cbiAgICBpZiAodGhpcy5leHRyYV9hY3Rpb25zKSB7XG4gICAgICBmb3IgKHZhciBhY3Rpb24gaW4gdGhpcy5leHRyYV9hY3Rpb25zKSB7XG4gICAgICAgIG5vcm1hbFt0aGlzLmV4dHJhX2FjdGlvbnNbYWN0aW9uXS5iaW5kaW5nXSA9IHRoaXMuZXh0cmFfYWN0aW9uc1thY3Rpb25dLmFjdGlvblxuICAgICAgfVxuICAgIH1cblxuICAgIHZhciB2aXN1YWwgPSBrZXlIYW5kbGVyKGRlZmF1bHRLZXlzLnZpc3VhbCwgdmlzdWFsQWN0aW9ucywgdGhpcy5jdHJsYWN0aW9ucylcbiAgICB2YXIgaGFuZGxlcnMgPSB7XG4gICAgICAnaW5zZXJ0JzogZnVuY3Rpb24gKCkge30sXG4gICAgICAnbm9ybWFsJzoga2V5cyhub3JtYWwpLFxuICAgICAgJ3Zpc3VhbCc6IGtleXModmlzdWFsKSxcbiAgICB9XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGhhbmRsZXJzW3RoaXMubW9kZV0uYXBwbHkodGhpcywgYXJndW1lbnRzKVxuICAgIH0uYmluZCh0aGlzKVxuICB9LFxuXG4gIGF0dGFjaExpc3RlbmVyczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBrZXlkb3duID0gdGhpcy5rZXlIYW5kbGVyKClcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQubm9kZU5hbWUgPT09ICdJTlBVVCcpIHJldHVyblxuICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ2luc2VydCcpIHJldHVyblxuICAgICAga2V5ZG93bi5jYWxsKHRoaXMsIGUpXG4gICAgfS5iaW5kKHRoaXMpKVxuICB9LFxuXG4gIGFkZFRyZWU6IGZ1bmN0aW9uIChub2RlLCBiZWZvcmUpIHtcbiAgICBpZiAoIXRoaXMudmwuYm9keShub2RlLnBhcmVudCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlYmFzZShub2RlLnBhcmVudCwgdHJ1ZSlcbiAgICB9XG4gICAgdGhpcy5yZW1vdmVOZXcoKVxuICAgIHRoaXMuYWRkKG5vZGUsIGJlZm9yZSlcbiAgICBpZiAoIW5vZGUuY2hpbGRyZW4gfHwgIW5vZGUuY2hpbGRyZW4ubGVuZ3RoKSByZXR1cm5cbiAgICBmb3IgKHZhciBpPTA7IGk8bm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5hZGRUcmVlKHRoaXMubW9kZWwuaWRzW25vZGUuY2hpbGRyZW5baV1dLCBmYWxzZSlcbiAgICB9XG4gIH0sXG5cbiAgLy8gb3BlcmF0aW9uc1xuICBhZGQ6IGZ1bmN0aW9uIChub2RlLCBiZWZvcmUsIGRvbnRmb2N1cykge1xuICAgIHZhciBlZCA9IHRoaXMubW9kZSA9PT0gJ2luc2VydCdcbiAgICAgICwgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuICYmICEhbm9kZS5jaGlsZHJlbi5sZW5ndGhcbiAgICBpZiAoIXRoaXMudmwuYm9keShub2RlLnBhcmVudCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlYmFzZShub2RlLnBhcmVudCwgdHJ1ZSlcbiAgICB9XG4gICAgdGhpcy52bC5hZGROZXcobm9kZSwgdGhpcy5iaW5kQWN0aW9ucyhub2RlLmlkKSwgdGhpcy5tb2RlbEFjdGlvbnMsIGJlZm9yZSwgY2hpbGRyZW4pXG4gICAgaWYgKCFkb250Zm9jdXMpIHtcbiAgICAgIGlmIChlZCkge1xuICAgICAgICB0aGlzLnZsLmJvZHkobm9kZS5pZCkuc3RhcnRFZGl0aW5nKClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlKG5vZGUuaWQpXG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKGlkLCBub2RlKSB7XG4gICAgdmFyIG9sZCA9IHRoaXMubW9kZWwuaWRzW2lkXSB8fCB7fVxuICAgIGNvbnNvbGUubG9nKCd1cGRhdGUhJywgaWQsIG5vZGUsIG9sZClcbiAgICB2YXIgYm9keSA9IHRoaXMudmwuYm9keShpZClcbiAgICBpZiAoIWJvZHkpIHJldHVybiBjb25zb2xlLndhcm4oJ25vIGJvZHkgZm9yIHVwZGF0ZScpXG4gICAgaWYgKG5vZGUuY29udGVudCAhPT0gb2xkLmNvbnRlbnQpIHtcbiAgICAgIGJvZHkuc2V0Q29udGVudChub2RlLmNvbnRlbnQpXG4gICAgfVxuICAgIGlmICghZXFsaXN0KG5vZGUuY2hpbGRyZW4sIG9sZC5jaGlsZHJlbikpIHtcbiAgICAgIHRoaXMucG9wdWxhdGVDaGlsZHJlbihpZCwgbm9kZSlcbiAgICAgIC8vIFRPRE8gaGFuZGxlIHJlbW90ZSBkZWxldGlvbiBvZiB0aGUgYWN0aXZlIG5vZGUuXG4gICAgfVxuICAgIGJvZHkuc2V0TWV0YShub2RlLm1ldGEgfHwge30pXG4gICAgLy8gdGhpcyBjb3VsZCBnZXQgYW5ub3lpbmdcbiAgICBpZiAobm9kZS5jb2xsYXBzZWQgIT09IG9sZC5jb2xsYXBzZWQpIHtcbiAgICAgIHRoaXMuc2V0Q29sbGFwc2VkKGlkLCBub2RlLmNvbGxhcHNlZClcbiAgICB9XG4gIH0sXG5cbiAgcmVtb3ZlOiBmdW5jdGlvbiAoaWQsIGlnbm9yZUFjdGl2ZSkge1xuICAgIHZhciBwaWQgPSB0aGlzLm1vZGVsLmlkc1tpZF0ucGFyZW50XG4gICAgICAsIHBhcmVudCA9IHRoaXMubW9kZWwuaWRzW3BpZF1cbiAgICBpZiAoIXRoaXMudmwuYm9keShpZCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlYmFzZShwaWQsIHRydWUpXG4gICAgfVxuICAgIGlmIChpZCA9PT0gdGhpcy5hY3RpdmUgJiYgIWlnbm9yZUFjdGl2ZSkge1xuICAgICAgdGhpcy5zZXRBY3RpdmUodGhpcy5yb290KVxuICAgIH1cbiAgICB0aGlzLnZsLnJlbW92ZShpZCwgcGlkLCBwYXJlbnQgJiYgcGFyZW50LmNoaWxkcmVuLmxlbmd0aCA9PT0gMSlcbiAgICBpZiAocGFyZW50LmNoaWxkcmVuLmxlbmd0aCA9PT0gMSkge1xuICAgICAgaWYgKHBpZCA9PT0gdGhpcy5yb290KSB7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmFkZE5ldyhwaWQsIDApXG4gICAgICAgIH0uYmluZCh0aGlzKSwwKVxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBzZXRDb250ZW50OiBmdW5jdGlvbiAoaWQsIGNvbnRlbnQpIHtcbiAgICBpZiAoIXRoaXMudmwuYm9keShpZCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlYmFzZShpZCwgdHJ1ZSlcbiAgICB9XG4gICAgdGhpcy52bC5ib2R5KGlkKS5zZXRDb250ZW50KGNvbnRlbnQpXG4gICAgaWYgKHRoaXMubW9kZSA9PT0gJ2luc2VydCcpIHtcbiAgICAgIHRoaXMudmwuYm9keShpZCkuc3RhcnRFZGl0aW5nKClcbiAgICB9XG4gIH0sXG5cbiAgc2V0QXR0cjogZnVuY3Rpb24gKGlkLCBhdHRyLCB2YWx1ZSwgcXVpZXQpIHtcbiAgICBpZiAoIXRoaXMudmwuYm9keShpZCkpIHtcbiAgICAgIGlmIChxdWlldCkgcmV0dXJuXG4gICAgICByZXR1cm4gdGhpcy5yZWJhc2UoaWQsIHRydWUpXG4gICAgfVxuICAgIHRoaXMudmwuYm9keShpZCkuc2V0QXR0cihhdHRyLCB2YWx1ZSlcbiAgICBpZiAodGhpcy5tb2RlID09PSAnaW5zZXJ0JyAmJiAhcXVpZXQpIHtcbiAgICAgIHRoaXMudmwuYm9keShpZCkuc3RhcnRFZGl0aW5nKClcbiAgICB9XG4gIH0sXG5cbiAgcmVwbGFjZU1ldGE6IGZ1bmN0aW9uIChpZCwgbWV0YSkge1xuICAgIHRoaXMudmwuYm9keShpZCkucmVwbGFjZU1ldGEobWV0YSlcbiAgICBpZiAodGhpcy5tb2RlID09PSAnaW5zZXJ0Jykge1xuICAgICAgdGhpcy52bC5ib2R5KGlkKS5zdGFydEVkaXRpbmcoKVxuICAgIH1cbiAgfSxcblxuICBhcHBlbmRUZXh0OiBmdW5jdGlvbiAoaWQsIHRleHQpIHtcbiAgICB0aGlzLnZsLmJvZHkoaWQpLmFkZEVkaXRUZXh0KHRleHQpXG4gIH0sXG5cbiAgbW92ZTogZnVuY3Rpb24gKGlkLCBwaWQsIGJlZm9yZSwgcHBpZCwgbGFzdGNoaWxkKSB7XG4gICAgaWYgKCF0aGlzLnZsLmJvZHkoaWQpKSB7XG4gICAgICByZXR1cm4gdGhpcy5yZWJhc2UodGhpcy5tb2RlbC5jb21tb25QYXJlbnQocGlkLCBwcGlkKSwgdHJ1ZSlcbiAgICB9XG4gICAgdmFyIGVkID0gdGhpcy5tb2RlID09PSAnaW5zZXJ0J1xuICAgIHRoaXMudmwubW92ZShpZCwgcGlkLCBiZWZvcmUsIHBwaWQsIGxhc3RjaGlsZClcbiAgICBpZiAoZWQpIHRoaXMuc3RhcnRFZGl0aW5nKGlkKVxuICB9LFxuXG4gIHN0YXJ0RWRpdGluZzogZnVuY3Rpb24gKGlkLCBmcm9tU3RhcnQpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgaWQgPSB0aGlzLmFjdGl2ZSAhPT0gbnVsbCA/IHRoaXMuYWN0aXZlIDogdGhpcy5yb290XG4gICAgfVxuICAgIGlmIChpZCA9PT0gdGhpcy5yb290ICYmIHRoaXMuby5ub1NlbGVjdFJvb3QpIHtcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICB2YXIgYm9keSA9IHRoaXMudmwuYm9keShpZClcbiAgICBpZiAoIWJvZHkpIHJldHVyblxuICAgIGJvZHkuc3RhcnRFZGl0aW5nKGZyb21TdGFydClcbiAgfSxcblxuICBzdG9wRWRpdGluZzogZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLm1vZGUgIT09ICdpbnNlcnQnKSByZXR1cm5cbiAgICBpZiAodGhpcy5hY3RpdmUgPT09IG51bGwpIHJldHVyblxuICAgIHRoaXMudmwuYm9keSh0aGlzLmFjdGl2ZSkuc3RvcEVkaXRpbmcoKVxuICB9LFxuXG4gIHNldEVkaXRpbmc6IGZ1bmN0aW9uIChpZCkge1xuICAgIGlmICh0aGlzLm1vZGUgPT09ICd2aXN1YWwnKSB7XG4gICAgICB0aGlzLnN0b3BTZWxlY3RpbmcoKVxuICAgIH1cbiAgICB0aGlzLm1vZGUgPSAnaW5zZXJ0J1xuICAgIHRoaXMuc2V0QWN0aXZlKGlkKVxuICB9LFxuXG4gIGRvbmVFZGl0aW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RlID0gJ25vcm1hbCdcbiAgfSxcblxuICBzZXRBY3RpdmU6IGZ1bmN0aW9uIChpZCkge1xuICAgIGlmIChpZCA9PT0gdGhpcy5hY3RpdmUpIHJldHVybiB0aGlzLnZsLnNob3dBY3RpdmUoaWQpXG4gICAgaWYgKHRoaXMuYWN0aXZlICE9PSBudWxsKSB7XG4gICAgICB0aGlzLnZsLmNsZWFyQWN0aXZlKHRoaXMuYWN0aXZlKVxuICAgIH1cbiAgICBpZiAoIXRoaXMudmwuZG9tW2lkXSkge1xuICAgICAgaWQgPSB0aGlzLnJvb3RcbiAgICB9XG4gICAgdGhpcy5hY3RpdmUgPSBpZFxuICAgIHRoaXMudmwuc2hvd0FjdGl2ZShpZClcbiAgfSxcblxuICBnZXRBY3RpdmU6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIXRoaXMudmwuZG9tW3RoaXMuYWN0aXZlXSkge1xuICAgICAgcmV0dXJuIHRoaXMucm9vdFxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5hY3RpdmVcbiAgfSxcblxuICBhZGRUb1NlbGVjdGlvbjogZnVuY3Rpb24gKGlkLCBpbnZlcnQpIHtcbiAgICB2YXIgaXggPSB0aGlzLnNlbGVjdGlvbi5pbmRleE9mKGlkKVxuICAgIGlmIChpeCA9PT0gLTEpIHtcbiAgICAgIHRoaXMuc2VsZWN0aW9uLnB1c2goaWQpXG4gICAgICB0aGlzLnZsLnNob3dTZWxlY3Rpb24oW2lkXSlcbiAgICAgIHRoaXMuc2VsX2ludmVydGVkID0gaW52ZXJ0XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmwuY2xlYXJTZWxlY3Rpb24odGhpcy5zZWxlY3Rpb24uc2xpY2UoaXggKyAxKSlcbiAgICAgIHRoaXMuc2VsZWN0aW9uID0gdGhpcy5zZWxlY3Rpb24uc2xpY2UoMCwgaXggKyAxKVxuICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICB0aGlzLnNlbF9pbnZlcnRlZCA9IGZhbHNlXG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuc2V0QWN0aXZlKGlkKVxuICAgIGNvbnNvbGUubG9nKHRoaXMuc2VsX2ludmVydGVkKVxuICB9LFxuXG4gIHNldFNlbGVjdGlvbjogZnVuY3Rpb24gKHNlbCkge1xuICAgIHRoaXMubW9kZSA9ICd2aXN1YWwnXG4gICAgdGhpcy5zZWxfaW52ZXJ0ZWQgPSBmYWxzZVxuICAgIGlmICh0aGlzLnNlbGVjdGlvbikge1xuICAgICAgdGhpcy52bC5jbGVhclNlbGVjdGlvbih0aGlzLnNlbGVjdGlvbilcbiAgICB9XG4gICAgdGhpcy5zZWxlY3Rpb24gPSBzZWxcbiAgICB0aGlzLnZsLnNob3dTZWxlY3Rpb24oc2VsKVxuICB9LFxuXG4gIHN0b3BTZWxlY3Rpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5zZWxlY3Rpb24gIT09IG51bGwpIHtcbiAgICAgIHRoaXMudmwuY2xlYXJTZWxlY3Rpb24odGhpcy5zZWxlY3Rpb24pXG4gICAgICB0aGlzLnNlbGVjdGlvbiA9IG51bGxcbiAgICB9XG4gICAgdGhpcy5tb2RlID0gJ25vcm1hbCdcbiAgfSxcblxuICBzZXRDb2xsYXBzZWQ6IGZ1bmN0aW9uIChpZCwgd2hhdCkge1xuICAgIC8qXG4gICAgaWYgKCF0aGlzLnZsLmJvZHkoaWQpKSB7XG4gICAgICByZXR1cm4gdGhpcy5yZWJhc2UodGhpcy5tb2RlbC5pZHNbaWRdLnBhcmVudClcbiAgICB9XG4gICAgKi9cbiAgICBpZiAod2hhdCkge1xuICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ2luc2VydCcpIHtcbiAgICAgICAgdGhpcy5zdGFydEVkaXRpbmcoaWQpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldEFjdGl2ZShpZClcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm8uYW5pbWF0ZSkge1xuICAgICAgICB0aGlzLnZsLmFuaW1hdGVDbG9zZWQoaWQpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnZsLnNldENvbGxhcHNlZChpZCwgdHJ1ZSlcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMubGF6eV9jaGlsZHJlbltpZF0pIHtcbiAgICAgICAgdGhpcy5wb3B1bGF0ZUNoaWxkcmVuKGlkKVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuby5hbmltYXRlKSB7XG4gICAgICAgIHRoaXMudmwuYW5pbWF0ZU9wZW4oaWQpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnZsLnNldENvbGxhcHNlZChpZCwgZmFsc2UpXG4gICAgICB9XG4gICAgfVxuICAgIC8vIFRPRE86IGV2ZW50IGxpc3RlbmVycz9cbiAgfSxcblxuICAvLyBub24tbW9kaWZ5aW5nIHN0dWZmXG4gIGdvVXA6IGZ1bmN0aW9uIChpZCkge1xuICAgIC8vIHNob3VsZCBJIGNoZWNrIHRvIHNlZSBpZiBpdCdzIG9rP1xuICAgIHZhciBhYm92ZSA9IHRoaXMubW9kZWwuaWRBYm92ZShpZClcbiAgICBpZiAoYWJvdmUgPT09IGZhbHNlKSByZXR1cm5cbiAgICBpZiAoYWJvdmUgPT09IHRoaXMucm9vdCAmJiB0aGlzLm8ubm9TZWxlY3RSb290KSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgdGhpcy52bC5ib2R5KGFib3ZlKS5ib2R5LnN0YXJ0RWRpdGluZygpO1xuICB9LFxuXG4gIGdvRG93bjogZnVuY3Rpb24gKGlkLCBmcm9tU3RhcnQpIHtcbiAgICB2YXIgYmVsb3cgPSB0aGlzLm1vZGVsLmlkQmVsb3coaWQsIHRoaXMucm9vdClcbiAgICBpZiAoYmVsb3cgPT09IGZhbHNlKSByZXR1cm5cbiAgICB0aGlzLnZsLmJvZHkoYmVsb3cpLmJvZHkuc3RhcnRFZGl0aW5nKGZyb21TdGFydClcbiAgfSxcbn1cblxuIiwiXG5mdW5jdGlvbiByZXZlcnNlZChpdGVtcykge1xuICB2YXIgbncgPSBbXVxuICBmb3IgKHZhciBpPWl0ZW1zLmxlbmd0aDsgaT4wOyBpLS0pIHtcbiAgICBudy5wdXNoKGl0ZW1zW2kgLSAxXSlcbiAgfVxuICByZXR1cm4gbndcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIC8vIG1vdmVtZW50XG4gICdzZWxlY3QgdXAnOiB7XG4gICAgaGVscDogJ21vdmUgdGhlIGN1cnNvciB1cCcsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcHJldiA9IHRoaXMubW9kZWwucHJldlNpYmxpbmcodGhpcy5hY3RpdmUsIHRydWUpXG4gICAgICBpZiAoIXByZXYpIHJldHVyblxuICAgICAgdGhpcy5hZGRUb1NlbGVjdGlvbihwcmV2LCB0cnVlKVxuICAgIH0sXG4gIH0sXG5cbiAgJ3NlbGVjdCBkb3duJzoge1xuICAgIGhlbHA6ICdtb3ZlIHRoZSBjdXJzb3IgZG93bicsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbmV4dCA9IHRoaXMubW9kZWwubmV4dFNpYmxpbmcodGhpcy5hY3RpdmUsIHRydWUpXG4gICAgICBpZiAoIW5leHQpIHJldHVyblxuICAgICAgdGhpcy5hZGRUb1NlbGVjdGlvbihuZXh0LCBmYWxzZSlcbiAgICB9LFxuICB9LFxuXG4gICdzZWxlY3QgdG8gYm90dG9tJzoge1xuICAgIGhlbHA6ICdtb3ZlIHRoZSBjdXJzb3IgdG8gdGhlIGJvdHRvbScsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbiA9IHRoaXMubW9kZWwuaWRzW3RoaXMuc2VsZWN0aW9uWzBdXVxuICAgICAgICAsIGNoID0gdGhpcy5tb2RlbC5pZHNbbi5wYXJlbnRdLmNoaWxkcmVuXG4gICAgICAgICwgaXggPSBjaC5pbmRleE9mKHRoaXMuc2VsZWN0aW9uWzBdKVxuICAgICAgdGhpcy5zZXRTZWxlY3Rpb24oY2guc2xpY2UoaXgpKVxuICAgICAgdGhpcy5zZWxfaW52ZXJ0ZWQgPSBmYWxzZVxuICAgICAgdGhpcy5zZXRBY3RpdmUoY2hbY2gubGVuZ3RoLTFdKVxuICAgIH0sXG4gIH0sXG5cbiAgJ3NlbGVjdCB0byB0b3AnOiB7XG4gICAgaGVscDogJ21vdmUgdGhlIGN1cnNvciB0byB0aGUgdG9wJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBuID0gdGhpcy5tb2RlbC5pZHNbdGhpcy5zZWxlY3Rpb25bMF1dXG4gICAgICAgICwgY2ggPSB0aGlzLm1vZGVsLmlkc1tuLnBhcmVudF0uY2hpbGRyZW5cbiAgICAgICAgLCBpeCA9IGNoLmluZGV4T2YodGhpcy5zZWxlY3Rpb25bMF0pXG4gICAgICAgICwgaXRlbXMgPSBbXVxuICAgICAgZm9yICh2YXIgaT0wOyBpPD1peDsgaSsrKSB7XG4gICAgICAgIGl0ZW1zLnVuc2hpZnQoY2hbaV0pXG4gICAgICB9XG4gICAgICB0aGlzLnNldFNlbGVjdGlvbihpdGVtcylcbiAgICAgIHRoaXMuc2VsX2ludmVydGVkID0gaXRlbXMubGVuZ3RoID4gMVxuICAgICAgdGhpcy5zZXRBY3RpdmUoY2hbMF0pXG4gICAgfSxcbiAgfSxcblxuICAnc3RvcCBzZWxlY3RpbmcnOiB7XG4gICAgaGVscDogJ3F1aXQgc2VsZWN0aW9uIG1vZGUnLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5zdG9wU2VsZWN0aW5nKClcbiAgICB9LFxuICB9LFxuXG4gICdlZGl0Jzoge1xuICAgIGhlbHA6ICdzdGFydCBlZGl0aW5nIHRoZSBhY3RpdmUgbm9kZScsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnN0YXJ0RWRpdGluZyh0aGlzLmFjdGl2ZSlcbiAgICB9LFxuICB9LFxuXG4gICdlZGl0IHN0YXJ0Jzoge1xuICAgIGhlbHA6ICdlZGl0IGF0IHRoZSBzdGFydCBvZiB0aGUgbm9kZScsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnN0YXJ0RWRpdGluZyh0aGlzLmFjdGl2ZSwgdHJ1ZSlcbiAgICB9LFxuICB9LFxuXG4gICAgLy8gZWRpdG5lc3NcbiAgJ2N1dCc6IHtcbiAgICBoZWxwOiAnY3V0IHRoZSBjdXJyZW50IHNlbGVjdGlvbicsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgaXRlbXMgPSB0aGlzLnNlbGVjdGlvbi5zbGljZSgpXG4gICAgICBpZiAodGhpcy5zZWxfaW52ZXJ0ZWQpIHtcbiAgICAgICAgaXRlbXMgPSByZXZlcnNlZChpdGVtcylcbiAgICAgIH1cbiAgICAgIHRoaXMuY3RybGFjdGlvbnMuY3V0KGl0ZW1zKVxuICAgICAgdGhpcy5zdG9wU2VsZWN0aW5nKClcbiAgICB9LFxuICB9LFxuXG4gICdjb3B5Jzoge1xuICAgIGhlbHA6ICdjb3B5IHRoZSBjdXJyZW50IHNlbGVjdGlvbicsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgaXRlbXMgPSB0aGlzLnNlbGVjdGlvbi5zbGljZSgpXG4gICAgICBpZiAodGhpcy5zZWxfaW52ZXJ0ZWQpIHtcbiAgICAgICAgaXRlbXMgPSByZXZlcnNlZChpdGVtcylcbiAgICAgIH1cbiAgICAgIHRoaXMuY3RybGFjdGlvbnMuY29weShpdGVtcylcbiAgICAgIHRoaXMuc3RvcFNlbGVjdGluZygpXG4gICAgfSxcbiAgfSxcblxuICAndW5kbyc6IHtcbiAgICBoZWxwOiAndW5kbyB0aGUgbGFzdCBjaGFuZ2UnLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5zdG9wU2VsZWN0aW5nKClcbiAgICAgIHRoaXMuY3RybGFjdGlvbnMudW5kbygpXG4gICAgfSxcbiAgfSxcblxuICAncmVkbyc6IHtcbiAgICBoZWxwOiAncmVkbyB0aGUgbGFzdCB1bmRvJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuc3RvcFNlbGVjdGluZygpXG4gICAgICB0aGlzLmN0cmxhY3Rpb25zLnJlZG8oKVxuICAgIH0sXG4gIH0sXG59XG5cbiIsIlxubW9kdWxlLmV4cG9ydHMgPSBCbG9ja1xuXG5mdW5jdGlvbiB1bkVzY2FwZUh0bWwoc3RyKSB7XG4gIGlmICghc3RyKSByZXR1cm4gJyc7XG4gIHJldHVybiBzdHJcbiAgICAucmVwbGFjZSgvPGRpdj4vZywgJ1xcbicpLnJlcGxhY2UoLzxicj4vZywgJ1xcbicpXG4gICAgLnJlcGxhY2UoLzxcXC9kaXY+L2csICcnKVxuICAgIC5yZXBsYWNlKC9cXHUyMDBiL2csICcnKVxufVxuXG4vKipcbiAqIENvbmZpZyBsb29rcyBsaWtlOlxuICoge1xuICogICB0b3A6IG51bSxcbiAqICAgbGVmdDogbnVtLCAoZnJvbSBtZXRhLndoaXRlYm9hcmQpXG4gKiAgfVxuICogT3B0aW9ucyBsb29rcyBsaWtlOlxuICoge1xuICogIHNhdmVDb25maWdcbiAqICBzYXZlQ29udGVudFxuICogIGNoYW5nZUNvbnRlbnRcbiAqICBzdGFydE1vdmluZyhldmVudCwgcmVjdCwgP3NoaWZ0TW92ZSlcbiAqICBzdGFydE1vdmluZ0NoaWxkKGV2ZW50LCBpZCwgP3NoaWZ0TW92ZSlcbiAqICBvblpvb21cbiAqIH1cbiAqL1xuZnVuY3Rpb24gQmxvY2soZGF0YSwgY2hpbGRyZW4sIGNvbmZpZywgb3B0aW9ucykge1xuICB0aGlzLm8gPSBvcHRpb25zXG4gIHRoaXMuZWRpdGluZyA9IGZhbHNlXG4gIHRoaXMuX21vdmVkID0gZmFsc2VcbiAgdGhpcy5zZXR1cE5vZGUoZGF0YSwgY2hpbGRyZW4pXG4gIHRoaXMucmVwb3NpdGlvbihjb25maWcubGVmdCwgY29uZmlnLnRvcCwgdHJ1ZSlcbiAgLy8gdGhpcy5yZXNpemUoY29uZmlnLndpZHRoLCBjb25maWcuaGVpZ2h0LCB0cnVlKVxufVxuXG5CbG9jay5wcm90b3R5cGUgPSB7XG4gIHNldHVwTm9kZTogZnVuY3Rpb24gKGRhdGEsIGNoaWxkcmVuKSB7XG4gICAgdGhpcy5ub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLm5vZGUuY2xhc3NOYW1lID0gJ3doaXRlYm9hcmQtaXRlbSdcbiAgICAvLyB0aGlzLm5vZGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fb25Nb3VzZURvd24uYmluZCh0aGlzKSlcbiAgICB0aGlzLm5vZGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuX29uTW91c2VVcC5iaW5kKHRoaXMpKVxuICAgIHRoaXMubm9kZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9vbk1vdXNlTW92ZS5iaW5kKHRoaXMpKVxuICAgIHRoaXMubm9kZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLl9vbk1vdXNlRG93bi5iaW5kKHRoaXMpKVxuXG4gICAgdGhpcy50aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy50aXRsZS5jbGFzc05hbWU9J3doaXRlYm9hcmQtaXRlbV90aXRsZSdcbiAgICAvLyB0aGlzLnRpdGxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fb25DbGljay5iaW5kKHRoaXMpKVxuICAgIHRoaXMudGl0bGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9vbkNsaWNrLmJpbmQodGhpcykpXG4gICAgdGhpcy50aXRsZS5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsIHRoaXMuby5vblpvb20pXG5cbiAgICB0aGlzLmlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLmlucHV0LnNldEF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJywgdHJ1ZSlcbiAgICB0aGlzLmlucHV0LmNsYXNzTmFtZSA9ICd3aGl0ZWJvYXJkLWl0ZW1faW5wdXQnXG4gICAgdGhpcy5pbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5fb25CbHVyLmJpbmQodGhpcykpXG5cbiAgICB0aGlzLmJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpXG4gICAgdGhpcy5ib2R5LmNsYXNzTmFtZT0nd2hpdGVib2FyZC1pdGVtX2JvZHknXG5cbiAgICB2YXIgem9vbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgem9vbS5jbGFzc05hbWUgPSAnd2hpdGVib2FyZC1pdGVtX3pvb20nXG4gICAgem9vbS5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJmYSBmYS1leHBhbmRcIi8+J1xuICAgIHpvb20uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm8ub25ab29tKVxuXG4gICAgdGhpcy5jaGlsZHJlbiA9IHt9XG5cbiAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkge1xuICAgICAgdmFyIG5vZGUgPSB0aGlzLmNyZWF0ZUNoaWxkKGNoaWxkKVxuICAgICAgLy8gbm9kZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLl9vbk1vdXNlRG93bkNoaWxkLmJpbmQodGhpcywgY2hpbGQuaWQpKVxuICAgICAgdGhpcy5ib2R5LmFwcGVuZENoaWxkKG5vZGUpXG4gICAgICB0aGlzLmNoaWxkcmVuW2NoaWxkLmlkXSA9IG5vZGVcbiAgICB9LmJpbmQodGhpcykpXG5cbiAgICAvKlxuICAgIHRoaXMuZm9vdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLmZvb3Rlci5jbGFzc05hbWUgPSAnd2hpdGVib2FyZC1pdGVtX2Zvb3RlcidcbiAgICB2YXIgem9vbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKVxuICAgIHpvb20uY2xhc3NOYW1lID0gJ2ZhIGZhLWV4cGFuZCB6b29tJ1xuICAgIHpvb20uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm8ub25ab29tKVxuICAgIHRoaXMuZm9vdGVyLmFwcGVuZENoaWxkKHpvb20pXG4gICAgKi9cblxuICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZCh0aGlzLnRpdGxlKVxuICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZCh0aGlzLmJvZHkpXG4gICAgdGhpcy5ub2RlLmFwcGVuZENoaWxkKHpvb20pXG4gICAgLy8gdGhpcy5ub2RlLmFwcGVuZENoaWxkKHRoaXMuZm9vdGVyKVxuXG4gICAgdGhpcy5zZXRUZXh0Q29udGVudChkYXRhLmNvbnRlbnQpXG4gICAgdGhpcy5jb250ZW50ID0gZGF0YS5jb250ZW50XG4gICAgcmV0dXJuIHRoaXMubm9kZVxuICB9LFxuXG4gIHJlbW92ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubm9kZSlcbiAgICByZXR1cm4gdHJ1ZVxuICB9LFxuXG4gIC8qKlxuICAgKiBwaWQ6IHRoZSBpZCBvZiB0aGlzIGJsb2NrXG4gICAqIGNpZDogdGhlIGNoaWxkIHRoYXQgaXMgYmVpbmcgbW92ZWRcbiAgICogY2hpbGRyZW46IGxpc3Qgb2YgY2hpbGQgaWRzXG4gICAqL1xuICBnZXRDaGlsZFRhcmdldHM6IGZ1bmN0aW9uIChjaWQsIGJpZCwgY2hpbGRyZW4pIHtcbiAgICB2YXIgdGFyZ2V0cyA9IGNoaWxkcmVuID8gY2hpbGRyZW4ubWFwKHRoaXMuY2hpbGRUYXJnZXQuYmluZCh0aGlzLCBiaWQpKSA6IFtdXG4gICAgdGFyZ2V0cy5wdXNoKHRoaXMud2hvbGVUYXJnZXQoYmlkLCBjaGlsZHJlbi5sZW5ndGgpKVxuICAgIHJldHVybiB0YXJnZXRzXG4gIH0sXG5cbiAgY2hpbGRUYXJnZXQ6IGZ1bmN0aW9uIChwaWQsIGlkLCBpKSB7XG4gICAgdmFyIGJveCA9IHRoaXMuY2hpbGRyZW5baWRdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICAsIG1hZ2ljID0gMTBcbiAgICByZXR1cm4ge1xuICAgICAgaGl0OiB7XG4gICAgICAgIGxlZnQ6IGJveC5sZWZ0LFxuICAgICAgICByaWdodDogYm94LnJpZ2h0LFxuICAgICAgICB0b3A6IGJveC50b3AgLSBtYWdpYyxcbiAgICAgICAgYm90dG9tOiBib3guYm90dG9tIC0gbWFnaWNcbiAgICAgIH0sXG4gICAgICBwb3M6IGksXG4gICAgICBwaWQ6IHBpZCxcbiAgICAgIGRyYXc6IHtcbiAgICAgICAgbGVmdDogYm94LmxlZnQsXG4gICAgICAgIHdpZHRoOiBib3gud2lkdGgsXG4gICAgICAgIHRvcDogYm94LnRvcCAtIG1hZ2ljLzIsXG4gICAgICAgIGhlaWdodDogbWFnaWNcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIGlkOiB0aGUgYm94IGlkXG4gICAqIGxhc3Q6IHRoZSBsYXN0IGluZGV4IGluIHRoZSBjaGlsZCBsaXN0XG4gICAqL1xuICB3aG9sZVRhcmdldDogZnVuY3Rpb24gKGlkLCBsYXN0KSB7XG4gICAgdmFyIGJveCA9IHRoaXMubm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgICAgLCBtYWdpYyA9IDEwXG4gICAgcmV0dXJuIHtcbiAgICAgIGhpdDogYm94LFxuICAgICAgcGlkOiBpZCxcbiAgICAgIHBvczogbGFzdCxcbiAgICAgIGRyYXc6IHtcbiAgICAgICAgdG9wOiBib3guYm90dG9tIC0gbWFnaWMsXG4gICAgICAgIGxlZnQ6IGJveC5sZWZ0ICsgbWFnaWMvMixcbiAgICAgICAgaGVpZ2h0OiBtYWdpYyxcbiAgICAgICAgd2lkdGg6IGJveC53aWR0aCAtIG1hZ2ljXG4gICAgICB9XG4gICAgfVxuICB9LFxuXG5cbiAgLy8gQ2hpbGRyZW4hIVxuXG5cbiAgLy8gTm90IGNoaWxkcmVuISFcblxuICB1cGRhdGVDb25maWc6IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICB0aGlzLnJlcG9zaXRpb24oY29uZmlnLmxlZnQsIGNvbmZpZy50b3AsIHRydWUpXG4gICAgLy8gdGhpcy5yZXNpemUoY29uZmlnLndpZHRoLCBjb25maWcuaGVpZ2h0LCB0cnVlKVxuICB9LFxuXG4gIHNldENvbnRlbnQ6IGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgaWYgKGNvbnRlbnQgPT09IHRoaXMuY29udGVudCkgcmV0dXJuXG4gICAgdGhpcy5zZXRUZXh0Q29udGVudChjb250ZW50KVxuICAgIHRoaXMuc2V0SW5wdXRWYWx1ZShjb250ZW50KVxuICB9LFxuXG4gIF9vbkJsdXI6IGZ1bmN0aW9uIChlKSB7XG4gICAgdGhpcy5zdG9wRWRpdGluZygpXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgcmV0dXJuIGZhbHNlXG4gIH0sXG5cbiAgX29uTW91c2VNb3ZlOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2hhbmRsZScpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgaWYgKCFlLnNoaWZ0S2V5KSByZXR1cm5cbiAgICB2YXIgcmVjdCA9IHRoaXMubm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgIGlmICh0aGlzLm8uc3RhcnRNb3ZpbmcoZSwgcmVjdCwgdHJ1ZSkpIHtcbiAgICAgIHRoaXMubm9kZS5jbGFzc0xpc3QuYWRkKCd3aGl0ZWJvYXJkLWl0ZW0tLW1vdmluZycpXG4gICAgfVxuICB9LFxuXG4gIF9vbk1vdXNlVXA6IGZ1bmN0aW9uIChlKSB7XG4gIH0sXG5cbiAgX29uQ2xpY2s6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKHRoaXMuX21vdmVkKSB7XG4gICAgICB0aGlzLl9tb3ZlZCA9IGZhbHNlXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgdGhpcy5zdGFydEVkaXRpbmcoKVxuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIHJldHVybiBmYWxzZVxuICB9LFxuXG4gIF9vbk1vdXNlTW92ZUNoaWxkOiBmdW5jdGlvbiAoaWQsIGUpIHtcbiAgICBpZiAoIWUuc2hpZnRLZXkpIHJldHVyblxuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIHZhciBjbG9uZSA9IHRoaXMuY2hpbGRyZW5baWRdLmxhc3RDaGlsZC5jbG9uZU5vZGUodHJ1ZSlcbiAgICBpZiAodGhpcy5vLnN0YXJ0TW92aW5nQ2hpbGQoZSwgaWQsIGNsb25lLCB0cnVlKSkge1xuICAgICAgdGhpcy5jaGlsZHJlbltpZF0uY2xhc3NMaXN0LmFkZCgnd2hpdGVib2FyZC1pdGVtX2NoaWxkLS1tb3ZpbmcnKVxuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZURvd25DaGlsZDogZnVuY3Rpb24gKGlkLCBlKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIHZhciBjbG9uZSA9IHRoaXMuY2hpbGRyZW5baWRdLmxhc3RDaGlsZC5jbG9uZU5vZGUodHJ1ZSlcbiAgICBpZiAodGhpcy5vLnN0YXJ0TW92aW5nQ2hpbGQoZSwgaWQsIGNsb25lKSkge1xuICAgICAgdGhpcy5jaGlsZHJlbltpZF0uY2xhc3NMaXN0LmFkZCgnd2hpdGVib2FyZC1pdGVtX2NoaWxkLS1tb3ZpbmcnKVxuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZURvd246IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUuYnV0dG9uICE9PSAwKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgdGhpcy5fbW92ZWQgPSBmYWxzZVxuICAgIGlmIChlLnRhcmdldCAhPT0gdGhpcy5pbnB1dCkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKVxuICAgIH1cbiAgICB2YXIgcmVjdCA9IHRoaXMubm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgIHRoaXMubm9kZS5jbGFzc0xpc3QuYWRkKCd3aGl0ZWJvYXJkLWl0ZW0tLW1vdmluZycpXG4gICAgdGhpcy5vLnN0YXJ0TW92aW5nKGUsIHJlY3QpXG4gICAgICAvLywgdG9wID0gZS5jbGllbnRZIC0gcmVjdC50b3BcbiAgICAgIC8vLCBsZWZ0ID0gZS5jbGllbnRYIC0gcmVjdC5sZWZ0XG4gICAgLyoqXG4gICAgICogVE9ETzogcmVzaXphYmlsaXR5ID9cbiAgICBpZiAobGVmdCA+IHJlY3Qud2lkdGggLSAxMCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RhcnRSZXNpemluZygneCcpXG4gICAgfVxuICAgIGlmICh0b3AgPiByZWN0LmhlaWdodCAtIDEwKSB7XG4gICAgICByZXR1cm4gdGhpcy5zdGFydFJlc2l6aW5nKCd5JylcbiAgICB9XG4gICAgICovXG4gICAgLy90aGlzLm8uc3RhcnRNb3ZpbmcobGVmdCwgdG9wKVxuICAgIHJldHVybiBmYWxzZVxuICB9LFxuXG4gIHJlbW92ZUNoaWxkOiBmdW5jdGlvbiAoaWQpIHtcbiAgICBpZiAoIXRoaXMuY2hpbGRyZW5baWRdKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gICAgdGhpcy5jaGlsZHJlbltpZF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmNoaWxkcmVuW2lkXSlcbiAgICBkZWxldGUgdGhpcy5jaGlsZHJlbltpZF1cbiAgfSxcblxuICBhZGRDaGlsZDogZnVuY3Rpb24gKGNoaWxkLCBpZCwgYmVmb3JlKSB7XG4gICAgdmFyIG5vZGUgPSB0aGlzLmNyZWF0ZUNoaWxkKGNoaWxkKVxuICAgIGlmIChiZWZvcmUgPT09IGZhbHNlKSB7XG4gICAgICB0aGlzLmJvZHkuYXBwZW5kQ2hpbGQobm9kZSlcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5ib2R5Lmluc2VydEJlZm9yZShub2RlLCB0aGlzLmNoaWxkcmVuW2JlZm9yZV0pXG4gICAgfVxuICAgIHRoaXMuY2hpbGRyZW5baWRdID0gbm9kZVxuICB9LFxuXG4gIGNyZWF0ZUNoaWxkOiBmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJylcbiAgICBub2RlLmNsYXNzTmFtZT0nd2hpdGVib2FyZC1pdGVtX2NoaWxkJ1xuICAgIGlmIChjaGlsZC5jaGlsZHJlbiAmJiBjaGlsZC5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgIG5vZGUuY2xhc3NMaXN0LmFkZCgnd2hpdGVib2FyZC1pdGVtX2NoaWxkLS1wYXJlbnQnKVxuICAgIH1cbiAgICB2YXIgYm9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgYm9keS5pbm5lckhUTUwgPSBjaGlsZC5jb250ZW50ID8gbWFya2VkKGNoaWxkLmNvbnRlbnQpIDogJzxlbT5DbGljayBoZXJlIHRvIGVkaXQ8L2VtPidcbiAgICB2YXIgaGFuZGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICBoYW5kbGUuY2xhc3NOYW1lID0gJ2hhbmRsZSdcbiAgICBoYW5kbGUuaW5uZXJIVE1MID0gJzxpIGNsYXNzPVwiZmEgZmEtY2lyY2xlXCIvPidcbiAgICBoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3VzZU1vdmVDaGlsZC5iaW5kKHRoaXMsIGNoaWxkLmlkKSlcbiAgICBoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fb25Nb3VzZURvd25DaGlsZC5iaW5kKHRoaXMsIGNoaWxkLmlkKSlcbiAgICBub2RlLmFwcGVuZENoaWxkKGhhbmRsZSlcbiAgICBub2RlLmFwcGVuZENoaWxkKGJvZHkpXG4gICAgcmV0dXJuIG5vZGVcbiAgfSxcblxuICBkb25lTW92aW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5ub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ3doaXRlYm9hcmQtaXRlbS0tbW92aW5nJylcbiAgfSxcblxuICBkb25lTW92aW5nQ2hpbGQ6IGZ1bmN0aW9uIChpZCkge1xuICAgIHRoaXMuY2hpbGRyZW5baWRdLmNsYXNzTGlzdC5yZW1vdmUoJ3doaXRlYm9hcmQtaXRlbV9jaGlsZC0tbW92aW5nJylcbiAgfSxcblxuICBzdGFydEVkaXRpbmc6IGZ1bmN0aW9uIChmcm9tU3RhcnQpIHtcbiAgICBpZiAodGhpcy5lZGl0aW5nKSByZXR1cm5cbiAgICB0aGlzLm5vZGUuY2xhc3NMaXN0LmFkZCgnd2hpdGVib2FyZC1pdGVtLS1lZGl0aW5nJylcbiAgICB0aGlzLmVkaXRpbmcgPSB0cnVlO1xuICAgIHRoaXMuc2V0SW5wdXRWYWx1ZSh0aGlzLmNvbnRlbnQpXG4gICAgdGhpcy5ub2RlLnJlcGxhY2VDaGlsZCh0aGlzLmlucHV0LCB0aGlzLnRpdGxlKVxuICAgIHRoaXMuaW5wdXQuZm9jdXMoKTtcbiAgICB0aGlzLnNldFNlbGVjdGlvbighZnJvbVN0YXJ0KVxuICB9LFxuXG4gIHN0b3BFZGl0aW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLmVkaXRpbmcpIHJldHVyblxuICAgIHRoaXMubm9kZS5jbGFzc0xpc3QucmVtb3ZlKCd3aGl0ZWJvYXJkLWl0ZW0tLWVkaXRpbmcnKVxuICAgIGNvbnNvbGUubG9nKCdzdG9wIGVkZGludCcsIHRoaXMuaXNOZXcpXG4gICAgdmFyIHZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKClcbiAgICB0aGlzLmVkaXRpbmcgPSBmYWxzZVxuICAgIHRoaXMubm9kZS5yZXBsYWNlQ2hpbGQodGhpcy50aXRsZSwgdGhpcy5pbnB1dClcbiAgICBpZiAodGhpcy5jb250ZW50ICE9IHZhbHVlKSB7XG4gICAgICB0aGlzLnNldFRleHRDb250ZW50KHZhbHVlKVxuICAgICAgdGhpcy5jb250ZW50ID0gdmFsdWVcbiAgICAgIHRoaXMuby5jaGFuZ2VDb250ZW50KHRoaXMuY29udGVudClcbiAgICB9XG4gIH0sXG5cbiAgc2V0U2VsZWN0aW9uOiBmdW5jdGlvbiAoZW5kKSB7XG4gICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKVxuICAgIHNlbC5zZWxlY3RBbGxDaGlsZHJlbih0aGlzLmlucHV0KVxuICAgIHRyeSB7XG4gICAgICBzZWxbJ2NvbGxhcHNlVG8nICsgKGVuZCA/ICdFbmQnIDogJ1N0YXJ0JyldKClcbiAgICB9IGNhdGNoIChlKSB7fVxuICB9LFxuXG4gIGZvY3VzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zdGFydEVkaXRpbmcoKVxuICB9LFxuXG4gIHNldFRleHRDb250ZW50OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnRpdGxlLmlubmVySFRNTCA9IHZhbHVlID8gbWFya2VkKHZhbHVlKSA6ICcnXG4gIH0sXG5cbiAgc2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5pbnB1dC5pbm5lckhUTUwgPSB2YWx1ZVxuICB9LFxuXG4gIGdldElucHV0VmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdW5Fc2NhcGVIdG1sKHRoaXMuaW5wdXQuaW5uZXJIVE1MKVxuICB9LFxuXG4gIHJlcG9zaXRpb246IGZ1bmN0aW9uICh4LCB5LCBzaWxlbnQpIHtcbiAgICBpZiAoeCAhPT0gdGhpcy54IHx8IHkgIT09IHRoaXMueSkge1xuICAgICAgdGhpcy5fbW92ZWQgPSB0cnVlXG4gICAgfVxuICAgIHRoaXMueCA9IHhcbiAgICB0aGlzLnkgPSB5XG4gICAgdGhpcy5ub2RlLnN0eWxlLnRvcCA9IHkgKyAncHgnXG4gICAgdGhpcy5ub2RlLnN0eWxlLmxlZnQgPSB4ICsgJ3B4J1xuICAgIGlmICghc2lsZW50KSB7XG4gICAgICB0aGlzLnNhdmVDb25maWcoKVxuICAgIH1cbiAgfSxcblxuICByZXNpemU6IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCBzaWxlbnQpIHtcbiAgICB0aGlzLndpZHRoID0gd2lkdGhcbiAgICB0aGlzLmhlaWdodCA9IGhlaWdodFxuICAgIHRoaXMubm9kZS5zdHlsZS53aWR0aCA9IHdpZHRoICsgJ3B4J1xuICAgIHRoaXMubm9kZS5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyAncHgnXG4gICAgaWYgKCFzaWxlbnQpIHtcbiAgICAgIHRoaXMuc2F2ZUNvbmZpZygpXG4gICAgfVxuICB9LFxuXG4gIHNhdmVDb25maWc6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm8uc2F2ZUNvbmZpZyh7XG4gICAgICBsZWZ0OiB0aGlzLngsXG4gICAgICB0b3A6IHRoaXMueSxcbiAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodFxuICAgIH0pXG4gIH0sXG5cbiAgc2F2ZUNvbnRlbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm8uc2F2ZUNvbnRlbnQodGhpcy5jb250ZW50KVxuICB9LFxuXG4gIG1vdXNlTW92ZTogZnVuY3Rpb24gKGUpIHtcbiAgfSxcblxuICBtb3VzZVVwOiBmdW5jdGlvbiAoZSkge1xuICB9LFxuXG4gIGNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgIHRoaXMuc3RhcnRFZGl0aW5nKClcbiAgfSxcblxuICBibHVyOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zdG9wRWRpdGluZygpXG4gIH0sXG5cbiAga2V5RG93bjogZnVuY3Rpb24gKGUpIHtcbiAgfVxufVxuXG4iLCJcbm1vZHVsZS5leHBvcnRzID0ge1xuICBWaWV3OiByZXF1aXJlKCcuL3ZpZXcnKVxufVxuXG4iLCJcbnZhciBEdW5nZW9uc0FuZERyYWdvbnMgPSByZXF1aXJlKCcuLi8uLi9saWIvZG5kLmpzJylcbnZhciBCbG9jayA9IHJlcXVpcmUoJy4vYmxvY2snKVxuXG5tb2R1bGUuZXhwb3J0cyA9IFZpZXdcblxuZnVuY3Rpb24gVmlldyhiaW5kQWN0aW9ucywgbW9kZWwsIGFjdGlvbnMsIG9wdGlvbnMpIHtcbiAgdGhpcy5tb2RlID0gJ25vcm1hbCdcbiAgdGhpcy5hY3RpdmUgPSBudWxsXG4gIHRoaXMuaWRzID0ge31cblxuICB0aGlzLmJpbmRBY3Rpb25zID0gYmluZEFjdGlvbnNcbiAgdGhpcy5tb2RlbCA9IG1vZGVsXG4gIHRoaXMuY3RybGFjdGlvbnMgPSBhY3Rpb25zXG5cbiAgdGhpcy5fYm91bmRNb3ZlID0gdGhpcy5fb25Nb3VzZU1vdmUuYmluZCh0aGlzKVxuICB0aGlzLl9ib3VuZFVwID0gdGhpcy5fb25Nb3VzZVVwLmJpbmQodGhpcylcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLl9vbktleVVwLmJpbmQodGhpcykpXG59XG5cblZpZXcucHJvdG90eXBlID0ge1xuICBpbml0aWFsaXplOiBmdW5jdGlvbiAocm9vdCkge1xuICAgIHZhciBub2RlID0gdGhpcy5tb2RlbC5pZHNbcm9vdF1cbiAgICB0aGlzLnNldHVwUm9vdCgpXG4gICAgdGhpcy5yb290ID0gcm9vdFxuICAgIHRoaXMubWFrZUJsb2Nrcyhyb290KVxuICAgIHJldHVybiB0aGlzLnJvb3ROb2RlXG4gIH0sXG5cbiAgc2V0dXBSb290OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHJvb3ROb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICByb290Tm9kZS5jbGFzc05hbWU9J3doaXRlYm9hcmQnXG4gICAgcm9vdE5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9vbkNsaWNrLmJpbmQodGhpcykpXG4gICAgcm9vdE5vZGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fb25Nb3VzZURvd24uYmluZCh0aGlzKSlcbiAgICByb290Tm9kZS5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIHRoaXMuX29uV2hlZWwuYmluZCh0aGlzKSlcblxuICAgIHRoaXMuaGVhZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy5oZWFkLmNsYXNzTmFtZSA9ICd3aGl0ZWJvYXJkLWhlYWQnXG4gICAgdGhpcy5oZWFkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fb25DbGlja0hlYWQuYmluZCh0aGlzKSlcblxuICAgIHRoaXMuaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpXG4gICAgdGhpcy5pbnB1dC5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScsIHRydWUpXG4gICAgdGhpcy5pbnB1dC5jbGFzc05hbWUgPSAnd2hpdGVib2FyZC1pbnB1dC1oZWFkJ1xuICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX29uQmx1ckhlYWQuYmluZCh0aGlzKSlcblxuICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgPSAnd2hpdGVib2FyZC1jb250YWluZXInXG5cbiAgICB0aGlzLmNvbnRyb2xzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLmNvbnRyb2xzLmNsYXNzTmFtZSA9ICd3aGl0ZWJvYXJkLWNvbnRyb2xzJ1xuICAgIHZhciBiMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXG4gICAgYjEuaW5uZXJIVE1MID0gJzE6MSdcbiAgICBiMS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMucmVzZXRDb250YWluZXIuYmluZCh0aGlzKSlcbiAgICB2YXIgYjIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKVxuICAgIGIyLmlubmVySFRNTCA9ICc8aSBjbGFzcz1cImZhIGZhLXRoLWxhcmdlXCIvPidcbiAgICBiMi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMucmVzZXRQb3NpdGlvbnMuYmluZCh0aGlzKSlcbiAgICB0aGlzLmNvbnRyb2xzLmFwcGVuZENoaWxkKGIxKVxuICAgIHRoaXMuY29udHJvbHMuYXBwZW5kQ2hpbGQoYjIpXG5cbiAgICB0aGlzLmRyb3BTaGFkb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgIHRoaXMuZHJvcFNoYWRvdy5jbGFzc05hbWUgPSAnd2hpdGVib2FyZC1kcm9wc2hhZG93J1xuXG4gICAgdGhpcy5ib2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5jb250YWluZXIpXG4gICAgdGhpcy5ib2R5LmNsYXNzTmFtZSA9ICd3aGl0ZWJvYXJkLWJvZHknXG4gICAgdGhpcy5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2RibGNsaWNrJywgdGhpcy5fb25Eb3VibGVDbGljay5iaW5kKHRoaXMpKVxuXG4gICAgdGhpcy52bGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy52bGluZS5jbGFzc05hbWU9J3doaXRlYm9hcmRfdmxpbmUnXG4gICAgdGhpcy5obGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy5obGluZS5jbGFzc05hbWU9J3doaXRlYm9hcmRfaGxpbmUnXG4gICAgdGhpcy5ib2R5LmFwcGVuZENoaWxkKHRoaXMudmxpbmUpXG4gICAgdGhpcy5ib2R5LmFwcGVuZENoaWxkKHRoaXMuaGxpbmUpXG4gICAgdGhpcy5ib2R5LmFwcGVuZENoaWxkKHRoaXMuZHJvcFNoYWRvdylcbiAgICB0aGlzLmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5jb250cm9scylcblxuICAgIHJvb3ROb2RlLmFwcGVuZENoaWxkKHRoaXMuaGVhZClcbiAgICByb290Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmJvZHkpXG5cbiAgICB0aGlzLnJvb3ROb2RlID0gcm9vdE5vZGVcbiAgICB0aGlzLnNldENvbnRhaW5lclpvb20oMSlcbiAgICB0aGlzLnNldENvbnRhaW5lclBvcygwLCAwKVxuICB9LFxuXG4gIC8vIENvbnRyb2xsZXIgLyBDb21tYW5kcyBBUEkgc3R1ZmZcblxuICBnZXRBY3RpdmU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5yb290XG4gIH0sXG5cbiAgYWRkVHJlZTogZnVuY3Rpb24gKG5vZGUsIGJlZm9yZSkge1xuICAgIGlmIChub2RlLnBhcmVudCAhPT0gdGhpcy5yb290KSByZXR1cm47XG4gICAgdGhpcy5tYWtlQmxvY2sobm9kZS5pZCwgMClcbiAgfSxcblxuICBhZGQ6IGZ1bmN0aW9uIChub2RlLCBiZWZvcmUsIGRvbnRmb2N1cykge1xuICAgIGlmIChub2RlLnBhcmVudCA9PT0gdGhpcy5yb290KSB7XG4gICAgICB2YXIgYmxvY2sgPSB0aGlzLm1ha2VCbG9jayhub2RlLmlkLCAwKVxuICAgICAgYmxvY2subm9kZS5zdHlsZS56SW5kZXggPSBPYmplY3Qua2V5cyh0aGlzLmlkcykubGVuZ3RoXG4gICAgICBpZiAoIWRvbnRmb2N1cykge1xuICAgICAgICBibG9jay5mb2N1cygpXG4gICAgICB9XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgaWYgKCF0aGlzLmlkc1tub2RlLnBhcmVudF0pIHtcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICB0aGlzLmlkc1tub2RlLnBhcmVudF0uYWRkQ2hpbGQobm9kZSwgdGhpcy5tb2RlbClcbiAgfSxcblxuICBzZXRDb2xsYXBzZWQ6IGZ1bmN0aW9uICgpIHtcbiAgfSxcbiAgc3RhcnRFZGl0aW5nOiBmdW5jdGlvbiAoKSB7XG4gIH0sXG4gIHNldEFjdGl2ZTogZnVuY3Rpb24gKCkge1xuICB9LFxuICBzZXRTZWxlY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgfSxcblxuICBtb3ZlOiBmdW5jdGlvbiAoaWQsIHBpZCwgYmVmb3JlLCBvcGlkLCBsYXN0Y2hpbGQpIHtcbiAgICBpZiAodGhpcy5pZHNbb3BpZF0pIHtcbiAgICAgIHRoaXMuaWRzW29waWRdLnJlbW92ZUNoaWxkKGlkKVxuICAgIH0gZWxzZSBpZiAob3BpZCA9PSB0aGlzLnJvb3QpIHtcbiAgICAgIHRoaXMuaWRzW2lkXS5yZW1vdmUoKVxuICAgICAgZGVsZXRlIHRoaXMuaWRzW2lkXVxuICAgIH1cbiAgICBpZiAodGhpcy5pZHNbcGlkXSkge1xuICAgICAgcmV0dXJuIHRoaXMuaWRzW3BpZF0uYWRkQ2hpbGQodGhpcy5tb2RlbC5pZHNbaWRdLCBpZCwgYmVmb3JlKVxuICAgIH1cbiAgICBpZiAocGlkICE9PSB0aGlzLnJvb3QpIHtcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICB0aGlzLmFkZCh0aGlzLm1vZGVsLmlkc1tpZF0sIGJlZm9yZSlcbiAgfSxcblxuICByZW1vdmU6IGZ1bmN0aW9uIChpZCkge1xuICAgIGNvbnNvbGUud2FybihcIkZJWD8/XCIpXG4gICAgdGhpcy5jb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy5pZHNbaWRdLm5vZGUpXG4gICAgZGVsZXRlIHRoaXMuaWRzW2lkXVxuICB9LFxuICBnb1RvOiBmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS53YXJuKCdGSVghJyk7XG4gIH0sXG4gIGNsZWFyOiBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgaWQgaW4gdGhpcy5pZHMpIHtcbiAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuaWRzW2lkXS5ub2RlKVxuICAgIH1cbiAgICB0aGlzLmlkcyA9IHt9XG4gICAgdGhpcy5zZXRDb250YWluZXJQb3MoMCwgMClcbiAgICB0aGlzLnNldENvbnRhaW5lclpvb20oMSk7XG4gIH0sXG5cbiAgcmViYXNlOiBmdW5jdGlvbiAobmV3cm9vdCwgdHJpZ2dlcikge1xuICAgIHRoaXMuY2xlYXIoKVxuICAgIHRoaXMucm9vdCA9IG5ld3Jvb3RcbiAgICB0aGlzLm1ha2VCbG9ja3MobmV3cm9vdClcbiAgICB0aGlzLmN0cmxhY3Rpb25zLnRyaWdnZXIoJ3JlYmFzZScsIG5ld3Jvb3QpXG4gIH0sXG5cbiAgc2V0QXR0cjogZnVuY3Rpb24gKGlkLCBhdHRyLCB2YWx1ZSkge1xuICAgIGlmICghdGhpcy5pZHNbaWRdKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgaWYgKGF0dHIgPT09ICd3aGl0ZWJvYXJkJykge1xuICAgICAgaWYgKCF2YWx1ZSB8fCAhdmFsdWUudG9wKSB7XG4gICAgICAgIHZhciBjaCA9IHRoaXMubW9kZWwuaWRzW3RoaXMucm9vdF0uY2hpbGRyZW5cbiAgICAgICAgICAsIGkgPSBjaC5pbmRleE9mKGlkKVxuICAgICAgICAgICwgZGVmYXVsdFdpZHRoID0gMzAwXG4gICAgICAgICAgLCBkZWZhdWx0SGVpZ2h0ID0gMTAwXG4gICAgICAgICAgLCBtYXJnaW4gPSAxMFxuICAgICAgICB2YWx1ZSA9IHtcbiAgICAgICAgICB0b3A6IDEwICsgcGFyc2VJbnQoaSAvIDQpICogKGRlZmF1bHRIZWlnaHQgKyBtYXJnaW4pLFxuICAgICAgICAgIGxlZnQ6IDEwICsgKGkgJSA0KSAqIChkZWZhdWx0V2lkdGggKyBtYXJnaW4pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuaWRzW2lkXS51cGRhdGVDb25maWcodmFsdWUpXG4gICAgfVxuICAgIC8vIFRPRE8gc29tZXRoaW5nIHdpdGggZG9uZS1uZXNzP1xuICB9LFxuXG4gIHNldENvbnRlbnQ6IGZ1bmN0aW9uIChpZCwgY29udGVudCkge1xuICAgIGlmICghdGhpcy5pZHNbaWRdKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgdGhpcy5pZHNbaWRdLnNldENvbnRlbnQoY29udGVudClcbiAgfSxcblxuICBzZXRSb290Q29udGVudDogZnVuY3Rpb24gKGNvbnRlbnQpIHtcbiAgICB0aGlzLmhlYWQuaW5uZXJIVE1MID0gbWFya2VkKGNvbnRlbnQpO1xuICB9LFxuXG4gIG1ha2VCbG9ja3M6IGZ1bmN0aW9uIChyb290KSB7XG4gICAgdGhpcy5zZXRSb290Q29udGVudCh0aGlzLm1vZGVsLmlkc1tyb290XS5jb250ZW50KTtcbiAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLm1vZGVsLmlkc1tyb290XS5jaGlsZHJlblxuICAgIGlmICghY2hpbGRyZW4pIHJldHVyblxuICAgIGNoaWxkcmVuLmZvckVhY2godGhpcy5tYWtlQmxvY2suYmluZCh0aGlzKSk7XG4gIH0sXG5cbiAgbWFrZUJsb2NrOiBmdW5jdGlvbiAoaWQsIGkpIHtcbiAgICB2YXIgbm9kZSA9IHRoaXMubW9kZWwuaWRzW2lkXVxuICAgICAgLCBjb25maWcgPSBub2RlLm1ldGEud2hpdGVib2FyZFxuICAgICAgLy8gVE9ETzogbWFnaWMgbnVtYmVycz9cbiAgICAgICwgZGVmYXVsdFdpZHRoID0gMzAwXG4gICAgICAsIGRlZmF1bHRIZWlnaHQgPSAxMDBcbiAgICAgICwgbWFyZ2luID0gMTBcbiAgICBpZiAoIWNvbmZpZykge1xuICAgICAgY29uZmlnID0ge1xuICAgICAgICAvLyB3aWR0aDogMjAwLFxuICAgICAgICAvLyBoZWlnaHQ6IDIwMCxcbiAgICAgICAgdG9wOiAxMCArIHBhcnNlSW50KGkgLyA0KSAqIChkZWZhdWx0SGVpZ2h0ICsgbWFyZ2luKSxcbiAgICAgICAgbGVmdDogMTAgKyAoaSAlIDQpICogKGRlZmF1bHRXaWR0aCArIG1hcmdpbilcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIGNoaWxkcmVuID0gKG5vZGUuY2hpbGRyZW4gfHwgW10pLm1hcChmdW5jdGlvbiAoaWQpIHtcbiAgICAgIHJldHVybiB0aGlzLm1vZGVsLmlkc1tpZF1cbiAgICB9LmJpbmQodGhpcykpO1xuICAgIHZhciBibG9jayA9IG5ldyBCbG9jayhub2RlLCBjaGlsZHJlbiwgY29uZmlnLCB7XG4gICAgICBzYXZlQ29uZmlnOiBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgIHRoaXMuY3RybGFjdGlvbnMuY2hhbmdlZChub2RlLmlkLCAnd2hpdGVib2FyZCcsIGNvbmZpZylcbiAgICAgICAgLy8gdGhpcy5jdHJsLmV4ZWN1dGVDb21tYW5kcygnY2hhbmdlTm9kZUF0dHInLCBbbm9kZS5pZCwgJ3doaXRlYm9hcmQnLCBjb25maWddKTtcbiAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgIHNhdmVDb250ZW50OiBmdW5jdGlvbiAoY29udGVudCkge1xuICAgICAgICB0aGlzLmN0cmxhY3Rpb25zLmNoYW5nZUNvbnRlbnQobm9kZS5pZCwgY29udGVudClcbiAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgIGNoYW5nZUNvbnRlbnQ6IGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgICAgIHRoaXMuY3RybGFjdGlvbnMuY2hhbmdlQ29udGVudChub2RlLmlkLCBjb250ZW50KVxuICAgICAgfS5iaW5kKHRoaXMpLFxuICAgICAgc3RhcnRNb3Zpbmc6IHRoaXMuX29uU3RhcnRNb3ZpbmcuYmluZCh0aGlzLCBub2RlLmlkKSxcbiAgICAgIHN0YXJ0TW92aW5nQ2hpbGQ6IHRoaXMuX29uU3RhcnRNb3ZpbmdDaGlsZC5iaW5kKHRoaXMsIG5vZGUuaWQpLFxuICAgICAgb25ab29tOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmViYXNlKG5vZGUuaWQpXG4gICAgICB9LmJpbmQodGhpcyksXG4gICAgfSlcbiAgICB0aGlzLmlkc1tpZF0gPSBibG9ja1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGJsb2NrLm5vZGUpXG4gICAgcmV0dXJuIGJsb2NrXG4gIH0sXG5cbiAgLyoqXG4gICAqIElmIHRoZSBjdXJyZW50IGlzIG92ZXIgYSB0YXJnZXQsIHNob3cgdGhlIGRyb3Agc2hhZG93LlxuICAgKi9cbiAgdXBkYXRlRHJvcFRhcmdldDogZnVuY3Rpb24gKHgsIHkpIHtcbiAgICB2YXIgdFxuICAgIC8qXG4gICAgaWYgKHRoaXMubW92aW5nLmN1cnJlbnRUYXJnZXQpIHtcbiAgICAgIHQgPSB0aGlzLm1vdmluZy5jdXJyZW50VGFyZ2V0XG4gICAgICBpZiAoeCA+PSB0LmhpdC5sZWZ0ICYmIHggPD0gdC5oaXQucmlnaHQgJiZcbiAgICAgICAgICB5ID49IHQuaGl0LnRvcCAmJiB5IDw9IHQuaGl0LmJvdHRvbSkge1xuICAgICAgICAvLyBqdXN0IGtlZXAgdGhlIGN1cnJlbnQgb25lXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgIH1cbiAgICAqL1xuICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLm1vdmluZy50YXJnZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0ID0gdGhpcy5tb3ZpbmcudGFyZ2V0c1tpXVxuICAgICAgaWYgKHggPj0gdC5oaXQubGVmdCAmJiB4IDw9IHQuaGl0LnJpZ2h0ICYmXG4gICAgICAgICAgeSA+PSB0LmhpdC50b3AgJiYgeSA8PSB0LmhpdC5ib3R0b20pIHtcbiAgICAgICAgdGhpcy5tb3ZpbmcuY3VycmVudFRhcmdldCA9IHRcbiAgICAgICAgdGhpcy5zaG93RHJvcFNoYWRvdyh0LmRyYXcpXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMubW92aW5nLmN1cnJlbnRUYXJnZXQgPSBudWxsXG4gICAgdGhpcy5oaWRlRHJvcFNoYWRvdygpXG4gICAgcmV0dXJuIGZhbHNlXG4gIH0sXG5cbiAgLyoqXG4gICAqIENvbGxlY3QgYSBsaXN0IG9mIHRhcmdldHMgXG4gICAqL1xuICBmaW5kVGFyZ2V0czogZnVuY3Rpb24gKGNoaWxkcmVuLCBpZCwgaXNDaGlsZCkge1xuICAgIHZhciB0YXJnZXRzID0gW11cbiAgICAgICwgc25hcHMgPSBbXVxuICAgICAgLCByb290ID0gdGhpcy5ib2R5LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgZm9yICh2YXIgaSA9IGNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBpZiAoaWQgPT0gY2hpbGRyZW5baV0pIGNvbnRpbnVlO1xuICAgICAgdmFyIGNoaWxkaWRzID0gdGhpcy5tb2RlbC5pZHNbY2hpbGRyZW5baV1dLmNoaWxkcmVuXG4gICAgICAgICwgY2hpbGQgPSB0aGlzLmlkc1tjaGlsZHJlbltpXV1cbiAgICAgICAgLCB3aG9sZSA9IGNoaWxkLndob2xlVGFyZ2V0KGlkLCBjaGlsZGlkcy5sZW5ndGgpXG4gICAgICB0YXJnZXRzID0gdGFyZ2V0cy5jb25jYXQoY2hpbGQuZ2V0Q2hpbGRUYXJnZXRzKGlkLCBjaGlsZHJlbltpXSwgY2hpbGRpZHMpKVxuICAgICAgdGFyZ2V0cy5wdXNoKHdob2xlKVxuICAgICAgaWYgKCFpc0NoaWxkKSB7XG4gICAgICAgIHNuYXBzLnB1c2goe1xuICAgICAgICAgIHRvcDogd2hvbGUuaGl0LnRvcCAtIHJvb3QudG9wLFxuICAgICAgICAgIGxlZnQ6IHdob2xlLmhpdC5sZWZ0IC0gcm9vdC5sZWZ0LFxuICAgICAgICAgIHJpZ2h0OiB3aG9sZS5oaXQucmlnaHQgLSByb290LmxlZnQsXG4gICAgICAgICAgYm90dG9tOiB3aG9sZS5oaXQuYm90dG9tIC0gcm9vdC50b3BcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHRhcmdldHM6IHRhcmdldHMsXG4gICAgICBzbmFwczogc25hcHNcbiAgICB9XG4gIH0sXG5cbiAgdHJ5U25hcDogZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAvLyBjb252ZXJ0IHRvIHNjcmVlbiBjb29yZHNcbiAgICB4ID0geCAqIHRoaXMuX3pvb20gKyB0aGlzLnhcbiAgICB5ID0geSAqIHRoaXMuX3pvb20gKyB0aGlzLnlcbiAgICB2YXIgaCA9IHRoaXMubW92aW5nLmhlaWdodFxuICAgICAgLCB3ID0gdGhpcy5tb3Zpbmcud2lkdGhcbiAgICAgICwgYiA9IHkgKyBoXG4gICAgICAsIHIgPSB4ICsgd1xuICAgICAgLCBhbGxvd2FuY2UgPSAyMCAqIHRoaXMuX3pvb21cbiAgICAgICwgc3BhY2UgPSAxMCAqIHRoaXMuX3pvb21cblxuICAgIGlmIChhbGxvd2FuY2UgPCAyKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICAvLyBUT0RPOiBzaG93IGd1aWRpbmcgbGluZXNcbiAgICB2YXIgbGluZXMgPSBbXVxuICAgICAgLCBkeCA9IGZhbHNlXG4gICAgICAsIGR5ID0gZmFsc2VcblxuICAgIHRoaXMubW92aW5nLnNuYXBzLmZvckVhY2goZnVuY3Rpb24gKHNuYXApIHtcbiAgICAgIGlmICghZHkpIHtcbiAgICAgICAgLy8gdG9wXG4gICAgICAgIGlmIChNYXRoLmFicyhzbmFwLnRvcCAtIHNwYWNlIC0gYikgPCBhbGxvd2FuY2UpIHtcbiAgICAgICAgICB5ID0gc25hcC50b3AgLSBzcGFjZSAtIGhcbiAgICAgICAgICBkeSA9IFtzbmFwLmxlZnQsIHNuYXAucmlnaHQsIHNuYXAudG9wIC0gc3BhY2UgLyAyXVxuICAgICAgICB9IGVsc2UgaWYgKE1hdGguYWJzKHNuYXAudG9wIC0geSkgPCBhbGxvd2FuY2UpIHtcbiAgICAgICAgICB5ID0gc25hcC50b3BcbiAgICAgICAgICBkeSA9IFtzbmFwLmxlZnQsIHNuYXAucmlnaHQsIHNuYXAudG9wIC0gc3BhY2UgLyAyXVxuICAgICAgICB9IGVsc2UgaWYgKE1hdGguYWJzKHNuYXAuYm90dG9tICsgc3BhY2UgLSB5KSA8IGFsbG93YW5jZSkgeyAvLyBib3R0b21cbiAgICAgICAgICB5ID0gc25hcC5ib3R0b20gKyBzcGFjZVxuICAgICAgICAgIGR5ID0gW3NuYXAubGVmdCwgc25hcC5yaWdodCwgc25hcC5ib3R0b20gKyBzcGFjZSAvIDJdXG4gICAgICAgIH0gZWxzZSBpZiAoTWF0aC5hYnMoc25hcC5ib3R0b20gLSBiKSA8IGFsbG93YW5jZSkge1xuICAgICAgICAgIHkgPSBzbmFwLmJvdHRvbSAtIGhcbiAgICAgICAgICBkeSA9IFtzbmFwLmxlZnQsIHNuYXAucmlnaHQsIHNuYXAuYm90dG9tICsgc3BhY2UgLyAyXVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghZHgpIHtcbiAgICAgICAgLy8gbGVmdFxuICAgICAgICBpZiAoTWF0aC5hYnMoc25hcC5sZWZ0IC0gc3BhY2UgLSByKSA8IGFsbG93YW5jZSkge1xuICAgICAgICAgIHggPSBzbmFwLmxlZnQgLSBzcGFjZSAtIHdcbiAgICAgICAgICBkeCA9IFtzbmFwLnRvcCwgc25hcC5ib3R0b20sIHNuYXAubGVmdCAtIHNwYWNlIC8gMl1cbiAgICAgICAgfSBlbHNlIGlmIChNYXRoLmFicyhzbmFwLmxlZnQgLSB4KSA8IGFsbG93YW5jZSkge1xuICAgICAgICAgIHggPSBzbmFwLmxlZnRcbiAgICAgICAgICBkeCA9IFtzbmFwLnRvcCwgc25hcC5ib3R0b20sIHNuYXAubGVmdCAtIHNwYWNlIC8gMl1cbiAgICAgICAgfSBlbHNlIGlmIChNYXRoLmFicyhzbmFwLnJpZ2h0ICsgc3BhY2UgLSB4KSA8IGFsbG93YW5jZSkgeyAvLyByaWdodFxuICAgICAgICAgIHggPSBzbmFwLnJpZ2h0ICsgc3BhY2VcbiAgICAgICAgICBkeCA9IFtzbmFwLnRvcCwgc25hcC5ib3R0b20sIHNuYXAucmlnaHQgKyBzcGFjZSAvIDJdXG4gICAgICAgIH0gZWxzZSBpZiAoTWF0aC5hYnMoc25hcC5yaWdodCAtIHIpIDwgYWxsb3dhbmNlKSB7XG4gICAgICAgICAgeCA9IHNuYXAucmlnaHQgLSB3XG4gICAgICAgICAgZHggPSBbc25hcC50b3AsIHNuYXAuYm90dG9tLCBzbmFwLnJpZ2h0ICsgc3BhY2UgLyAyXVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcblxuICAgIGlmIChkeCkge1xuICAgICAgdmFyIGh0ID0gTWF0aC5taW4oZHhbMF0sIHkpXG4gICAgICAgICwgaGIgPSBNYXRoLm1heChkeFsxXSwgeSArIGgpXG4gICAgICB0aGlzLnZsaW5lLnN0eWxlLmxlZnQgPSBkeFsyXSAtIDEgKyAncHgnXG4gICAgICB0aGlzLnZsaW5lLnN0eWxlLnRvcCA9IGh0IC0gc3BhY2UvMiArICdweCdcbiAgICAgIHRoaXMudmxpbmUuc3R5bGUuaGVpZ2h0ID0gKGhiIC0gaHQpICsgc3BhY2UgKyAncHgnXG4gICAgICB0aGlzLnZsaW5lLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmxpbmUuc3R5bGUuZGlzcGxheSA9ICdub25lJ1xuICAgIH1cblxuICAgIGlmIChkeSkge1xuICAgICAgdmFyIHZsID0gTWF0aC5taW4oZHlbMF0sIHgpXG4gICAgICAgICwgdnIgPSBNYXRoLm1heChkeVsxXSwgeCArIHcpXG4gICAgICB0aGlzLmhsaW5lLnN0eWxlLnRvcCA9IGR5WzJdIC0gMSArICdweCdcbiAgICAgIHRoaXMuaGxpbmUuc3R5bGUubGVmdCA9IHZsIC0gc3BhY2UvMiArICdweCdcbiAgICAgIHRoaXMuaGxpbmUuc3R5bGUud2lkdGggPSAodnIgLSB2bCkgKyBzcGFjZSArICdweCdcbiAgICAgIHRoaXMuaGxpbmUuc3R5bGUuZGlzcGxheSA9ICdibG9jaydcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5obGluZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnXG4gICAgfVxuXG4gICAgaWYgKGR4IHx8IGR5KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiAoeCAtIHRoaXMueCkvdGhpcy5fem9vbSxcbiAgICAgICAgeTogKHkgLSB0aGlzLnkpL3RoaXMuX3pvb21cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlXG4gIH0sXG5cbiAgZ2V0QnlaSW5kZXg6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICBmb3IgKHZhciBpZCBpbiB0aGlzLmlkcykge1xuICAgICAgaXRlbXMucHVzaChbK3RoaXMuaWRzW2lkXS5ub2RlLnN0eWxlLnpJbmRleCwgaWRdKVxuICAgIH1cbiAgICBpdGVtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICByZXR1cm4gYVswXSAtIGJbMF1cbiAgICB9KVxuICAgIHJldHVybiBpdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtyZXR1cm4gaXRlbVsxXX0pXG4gIH0sXG5cbiAgc2h1ZmZsZVpJbmRpY2VzOiBmdW5jdGlvbiAodG9wKSB7XG4gICAgdmFyIGl0ZW1zID0gdGhpcy5nZXRCeVpJbmRleCgpXG4gICAgZm9yICh2YXIgaT0wOyBpPGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLmlkc1tpdGVtc1tpXV0ubm9kZS5zdHlsZS56SW5kZXggPSBpXG4gICAgfVxuICAgIHRoaXMuaWRzW3RvcF0ubm9kZS5zdHlsZS56SW5kZXggPSBpdGVtcy5sZW5ndGhcbiAgICByZXR1cm4gaXRlbXNcbiAgfSxcblxuICAvLyBldmVudCBoYW5kbGVyc1xuXG4gIF9vbkNsaWNrSGVhZDogZnVuY3Rpb24gKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICB0aGlzLnN0YXJ0RWRpdGluZygpXG4gIH0sXG5cbiAgX29uQmx1ckhlYWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgdGhpcy5zdG9wRWRpdGluZygpXG4gIH0sXG5cbiAgc3RhcnRFZGl0aW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pbnB1dC52YWx1ZSA9IHRoaXMubW9kZWwuaWRzW3RoaXMucm9vdF0uY29udGVudFxuICAgIHRoaXMucm9vdE5vZGUucmVwbGFjZUNoaWxkKHRoaXMuaW5wdXQsIHRoaXMuaGVhZClcbiAgICB0aGlzLmlucHV0LmZvY3VzKClcbiAgICB0aGlzLmlucHV0LnNlbGVjdGlvblN0YXJ0ID0gdGhpcy5pbnB1dC5zZWxlY3Rpb25FbmQgPSB0aGlzLmlucHV0LnZhbHVlLmxlbmd0aFxuICB9LFxuXG4gIHN0b3BFZGl0aW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jdHJsYWN0aW9ucy5jaGFuZ2VDb250ZW50KHRoaXMucm9vdCwgdGhpcy5pbnB1dC52YWx1ZSlcbiAgICB0aGlzLnNldFJvb3RDb250ZW50KHRoaXMuaW5wdXQudmFsdWUpXG4gICAgdGhpcy5yb290Tm9kZS5yZXBsYWNlQ2hpbGQodGhpcy5oZWFkLCB0aGlzLmlucHV0KVxuICB9LFxuXG4gIF9vbkNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5yb290Tm9kZSkge1xuICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKClcbiAgICB9XG4gIH0sXG5cbiAgX29uRG91YmxlQ2xpY2s6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUudGFyZ2V0ICE9PSB0aGlzLmJvZHkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICB2YXIgYm94ID0gdGhpcy5jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICB2YXIgeCA9IGUuY2xpZW50WCAtIDUwIC0gYm94LmxlZnRcbiAgICAgICwgeSA9IGUuY2xpZW50WSAtIDEwIC0gYm94LnRvcFxuICAgICAgLCBpZHggPSB0aGlzLm1vZGVsLmlkc1t0aGlzLnJvb3RdLmNoaWxkcmVuLmxlbmd0aFxuICAgIHRoaXMuY3RybGFjdGlvbnMuYWRkQ2hpbGQodGhpcy5yb290LCBpZHgsICcnLCB7XG4gICAgICB3aGl0ZWJvYXJkOiB7XG4gICAgICAgIC8vIHdpZHRoOiAyMDAsXG4gICAgICAgIC8vIGhlaWdodDogMjAwLFxuICAgICAgICB0b3A6IHksXG4gICAgICAgIGxlZnQ6IHhcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuXG4gIF9vbldoZWVsOiBmdW5jdGlvbiAoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGlmICh0aGlzLm1vdmluZykge1xuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIHZhciB4LCB5XG4gICAgdmFyIGRlbHRhWCA9IC1lLmRlbHRhWCwgZGVsdGFZID0gLWUuZGVsdGFZXG4gICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgIHZhciByb290ID0gdGhpcy5ib2R5LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICB4ID0gZS5jbGllbnRYIC0gcm9vdC5sZWZ0XG4gICAgICB5ID0gZS5jbGllbnRZIC0gcm9vdC50b3BcbiAgICAgIHRoaXMuem9vbU1vdmUoKGRlbHRhWSAvIDUwMCksIHgsIHkpXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgeCA9IHRoaXMueFxuICAgIHkgPSB0aGlzLnlcbiAgICB0aGlzLnNldENvbnRhaW5lclBvcyh4ICsgZGVsdGFYLCB5ICsgZGVsdGFZKVxuICB9LFxuXG4gIF9vbk1vdXNlRG93bjogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS50YXJnZXQgIT09IHRoaXMucm9vdE5vZGUpIHtcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICB2YXIgYm94ID0gdGhpcy5jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICB2YXIgeCA9IGUuY2xpZW50WCAtIGJveC5sZWZ0XG4gICAgICAsIHkgPSBlLmNsaWVudFkgLSBib3gudG9wXG4gICAgdGhpcy5tb3ZpbmcgPSB7XG4gICAgICB4OiB4LFxuICAgICAgeTogeSxcbiAgICB9XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5fYm91bmRNb3ZlKVxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl9ib3VuZFVwKVxuICB9LFxuXG4gIF9vblN0YXJ0TW92aW5nOiBmdW5jdGlvbiAoaWQsIGUsIHJlY3QsIHNoaWZ0TW92ZSkge1xuICAgIGlmICh0aGlzLm1vdmluZykgcmV0dXJuIGZhbHNlO1xuICAgIHZhciB5ID0gZS5jbGllbnRZIC8gdGhpcy5fem9vbSAtIHJlY3QudG9wL3RoaXMuX3pvb21cbiAgICAgICwgeCA9IGUuY2xpZW50WCAvIHRoaXMuX3pvb20gLSByZWN0LmxlZnQvdGhpcy5fem9vbVxuICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuc2h1ZmZsZVpJbmRpY2VzKGlkKVxuICAgIHZhciBib3hlcyA9IHRoaXMuZmluZFRhcmdldHMoY2hpbGRyZW4sIGlkKVxuICAgIHRoaXMubW92aW5nID0ge1xuICAgICAgc2hpZnQ6IHNoaWZ0TW92ZSxcbiAgICAgIHRhcmdldHM6IGJveGVzLnRhcmdldHMsXG4gICAgICBzbmFwczogYm94ZXMuc25hcHMsXG4gICAgICB3aWR0aDogcmVjdC53aWR0aCxcbiAgICAgIGhlaWdodDogcmVjdC5oZWlnaHQsXG4gICAgICBhdHg6IHRoaXMuaWRzW2lkXS54LFxuICAgICAgYXR5OiB0aGlzLmlkc1tpZF0ueSxcbiAgICAgIGlkOiBpZCxcbiAgICAgIHg6IHgsXG4gICAgICB5OiB5LFxuICAgIH1cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9ib3VuZE1vdmUpXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuX2JvdW5kVXApXG4gICAgdGhpcy5yb290Tm9kZS5jbGFzc0xpc3QuYWRkKCd3aGl0ZWJvYXJkLS1tb3ZpbmcnKVxuICAgIHJldHVybiB0cnVlXG4gIH0sXG5cbiAgX29uU3RhcnRNb3ZpbmdDaGlsZDogZnVuY3Rpb24gKGlkLCBlLCBjaWQsIGhhbmRsZSwgc2hpZnRNb3ZlKSB7XG4gICAgaWYgKHRoaXMubW92aW5nKSByZXR1cm4gZmFsc2U7XG4gICAgdmFyIGJveCA9IHRoaXMuY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgdmFyIHggPSBlLmNsaWVudFgvdGhpcy5fem9vbSAtIGJveC5sZWZ0L3RoaXMuX3pvb21cbiAgICAgICwgeSA9IGUuY2xpZW50WS90aGlzLl96b29tIC0gYm94LnRvcC90aGlzLl96b29tXG4gICAgdmFyIGNoaWxkcmVuID0gdGhpcy5nZXRCeVpJbmRleCgpXG4gICAgdmFyIGJveGVzID0gdGhpcy5maW5kVGFyZ2V0cyhjaGlsZHJlbiwgY2lkLCB0cnVlKVxuICAgIHRoaXMubW92aW5nID0ge1xuICAgICAgc2hpZnQ6IHNoaWZ0TW92ZSxcbiAgICAgIHRhcmdldHM6IGJveGVzLnRhcmdldHMsXG4gICAgICBzbmFwczogYm94ZXMuc25hcHMsXG4gICAgICBoYW5kbGU6IGhhbmRsZSxcbiAgICAgIGNoaWxkOiBjaWQsXG4gICAgICBwYXJlbnRfaWQ6IGlkLFxuICAgICAgb3R5OiB4LFxuICAgICAgb3R4OiB5LFxuICAgICAgeDogeCxcbiAgICAgIHk6IHlcbiAgICB9XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoaGFuZGxlKVxuICAgIHRoaXMudXBkYXRlRHJvcFRhcmdldChlLmNsaWVudFgsIGUuY2xpZW50WSlcbiAgICBoYW5kbGUuY2xhc3NOYW1lID0gJ3doaXRlYm9hcmRfY2hpbGQtaGFuZGxlJ1xuICAgIGhhbmRsZS5zdHlsZS50b3AgPSB5ICsgJ3B4J1xuICAgIGhhbmRsZS5zdHlsZS5sZWZ0ID0geCArICdweCdcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9ib3VuZE1vdmUpXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuX2JvdW5kVXApXG4gICAgdGhpcy5yb290Tm9kZS5jbGFzc0xpc3QuYWRkKCd3aGl0ZWJvYXJkLS1tb3ZpbmcnKVxuICAgIHJldHVybiB0cnVlXG4gIH0sXG5cbiAgX29uS2V5VXA6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMTYgJiYgdGhpcy5tb3ZpbmcgJiYgdGhpcy5tb3Zpbmcuc2hpZnQpIHtcbiAgICAgIHRoaXMuc3RvcE1vdmluZygpXG4gICAgfVxuICB9LFxuXG4gIF9vbk1vdXNlTW92ZTogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoIXRoaXMubW92aW5nKSB7XG4gICAgICByZXR1cm4gdGhpcy5fb25Nb3VzZVVwKGUpXG4gICAgfVxuICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgaWYgKHRoaXMubW92aW5nLmNoaWxkKSB7XG4gICAgICB2YXIgYm94ID0gdGhpcy5jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICAgIHZhciB4ID0gZS5jbGllbnRYL3RoaXMuX3pvb20gLSBib3gubGVmdC90aGlzLl96b29tXG4gICAgICAgICwgeSA9IGUuY2xpZW50WS90aGlzLl96b29tIC0gYm94LnRvcC90aGlzLl96b29tXG4gICAgICB0aGlzLm1vdmluZy5oYW5kbGUuc3R5bGUudG9wID0geSArICdweCdcbiAgICAgIHRoaXMubW92aW5nLmhhbmRsZS5zdHlsZS5sZWZ0ID0geCArICdweCdcbiAgICAgIHRoaXMubW92aW5nLnggPSB4XG4gICAgICB0aGlzLm1vdmluZy55ID0geVxuICAgICAgdGhpcy51cGRhdGVEcm9wVGFyZ2V0KGUuY2xpZW50WCwgZS5jbGllbnRZKVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgaWYgKHRoaXMubW92aW5nLmlkKSB7XG4gICAgICB2YXIgYm94ID0gdGhpcy5jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICAgIHZhciB4ID0gZS5jbGllbnRYL3RoaXMuX3pvb20gLSBib3gubGVmdC90aGlzLl96b29tIC0gdGhpcy5tb3ZpbmcueFxuICAgICAgICAsIHkgPSBlLmNsaWVudFkvdGhpcy5fem9vbSAtIGJveC50b3AvdGhpcy5fem9vbSAtIHRoaXMubW92aW5nLnlcbiAgICAgIGlmICghdGhpcy51cGRhdGVEcm9wVGFyZ2V0KGUuY2xpZW50WCwgZS5jbGllbnRZKSkge1xuICAgICAgICAvLyBubyBkcm9wIHBsYWNlIHdhcyBmb3VuZCwgbGV0J3Mgc25hcCFcbiAgICAgICAgdmFyIHBvcyA9IHRoaXMudHJ5U25hcCh4LCB5KVxuICAgICAgICBpZiAocG9zKSB7XG4gICAgICAgICAgeCA9IHBvcy54XG4gICAgICAgICAgeSA9IHBvcy55XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMubW92aW5nLmF0eCA9IHhcbiAgICAgIHRoaXMubW92aW5nLmF0eSA9IHlcbiAgICAgIHRoaXMuaWRzW3RoaXMubW92aW5nLmlkXS5yZXBvc2l0aW9uKHgsIHksIHRydWUpXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9IFxuXG4gICAgLy8gZHJhZ2dpbmcgdGhlIGNhbnZhc1xuICAgIHZhciBib3ggPSB0aGlzLmJvZHkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICB2YXIgeCA9IGUuY2xpZW50WCAtIGJveC5sZWZ0IC0gdGhpcy5tb3ZpbmcueFxuICAgICAgLCB5ID0gZS5jbGllbnRZIC0gYm94LnRvcCAtIHRoaXMubW92aW5nLnlcbiAgICB0aGlzLnNldENvbnRhaW5lclBvcyh4LCB5KVxuICAgIHJldHVybiBmYWxzZVxuICB9LFxuXG4gIF9vbk1vdXNlVXA6IGZ1bmN0aW9uIChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgdGhpcy5zdG9wTW92aW5nKClcbiAgICByZXR1cm4gZmFsc2VcbiAgfSxcblxuICByZXNldENvbnRhaW5lcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0Q29udGFpbmVyUG9zKDAsIDApXG4gICAgdGhpcy5zZXRDb250YWluZXJab29tKDEpXG4gIH0sXG5cbiAgcmVzZXRQb3NpdGlvbnM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY21kcyA9IFtdXG4gICAgdGhpcy5tb2RlbC5pZHNbdGhpcy5yb290XS5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChpZCkge1xuICAgICAgY21kcy5wdXNoKCdjaGFuZ2VOb2RlQXR0cicpXG4gICAgICBjbWRzLnB1c2goW2lkLCAnd2hpdGVib2FyZCcsIG51bGxdKVxuICAgIH0pO1xuICAgIHRoaXMuY3RybGFjdGlvbnMuY29tbWFuZHMoY21kcylcbiAgfSxcblxuICB6b29tTW92ZTogZnVuY3Rpb24gKGRlbHRhLCB4LCB5KSB7XG4gICAgdmFyIG5leHQgPSB0aGlzLl96b29tICogZGVsdGFcbiAgICAgICwgbnogPSB0aGlzLl96b29tICsgbmV4dFxuICAgICAgLCBzY2FsZSA9IHRoaXMuX3pvb20gLyBuelxuICAgICAgLCBueCA9IHggLSB4IC8gc2NhbGVcbiAgICAgICwgbnkgPSB5IC0geSAvIHNjYWxlXG4gICAgdGhpcy5zZXRDb250YWluZXJQb3ModGhpcy54L3NjYWxlICsgbngsIHRoaXMueS9zY2FsZSArIG55KVxuICAgIHRoaXMuc2V0Q29udGFpbmVyWm9vbShueilcbiAgfSxcblxuICBzZXRDb250YWluZXJab29tOiBmdW5jdGlvbiAobnVtKSB7XG4gICAgdGhpcy5fem9vbSA9IG51bVxuICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLldlYmtpdFRyYW5zZm9ybSA9ICdzY2FsZSgnICsgbnVtICsgJyknXG4gICAgdGhpcy5jb250YWluZXIuc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKCcgKyBudW0gKyAnKSdcbiAgfSxcblxuICBzZXRDb250YWluZXJQb3M6IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgdGhpcy54ID0geFxuICAgIHRoaXMueSA9IHlcbiAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5sZWZ0ID0geCArICdweCdcbiAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS50b3AgPSB5ICsgJ3B4J1xuICB9LFxuXG4gIC8vIG90aGVyIHN0dWZmXG5cbiAgc3RvcE1vdmluZ0NoaWxkOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gVE9ETyBtb3ZlIGludG9cbiAgICB0aGlzLm1vdmluZy5oYW5kbGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLm1vdmluZy5oYW5kbGUpXG4gICAgdmFyIHBvcyA9IHRoaXMubW9kZWwuaWRzW3RoaXMucm9vdF0uY2hpbGRyZW4ubGVuZ3RoXG5cbiAgICBpZiAodGhpcy5tb3ZpbmcuY3VycmVudFRhcmdldCkge1xuICAgICAgdmFyIHBvcyA9IHRoaXMubW92aW5nLmN1cnJlbnRUYXJnZXQucG9zXG4gICAgICBpZiAodGhpcy5tb3ZpbmcuY3VycmVudFRhcmdldC5waWQgPT0gdGhpcy5tb3ZpbmcucGFyZW50X2lkKSB7XG4gICAgICAgIGlmIChwb3MgPiB0aGlzLm1vZGVsLmlkc1t0aGlzLm1vdmluZy5wYXJlbnRfaWRdLmNoaWxkcmVuLmluZGV4T2YodGhpcy5tb3ZpbmcuY2hpbGQpKSB7XG4gICAgICAgICAgcG9zIC09IDFcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5jdHJsYWN0aW9ucy5jb21tYW5kcygnbW92ZScsIFtcbiAgICAgICAgdGhpcy5tb3ZpbmcuY2hpbGQsXG4gICAgICAgIHRoaXMubW92aW5nLmN1cnJlbnRUYXJnZXQucGlkLFxuICAgICAgICBwb3NcbiAgICAgIF0sICdjaGFuZ2VOb2RlQXR0cicsIFtcbiAgICAgICAgdGhpcy5tb3ZpbmcuY2hpbGQsXG4gICAgICAgICd3aGl0ZWJvYXJkJyxcbiAgICAgICAgbnVsbFxuICAgICAgXSk7XG4gICAgfSBlbHNlIHtcblxuICAgICAgdGhpcy5jdHJsYWN0aW9ucy5jb21tYW5kcygnY2hhbmdlTm9kZUF0dHInLCBbXG4gICAgICAgIHRoaXMubW92aW5nLmNoaWxkLFxuICAgICAgICAnd2hpdGVib2FyZCcsXG4gICAgICAgIHt0b3A6IHRoaXMubW92aW5nLnksIGxlZnQ6IHRoaXMubW92aW5nLnh9XG4gICAgICBdLCAnbW92ZScsIFtcbiAgICAgICAgdGhpcy5tb3ZpbmcuY2hpbGQsXG4gICAgICAgIHRoaXMucm9vdCxcbiAgICAgICAgcG9zXG4gICAgICBdKVxuXG4gICAgfVxuXG4gICAgdGhpcy5pZHNbdGhpcy5tb3ZpbmcucGFyZW50X2lkXS5kb25lTW92aW5nKClcbiAgfSxcblxuICBzaG93RHJvcFNoYWRvdzogZnVuY3Rpb24gKHJlY3QpIHtcbiAgICB2YXIgYm94ID0gdGhpcy5ib2R5LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICAsIHJlYWxoZWlnaHQgPSByZWN0LmhlaWdodCAqIHRoaXMuX3pvb21cbiAgICAgICwgeW9mZiA9IChyZWN0LmhlaWdodCAtIHJlYWxoZWlnaHQpIC8gMlxuICAgIHRoaXMuZHJvcFNoYWRvdy5zdHlsZS50b3AgPSByZWN0LnRvcCAtIGJveC50b3AgKyB5b2ZmICsgJ3B4J1xuICAgIHRoaXMuZHJvcFNoYWRvdy5zdHlsZS5sZWZ0ID0gcmVjdC5sZWZ0IC0gYm94LmxlZnQgKyAncHgnXG4gICAgdGhpcy5kcm9wU2hhZG93LnN0eWxlLndpZHRoID0gcmVjdC53aWR0aCArICdweCdcbiAgICB0aGlzLmRyb3BTaGFkb3cuc3R5bGUuaGVpZ2h0ID0gcmVhbGhlaWdodCArICdweCdcbiAgICB0aGlzLmRyb3BTaGFkb3cuc3R5bGUuZGlzcGxheSA9ICdibG9jaydcbiAgfSxcblxuICBoaWRlRHJvcFNoYWRvdzogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZHJvcFNoYWRvdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnXG4gIH0sXG5cbiAgc3RvcE1vdmluZ01haW46IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmlkc1t0aGlzLm1vdmluZy5pZF0ucmVwb3NpdGlvbih0aGlzLm1vdmluZy5hdHgsIHRoaXMubW92aW5nLmF0eSlcbiAgICB0aGlzLmlkc1t0aGlzLm1vdmluZy5pZF0uZG9uZU1vdmluZygpXG4gICAgaWYgKHRoaXMubW92aW5nLmN1cnJlbnRUYXJnZXQpIHtcbiAgICAgIHRoaXMuY3RybGFjdGlvbnMuY29tbWFuZHMoJ21vdmUnLCBbXG4gICAgICAgIHRoaXMubW92aW5nLmlkLFxuICAgICAgICB0aGlzLm1vdmluZy5jdXJyZW50VGFyZ2V0LnBpZCxcbiAgICAgICAgdGhpcy5tb3ZpbmcuY3VycmVudFRhcmdldC5wb3NcbiAgICAgIF0sICdjaGFuZ2VOb2RlQXR0cicsIFtcbiAgICAgICAgdGhpcy5tb3ZpbmcuaWQsXG4gICAgICAgICd3aGl0ZWJvYXJkJyxcbiAgICAgICAgbnVsbFxuICAgICAgXSk7XG4gICAgfVxuICB9LFxuXG4gIHN0b3BNb3Zpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5tb3ZpbmcuY2hpbGQpIHtcbiAgICAgIHRoaXMuc3RvcE1vdmluZ0NoaWxkKClcbiAgICB9IGVsc2UgaWYgKHRoaXMubW92aW5nLmlkKSB7XG4gICAgICB0aGlzLnN0b3BNb3ZpbmdNYWluKClcbiAgICB9XG4gICAgaWYgKHRoaXMubW92aW5nLmN1cnJlbnRUYXJnZXQpIHtcbiAgICAgIHRoaXMuaGlkZURyb3BTaGFkb3coKVxuICAgIH1cbiAgICB0aGlzLm1vdmluZyA9IG51bGxcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9ib3VuZE1vdmUpXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuX2JvdW5kVXApXG4gICAgdGhpcy52bGluZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnXG4gICAgdGhpcy5obGluZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnXG4gICAgdGhpcy5yb290Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCd3aGl0ZWJvYXJkLS1tb3ZpbmcnKVxuICB9LFxuXG4gIGdldE5vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5yb290Tm9kZVxuICB9XG59XG5cbiIsIlxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGFkZFRhZzoge1xuICAgIGFyZ3M6IFsnbmFtZSddLFxuICAgIGFwcGx5OiBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcbiAgICAgIGlmICghbW9kZWwuaGFzVGFnUm9vdCgpKSB7XG4gICAgICAgIHZhciBjciA9IG1vZGVsLmFkZFRhZ1Jvb3QoKVxuICAgICAgICB0aGlzLnRhZ1Jvb3QgPSB2aWV3LmFkZChjci5ub2RlLCBjci5iZWZvcmUsIHRydWUpXG4gICAgICB9XG4gICAgICB2YXIgbnIgPSBtb2RlbC5hZGRUYWcodGhpcy5uYW1lKVxuICAgICAgdmlldy5hZGQobnIubm9kZSwgbnIuYmVmb3JlLCB0cnVlKVxuICAgICAgdGhpcy5ub2RlID0gbnIubm9kZVxuICAgICAgcmV0dXJuIHRoaXMubm9kZVxuICAgIH0sXG4gICAgdW5kbzogZnVuY3Rpb24gKHZpZXcsIG1vZGVsKSB7XG4gICAgICBtb2RlbC5yZW1vdmUodGhpcy5ub2RlLmlkKVxuICAgICAgaWYgKHRoaXMudGFnUm9vdCkge1xuICAgICAgICBtb2RlbC5yZW1vdmVUYWdSb290KClcbiAgICAgICAgdmlldy5yZW1vdmUodGhpcy50YWdSb290Lm5vZGUuaWQpXG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZXRUYWdzOiB7XG4gICAgYXJnczogWydpZCcsICd0YWdzJ10sXG4gICAgYXBwbHk6IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuICAgICAgdGhpcy5vbGRUYWdzID0gbW9kZWwuc2V0VGFncyh0aGlzLmlkLCB0aGlzLnRhZ3MpXG4gICAgICB2aWV3LnNldFRhZ3ModGhpcy5pZCwgdGhpcy50YWdzLCB0aGlzLm9sZFRhZ3MpXG4gICAgfSxcbiAgICB1bmRvOiBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcbiAgICAgIG1vZGVsLnNldFRhZ3ModGhpcy5pZCwgdGhpcy5vbGRUYWdzKVxuICAgICAgdmlldy5zZXRUYWdzKHRoaXMuaWQsIHRoaXMub2xkVGFncywgdGhpcy50YWdzKVxuICAgIH0sXG4gIH0sXG59XG5cbiIsIlxudmFyIENvbnRyb2xsZXIgPSByZXF1aXJlKCcuLi8uLi9saWIvY29udHJvbGxlcicpXG4gICwgdXRpbCA9IHJlcXVpcmUoJy4uLy4uL2xpYi91dGlsJylcblxuICAsIFdGTm9kZSA9IHJlcXVpcmUoJy4vbm9kZScpXG4gICwgV0ZWaWV3ID0gcmVxdWlyZSgnLi92aWV3JylcbiAgLCBXRlZMID0gcmVxdWlyZSgnLi92bCcpXG4gICwgY29tbWFuZHMgPSByZXF1aXJlKCcuL2NvbW1hbmRzJylcblxubW9kdWxlLmV4cG9ydHMgPSBXRkNvbnRyb2xsZXJcblxuZnVuY3Rpb24gV0ZDb250cm9sbGVyKG1vZGVsLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMuZXh0cmFfY29tbWFuZHMgPSB1dGlsLmV4dGVuZChvcHRpb25zLmV4dHJhX2NvbW1hbmRzIHx8IHt9LCBjb21tYW5kcylcbiAgQ29udHJvbGxlci5jYWxsKHRoaXMsIG1vZGVsLCBvcHRpb25zKVxuICB0aGlzLm9uKCdyZWJhc2UnLCBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIHRoaXMudHJpZ2dlcignYnVsbGV0JywgdGhpcy5tb2RlbC5nZXRMaW5lYWdlKGlkKSlcbiAgfS5iaW5kKHRoaXMpKVxufVxuXG5XRkNvbnRyb2xsZXIucHJvdG90eXBlID0gdXRpbC5leHRlbmQoT2JqZWN0LmNyZWF0ZShDb250cm9sbGVyLnByb3RvdHlwZSksIHtcbiAgcmVmcmVzaEJ1bGxldDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudHJpZ2dlcignYnVsbGV0JywgdGhpcy5tb2RlbC5nZXRMaW5lYWdlKHRoaXMubW9kZWwucm9vdCkpXG4gIH1cbn0pXG5cbldGQ29udHJvbGxlci5wcm90b3R5cGUuYWN0aW9ucyA9IHV0aWwuZXh0ZW5kKHtcbiAgY2xpY2tCdWxsZXQ6IGZ1bmN0aW9uIChpZCkge1xuICAgIGlmIChpZCA9PT0gJ25ldycpIHJldHVyblxuICAgIHRoaXMudmlldy5yZWJhc2UoaWQpXG4gICAgLy8gdGhpcy50cmlnZ2VyKCdidWxsZXQnLCB0aGlzLm1vZGVsLmdldExpbmVhZ2UoaWQpKVxuICB9LFxuICByZWJhc2U6IGZ1bmN0aW9uIChpZCwgdG9pZCkge1xuICAgIHRoaXMudmlldy5yZWJhc2UodG9pZClcbiAgfSxcbiAgYmFja0FMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgIHZhciByb290ID0gdGhpcy52aWV3LnJvb3RcbiAgICAgICwgcGlkID0gdGhpcy5tb2RlbC5pZHNbcm9vdF0ucGFyZW50XG4gICAgaWYgKCF0aGlzLm1vZGVsLmlkc1twaWRdKSByZXR1cm5cbiAgICB0aGlzLmFjdGlvbnMuY2xpY2tCdWxsZXQocGlkKVxuICB9LFxuICBzZXRUYWdzOiBmdW5jdGlvbiAoaWQsIGlkcykge1xuICAgIHRoaXMuZXhlY3V0ZUNvbW1hbmRzKCdzZXRUYWdzJywgW2lkLCBpZHNdKVxuICB9LFxuICBhZGRUYWc6IGZ1bmN0aW9uIChpZCwgY29udGVudHMpIHtcbiAgICByZXR1cm4gdGhpcy5leGVjdXRlQ29tbWFuZHMoJ2FkZFRhZycsIFtjb250ZW50c10pWzBdO1xuICB9LFxufSwgQ29udHJvbGxlci5wcm90b3R5cGUuYWN0aW9ucylcblxuIiwiXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgQ29udHJvbGxlcjogcmVxdWlyZSgnLi9jb250cm9sbGVyJyksXG4gIE1vZGVsOiByZXF1aXJlKCcuL21vZGVsJyksXG4gIE5vZGU6IHJlcXVpcmUoJy4vbm9kZScpLFxuICBWaWV3OiByZXF1aXJlKCcuL3ZpZXcnKSxcbiAgVmlld0xheWVyOiByZXF1aXJlKCcuL3ZsJyksXG59XG5cbiIsIlxudmFyIE1vZGVsID0gcmVxdWlyZSgnLi4vLi4vbGliL21vZGVsJylcblxubW9kdWxlLmV4cG9ydHMgPSBXRk1vZGVsXG5cbmZ1bmN0aW9uIFdGTW9kZWwoKSB7XG4gIE1vZGVsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcbn1cblxuV0ZNb2RlbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKE1vZGVsLnByb3RvdHlwZSlcblxuV0ZNb2RlbC5wcm90b3R5cGUuYWN0aW9ucyA9IHtcbiAgcmVzb2x2ZVRhZ3M6IGZ1bmN0aW9uICh0YWdzKSB7XG4gICAgaWYgKCF0YWdzKSByZXR1cm4gW11cbiAgICByZXR1cm4gdGFncy5tYXAoZnVuY3Rpb24gKGlkKSB7XG4gICAgICByZXR1cm4gdGhpcy5pZHNbaWRdXG4gICAgfS5iaW5kKHRoaXMpKVxuICB9LFxuICBnZXRBbGxUYWdzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRhZ3MgPSBbXVxuICAgIGZvciAodmFyIGlkIGluIHRoaXMuaWRzKSB7XG4gICAgICB0YWdzLnB1c2godGhpcy5pZHNbaWRdKVxuICAgIH1cbiAgICAvLyB0b2RvIHNvcnQgYnkgbnVtYmVyIG9mIHJlZmVyZW5jZXNcbiAgICByZXR1cm4gdGFnc1xuICB9XG59XG5cbldGTW9kZWwucHJvdG90eXBlLmhhc1RhZ1Jvb3QgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiAhIXRoaXMucm9vdE5vZGUudGFnUm9vdFxufVxuXG5XRk1vZGVsLnByb3RvdHlwZS5hZGRUYWdSb290ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgaW5kZXggPSB0aGlzLmlkc1t0aGlzLnJvb3RdLmNoaWxkcmVuID8gdGhpcy5pZHNbdGhpcy5yb290XS5jaGlsZHJlbi5sZW5ndGggOiAwXG4gIHZhciBjciA9IG1vZGVsLmNyZWF0ZSh0aGlzLnJvb3QsIGluZGV4LCAnVGFncycpXG4gIHRoaXMucm9vdE5vZGUudGFnUm9vdCA9IGNyLm5vZGUuaWRcbiAgdGhpcy5kYi51cGRhdGUoJ3Jvb3QnLCB0aGlzLnJvb3QsIHt0YWdSb290OiBjci5ub2RlLmlkfSlcbiAgcmV0dXJuIGNyXG59XG5cbldGTW9kZWwucHJvdG90eXBlLmFkZFRhZyA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gIHZhciB0YWdSb290ID0gdGhpcy5yb290Tm9kZS50YWdSb290XG4gIHZhciBpbmRleCA9IHRoaXMuaWRzW3RhZ1Jvb3RdLmNoaWxkcmVuID8gdGhpcy5pZHNbdGFnUm9vdF0uY2hpbGRyZW4ubGVuZ3RoIDogMFxuICB2YXIgY3IgPSBtb2RlbC5jcmVhdGUodGFnUm9vdCwgaW5kZXgsIG5hbWUpXG4gIHJldHVybiBjclxufVxuXG5XRk1vZGVsLnByb3RvdHlwZS5yZWFkZCA9IGZ1bmN0aW9uIChzYXZlZCkge1xuICB0aGlzLmlkc1tzYXZlZC5pZF0gPSBzYXZlZC5ub2RlXG4gIHZhciBjaGlsZHJlbiA9IHRoaXMuaWRzW3NhdmVkLm5vZGUucGFyZW50XS5jaGlsZHJlblxuICBjaGlsZHJlbi5zcGxpY2Uoc2F2ZWQuaXgsIDAsIHNhdmVkLmlkKVxuICB2YXIgYmVmb3JlID0gZmFsc2VcbiAgaWYgKHNhdmVkLml4IDwgY2hpbGRyZW4ubGVuZ3RoIC0gMSkge1xuICAgIGJlZm9yZSA9IGNoaWxkcmVuW3NhdmVkLml4ICsgMV1cbiAgfVxuXG4gIHZhciB1cFJlZnMgPSB7fVxuICB2YXIgdXBUYWdzID0ge31cbiAgdmFyIGlkcyA9IHRoaXMuaWRzXG5cbiAgZnVuY3Rpb24gcHJvY2Vzcyhub2RlKSB7XG4gICAgZm9yICh2YXIgaT0wOyBpPG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHByb2Nlc3MoaWRzW25vZGUuY2hpbGRyZW5baV1dKVxuICAgIH1cblxuICAgIGlmIChub2RlLm1ldGEudGFncykge1xuICAgICAgbm9kZS5tZXRhLnRhZ3MuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIHJlZnMgPSBpZHNbaWRdLm1ldGEucmVmZXJlbmNlc1xuICAgICAgICBpZiAoIXJlZnMpIHtcbiAgICAgICAgICByZWZzID0gaWRzW2lkXS5tZXRhLnJlZmVyZW5jZXMgPSBbXVxuICAgICAgICB9XG4gICAgICAgIGlmIChyZWZzLmluZGV4T2Yobm9kZS5pZCkgIT09IC0xKSByZXR1cm4gY29uc29sZS53YXJuKCdkdXBsaWNhdGUgcmVmIG9uIHJlYWRkJylcbiAgICAgICAgcmVmcy5wdXNoKG5vZGUuaWQpXG4gICAgICAgIHVwUmVmc1tpZF0gPSB0cnVlXG4gICAgICB9KVxuICAgIH1cblxuICAgIGlmIChub2RlLm1ldGEucmVmZXJlbmNlcykge1xuICAgICAgbm9kZS5tZXRhLnJlZmVyZW5jZXMuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgaWRzW2lkXS5tZXRhLnRhZ3MucHVzaChub2RlLmlkKVxuICAgICAgICB2YXIgdGFncyA9IGlkc1tpZF0ubWV0YS50YWdzXG4gICAgICAgIGlmICghdGFncykge1xuICAgICAgICAgIHRhZ3MgPSBpZHNbaWRdLm1ldGEudGFncyA9IFtdXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhZ3MuaW5kZXhPZihub2RlLmlkKSAhPT0gLTEpIHJldHVybiBjb25zb2xlLndhcm4oJ2R1cGxpY2F0ZSB0YWcgb24gcmVhZGQnKVxuICAgICAgICB0YWdzLnB1c2gobm9kZS5pZClcbiAgICAgICAgdXBUYWdzW2lkXSA9IHRydWVcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgcHJvY2Vzcyh0aGlzLmlkc1tzYXZlZC5pZF0pXG5cbiAgdGhpcy5kYi5zYXZlKCdub2RlJywgc2F2ZWQubm9kZS5pZCwgc2F2ZWQubm9kZSlcbiAgdGhpcy5kYi51cGRhdGUoJ25vZGUnLCBzYXZlZC5ub2RlLnBhcmVudCwge2NoaWxkcmVuOiBjaGlsZHJlbn0pXG5cbiAgZm9yIChpZCBpbiB1cFRhZ3MpIHtcbiAgICB0aGlzLmRiLnVwZGF0ZSgnbm9kZScsIGlkLCB7dGFnczogdGhpcy5pZHNbaWRdLnRhZ3N9KVxuICB9XG5cbiAgZm9yIChpZCBpbiB1cFJlZnMpIHtcbiAgICB0aGlzLmRiLnVwZGF0ZSgnbm9kZScsIGlkLCB7cmVmZXJlbmNlczogdGhpcy5pZHNbaWRdLnJlZmVyZW5jZXN9KVxuICB9XG5cbiAgcmV0dXJuIGJlZm9yZVxufVxuXG5XRk1vZGVsLnByb3RvdHlwZS5kdW1wRGF0YSA9IGZ1bmN0aW9uIChpZCwgbm9pZHMpIHtcbiAgdmFyIGRhdGEgPSBNb2RlbC5wcm90b3R5cGUuZHVtcERhdGEuY2FsbCh0aGlzLCBpZCwgbm9pZHMpXG4gIGlmICghbm9pZHMpIHJldHVybiBkYXRhXG4gIGRlbGV0ZSBkYXRhLm1ldGEucmVmZXJlbmNlc1xuICBkZWxldGUgZGF0YS5tZXRhLnRhZ3NcbiAgcmV0dXJuIGRhdGFcbn1cblxuV0ZNb2RlbC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGlkKSB7XG4gIC8vIHJlbW92ZSB0aGUgcmVmZXJlbmNlcyBhbmQgdGFnc1xuXG4gIGlmIChpZCA9PT0gdGhpcy5yb290KSByZXR1cm5cbiAgdmFyIG4gPSB0aGlzLmlkc1tpZF1cbiAgICAsIHAgPSB0aGlzLmlkc1tuLnBhcmVudF1cbiAgICAsIGl4ID0gcC5jaGlsZHJlbi5pbmRleE9mKGlkKVxuXG4gIHZhciB1cFJlZnMgPSB7fVxuICB2YXIgdXBUYWdzID0ge31cbiAgdmFyIGlkcyA9IHRoaXMuaWRzXG4gIHZhciByZW1vdmVkID0gW11cblxuICBmdW5jdGlvbiBwcm9jZXNzKG5vZGUpIHtcbiAgICBpZiAobm9kZS5tZXRhLnRhZ3MpIHtcbiAgICAgIG5vZGUubWV0YS50YWdzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciByZWZzID0gaWRzW2lkXS5tZXRhLnJlZmVyZW5jZXNcbiAgICAgICAgdXBSZWZzW2lkXSA9IHRydWVcbiAgICAgICAgcmVmcy5zcGxpY2UocmVmcy5pbmRleE9mKG5vZGUuaWQpLCAxKVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBpZiAobm9kZS5tZXRhLnJlZmVyZW5jZXMpIHtcbiAgICAgIG5vZGUubWV0YS5yZWZlcmVuY2VzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciB0YWdzID0gaWRzW2lkXS5tZXRhLnRhZ3NcbiAgICAgICAgdXBUYWdzW2lkXSA9IHRydWVcbiAgICAgICAgdGFncy5zcGxpY2UodGFncy5pbmRleE9mKG5vZGUuaWQpLCAxKVxuICAgICAgfSlcbiAgICB9XG4gICAgZm9yICh2YXIgaT0wOyBpPG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHByb2Nlc3MoaWRzW25vZGUuY2hpbGRyZW5baV1dKVxuICAgIH1cblxuICAgIGRlbGV0ZSBpZHNbbm9kZS5pZF1cbiAgICByZW1vdmVkLnB1c2gobm9kZS5pZClcbiAgfVxuXG4gIHByb2Nlc3MobilcblxuICBwLmNoaWxkcmVuLnNwbGljZShpeCwgMSlcbiAgZGVsZXRlIHRoaXMuaWRzW2lkXVxuXG4gIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZGIucmVtb3ZlQmF0Y2goJ25vZGUnLCByZW1vdmVkKVxuICAgIHRoaXMuZGIudXBkYXRlKCdub2RlJywgbi5wYXJlbnQsIHtjaGlsZHJlbjogcC5jaGlsZHJlbn0pXG5cblxuICAgIGlmIChpZCA9PT0gdGhpcy5yb290Tm9kZS50YWdSb290KSB7XG4gICAgICBkZWxldGUgdGhpcy5yb290Tm9kZS50YWdSb290XG4gICAgICB0aGlzLmRiLnVwZGF0ZSgncm9vdCcsIHRoaXMucm9vdCwge3RhZ1Jvb3Q6IG51bGx9KVxuICAgIH1cblxuICAgIGZvciAoaWQgaW4gdXBUYWdzKSB7XG4gICAgICBpZiAodGhpcy5pZHNbaWRdKSB7XG4gICAgICAgIHRoaXMuZGIudXBkYXRlKCdub2RlJywgaWQsIHt0YWdzOiB0aGlzLmlkc1tpZF0ubWV0YS50YWdzfSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKGlkIGluIHVwUmVmcykge1xuICAgICAgaWYgKHRoaXMuaWRzW2lkXSkge1xuICAgICAgICB0aGlzLmRiLnVwZGF0ZSgnbm9kZScsIGlkLCB7cmVmZXJlbmNlczogdGhpcy5pZHNbaWRdLm1ldGEucmVmZXJlbmNlc30pXG4gICAgICB9XG4gICAgfVxuICB9LmJpbmQodGhpcykpXG5cbiAgcmV0dXJuIHtpZDogaWQsIG5vZGU6IG4sIGl4OiBpeH1cbn1cblxuLy8gVE9ETyBzaG91bGQgSSBtYWtlIHJlZmVyZW5jZXMgYmUgYSBkaWN0IGluc3RlYWQ/XG5XRk1vZGVsLnByb3RvdHlwZS5zZXRUYWdzID0gZnVuY3Rpb24gKGlkLCB0YWdzKSB7XG4gIHZhciBvbGQgPSB0aGlzLmlkc1tpZF0ubWV0YS50YWdzXG4gIHZhciB1c2VkID0ge31cbiAgaWYgKG9sZCkgb2xkID0gb2xkLnNsaWNlKClcblxuICAvLyBhZGQgcmVmZXJlbmNlc1xuICBpZiAodGFncykge1xuICAgIGZvciAodmFyIGk9MDsgaTx0YWdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB1c2VkW3RhZ3NbaV1dID0gdHJ1ZVxuICAgICAgdmFyIHJlZnMgPSB0aGlzLmlkc1t0YWdzW2ldXS5tZXRhLnJlZmVyZW5jZXNcbiAgICAgIGlmICghcmVmcykge1xuICAgICAgICByZWZzID0gdGhpcy5pZHNbdGFnc1tpXV0ubWV0YS5yZWZlcmVuY2VzID0gW11cbiAgICAgIH1cbiAgICAgIGlmIChyZWZzLmluZGV4T2YoaWQpID09PSAtMSkge1xuICAgICAgICByZWZzLnB1c2goaWQpXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gcmVtb3ZlIG9sZCByZWZlcmVuY2VzIHRoYXQgd2VyZSByZW1vdmVkXG4gIGlmIChvbGQpIHtcbiAgICBmb3IgKHZhciBpPTA7IGk8b2xkLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAodXNlZFtvbGRbaV1dKSBjb250aW51ZTtcbiAgICAgIHZhciByZWZzID0gdGhpcy5pZHNbb2xkW2ldXS5tZXRhLnJlZmVyZW5jZXNcbiAgICAgIHJlZnMuc3BsaWNlKHJlZnMuaW5kZXhPZihpZCksIDEpXG4gICAgICB1c2VkW29sZFtpXV0gPSB0cnVlXG4gICAgfVxuICB9XG5cbiAgdGhpcy5pZHNbaWRdLm1ldGEudGFncyA9IHRhZ3NcbiAgLy8gdXBkYXRlIHRoaW5nc1xuICB0aGlzLmRiLnVwZGF0ZShpZCwge21ldGE6IHRoaXMuaWRzW2lkXS5tZXRhfSlcbiAgZm9yICh2YXIgb2lkIGluIHVzZWQpIHtcbiAgICB0aGlzLmRiLnVwZGF0ZShvaWQsIHttZXRhOiB0aGlzLmlkc1tvaWRdLm1ldGF9KVxuICB9XG4gIHJldHVybiBvbGRcbn1cblxuV0ZNb2RlbC5wcm90b3R5cGUuZ2V0TGluZWFnZSA9IGZ1bmN0aW9uIChpZCkge1xuICB2YXIgbGluZWFnZSA9IFtdXG4gIHdoaWxlICh0aGlzLmlkc1tpZF0pIHtcbiAgICBsaW5lYWdlLnVuc2hpZnQoe1xuICAgICAgY29udGVudDogdGhpcy5pZHNbaWRdLmNvbnRlbnQsXG4gICAgICBpZDogaWRcbiAgICB9KVxuICAgIGlkID0gdGhpcy5pZHNbaWRdLnBhcmVudFxuICB9XG4gIHJldHVybiBsaW5lYWdlXG59XG5cbldGTW9kZWwucHJvdG90eXBlLnNlYXJjaCA9IGZ1bmN0aW9uICh0ZXh0KSB7XG4gIHZhciBpdGVtcyA9IFtdXG4gICAgLCBmcm9udGllciA9IFt0aGlzLnJvb3RdXG4gIHRleHQgPSB0ZXh0LnRvTG93ZXJDYXNlKClcbiAgd2hpbGUgKGZyb250aWVyLmxlbmd0aCkge1xuICAgICAgdmFyIG5leHQgPSBbXVxuICAgICAgZm9yICh2YXIgaT0wOyBpPGZyb250aWVyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIGNvbnRlbnQgPSB0aGlzLmlkc1tmcm9udGllcltpXV0uY29udGVudFxuICAgICAgICAgIGlmIChjb250ZW50ICYmIGNvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRleHQpICE9PSAtMSkge1xuICAgICAgICAgICAgaXRlbXMucHVzaCh7aWQ6IGZyb250aWVyW2ldLCB0ZXh0OiB0aGlzLmlkc1tmcm9udGllcltpXV0uY29udGVudH0pXG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuaWRzW2Zyb250aWVyW2ldXS5jaGlsZHJlblxuICAgICAgICAgIGlmIChjaGlsZHJlbikge1xuICAgICAgICAgICAgbmV4dCA9IG5leHQuY29uY2F0KGNoaWxkcmVuKVxuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZyb250aWVyID0gbmV4dFxuICB9XG4gIHJldHVybiBpdGVtc1xufVxuXG4iLCJcbnZhciBEZWZhdWx0Tm9kZSA9IHJlcXVpcmUoJy4uLy4uL2xpYi9kZWZhdWx0LW5vZGUnKVxudmFyIFRhZ3MgPSByZXF1aXJlKCcuL3RhZ3MnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IFdGTm9kZVxuXG5mdW5jdGlvbiBXRk5vZGUoY29udGVudCwgbWV0YSwgYWN0aW9ucywgaXNOZXcsIG1vZGVsQWN0aW9ucykge1xuICBEZWZhdWx0Tm9kZS5jYWxsKHRoaXMsIGNvbnRlbnQsIG1ldGEsIGFjdGlvbnMsIGlzTmV3LCBtb2RlbEFjdGlvbnMpXG4gIHRoaXMuZG9uZSA9IG1ldGEuZG9uZVxuICB0aGlzLnRhZ3MgPSBuZXcgVGFncyhtb2RlbEFjdGlvbnMucmVzb2x2ZVRhZ3MobWV0YS50YWdzKSwgYWN0aW9ucywgbW9kZWxBY3Rpb25zKVxuICB0aGlzLm5vZGUuYXBwZW5kQ2hpbGQodGhpcy50YWdzLm5vZGUpXG4gIGlmIChtZXRhLmRvbmUpIHtcbiAgICB0aGlzLm5vZGUuY2xhc3NMaXN0LmFkZCgndHJlZWRfX2RlZmF1bHQtbm9kZS0tZG9uZScpXG4gIH1cbn1cblxuV0ZOb2RlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRGVmYXVsdE5vZGUucHJvdG90eXBlKVxuV0ZOb2RlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFdGTm9kZVxuXG5XRk5vZGUucHJvdG90eXBlLnNldEF0dHIgPSBmdW5jdGlvbiAoYXR0ciwgdmFsdWUpIHtcbiAgaWYgKGF0dHIgPT09ICd0YWdzJykge1xuICAgIHJldHVybiB0aGlzLnNldFRhZ3ModmFsdWUpXG4gIH1cbiAgaWYgKGF0dHIgPT09ICdkb25lJykge1xuICAgIHJldHVybiB0aGlzLnNldERvbmUodmFsdWUpXG4gIH1cbiAgRGVmYXVsdE5vZGUucHJvdG90eXBlLnNldEF0dHIuY2FsbCh0aGlzLCBhdHRyLCB2YWx1ZSlcbn1cblxuV0ZOb2RlLnByb3RvdHlwZS5hZGRUYWcgPSBmdW5jdGlvbiAobm9kZSkge1xuICB0aGlzLnRhZ3MuYWRkKG5vZGUpXG59XG5cbldGTm9kZS5wcm90b3R5cGUucmVtb3ZlVGFnID0gZnVuY3Rpb24gKHRpZCkge1xuICB0aGlzLnRhZ3MucmVtb3ZlRnVsbCh0aWQpXG59XG5cbldGTm9kZS5wcm90b3R5cGUuc2V0VGFncyA9IGZ1bmN0aW9uICh0YWdzKSB7XG4gIHRoaXMudGFncy5zZXQodGhpcy5tb2RlbEFjdGlvbnMucmVzb2x2ZVRhZ3ModGFncykpXG59XG5cbldGTm9kZS5wcm90b3R5cGUuc2V0RG9uZSA9IGZ1bmN0aW9uIChpc0RvbmUpIHtcbiAgdGhpcy5kb25lID0gaXNEb25lXG4gIGlmIChpc0RvbmUpIHtcbiAgICB0aGlzLm5vZGUuY2xhc3NMaXN0LmFkZCgndHJlZWRfX2RlZmF1bHQtbm9kZS0tZG9uZScpXG4gIH0gZWxzZSB7XG4gICAgdGhpcy5ub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ3RyZWVkX19kZWZhdWx0LW5vZGUtLWRvbmUnKVxuICB9XG59XG5cbldGTm9kZS5wcm90b3R5cGUuZXh0cmFfYWN0aW9ucyA9IHtcbiAgJ3JlYmFzZSc6IHtcbiAgICBiaW5kaW5nOiAnYWx0K3JldHVybicsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm8uY2xpY2tCdWxsZXQoKVxuICAgIH1cbiAgfSxcbiAgJ2JhY2sgYSBsZXZlbCc6IHtcbiAgICBiaW5kaW5nOiAnc2hpZnQrYWx0K3JldHVybicsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm8uYmFja0FMZXZlbCgpXG4gICAgfVxuICB9LFxuICAndG9nZ2xlIGRvbmUnOiB7XG4gICAgYmluZGluZzogJ2N0cmwrcmV0dXJuJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuYmx1cigpXG4gICAgICB0aGlzLm8uY2hhbmdlZCgnZG9uZScsICF0aGlzLmRvbmUpXG4gICAgICB0aGlzLmZvY3VzKClcbiAgICAgIGlmICh0aGlzLmRvbmUpIHtcbiAgICAgICAgdGhpcy5vLmdvRG93bigpXG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbiIsIlxubW9kdWxlLmV4cG9ydHMgPSBUYWdzXG5cbmZ1bmN0aW9uIFRhZ3ModGFncywgYWN0aW9ucywgbW9kZWxhY3Rpb25zKSB7XG4gIHRoaXMuYWN0aW9ucyA9IGFjdGlvbnNcbiAgdGhpcy5tb2RlbGFjdGlvbnMgPSBtb2RlbGFjdGlvbnNcbiAgdGhpcy5zZXR1cE5vZGUoKVxuICB0aGlzLnNldCh0YWdzKVxufVxuXG5UYWdzLnByb3RvdHlwZSA9IHtcbiAgc2V0dXBOb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5ub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLm5vZGUuY2xhc3NOYW1lID0gJ3RyZWVkX3RhZ3MnXG5cbiAgICB0aGlzLmhhbmRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy5oYW5kbGUuY2xhc3NOYW1lID0gJ3RyZWVkX3RhZ3NfaGFuZGxlJ1xuICAgIHRoaXMuaGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5zdGFydEVkaXRpbmcuYmluZCh0aGlzKSlcbiAgICB0aGlzLmhhbmRsZS5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJmYSBmYS10YWdcIi8+J1xuXG4gICAgdGhpcy50YWdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLnRhZ3MuY2xhc3NOYW1lID0gJ3RyZWVkX3RhZ3NfbGlzdCdcblxuICAgIHRoaXMuZWRpdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLmVkaXRvci5jbGFzc05hbWUgPSAndHJlZWRfdGFnc19lZGl0b3InXG5cbiAgICB0aGlzLmlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKVxuICAgIHRoaXMuaW5wdXQuY2xhc3NOYW1lID0gJ3RyZWVkX3RhZ3NfaW5wdXQnXG5cbiAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmtleURvd24uYmluZCh0aGlzKSlcbiAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5rZXlVcC5iaW5kKHRoaXMpKVxuICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMub25CbHVyLmJpbmQodGhpcykpXG5cbiAgICB0aGlzLnJlc3VsdHNOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKVxuICAgIHRoaXMucmVzdWx0c05vZGUuY2xhc3NOYW1lID0gJ3RyZWVkX3RhZ3NfcmVzdWx0cydcbiAgICB0aGlzLnRhZ3MuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHtlLnByZXZlbnREZWZhdWx0KCl9KVxuICAgIHRoaXMucmVzdWx0c05vZGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHtlLnByZXZlbnREZWZhdWx0KCl9KVxuXG4gICAgdGhpcy5uZXdOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLm5ld05vZGUuY2xhc3NOYW1lID0gJ3RyZWVkX3RhZ3NfbmV3J1xuICAgIHRoaXMubmV3Tm9kZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkge2UucHJldmVudERlZmF1bHQoKX0pXG4gICAgdGhpcy5uZXdOb2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbk5ldy5iaW5kKHRoaXMpKVxuICAgIHRoaXMubmV3Tm9kZS5pbm5lclRleHQgPSAnQ3JlYXRlIG5ldyB0YWcnXG5cbiAgICB0aGlzLm5vZGUuYXBwZW5kQ2hpbGQodGhpcy50YWdzKVxuICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZCh0aGlzLmhhbmRsZSlcbiAgICB0aGlzLm5vZGUuYXBwZW5kQ2hpbGQodGhpcy5lZGl0b3IpXG5cbiAgICB0aGlzLmVkaXRvci5hcHBlbmRDaGlsZCh0aGlzLmlucHV0KVxuICAgIHRoaXMuZWRpdG9yLmFwcGVuZENoaWxkKHRoaXMucmVzdWx0c05vZGUpXG4gICAgdGhpcy5lZGl0b3IuYXBwZW5kQ2hpbGQodGhpcy5uZXdOb2RlKVxuXG4gICAgdGhpcy5kb20gPSB7fVxuICB9LFxuXG4gIHN0YXJ0RWRpdGluZzogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAodGhpcy5lZGl0aW5nKSByZXR1cm5cbiAgICB0aGlzLmFjdGlvbnMuc2V0QWN0aXZlKClcbiAgICB0aGlzLmVkaXRpbmcgPSB0cnVlXG4gICAgdGhpcy5ub2RlLmNsYXNzTGlzdC5hZGQoJ3RyZWVkX3RhZ3MtLW9wZW4nKVxuICAgIHRoaXMuZnVsbFJlc3VsdHMgPSB0aGlzLm1vZGVsYWN0aW9ucy5nZXRBbGxUYWdzKClcbiAgICB0aGlzLmZpbHRlckJ5KCcnKVxuICAgIHRoaXMuc2VsZWN0aW9uID0gMFxuICAgIHRoaXMuaW5wdXQudmFsdWUgPSAnJ1xuICAgIHRoaXMuaW5wdXQuZm9jdXMoKVxuICAgIHRoaXMuc2hvd1Jlc3VsdHMoKVxuICAgIC8vIHRvZG8gc2hvdyBldmVyeXRoaW5nIGZpcnN0PyBJIHRoaW5rIEknbGwgd2FpdCBmb3IgZmlyc3Qga2V5IGNoYW5nZVxuICB9LFxuXG4gIGRvbmVFZGl0aW5nOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmICghdGhpcy5lZGl0aW5nKSByZXR1cm5cbiAgICB0aGlzLmVkaXRpbmcgPSBmYWxzZVxuICAgIHRoaXMubm9kZS5jbGFzc0xpc3QucmVtb3ZlKCd0cmVlZF90YWdzLS1vcGVuJylcbiAgICB0aGlzLmFjdGlvbnMuc2V0VGFncyh0aGlzLnZhbHVlLm1hcChmdW5jdGlvbiAoeCl7IHJldHVybiB4LmlkIH0pKVxuICB9LFxuXG4gIG9uQmx1cjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZG9uZUVkaXRpbmcoKVxuICB9LFxuXG4gIGtleXM6IHtcbiAgICAyNzogZnVuY3Rpb24gKGUpIHsgLy8gZXNjYXBlXG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIHRoaXMuZG9uZUVkaXRpbmcoKVxuICAgIH0sXG4gICAgOTogZnVuY3Rpb24gKGUpIHsgLy8gdGFiXG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIHRoaXMuYWRkQ3VycmVudCgpXG4gICAgfSxcbiAgICAxMzogZnVuY3Rpb24gKGUpIHsgLy8gcmV0dXJuXG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIHRoaXMuYWRkQ3VycmVudCgpXG4gICAgICB0aGlzLmRvbmVFZGl0aW5nKClcbiAgICB9LFxuICAgIDg6IGZ1bmN0aW9uIChlKSB7IC8vIGJhY2tzcGFjZVxuICAgICAgaWYgKCF0aGlzLmlucHV0LnZhbHVlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICB0aGlzLnJlbW92ZUxhc3QoKVxuICAgICAgfVxuICAgIH0sXG4gIH0sXG5cbiAga2V5RG93bjogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgYWN0aW9uID0gdGhpcy5rZXlzW2Uua2V5Q29kZV1cbiAgICBpZiAoYWN0aW9uKSByZXR1cm4gYWN0aW9uLmNhbGwodGhpcywgZSlcbiAgfSxcblxuICBrZXlVcDogZnVuY3Rpb24gKGUpIHtcbiAgICB0aGlzLmZpbHRlckJ5KHRoaXMuaW5wdXQudmFsdWUpXG4gICAgdGhpcy5zaG93UmVzdWx0cygpXG4gIH0sXG5cbiAgZmlsdGVyQnk6IGZ1bmN0aW9uIChuZWVkbGUpIHtcbiAgICB2YXIgdXNlZCA9IHt9XG4gICAgZm9yICh2YXIgaT0wOyBpPHRoaXMudmFsdWUubGVuZ3RoOyBpKyspIHtcbiAgICAgIHVzZWRbdGhpcy52YWx1ZVtpXS5pZF0gPSB0cnVlXG4gICAgfVxuICAgIGlmICghbmVlZGxlKSB7XG4gICAgICB0aGlzLnJlc3VsdHMgPSB0aGlzLmZ1bGxSZXN1bHRzLmZpbHRlcihmdW5jdGlvbiAodGFnKSB7XG4gICAgICAgIHJldHVybiAhdXNlZFt0YWcuaWRdXG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICBuZWVkbGUgPSBuZWVkbGUudG9Mb3dlckNhc2UoKVxuICAgICAgdGhpcy5yZXN1bHRzID0gdGhpcy5mdWxsUmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24gKHRhZykge1xuICAgICAgICByZXR1cm4gIXVzZWRbdGFnLmlkXSAmJiB0YWcuY29udGVudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YobmVlZGxlKSAhPT0gLTFcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIHNob3dSZXN1bHRzOiBmdW5jdGlvbiAoKSB7XG4gICAgd2hpbGUgKHRoaXMucmVzdWx0c05vZGUubGFzdENoaWxkKSB7XG4gICAgICB0aGlzLnJlc3VsdHNOb2RlLnJlbW92ZUNoaWxkKHRoaXMucmVzdWx0c05vZGUubGFzdENoaWxkKVxuICAgIH1cbiAgICB2YXIgbnVtID0gNVxuICAgIGlmIChudW0gPiB0aGlzLnJlc3VsdHMubGVuZ3RoKSBudW0gPSB0aGlzLnJlc3VsdHMubGVuZ3RoXG4gICAgdmFyIGNsaWNrID0gZnVuY3Rpb24gKHRhZywgZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICB0aGlzLmFkZEN1cnJlbnQodGFnKVxuICAgIH1cbiAgICBmb3IgKHZhciBpPTA7IGk8bnVtOyBpKyspIHtcbiAgICAgIHZhciBub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKVxuICAgICAgbm9kZS5pbm5lclRleHQgPSB0aGlzLnJlc3VsdHNbaV0uY29udGVudFxuICAgICAgbm9kZS5jbGFzc05hbWUgPSAndHJlZWRfdGFnc19yZXN1bHQnXG4gICAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xpY2suYmluZCh0aGlzLCB0aGlzLnJlc3VsdHNbaV0pKVxuICAgICAgdGhpcy5yZXN1bHRzTm9kZS5hcHBlbmRDaGlsZChub2RlKVxuICAgIH1cbiAgfSxcblxuICBvbk5ldzogZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5pbnB1dC52YWx1ZS5sZW5ndGgpIHJldHVyblxuICAgIHZhciB0YWcgPSB0aGlzLmFjdGlvbnMuYWRkVGFnKHRoaXMuaW5wdXQudmFsdWUpXG4gICAgdGhpcy5hZGRDdXJyZW50KHRhZylcbiAgfSxcblxuICBhZGRDdXJyZW50OiBmdW5jdGlvbiAodGFnKSB7XG4gICAgaWYgKCF0YWcpIHtcbiAgICAgIGlmICghdGhpcy5pbnB1dC52YWx1ZS5sZW5ndGgpIHJldHVyblxuICAgICAgaWYgKCF0aGlzLnJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgIHRhZyA9IHRoaXMuYWN0aW9ucy5hZGRUYWcodGhpcy5pbnB1dC52YWx1ZSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhZyA9IHRoaXMucmVzdWx0c1t0aGlzLnNlbGVjdGlvbl1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMudmFsdWUuaW5kZXhPZih0YWcpICE9PSAtMSkgcmV0dXJuIHRoaXMucmVzZXRTZWFyY2goKVxuICAgIHRoaXMudmFsdWUucHVzaCh0YWcpXG4gICAgdGhpcy5hZGQodGFnKVxuICAgIHRoaXMucmVzZXRTZWFyY2goKVxuICB9LFxuXG4gIHJlc2V0U2VhcmNoOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pbnB1dC52YWx1ZSA9ICcnXG4gICAgdGhpcy5maWx0ZXJCeSgnJylcbiAgICB0aGlzLnNlbGVjdGlvbiA9IDBcbiAgICB0aGlzLnNob3dSZXN1bHRzKClcbiAgfSxcblxuICByZW1vdmVMYXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLnZhbHVlLmxlbmd0aCkgcmV0dXJuXG4gICAgdmFyIGxhc3QgPSB0aGlzLnZhbHVlLnBvcCgpXG4gICAgdGhpcy5yZW1vdmUobGFzdC5pZClcbiAgICB0aGlzLnJlc2V0U2VhcmNoKClcbiAgfSxcblxuICByZW1vdmU6IGZ1bmN0aW9uIChpZCkge1xuICAgIHRoaXMudGFncy5yZW1vdmVDaGlsZCh0aGlzLmRvbVtpZF0pXG4gICAgZGVsZXRlIHRoaXMuZG9tW2lkXVxuICB9LFxuXG4gIHJlbW92ZUZ1bGw6IGZ1bmN0aW9uIChpZCkge1xuICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLnZhbHVlLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAodGhpcy52YWx1ZVtpXS5pZCA9PT0gaWQpIHtcbiAgICAgICAgdGhpcy52YWx1ZS5zcGxpY2UoaSwgMSlcbiAgICAgICAgdGhpcy5yZW1vdmUoaWQpXG4gICAgICAgIHRoaXMucmVzZXRTZWFyY2goKVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgc2V0OiBmdW5jdGlvbiAodGFncykge1xuICAgIHRoaXMudmFsdWUgPSB0YWdzIHx8IFtdXG4gICAgd2hpbGUgKHRoaXMudGFncy5sYXN0Q2hpbGQpIHRoaXMudGFncy5yZW1vdmVDaGlsZCh0aGlzLnRhZ3MubGFzdENoaWxkKVxuICAgIHRoaXMuZG9tID0ge31cbiAgICB0aGlzLnZhbHVlLm1hcCh0aGlzLmFkZC5iaW5kKHRoaXMpKVxuICB9LFxuXG4gIGFkZDogZnVuY3Rpb24gKHRhZykge1xuICAgIGlmICh0aGlzLmRvbVt0YWcuaWRdKSByZXR1cm4gY29uc29sZS53YXJuKCd0cmllZCB0byBhZGQgZHVwbGljYXRlIHRhZycpXG4gICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgIHRoaXMuZG9tW3RhZy5pZF0gPSBub2RlXG4gICAgbm9kZS5jbGFzc05hbWUgPSAndHJlZWRfdGFnJ1xuXG4gICAgdmFyIGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJylcbiAgICBjb250ZW50LmlubmVyVGV4dCA9IHRhZy5jb250ZW50XG4gICAgbm9kZS5hcHBlbmRDaGlsZChjb250ZW50KVxuXG4gICAgdmFyIHJlbW92ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxuICAgIHJlbW92ZS5jbGFzc05hbWUgPSAndHJlZWRfdGFnX3JlbW92ZSdcbiAgICByZW1vdmUuaW5uZXJIVE1MID0gJyAmdGltZXM7J1xuICAgIHZhciBybUZ1bmMgPSB0aGlzLnJlbW92ZUZ1bGwuYmluZCh0aGlzLCB0YWcuaWQpXG4gICAgcmVtb3ZlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgcm1GdW5jKClcbiAgICB9KVxuXG4gICAgbm9kZS5hcHBlbmRDaGlsZChyZW1vdmUpXG5cbiAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgaWYgKHRoaXMuZWRpdGluZykgcmV0dXJuXG4gICAgICB0aGlzLmFjdGlvbnMucmViYXNlKHRhZy5pZClcbiAgICB9LmJpbmQodGhpcykpXG4gICAgdGhpcy50YWdzLmFwcGVuZENoaWxkKG5vZGUpXG4gIH0sXG59XG5cbiIsIlxudmFyIFZpZXcgPSByZXF1aXJlKCcuLi8uLi9saWIvdmlldycpXG5cbm1vZHVsZS5leHBvcnRzID0gV0ZWaWV3XG5cbmZ1bmN0aW9uIFdGVmlldygpIHtcbiAgVmlldy5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG59XG5cbldGVmlldy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFZpZXcucHJvdG90eXBlKVxuXG5XRlZpZXcucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAocm9vdCkge1xuICB2YXIgcm9vdE5vZGUgPSBWaWV3LnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcywgcm9vdClcbiAgICAsIG5vZGUgPSB0aGlzLm1vZGVsLmlkc1tyb290XVxuICBpZiAobm9kZS5tZXRhLnJlZmVyZW5jZXMpIHtcbiAgICB0aGlzLnZsLnNldFJlZmVyZW5jZXMobm9kZS5tZXRhLnJlZmVyZW5jZXMubWFwKGZ1bmN0aW9uIChpZCkge1xuICAgICAgcmV0dXJuIHRoaXMubW9kZWwuaWRzW2lkXVxuICAgIH0uYmluZCh0aGlzKSksIHRoaXMucmViYXNlLmJpbmQodGhpcykpXG4gIH1cbiAgcmV0dXJuIHJvb3ROb2RlXG59XG5cbldGVmlldy5wcm90b3R5cGUuYWRkVHJlZSA9IGZ1bmN0aW9uIChub2RlLCBiZWZvcmUpIHtcbiAgaWYgKCF0aGlzLnZsLmJvZHkobm9kZS5wYXJlbnQpKSB7XG4gICAgcmV0dXJuIHRoaXMucmViYXNlKG5vZGUucGFyZW50LCB0cnVlKVxuICB9XG4gIHRoaXMuYWRkKG5vZGUsIGJlZm9yZSlcblxuICBpZiAobm9kZS5tZXRhLnRhZ3MpIHtcbiAgICBub2RlLm1ldGEudGFncy5mb3JFYWNoKGZ1bmN0aW9uIChpZCkge1xuICAgICAgaWYgKGlkID09PSB0aGlzLnJvb3QpIHtcbiAgICAgICAgdGhpcy52bC5hZGRSZWZlcmVuY2UodGhpcy5tb2RlbC5pZHNbbm9kZS5pZF0sIHRoaXMucmViYXNlLmJpbmQodGhpcywgbm9kZS5pZCkpXG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKVxuICB9XG5cbiAgaWYgKG5vZGUubWV0YS5yZWZlcmVuY2VzKSB7XG4gICAgbm9kZS5tZXRhLnJlZmVyZW5jZXMuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgIHRoaXMudmwuYWRkVGFnKGlkLCBub2RlKVxuICAgIH0uYmluZCh0aGlzKSlcbiAgfVxuXG4gIGlmICghbm9kZS5jaGlsZHJlbiB8fCAhbm9kZS5jaGlsZHJlbi5sZW5ndGgpIHJldHVyblxuICBmb3IgKHZhciBpPTA7IGk8bm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgIHRoaXMuYWRkVHJlZSh0aGlzLm1vZGVsLmlkc1tub2RlLmNoaWxkcmVuW2ldXSwgZmFsc2UpXG4gIH1cbn1cblxuV0ZWaWV3LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoaWQsIGlnbm9yZUFjdGl2ZSkge1xuICB2YXIgbm9kZSA9IHRoaXMubW9kZWwuaWRzW2lkXVxuICAgICwgcGlkID0gbm9kZS5wYXJlbnRcbiAgICAsIHBhcmVudCA9IHRoaXMubW9kZWwuaWRzW3BpZF1cblxuICBpZiAoIXRoaXMudmwuYm9keShpZCkpIHtcbiAgICByZXR1cm4gdGhpcy5yZWJhc2UocGlkLCB0cnVlKVxuICB9XG4gIGlmIChpZCA9PT0gdGhpcy5hY3RpdmUgJiYgIWlnbm9yZUFjdGl2ZSkge1xuICAgIHRoaXMuc2V0QWN0aXZlKHRoaXMucm9vdClcbiAgfVxuXG4gIHRoaXMudmwucmVtb3ZlKGlkLCBwaWQsIHBhcmVudCAmJiBwYXJlbnQuY2hpbGRyZW4ubGVuZ3RoID09PSAxKVxuICBpZiAocGFyZW50LmNoaWxkcmVuLmxlbmd0aCA9PT0gMSkge1xuICAgIGlmIChwaWQgPT09IHRoaXMucm9vdCkge1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmFkZE5ldyhwaWQsIDApXG4gICAgICB9LmJpbmQodGhpcyksMClcbiAgICB9XG4gIH1cblxuICAvLyByZW1vdmUgdGhlIHJlZmVyZW5jZXMgYW5kIHRhZ3NcblxuICB2YXIgaWRzID0gdGhpcy5tb2RlbC5pZHNcblxuICBmdW5jdGlvbiBwcm9jZXNzKG5vZGUpIHtcbiAgICBmb3IgKHZhciBpPTA7IGk8bm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgcHJvY2Vzcy5jYWxsKHRoaXMsIGlkc1tub2RlLmNoaWxkcmVuW2ldXSlcbiAgICB9XG5cbiAgICBpZiAobm9kZS5tZXRhLnJlZmVyZW5jZXMpIHtcbiAgICAgIG5vZGUubWV0YS5yZWZlcmVuY2VzLmZvckVhY2goZnVuY3Rpb24gKHJpZCkge1xuICAgICAgICB0aGlzLnZsLnJlbW92ZVRhZyhyaWQsIG5vZGUuaWQpXG4gICAgICB9LmJpbmQodGhpcykpXG4gICAgfVxuXG4gICAgaWYgKG5vZGUubWV0YS50YWdzKSB7XG4gICAgICBub2RlLm1ldGEudGFncy5mb3JFYWNoKGZ1bmN0aW9uICh0aWQpIHtcbiAgICAgICAgdGhpcy52bC5yZW1vdmVSZWZlcmVuY2UodGlkLCBub2RlLmlkKVxuICAgICAgfS5iaW5kKHRoaXMpKVxuICAgIH1cbiAgfVxuXG4gIHByb2Nlc3MuY2FsbCh0aGlzLCBub2RlKVxufVxuXG5XRlZpZXcucHJvdG90eXBlLnNldEF0dHIgPSBmdW5jdGlvbiAoaWQsIGF0dHIsIHZhbHVlLCBxdWlldCkge1xuICB2YXIgcmVzID0gVmlldy5wcm90b3R5cGUuc2V0QXR0ci5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gIGlmIChhdHRyICE9PSAncmVmZXJlbmNlcycpIHJldHVybiByZXNcbiAgaWYgKGlkICE9PSB0aGlzLnJvb3QpIHJldHVyblxuICB0aGlzLnZsLnNldFJlZmVyZW5jZXModmFsdWUgJiYgdmFsdWUubWFwKGZ1bmN0aW9uIChpZCkge1xuICAgIHJldHVybiB0aGlzLm1vZGVsLmlkc1tpZF1cbiAgfS5iaW5kKHRoaXMpKSwgdGhpcy5yZWJhc2UuYmluZCh0aGlzKSlcbiAgcmV0dXJuIHJlc1xufVxuXG5XRlZpZXcucHJvdG90eXBlLnNldFRhZ3MgPSBmdW5jdGlvbiAoaWQsIHRhZ3MsIG9sZFRhZ3MpIHtcbiAgdmFyIHVzZWQgPSB7fVxuICBmb3IgKHZhciBpPTA7IGk8dGFncy5sZW5ndGg7IGkrKykge1xuICAgIHVzZWRbdGFnc1tpXV0gPSB0cnVlXG4gIH1cbiAgdGhpcy5zZXRBdHRyKGlkLCAndGFncycsIHRhZ3MpXG4gIGZvciAodmFyIGk9MDsgaTx0YWdzLmxlbmd0aDsgaSsrKSB7XG4gICAgdGhpcy5zZXRBdHRyKHRhZ3NbaV0sICdyZWZlcmVuY2VzJywgdGhpcy5tb2RlbC5pZHNbdGFnc1tpXV0ubWV0YS5yZWZlcmVuY2VzLCB0cnVlKVxuICB9XG4gIGlmIChvbGRUYWdzKSB7XG4gICAgZm9yICh2YXIgaT0wOyBpPG9sZFRhZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh1c2VkW29sZFRhZ3NbaV1dKSBjb250aW51ZTtcbiAgICAgIHRoaXMuc2V0QXR0cihvbGRUYWdzW2ldLCAncmVmZXJlbmNlcycsIHRoaXMubW9kZWwuaWRzW29sZFRhZ3NbaV1dLm1ldGEucmVmZXJlbmNlcywgdHJ1ZSlcbiAgICB9XG4gIH1cbn1cblxuV0ZWaWV3LnByb3RvdHlwZS5leHRyYV9hY3Rpb25zID0ge1xuICAnZWRpdCB0YWdzJzoge1xuICAgIGJpbmRpbmc6ICdzaGlmdCszJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMudmwuZWRpdFRhZ3ModGhpcy5hY3RpdmUpXG4gICAgfSxcbiAgfSxcbiAgJ3JlYmFzZSc6IHtcbiAgICBiaW5kaW5nOiAnYWx0K3JldHVybicsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmN0cmxhY3Rpb25zLmNsaWNrQnVsbGV0KHRoaXMuYWN0aXZlKVxuICAgIH1cbiAgfSxcbiAgJ2JhY2sgYSBsZXZlbCc6IHtcbiAgICBiaW5kaW5nOiAnc2hpZnQrYWx0K3JldHVybicsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmN0cmxhY3Rpb25zLmJhY2tBTGV2ZWwoKVxuICAgIH1cbiAgfSxcblxuICAndG9nZ2xlIGRvbmUnOiB7XG4gICAgYmluZGluZzogJ2N0cmwrcmV0dXJuJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLmFjdGl2ZSA9PT0gbnVsbCkgcmV0dXJuXG4gICAgICB2YXIgaWQgPSB0aGlzLmFjdGl2ZVxuICAgICAgICAsIGRvbmUgPSAhdGhpcy5tb2RlbC5pZHNbaWRdLm1ldGEuZG9uZVxuICAgICAgICAsIG5leHQgPSB0aGlzLm1vZGVsLmlkQmVsb3coaWQsIHRoaXMucm9vdClcbiAgICAgIGlmIChuZXh0ID09PSB1bmRlZmluZWQpIG5leHQgPSBpZFxuICAgICAgdGhpcy5jdHJsYWN0aW9ucy5jaGFuZ2VkKHRoaXMuYWN0aXZlLCAnZG9uZScsIGRvbmUpXG4gICAgICBpZiAoZG9uZSkge1xuICAgICAgICB0aGlzLmdvVG8obmV4dClcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuIiwiXG52YXIgRG9tVmlld0xheWVyID0gcmVxdWlyZSgnLi4vLi4vbGliL2RvbS12bCcpXG5cbm1vZHVsZS5leHBvcnRzID0gV0ZWTFxuXG5mdW5jdGlvbiBXRlZMKCkge1xuICBEb21WaWV3TGF5ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKVxufVxuXG5XRlZMLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRG9tVmlld0xheWVyLnByb3RvdHlwZSlcblxuV0ZWTC5wcm90b3R5cGUucmVtb3ZlVGFnID0gZnVuY3Rpb24gKGlkLCB0aWQpIHtcbiAgdmFyIGJvZHkgPSB0aGlzLmJvZHkoaWQpXG4gIGlmICghYm9keSkgcmV0dXJuXG4gIGJvZHkucmVtb3ZlVGFnKHRpZClcbn1cblxuV0ZWTC5wcm90b3R5cGUuYWRkVGFnID0gZnVuY3Rpb24gKGlkLCBub2RlKSB7XG4gIHZhciBib2R5ID0gdGhpcy5ib2R5KGlkKVxuICBpZiAoIWJvZHkpIHJldHVyblxuICBib2R5LmFkZFRhZyhub2RlKVxufVxuXG5XRlZMLnByb3RvdHlwZS5lZGl0VGFncyA9IGZ1bmN0aW9uIChpZCkge1xuICB0aGlzLmJvZHkoaWQpLnRhZ3Muc3RhcnRFZGl0aW5nKClcbn1cblxuV0ZWTC5wcm90b3R5cGUubWFrZUhlYWQgPSBmdW5jdGlvbiAoYm9keSwgYWN0aW9ucykge1xuICB2YXIgaGVhZCA9IERvbVZpZXdMYXllci5wcm90b3R5cGUubWFrZUhlYWQuY2FsbCh0aGlzLCBib2R5LCBhY3Rpb25zKVxuICAgICwgYnVsbGV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgYnVsbGV0LmNsYXNzTGlzdC5hZGQoJ3RyZWVkX19idWxsZXQnKVxuICBidWxsZXQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgYWN0aW9ucy5jbGlja0J1bGxldClcbiAgaGVhZC5pbnNlcnRCZWZvcmUoYnVsbGV0LCBoZWFkLmNoaWxkTm9kZXNbMV0pXG4gIHJldHVybiBoZWFkXG59XG5cbldGVkwucHJvdG90eXBlLm1ha2VSb290ID0gZnVuY3Rpb24gKG5vZGUsIGJvdW5kcywgbW9kZWxBY3Rpb25zKSB7XG4gIHZhciByb290ID0gRG9tVmlld0xheWVyLnByb3RvdHlwZS5tYWtlUm9vdC5jYWxsKHRoaXMsIG5vZGUsIGJvdW5kcywgbW9kZWxBY3Rpb25zKVxuICB2YXIgcmVmQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgcmVmQ29udGFpbmVyLmNsYXNzTmFtZSA9ICd0cmVlZF9yZWZlcmVuY2VzJ1xuICByZWZDb250YWluZXIuaW5uZXJIVE1MID0gJzxoMSBjbGFzcz1cInRyZWVkX3JlZmVyZW5jZXNfdGl0bGVcIj5SZWZlcmVuY2VzPC9oMT4nXG4gIHRoaXMucmVmZXJlbmNlcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gIHRoaXMucmVmZXJlbmNlcy5jbGFzc05hbWUgPSAndHJlZWRfcmVmZXJlbmNlc19saXN0J1xuICB0aGlzLnJmcyA9IHt9XG4gIHJlZkNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLnJlZmVyZW5jZXMpXG4gIHJvb3QuYXBwZW5kQ2hpbGQocmVmQ29udGFpbmVyKVxuICB0aGlzLnJlZkNvbnRhaW5lciA9IHJlZkNvbnRhaW5lclxuICByZXR1cm4gcm9vdFxufVxuXG5XRlZMLnByb3RvdHlwZS5zZXRSZWZlcmVuY2VzID0gZnVuY3Rpb24gKG5vZGVzLCBhY3Rpb24pIHtcbiAgdGhpcy5jbGVhclJlZmVyZW5jZXMoKVxuICBpZiAoIW5vZGVzIHx8ICFub2Rlcy5sZW5ndGgpIHtcbiAgICB0aGlzLnJlZkNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCd0cmVlZF9yZWZlcmVuY2VzLS1zaG93bicpXG4gICAgcmV0dXJuXG4gIH1cbiAgdGhpcy5yZWZDb250YWluZXIuY2xhc3NMaXN0LmFkZCgndHJlZWRfcmVmZXJlbmNlcy0tc2hvd24nKVxuICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgdGhpcy5hZGRSZWZlcmVuY2Uobm9kZSwgYWN0aW9uLmJpbmQobnVsbCwgbm9kZS5pZCkpXG4gIH0uYmluZCh0aGlzKSlcbn1cblxuV0ZWTC5wcm90b3R5cGUuY2xlYXJSZWZlcmVuY2VzID0gZnVuY3Rpb24gKCkge1xuICB3aGlsZSAodGhpcy5yZWZlcmVuY2VzLmxhc3RDaGlsZCkge1xuICAgIHRoaXMucmVmZXJlbmNlcy5yZW1vdmVDaGlsZCh0aGlzLnJlZmVyZW5jZXMubGFzdENoaWxkKVxuICB9XG4gIHRoaXMucmZzID0ge31cbn1cblxuV0ZWTC5wcm90b3R5cGUuYWRkUmVmZXJlbmNlID0gZnVuY3Rpb24gKG5vZGUsIGFjdGlvbikge1xuICB0aGlzLnJlZkNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCd0cmVlZF9yZWZlcmVuY2VzLS1zaG93bicpXG4gIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICBkaXYuY2xhc3NOYW1lID0gJ3RyZWVkX3JlZmVyZW5jZSdcbiAgZGl2LmlubmVySFRNTCA9IG1hcmtlZChub2RlLmNvbnRlbnQpXG4gIGRpdi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFjdGlvbilcbiAgdGhpcy5yZnNbbm9kZS5pZF0gPSBkaXZcbiAgdGhpcy5yZWZlcmVuY2VzLmFwcGVuZENoaWxkKGRpdilcbn1cblxuV0ZWTC5wcm90b3R5cGUucmVtb3ZlUmVmZXJlbmNlID0gZnVuY3Rpb24gKGlkLCByaWQpIHtcbiAgLy8gVE9ETyBmaWxsIHRoaXMgaW5cbn1cblxuIl19
        (1)
    });

    /*end demo-bundle.js*/

    /*begin marked.js*/
    /**
     * marked - a markdown parser
     * Copyright (c) 2011-2014, Christopher Jeffrey. (MIT Licensed)
     * https://github.com/chjj/marked
     */

    ; (function () {

        /**
         * Block-Level Grammar
         */

        var block = {
            newline: /^\n+/,
            code: /^( {4}[^\n]+\n*)+/,
            fences: noop,
            hr: /^( *[-*_]){3,} *(?:\n+|$)/,
            heading: /^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,
            nptable: noop,
            lheading: /^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,
            blockquote: /^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,
            list: /^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,
            html: /^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,
            def: /^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,
            table: noop,
            paragraph: /^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,
            text: /^[^\n]+/
        };

        block.bullet = /(?:[*+-]|\d+\.)/;
        block.item = /^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/;
        block.item = replace(block.item, 'gm')
          (/bull/g, block.bullet)
          ();

        block.list = replace(block.list)
          (/bull/g, block.bullet)
          ('hr', '\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))')
          ('def', '\\n+(?=' + block.def.source + ')')
          ();

        block.blockquote = replace(block.blockquote)
          ('def', block.def)
          ();

        block._tag = '(?!(?:'
          + 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code'
          + '|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo'
          + '|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b';

        block.html = replace(block.html)
          ('comment', /<!--[\s\S]*?-->/)
          ('closed', /<(tag)[\s\S]+?<\/\1>/)
          ('closing', /<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)
          (/tag/g, block._tag)
          ();

        block.paragraph = replace(block.paragraph)
          ('hr', block.hr)
          ('heading', block.heading)
          ('lheading', block.lheading)
          ('blockquote', block.blockquote)
          ('tag', '<' + block._tag)
          ('def', block.def)
          ();

        /**
         * Normal Block Grammar
         */

        block.normal = merge({}, block);

        /**
         * GFM Block Grammar
         */

        block.gfm = merge({}, block.normal, {
            fences: /^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,
            paragraph: /^/
        });

        block.gfm.paragraph = replace(block.paragraph)
          ('(?!', '(?!'
            + block.gfm.fences.source.replace('\\1', '\\2') + '|'
            + block.list.source.replace('\\1', '\\3') + '|')
          ();

        /**
         * GFM + Tables Block Grammar
         */

        block.tables = merge({}, block.gfm, {
            nptable: /^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,
            table: /^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/
        });

        /**
         * Block Lexer
         */

        function Lexer(options) {
            this.tokens = [];
            this.tokens.links = {};
            this.options = options || marked.defaults;
            this.rules = block.normal;

            if (this.options.gfm) {
                if (this.options.tables) {
                    this.rules = block.tables;
                } else {
                    this.rules = block.gfm;
                }
            }
        }

        /**
         * Expose Block Rules
         */

        Lexer.rules = block;

        /**
         * Static Lex Method
         */

        Lexer.lex = function (src, options) {
            var lexer = new Lexer(options);
            return lexer.lex(src);
        };

        /**
         * Preprocessing
         */

        Lexer.prototype.lex = function (src) {
            src = src
              .replace(/\r\n|\r/g, '\n')
              .replace(/\t/g, '    ')
              .replace(/\u00a0/g, ' ')
              .replace(/\u2424/g, '\n');

            return this.token(src, true);
        };

        /**
         * Lexing
         */

        Lexer.prototype.token = function (src, top, bq) {
            var src = src.replace(/^ +$/gm, '')
              , next
              , loose
              , cap
              , bull
              , b
              , item
              , space
              , i
              , l;

            while (src) {
                // newline
                if (cap = this.rules.newline.exec(src)) {
                    src = src.substring(cap[0].length);
                    if (cap[0].length > 1) {
                        this.tokens.push({
                            type: 'space'
                        });
                    }
                }

                // code
                if (cap = this.rules.code.exec(src)) {
                    src = src.substring(cap[0].length);
                    cap = cap[0].replace(/^ {4}/gm, '');
                    this.tokens.push({
                        type: 'code',
                        text: !this.options.pedantic
                          ? cap.replace(/\n+$/, '')
                          : cap
                    });
                    continue;
                }

                // fences (gfm)
                if (cap = this.rules.fences.exec(src)) {
                    src = src.substring(cap[0].length);
                    this.tokens.push({
                        type: 'code',
                        lang: cap[2],
                        text: cap[3]
                    });
                    continue;
                }

                // heading
                if (cap = this.rules.heading.exec(src)) {
                    src = src.substring(cap[0].length);
                    this.tokens.push({
                        type: 'heading',
                        depth: cap[1].length,
                        text: cap[2]
                    });
                    continue;
                }

                // table no leading pipe (gfm)
                if (top && (cap = this.rules.nptable.exec(src))) {
                    src = src.substring(cap[0].length);

                    item = {
                        type: 'table',
                        header: cap[1].replace(/^ *| *\| *$/g, '').split(/ *\| */),
                        align: cap[2].replace(/^ *|\| *$/g, '').split(/ *\| */),
                        cells: cap[3].replace(/\n$/, '').split('\n')
                    };

                    for (i = 0; i < item.align.length; i++) {
                        if (/^ *-+: *$/.test(item.align[i])) {
                            item.align[i] = 'right';
                        } else if (/^ *:-+: *$/.test(item.align[i])) {
                            item.align[i] = 'center';
                        } else if (/^ *:-+ *$/.test(item.align[i])) {
                            item.align[i] = 'left';
                        } else {
                            item.align[i] = null;
                        }
                    }

                    for (i = 0; i < item.cells.length; i++) {
                        item.cells[i] = item.cells[i].split(/ *\| */);
                    }

                    this.tokens.push(item);

                    continue;
                }

                // lheading
                if (cap = this.rules.lheading.exec(src)) {
                    src = src.substring(cap[0].length);
                    this.tokens.push({
                        type: 'heading',
                        depth: cap[2] === '=' ? 1 : 2,
                        text: cap[1]
                    });
                    continue;
                }

                // hr
                if (cap = this.rules.hr.exec(src)) {
                    src = src.substring(cap[0].length);
                    this.tokens.push({
                        type: 'hr'
                    });
                    continue;
                }

                // blockquote
                if (cap = this.rules.blockquote.exec(src)) {
                    src = src.substring(cap[0].length);

                    this.tokens.push({
                        type: 'blockquote_start'
                    });

                    cap = cap[0].replace(/^ *> ?/gm, '');

                    // Pass `top` to keep the current
                    // "toplevel" state. This is exactly
                    // how markdown.pl works.
                    this.token(cap, top, true);

                    this.tokens.push({
                        type: 'blockquote_end'
                    });

                    continue;
                }

                // list
                if (cap = this.rules.list.exec(src)) {
                    src = src.substring(cap[0].length);
                    bull = cap[2];

                    this.tokens.push({
                        type: 'list_start',
                        ordered: bull.length > 1
                    });

                    // Get each top-level item.
                    cap = cap[0].match(this.rules.item);

                    next = false;
                    l = cap.length;
                    i = 0;

                    for (; i < l; i++) {
                        item = cap[i];

                        // Remove the list item's bullet
                        // so it is seen as the next token.
                        space = item.length;
                        item = item.replace(/^ *([*+-]|\d+\.) +/, '');

                        // Outdent whatever the
                        // list item contains. Hacky.
                        if (~item.indexOf('\n ')) {
                            space -= item.length;
                            item = !this.options.pedantic
                              ? item.replace(new RegExp('^ {1,' + space + '}', 'gm'), '')
                              : item.replace(/^ {1,4}/gm, '');
                        }

                        // Determine whether the next list item belongs here.
                        // Backpedal if it does not belong in this list.
                        if (this.options.smartLists && i !== l - 1) {
                            b = block.bullet.exec(cap[i + 1])[0];
                            if (bull !== b && !(bull.length > 1 && b.length > 1)) {
                                src = cap.slice(i + 1).join('\n') + src;
                                i = l - 1;
                            }
                        }

                        // Determine whether item is loose or not.
                        // Use: /(^|\n)(?! )[^\n]+\n\n(?!\s*$)/
                        // for discount behavior.
                        loose = next || /\n\n(?!\s*$)/.test(item);
                        if (i !== l - 1) {
                            next = item.charAt(item.length - 1) === '\n';
                            if (!loose) loose = next;
                        }

                        this.tokens.push({
                            type: loose
                              ? 'loose_item_start'
                              : 'list_item_start'
                        });

                        // Recurse.
                        this.token(item, false, bq);

                        this.tokens.push({
                            type: 'list_item_end'
                        });
                    }

                    this.tokens.push({
                        type: 'list_end'
                    });

                    continue;
                }

                // html
                if (cap = this.rules.html.exec(src)) {
                    src = src.substring(cap[0].length);
                    this.tokens.push({
                        type: this.options.sanitize
                          ? 'paragraph'
                          : 'html',
                        pre: cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style',
                        text: cap[0]
                    });
                    continue;
                }

                // def
                if ((!bq && top) && (cap = this.rules.def.exec(src))) {
                    src = src.substring(cap[0].length);
                    this.tokens.links[cap[1].toLowerCase()] = {
                        href: cap[2],
                        title: cap[3]
                    };
                    continue;
                }

                // table (gfm)
                if (top && (cap = this.rules.table.exec(src))) {
                    src = src.substring(cap[0].length);

                    item = {
                        type: 'table',
                        header: cap[1].replace(/^ *| *\| *$/g, '').split(/ *\| */),
                        align: cap[2].replace(/^ *|\| *$/g, '').split(/ *\| */),
                        cells: cap[3].replace(/(?: *\| *)?\n$/, '').split('\n')
                    };

                    for (i = 0; i < item.align.length; i++) {
                        if (/^ *-+: *$/.test(item.align[i])) {
                            item.align[i] = 'right';
                        } else if (/^ *:-+: *$/.test(item.align[i])) {
                            item.align[i] = 'center';
                        } else if (/^ *:-+ *$/.test(item.align[i])) {
                            item.align[i] = 'left';
                        } else {
                            item.align[i] = null;
                        }
                    }

                    for (i = 0; i < item.cells.length; i++) {
                        item.cells[i] = item.cells[i]
                          .replace(/^ *\| *| *\| *$/g, '')
                          .split(/ *\| */);
                    }

                    this.tokens.push(item);

                    continue;
                }

                // top-level paragraph
                if (top && (cap = this.rules.paragraph.exec(src))) {
                    src = src.substring(cap[0].length);
                    this.tokens.push({
                        type: 'paragraph',
                        text: cap[1].charAt(cap[1].length - 1) === '\n'
                          ? cap[1].slice(0, -1)
                          : cap[1]
                    });
                    continue;
                }

                // text
                if (cap = this.rules.text.exec(src)) {
                    // Top-level should never reach here.
                    src = src.substring(cap[0].length);
                    this.tokens.push({
                        type: 'text',
                        text: cap[0]
                    });
                    continue;
                }

                if (src) {
                    throw new
                      Error('Infinite loop on byte: ' + src.charCodeAt(0));
                }
            }

            return this.tokens;
        };

        /**
         * Inline-Level Grammar
         */

        var inline = {
            escape: /^\\([\\`*{}\[\]()#+\-.!_>])/,
            autolink: /^<([^ >]+(@|:\/)[^ >]+)>/,
            url: noop,
            tag: /^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,
            link: /^!?\[(inside)\]\(href\)/,
            reflink: /^!?\[(inside)\]\s*\[([^\]]*)\]/,
            nolink: /^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,
            strong: /^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,
            em: /^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,
            code: /^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,
            br: /^ {2,}\n(?!\s*$)/,
            del: noop,
            text: /^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/
        };

        inline._inside = /(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/;
        inline._href = /\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/;

        inline.link = replace(inline.link)
          ('inside', inline._inside)
          ('href', inline._href)
          ();

        inline.reflink = replace(inline.reflink)
          ('inside', inline._inside)
          ();

        /**
         * Normal Inline Grammar
         */

        inline.normal = merge({}, inline);

        /**
         * Pedantic Inline Grammar
         */

        inline.pedantic = merge({}, inline.normal, {
            strong: /^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,
            em: /^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/
        });

        /**
         * GFM Inline Grammar
         */

        inline.gfm = merge({}, inline.normal, {
            escape: replace(inline.escape)('])', '~|])')(),
            url: /^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,
            del: /^~~(?=\S)([\s\S]*?\S)~~/,
            text: replace(inline.text)
              (']|', '~]|')
              ('|', '|https?://|')
              ()
        });

        /**
         * GFM + Line Breaks Inline Grammar
         */

        inline.breaks = merge({}, inline.gfm, {
            br: replace(inline.br)('{2,}', '*')(),
            text: replace(inline.gfm.text)('{2,}', '*')()
        });

        /**
         * Inline Lexer & Compiler
         */

        function InlineLexer(links, options) {
            this.options = options || marked.defaults;
            this.links = links;
            this.rules = inline.normal;
            this.renderer = this.options.renderer || new Renderer;
            this.renderer.options = this.options;

            if (!this.links) {
                throw new
                  Error('Tokens array requires a `links` property.');
            }

            if (this.options.gfm) {
                if (this.options.breaks) {
                    this.rules = inline.breaks;
                } else {
                    this.rules = inline.gfm;
                }
            } else if (this.options.pedantic) {
                this.rules = inline.pedantic;
            }
        }

        /**
         * Expose Inline Rules
         */

        InlineLexer.rules = inline;

        /**
         * Static Lexing/Compiling Method
         */

        InlineLexer.output = function (src, links, options) {
            var inline = new InlineLexer(links, options);
            return inline.output(src);
        };

        /**
         * Lexing/Compiling
         */

        InlineLexer.prototype.output = function (src) {
            var out = ''
              , link
              , text
              , href
              , cap;

            while (src) {
                // escape
                if (cap = this.rules.escape.exec(src)) {
                    src = src.substring(cap[0].length);
                    out += cap[1];
                    continue;
                }

                // autolink
                if (cap = this.rules.autolink.exec(src)) {
                    src = src.substring(cap[0].length);
                    if (cap[2] === '@') {
                        text = cap[1].charAt(6) === ':'
                          ? this.mangle(cap[1].substring(7))
                          : this.mangle(cap[1]);
                        href = this.mangle('mailto:') + text;
                    } else {
                        text = escape(cap[1]);
                        href = text;
                    }
                    out += this.renderer.link(href, null, text);
                    continue;
                }

                // url (gfm)
                if (!this.inLink && (cap = this.rules.url.exec(src))) {
                    src = src.substring(cap[0].length);
                    text = escape(cap[1]);
                    href = text;
                    out += this.renderer.link(href, null, text);
                    continue;
                }

                // tag
                if (cap = this.rules.tag.exec(src)) {
                    if (!this.inLink && /^<a /i.test(cap[0])) {
                        this.inLink = true;
                    } else if (this.inLink && /^<\/a>/i.test(cap[0])) {
                        this.inLink = false;
                    }
                    src = src.substring(cap[0].length);
                    out += this.options.sanitize
                      ? escape(cap[0])
                      : cap[0];
                    continue;
                }

                // link
                if (cap = this.rules.link.exec(src)) {
                    src = src.substring(cap[0].length);
                    this.inLink = true;
                    out += this.outputLink(cap, {
                        href: cap[2],
                        title: cap[3]
                    });
                    this.inLink = false;
                    continue;
                }

                // reflink, nolink
                if ((cap = this.rules.reflink.exec(src))
                    || (cap = this.rules.nolink.exec(src))) {
                    src = src.substring(cap[0].length);
                    link = (cap[2] || cap[1]).replace(/\s+/g, ' ');
                    link = this.links[link.toLowerCase()];
                    if (!link || !link.href) {
                        out += cap[0].charAt(0);
                        src = cap[0].substring(1) + src;
                        continue;
                    }
                    this.inLink = true;
                    out += this.outputLink(cap, link);
                    this.inLink = false;
                    continue;
                }

                // strong
                if (cap = this.rules.strong.exec(src)) {
                    src = src.substring(cap[0].length);
                    out += this.renderer.strong(this.output(cap[2] || cap[1]));
                    continue;
                }

                // em
                if (cap = this.rules.em.exec(src)) {
                    src = src.substring(cap[0].length);
                    out += this.renderer.em(this.output(cap[2] || cap[1]));
                    continue;
                }

                // code
                if (cap = this.rules.code.exec(src)) {
                    src = src.substring(cap[0].length);
                    out += this.renderer.codespan(escape(cap[2], true));
                    continue;
                }

                // br
                if (cap = this.rules.br.exec(src)) {
                    src = src.substring(cap[0].length);
                    out += this.renderer.br();
                    continue;
                }

                // del (gfm)
                if (cap = this.rules.del.exec(src)) {
                    src = src.substring(cap[0].length);
                    out += this.renderer.del(this.output(cap[1]));
                    continue;
                }

                // text
                if (cap = this.rules.text.exec(src)) {
                    src = src.substring(cap[0].length);
                    out += escape(this.smartypants(cap[0]));
                    continue;
                }

                if (src) {
                    throw new
                      Error('Infinite loop on byte: ' + src.charCodeAt(0));
                }
            }

            return out;
        };

        /**
         * Compile Link
         */

        InlineLexer.prototype.outputLink = function (cap, link) {
            var href = escape(link.href)
              , title = link.title ? escape(link.title) : null;

            return cap[0].charAt(0) !== '!'
              ? this.renderer.link(href, title, this.output(cap[1]))
              : this.renderer.image(href, title, escape(cap[1]));
        };

        /**
         * Smartypants Transformations
         */

        InlineLexer.prototype.smartypants = function (text) {
            if (!this.options.smartypants) return text;
            return text
              // em-dashes
              .replace(/--/g, '\u2014')
              // opening singles
              .replace(/(^|[-\u2014/(\[{"\s])'/g, '$1\u2018')
              // closing singles & apostrophes
              .replace(/'/g, '\u2019')
              // opening doubles
              .replace(/(^|[-\u2014/(\[{\u2018\s])"/g, '$1\u201c')
              // closing doubles
              .replace(/"/g, '\u201d')
              // ellipses
              .replace(/\.{3}/g, '\u2026');
        };

        /**
         * Mangle Links
         */

        InlineLexer.prototype.mangle = function (text) {
            var out = ''
              , l = text.length
              , i = 0
              , ch;

            for (; i < l; i++) {
                ch = text.charCodeAt(i);
                if (Math.random() > 0.5) {
                    ch = 'x' + ch.toString(16);
                }
                out += '&#' + ch + ';';
            }

            return out;
        };

        /**
         * Renderer
         */

        function Renderer(options) {
            this.options = options || {};
        }

        Renderer.prototype.code = function (code, lang, escaped) {
            if (this.options.highlight) {
                var out = this.options.highlight(code, lang);
                if (out != null && out !== code) {
                    escaped = true;
                    code = out;
                }
            }

            if (!lang) {
                return '<pre><code>'
                  + (escaped ? code : escape(code, true))
                  + '\n</code></pre>';
            }

            return '<pre><code class="'
              + this.options.langPrefix
              + escape(lang, true)
              + '">'
              + (escaped ? code : escape(code, true))
              + '\n</code></pre>\n';
        };

        Renderer.prototype.blockquote = function (quote) {
            return '<blockquote>\n' + quote + '</blockquote>\n';
        };

        Renderer.prototype.html = function (html) {
            return html;
        };

        Renderer.prototype.heading = function (text, level, raw) {
            return '<h'
              + level
              + ' id="'
              + this.options.headerPrefix
              + raw.toLowerCase().replace(/[^\w]+/g, '-')
              + '">'
              + text
              + '</h'
              + level
              + '>\n';
        };

        Renderer.prototype.hr = function () {
            return this.options.xhtml ? '<hr/>\n' : '<hr>\n';
        };

        Renderer.prototype.list = function (body, ordered) {
            var type = ordered ? 'ol' : 'ul';
            return '<' + type + '>\n' + body + '</' + type + '>\n';
        };

        Renderer.prototype.listitem = function (text) {
            return '<li>' + text + '</li>\n';
        };

        Renderer.prototype.paragraph = function (text) {
            return '<p>' + text + '</p>\n';
        };

        Renderer.prototype.table = function (header, body) {
            return '<table>\n'
              + '<thead>\n'
              + header
              + '</thead>\n'
              + '<tbody>\n'
              + body
              + '</tbody>\n'
              + '</table>\n';
        };

        Renderer.prototype.tablerow = function (content) {
            return '<tr>\n' + content + '</tr>\n';
        };

        Renderer.prototype.tablecell = function (content, flags) {
            var type = flags.header ? 'th' : 'td';
            var tag = flags.align
              ? '<' + type + ' style="text-align:' + flags.align + '">'
              : '<' + type + '>';
            return tag + content + '</' + type + '>\n';
        };

        // span level renderer
        Renderer.prototype.strong = function (text) {
            return '<strong>' + text + '</strong>';
        };

        Renderer.prototype.em = function (text) {
            return '<em>' + text + '</em>';
        };

        Renderer.prototype.codespan = function (text) {
            return '<code>' + text + '</code>';
        };

        Renderer.prototype.br = function () {
            return this.options.xhtml ? '<br/>' : '<br>';
        };

        Renderer.prototype.del = function (text) {
            return '<del>' + text + '</del>';
        };

        Renderer.prototype.link = function (href, title, text) {
            if (this.options.sanitize) {
                try {
                    var prot = decodeURIComponent(unescape(href))
                      .replace(/[^\w:]/g, '')
                      .toLowerCase();
                } catch (e) {
                    return '';
                }
                if (prot.indexOf('javascript:') === 0) {
                    return '';
                }
            }
            var out = '<a href="' + href + '"';
            if (title) {
                out += ' title="' + title + '"';
            }
            out += '>' + text + '</a>';
            return out;
        };

        Renderer.prototype.image = function (href, title, text) {
            var out = '<img src="' + href + '" alt="' + text + '"';
            if (title) {
                out += ' title="' + title + '"';
            }
            out += this.options.xhtml ? '/>' : '>';
            return out;
        };

        /**
         * Parsing & Compiling
         */

        function Parser(options) {
            this.tokens = [];
            this.token = null;
            this.options = options || marked.defaults;
            this.options.renderer = this.options.renderer || new Renderer;
            this.renderer = this.options.renderer;
            this.renderer.options = this.options;
        }

        /**
         * Static Parse Method
         */

        Parser.parse = function (src, options, renderer) {
            var parser = new Parser(options, renderer);
            return parser.parse(src);
        };

        /**
         * Parse Loop
         */

        Parser.prototype.parse = function (src) {
            this.inline = new InlineLexer(src.links, this.options, this.renderer);
            this.tokens = src.reverse();

            var out = '';
            while (this.next()) {
                out += this.tok();
            }

            return out;
        };

        /**
         * Next Token
         */

        Parser.prototype.next = function () {
            return this.token = this.tokens.pop();
        };

        /**
         * Preview Next Token
         */

        Parser.prototype.peek = function () {
            return this.tokens[this.tokens.length - 1] || 0;
        };

        /**
         * Parse Text Tokens
         */

        Parser.prototype.parseText = function () {
            var body = this.token.text;

            while (this.peek().type === 'text') {
                body += '\n' + this.next().text;
            }

            return this.inline.output(body);
        };

        /**
         * Parse Current Token
         */

        Parser.prototype.tok = function () {
            switch (this.token.type) {
                case 'space': {
                    return '';
                }
                case 'hr': {
                    return this.renderer.hr();
                }
                case 'heading': {
                    return this.renderer.heading(
                      this.inline.output(this.token.text),
                      this.token.depth,
                      this.token.text);
                }
                case 'code': {
                    return this.renderer.code(this.token.text,
                      this.token.lang,
                      this.token.escaped);
                }
                case 'table': {
                    var header = ''
                      , body = ''
                      , i
                      , row
                      , cell
                      , flags
                      , j;

                    // header
                    cell = '';
                    for (i = 0; i < this.token.header.length; i++) {
                        flags = { header: true, align: this.token.align[i] };
                        cell += this.renderer.tablecell(
                          this.inline.output(this.token.header[i]),
                          { header: true, align: this.token.align[i] }
                        );
                    }
                    header += this.renderer.tablerow(cell);

                    for (i = 0; i < this.token.cells.length; i++) {
                        row = this.token.cells[i];

                        cell = '';
                        for (j = 0; j < row.length; j++) {
                            cell += this.renderer.tablecell(
                              this.inline.output(row[j]),
                              { header: false, align: this.token.align[j] }
                            );
                        }

                        body += this.renderer.tablerow(cell);
                    }
                    return this.renderer.table(header, body);
                }
                case 'blockquote_start': {
                    var body = '';

                    while (this.next().type !== 'blockquote_end') {
                        body += this.tok();
                    }

                    return this.renderer.blockquote(body);
                }
                case 'list_start': {
                    var body = ''
                      , ordered = this.token.ordered;

                    while (this.next().type !== 'list_end') {
                        body += this.tok();
                    }

                    return this.renderer.list(body, ordered);
                }
                case 'list_item_start': {
                    var body = '';

                    while (this.next().type !== 'list_item_end') {
                        body += this.token.type === 'text'
                          ? this.parseText()
                          : this.tok();
                    }

                    return this.renderer.listitem(body);
                }
                case 'loose_item_start': {
                    var body = '';

                    while (this.next().type !== 'list_item_end') {
                        body += this.tok();
                    }

                    return this.renderer.listitem(body);
                }
                case 'html': {
                    var html = !this.token.pre && !this.options.pedantic
                      ? this.inline.output(this.token.text)
                      : this.token.text;
                    return this.renderer.html(html);
                }
                case 'paragraph': {
                    return this.renderer.paragraph(this.inline.output(this.token.text));
                }
                case 'text': {
                    return this.renderer.paragraph(this.parseText());
                }
            }
        };

        /**
         * Helpers
         */

        function escape(html, encode) {
            return html
              .replace(!encode ? /&(?!#?\w+;)/g : /&/g, '&amp;')
              .replace(/</g, '&lt;')
              .replace(/>/g, '&gt;')
              .replace(/"/g, '&quot;')
              .replace(/'/g, '&#39;');
        }

        function unescape(html) {
            return html.replace(/&([#\w]+);/g, function (_, n) {
                n = n.toLowerCase();
                if (n === 'colon') return ':';
                if (n.charAt(0) === '#') {
                    return n.charAt(1) === 'x'
                      ? String.fromCharCode(parseInt(n.substring(2), 16))
                      : String.fromCharCode(+n.substring(1));
                }
                return '';
            });
        }

        function replace(regex, opt) {
            regex = regex.source;
            opt = opt || '';
            return function self(name, val) {
                if (!name) return new RegExp(regex, opt);
                val = val.source || val;
                val = val.replace(/(^|[^\[])\^/g, '$1');
                regex = regex.replace(name, val);
                return self;
            };
        }

        function noop() { }
        noop.exec = noop;

        function merge(obj) {
            var i = 1
              , target
              , key;

            for (; i < arguments.length; i++) {
                target = arguments[i];
                for (key in target) {
                    if (Object.prototype.hasOwnProperty.call(target, key)) {
                        obj[key] = target[key];
                    }
                }
            }

            return obj;
        }


        /**
         * Marked
         */

        function marked(src, opt, callback) {
            if (callback || typeof opt === 'function') {
                if (!callback) {
                    callback = opt;
                    opt = null;
                }

                opt = merge({}, marked.defaults, opt || {});

                var highlight = opt.highlight
                  , tokens
                  , pending
                  , i = 0;

                try {
                    tokens = Lexer.lex(src, opt)
                } catch (e) {
                    return callback(e);
                }

                pending = tokens.length;

                var done = function (err) {
                    if (err) {
                        opt.highlight = highlight;
                        return callback(err);
                    }

                    var out;

                    try {
                        out = Parser.parse(tokens, opt);
                    } catch (e) {
                        err = e;
                    }

                    opt.highlight = highlight;

                    return err
                      ? callback(err)
                      : callback(null, out);
                };

                if (!highlight || highlight.length < 3) {
                    return done();
                }

                delete opt.highlight;

                if (!pending) return done();

                for (; i < tokens.length; i++) {
                    (function (token) {
                        if (token.type !== 'code') {
                            return --pending || done();
                        }
                        return highlight(token.text, token.lang, function (err, code) {
                            if (err) return done(err);
                            if (code == null || code === token.text) {
                                return --pending || done();
                            }
                            token.text = code;
                            token.escaped = true;
                            --pending || done();
                        });
                    })(tokens[i]);
                }

                return;
            }
            try {
                if (opt) opt = merge({}, marked.defaults, opt);
                return Parser.parse(Lexer.lex(src, opt), opt);
            } catch (e) {
                e.message += '\nPlease report this to https://github.com/chjj/marked.';
                if ((opt || marked.defaults).silent) {
                    return '<p>An error occured:</p><pre>'
                      + escape(e.message + '', true)
                      + '</pre>';
                }
                throw e;
            }
        }

        /**
         * Options
         */

        marked.options =
        marked.setOptions = function (opt) {
            merge(marked.defaults, opt);
            return marked;
        };

        marked.defaults = {
            gfm: true,
            tables: true,
            breaks: false,
            pedantic: false,
            sanitize: false,
            smartLists: false,
            silent: false,
            highlight: null,
            langPrefix: 'lang-',
            smartypants: false,
            headerPrefix: '',
            renderer: new Renderer,
            xhtml: false
        };

        /**
         * Expose
         */

        marked.Parser = Parser;
        marked.parser = Parser.parse;

        marked.Renderer = Renderer;

        marked.Lexer = Lexer;
        marked.lexer = Lexer.lex;

        marked.InlineLexer = InlineLexer;
        marked.inlineLexer = InlineLexer.output;

        marked.parse = marked;

        if (typeof module !== 'undefined' && typeof exports === 'object') {
            module.exports = marked;
        } else if (typeof define === 'function' && define.amd) {
            define(function () { return marked; });
        } else {
            this.marked = marked;
        }

    }).call(function () {
        return this || (typeof window !== 'undefined' ? window : global);
    }());

    //"ruleapp_data.js"

    /*begin setup.js*/
    /* jshint undef: true, unused: true */
    /* global d3, demo, flare_data */

    function flare2treed(data) {
        return {
            content: data.name,
            children: data.children ? data.children.map(flare2treed) : [],
            collapsed: false
        }
    }

    var COLORS = {
        done: '#0f0',
        parent: 'lightsteelblue'
    }

    var COLORS1 = {
        done: '#00f',
        parent: 'red'
    }

    demo.run({
        data: flare2treed(ruleapp_data),
        ctrlOptions: {
            noCollapseRoot: false,
        },
        //MD: commented to remove the treeview
        //el: 'editme',
        noTitle: true
    }, initD3);

    function initD3(model, ctrl, view) {
        var margin = { top: 00, right: 0, bottom: 00, left: 50 }
          , width = 1200 - margin.right - margin.left
          , height = 850 - margin.top - margin.bottom;

        var tree = d3.layout.tree()
          .children(function (d) {
              if (!d.hidesChildren && d.children && d.collapsed && d.children.length) {
                  d.hidesChildren = true
              }
              return d.collapsed ? null : d.children
          })
          .size([height, width]);

        var diagonal = d3.svg.diagonal()
          .projection(function (d) { return [d.y, d.x]; });

        var svg = d3.select("#d3view").append("svg")
          .attr("width", width + margin.right + margin.left)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        //d3.select(self.frameElement).style("height", "auto");

        function setCollapsed(id, doCollapse) {
            ctrl.setCollapsed(id, doCollapse)
            view.startEditing(id)
        }

        var up = update.bind(null, tree, svg, setCollapsed, diagonal)

        var root = model.dumpData()
        root.x0 = height / 2;
        root.y0 = 0;
        up(root)

        ctrl.on('change', function () {
            var root = model.dumpData()
            root.x0 = height / 2;
            root.y0 = 0;
            up(root)
        })

        setTimeout(function () {
            ctrl.setCollapsed(view.root, false)
        }, 100);
    }


    function update(tree, svg, setCollapsed, diagonal, source) {
        // Compute the new tree layout.
        var nodes = tree.nodes(source).reverse(),
          links = tree.links(nodes);

        var i = 0
          , duration = 750

        var i = 0;
        var maxHeight = 0;
        var maxWidth = 0;

        // Normalize for fixed-depth.
        nodes.forEach(function (d) {
            d.y = d.depth * 300;
            if (d.y > maxHeight)
                maxHeight = d.y;
            if (d.x > maxWidth)
                maxWidth = d.x;
        });

        // Update the nodes…
        var node = svg.selectAll("g.node")
             .data(nodes, function (d) {
                 return d.id || (d.id = ++i);
             });

        // Enter any new nodes at the parent's previous position.
        var nodeEnter = node.enter().append("g")
            .attr("class", "node")
            .attr("transform", function (d) {
                var _source = d.parent || source
                return "translate(" + _source.y + "," + _source.x + ")";
            })
            .on("click", click);

        nodeEnter.append("circle")
            .attr("r", 1e-6)
            .style('stroke', function (d) {
                return !d.children && !d.hidesChildren ? COLORS1.parent : COLORS.parent;
            })
            .style("fill", function (d) {
                return !d.children && !d.hidesChildren ? COLORS1.parent : COLORS.parent;
            });

        nodeEnter.append("text")
            .attr("x", function (d) { return !d.children && !d.hidesChildren || d.depth == 0 ? 10 : -10; })
            .attr("dy", ".35em")
            .attr("text-anchor", function (d) { return (!d.children && !d.hidesChildren || d.depth == 0 ? "start" : "end"); })
            .attr("y", function (d) { return (!d.children && !d.hidesChildren || d.depth == 0) ? 0 : (d.depth % 2 == 1 ? -10 : 10); })
            .text(function (d) { return d.content; })
            .style("fill-opacity", 1e-6);

        // Transition nodes to their new position.
        var nodeUpdate = node.transition()
            .duration(duration)
            .attr("transform", function (d) {
                return "translate(" + d.y + "," + d.x + ")";
            });

        nodeUpdate.select("circle")
            .attr("r", 4.5)
            .style('stroke', function (d) {
                return !d.children && !d.hidesChildren ? COLORS1.parent : COLORS.parent;
            })
            .style("fill", function (d) {
                return !d.children && !d.hidesChildren ? COLORS1.parent : COLORS.parent;
            });

        nodeUpdate.select("text")
            .text(function (d) { return d.content; })
            .style("fill-opacity", 1);

        // Transition exiting nodes to the parent's new position.
        var nodeExit = node.exit().transition()
            .duration(duration)
            .attr("transform", function (d) {
                return "translate(" + d.parent.y + "," + d.parent.x + ")";
            })
            .remove();

        nodeExit.select("circle")
            .attr("r", 1e-6);

        nodeExit.select("text")
            .style("fill-opacity", 1e-6);

        // Update the links…
        var link = svg.selectAll("path.link")
            .data(links, function (d) { return d.target.id; });

        // Enter any new links at the parent's previous position.
        link.enter().insert("path", "g")
            .attr("class", "link")
            .attr("d", function (d) {
                var source = d.source
                var o = { x: source.x, y: source.y };
                return diagonal({ source: o, target: o });
            });

        // Transition links to their new position.
        link.transition()
            .duration(duration)
            .attr("d", diagonal);

        // Transition exiting nodes to the parent's new position.
        link.exit().transition()
            .duration(duration)
            .attr("d", function (d) {
                var o = { x: d.source.x, y: d.source.y };
                return diagonal({ source: o, target: o });
            })
            .remove();

        // Stash the old positions for transition.
        nodes.forEach(function (d) {
            d.x0 = d.x;
            d.y0 = d.y;
        });

        // Toggle children on click.
        function click(d) {
            window.external.SelectElementInIrAuthor(d.content);
            //window.external.ResizeControl(maxHeight, maxWidth);
            setCollapsed(d.id, !d.collapsed)
        };

        //var el = document.getElementById("d3view"); // or other selector like querySelector()
        //var rect = el.getBoundingClientRect(); // get the bounding rectangle

        ////window.external.ResizeControl(rect.height, rect.width);

        //alert("rect.width " + rect.width);
        //alert("rect.height " + rect.height);

        //var body = document.getElementsByTagName("BODY")[0];
        //alert("body.scrollHeight " + body.scrollHeight);
        //alert("body.scrollWidth " + body.scrollWidth);

        //alert("maxHeight " + maxHeight);
        window.external.ResizeControl(maxHeight, maxWidth);
        //window.external.ResizeControl(maxHeight, maxWidth);

    }



</SCRIPT>
    </BODY></HTML>
